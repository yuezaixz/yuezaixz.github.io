<!doctype html>



  


<html class="theme-next muse use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="react-native," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta name="description" content="介绍实际上这个例子并不需要使用react-art就能实现，但是我们将使用react-art来实现一种良好的效果。那这个例子中我们要完成的是什么呢？礼花🎉秀。并不花哨，只需要点击屏幕，一朵礼花就将要发射到你点击的地方并展开。 最终效果这就是我们要实现的效果。  start project就像普通的项目那样，创建一个空白的React-Native工程，然后把index.js里的自动生成代码改为 12">
<meta name="keywords" content="react-native">
<meta property="og:type" content="article">
<meta property="og:title" content="在React-Native应用中通过React-Art实现点击礼花效果">
<meta property="og:url" content="http://yoursite.com/2018/03/21/在React-Native应用中通过React-Art实现点击礼花效果/index.html">
<meta property="og:site_name" content="大胃吴的闲话唠嗑">
<meta property="og:description" content="介绍实际上这个例子并不需要使用react-art就能实现，但是我们将使用react-art来实现一种良好的效果。那这个例子中我们要完成的是什么呢？礼花🎉秀。并不花哨，只需要点击屏幕，一朵礼花就将要发射到你点击的地方并展开。 最终效果这就是我们要实现的效果。  start project就像普通的项目那样，创建一个空白的React-Native工程，然后把index.js里的自动生成代码改为 12">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://7oxfjd.com2.z0.glb.qiniucdn.com/2018-03-21-preview_3.gif">
<meta property="og:image" content="http://7oxfjd.com2.z0.glb.qiniucdn.com/2018-03-21-preview_1.gif">
<meta property="og:image" content="http://7oxfjd.com2.z0.glb.qiniucdn.com/2018-03-21-preview_2.gif">
<meta property="og:image" content="http://7oxfjd.com2.z0.glb.qiniucdn.com/2018-03-21-preview_3.gif">
<meta property="og:updated_time" content="2018-03-21T11:10:08.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="在React-Native应用中通过React-Art实现点击礼花效果">
<meta name="twitter:description" content="介绍实际上这个例子并不需要使用react-art就能实现，但是我们将使用react-art来实现一种良好的效果。那这个例子中我们要完成的是什么呢？礼花🎉秀。并不花哨，只需要点击屏幕，一朵礼花就将要发射到你点击的地方并展开。 最终效果这就是我们要实现的效果。  start project就像普通的项目那样，创建一个空白的React-Native工程，然后把index.js里的自动生成代码改为 12">
<meta name="twitter:image" content="http://7oxfjd.com2.z0.glb.qiniucdn.com/2018-03-21-preview_3.gif">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: 'Author'
    }
  };
</script>




  <link rel="canonical" href="http://yoursite.com/2018/03/21/在React-Native应用中通过React-Art实现点击礼花效果/"/>

  <title> 在React-Native应用中通过React-Art实现点击礼花效果 | 大胃吴的闲话唠嗑 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">大胃吴的闲话唠嗑</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">扯扯技术，唠唠闲话 交流email-xiao303178394@gmail.com</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-首页">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            menu.首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-文章">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            menu.文章
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                在React-Native应用中通过React-Art实现点击礼花效果
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Veröffentlicht am</span>
            <time itemprop="dateCreated" datetime="2018-03-21T14:15:52+08:00" content="2018-03-21">
              2018-03-21
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p>实际上这个例子并不需要使用react-art就能实现，但是我们将使用react-art来实现一种良好的效果。那这个例子中我们要完成的是什么呢？礼花🎉秀。并不花哨，只需要点击屏幕，一朵礼花就将要发射到你点击的地方并展开。</p>
<h2 id="最终效果"><a href="#最终效果" class="headerlink" title="最终效果"></a>最终效果</h2><p>这就是我们要实现的效果。</p>
<p><img src="http://7oxfjd.com2.z0.glb.qiniucdn.com/2018-03-21-preview_3.gif" alt="preview_3"></p>
<h2 id="start-project"><a href="#start-project" class="headerlink" title="start project"></a>start project</h2><p>就像普通的项目那样，创建一个空白的React-Native工程，然后把index.js里的自动生成代码改为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">import React, &#123;</div><div class="line">    Component</div><div class="line">&#125;from &apos;react&apos;;</div><div class="line"></div><div class="line">import &#123;</div><div class="line">    ART as Art,</div><div class="line">    StyleSheet,</div><div class="line">    View,</div><div class="line">    Dimensions,</div><div class="line">    TouchableWithoutFeedback,</div><div class="line">    Animated</div><div class="line">&#125; from &apos;react-native&apos;;</div><div class="line"></div><div class="line">var &#123;</div><div class="line">    width,</div><div class="line">    height</div><div class="line">&#125; = Dimensions.get(&apos;window&apos;);</div><div class="line"></div><div class="line">var &#123;</div><div class="line">    Surface,</div><div class="line">    Shape,</div><div class="line">    Path,</div><div class="line">    Group,</div><div class="line">    Transform</div><div class="line">&#125; = Art;</div><div class="line"></div><div class="line">var AnimatedShape = Animated.createAnimatedComponent(Shape);</div><div class="line">var AnimatedGroup = Animated.createAnimatedComponent(Group);</div></pre></td></tr></table></figure>
<p>我们引入了Animated API，react-art库，还有一些ART的组件。然后我要创建AnimatedShape和AnimatedGroup，这些让我们可以设置fill, opacity, x, y这些动画属性，可以让动画效果准确有效。</p>
<p>接着，我们创建styles</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">var styles = StyleSheet.create(&#123;</div><div class="line">  container: &#123;</div><div class="line">    flex: 1,</div><div class="line">    flexDirection: &apos;column&apos;</div><div class="line">  &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>是的，这就是我们动画的发生的组件了。</p>
<p>然后创建我们的组件类</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">export default class App extends Component&lt;Props&gt; &#123;</div><div class="line">    state = &#123;</div><div class="line">        fireworks: []</div><div class="line">    &#125;</div><div class="line">    render()&#123;</div><div class="line">        return (</div><div class="line">            &lt;View style=&#123;styles.container&#125;&gt;</div><div class="line">                &lt;TouchableWithoutFeedback&gt;</div><div class="line">                    &lt;View&gt;</div><div class="line">                        &lt;Surface width=&#123;width&#125; height=&#123;height&#125;&gt;</div><div class="line">                        &lt;/Surface&gt;</div><div class="line">                    &lt;/View&gt;</div><div class="line">                &lt;/TouchableWithoutFeedback&gt;</div><div class="line">            &lt;/View&gt;</div><div class="line">        );</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这样我们的启动空白工程就完成了。一个容器View，包含TouchableWithoutFeedback让我们能获取点击的坐标。在Touchable中需要有一个View在包装我们的react-art Surface组件，它可以设置宽高。我们的例子需要一个全屏的画布，所以我们通过获取屏幕尺寸并设置给Surface组件。</p>
<h2 id="让炮弹飞一会"><a href="#让炮弹飞一会" class="headerlink" title="让炮弹飞一会"></a>让炮弹飞一会</h2><p>让我们想象发送炮弹的情景：一个炮弹从屏幕底部中央处发射到我们在屏幕上点击的位置。</p>
<p>那也就是我们要通过react-art绘制一个圆；还要有一个可以触地点击事件的函数去获取我们点击的位置；还要通过Animated将圆发射到点击的位置；最后在点击的位置渲染出这个炮弹。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">&lt;TouchableWithoutFeedback onPress=&#123;this._handleAddFirework&#125;&gt;</div></pre></td></tr></table></figure>
<p>我们将使用TouchableWithoutFeedback在用户点击屏幕时候回调函数去增加礼花到队列中。然后渲染时候在队列中读取炮弹并绘制。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">class AnimatedCircle extends Component&lt;Props&gt; &#123;</div><div class="line">    render()&#123;</div><div class="line">        var radius = this.props.radius;</div><div class="line">        var path = Path().moveTo(0, -radius)</div><div class="line">            .arc(0, radius * 2, radius)</div><div class="line">            .arc(0, radius * -2, radius)</div><div class="line">            .close();</div><div class="line">        return (</div><div class="line">            &lt;AnimatedShape d=&#123;path&#125;  &#123;...this.props&#125;/&gt;</div><div class="line">        );</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>看起来我们只是把AnimatedShape包装起来，也就是组件化，这样可以尽可能是复用代码。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">const MORTAR_RADIUS = 5</div><div class="line">///...</div><div class="line">_handleAddFirework = (e) =&gt; &#123;</div><div class="line">    var _shootingPosition = new Animated.ValueXY(&#123;x: width/2, y: height - MORTAR_RADIUS&#125;);</div><div class="line"></div><div class="line">    this.state.fireworks.push(&#123;</div><div class="line">        shootingPosition: _shootingPosition,</div><div class="line">    &#125;);</div><div class="line"></div><div class="line">    Animated.timing(_shootingPosition, &#123;</div><div class="line">        duration: 300,</div><div class="line">        toValue: &#123;</div><div class="line">            y: e.nativeEvent.locationY,</div><div class="line">            x: e.nativeEvent.locationX</div><div class="line">        &#125;</div><div class="line">    &#125;).start()</div><div class="line"></div><div class="line">    this.setState(this.state);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>好的，让我们停下来分析下代码。</p>
<p>函数的第一行_shootingPosition，我们创建了一个Animated的向量值类型，这是默认值，也就是炮弹发送出来的地方，就是水平中央，并距离底部MORTAR_RADIUS的距离，使用常量方便我们修改尺寸时候可以不用修改代码，MORTAR_RADIUS会设置为5，因为我们炮弹的半径也是5.</p>
<p>然后我们将它添加到一个礼花的数组中，稍会我们就要发射他们了。</p>
<p>然后我们开始创建动画。我们想让炮弹经过300毫秒到达用户点击的位置，所以我们设置toValue为用户点击的位置。然后我们执行动画。对，我们还没有渲染任何东西但相信我马上我们就要看到第一步的效果了。</p>
<p>最后我们设置state，他会引发再渲染，然后我们就可以渲染我们的礼花了。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">&lt;Surface width=&#123;width&#125; height=&#123;height&#125;&gt;</div><div class="line">    &#123;</div><div class="line">        this.state.fireworks.map((firework, index) =&gt; &#123;</div><div class="line">            return &lt;AnimatedCircle</div><div class="line">                radius=&#123;MORTAR_RADIUS&#125;</div><div class="line">                x=&#123;firework.shootingPosition.x&#125;</div><div class="line">                y=&#123;firework.shootingPosition.y&#125;</div><div class="line">                key=&#123;&quot;circle&quot;+index&#125;</div><div class="line">                fill=&quot;#000&quot;</div><div class="line">            /&gt;</div><div class="line">        &#125;)</div><div class="line">    &#125;</div><div class="line">&lt;/Surface&gt;</div></pre></td></tr></table></figure>
<p>上面代码中我们映射了state中的每个炮弹成AnimatedCircle，并设置相应的x,y值。在我们的例子中，我们要给炮弹填充黑色为初始颜色。</p>
<p>到此位置，运行代码可以看到初步的效果了。</p>
<p><img src="http://7oxfjd.com2.z0.glb.qiniucdn.com/2018-03-21-preview_1.gif" alt="preview_1"></p>
<h2 id="消失的炮弹"><a href="#消失的炮弹" class="headerlink" title="消失的炮弹"></a>消失的炮弹</h2><p>是的，炮弹并不是这样粘贴在屏幕上的。所以我们要让他们消失。start()函数可以设置一个回调，当动画结束后会回调他。</p>
<p>所以数组中的炮弹需要唯一标识，我们可以使用shootingPosition来标识它们并过滤出他们来。</p>
<p>像下面这样</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">Animated.timing(_shootingPosition, &#123;</div><div class="line">    duration: 300,</div><div class="line">    toValue: &#123;</div><div class="line">        y: e.nativeEvent.locationY,</div><div class="line">        x: e.nativeEvent.locationX</div><div class="line">    &#125;</div><div class="line">&#125;).start(this.removeSelf.bind(this, _shootingPosition))</div><div class="line"></div><div class="line">this.setState(this.state);</div><div class="line">//...</div><div class="line"></div><div class="line">removeSelf = (_shootingPosition)=&gt; &#123;</div><div class="line">    this.setState(&#123;</div><div class="line">        fireworks: this.state.fireworks.filter((firework) =&gt; firework.shootingPosition !== _shootingPosition)</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>终于它运行起来像个炮弹了。</p>
<h2 id="逃离黑白世界"><a href="#逃离黑白世界" class="headerlink" title="逃离黑白世界"></a>逃离黑白世界</h2><p>现在我们开始让炮弹不只是一个黑点。让我们假设它是个火球，那我们可以让他在黄和橙色之间变换颜色。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">const SHOOTING_COLORS = [</div><div class="line">    &apos;rgb(234,238,112)&apos;, //Yellow</div><div class="line">    &apos;rgb(245,137,12)&apos; //Orange</div><div class="line">];</div></pre></td></tr></table></figure>
<p>我们要调用的interpolate函数只适用于rgb，因此使用rgb而不是hex。</p>
<p>现在我们就创建另一个Animated value，代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">adjustShootingFill = (_shootingColor, value) =&gt; &#123;</div><div class="line">    Animated.timing(_shootingColor, &#123;</div><div class="line">        duration: 16,</div><div class="line">        toValue: _shootingColor.__getAnimatedValue() == 0 ? 1 : 0</div><div class="line">    &#125;).start()</div><div class="line">&#125;</div><div class="line"></div><div class="line">_handleAddFirework = (e) =&gt; &#123;</div><div class="line">    var _shootingPosition = new Animated.ValueXY(&#123;x: width/2, y: height - MORTAR_RADIUS&#125;);</div><div class="line">    var _shootingColor = new Animated.Value(0);</div><div class="line"></div><div class="line">    this.state.fireworks.push(&#123;</div><div class="line">        shootingPosition: _shootingPosition,</div><div class="line">        shootingColor: _shootingColor,</div><div class="line">    &#125;);</div><div class="line"></div><div class="line">    _shootingPosition.addListener(this.adjustShootingFill.bind(null, _shootingColor));</div><div class="line"></div><div class="line">    Animated.timing(_shootingPosition, &#123;</div><div class="line">        duration: 300,</div><div class="line">        toValue: &#123;</div><div class="line">            y: e.nativeEvent.locationY,</div><div class="line">            x: e.nativeEvent.locationX</div><div class="line">        &#125;</div><div class="line">    &#125;).start(this.removeSelf.bind(this, _shootingPosition))</div><div class="line"></div><div class="line">    this.setState(this.state);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>开始我们添加了一个Animated.Value，默认设置为0.我们把它添加到我们的炮弹集合中。</p>
<p>然后我们添加了一个监听器在_shootingPosition，这样当炮弹位置发生变化的时候将调用设置的回调函数。回调中我们不断的通过变换黄和橙色。通过Animated.timing函数执行变色动画，这个动画在16内完成，__getAnimatedValue可以获取当前值并且变换成另一个。</p>
<p>所以，每16毫秒，炮弹的颜色都是黄→橙→黄→橙……循环下去。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">&lt;Surface width=&#123;width&#125; height=&#123;height&#125;&gt;</div><div class="line">    &#123;</div><div class="line">        this.state.fireworks.map((firework, index) =&gt; &#123;</div><div class="line">            var _shootingFill = firework.shootingColor.interpolate(&#123;</div><div class="line">                inputRange: [0,1],</div><div class="line">                outputRange: SHOOTING_COLORS</div><div class="line">            &#125;);</div><div class="line">            return &lt;AnimatedCircle</div><div class="line">                radius=&#123;MORTAR_RADIUS&#125;</div><div class="line">                key=&#123;&quot;circle&quot;+index&#125;</div><div class="line">                x=&#123;firework.shootingPosition.x&#125;</div><div class="line">                y=&#123;firework.shootingPosition.y&#125;</div><div class="line">                fill=&#123;_shootingFill&#125;</div><div class="line">            /&gt;</div><div class="line">        &#125;)</div><div class="line">    &#125;</div><div class="line">&lt;/Surface&gt;</div></pre></td></tr></table></figure>
<p>我们需要创建一个interpolator，它封装了Animated Value到颜色映射的逻辑，映射是像这样的</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">0 =&gt; yellow</div><div class="line">1 =&gt; orange</div></pre></td></tr></table></figure>
<p>然后，我们的效果离预期右近一步了。</p>
<p><img src="http://7oxfjd.com2.z0.glb.qiniucdn.com/2018-03-21-preview_2.gif" alt="preview_2"></p>
<h2 id="炸裂吧，炮弹"><a href="#炸裂吧，炮弹" class="headerlink" title="炸裂吧，炮弹"></a>炸裂吧，炮弹</h2><p>有趣的时间到了，炸裂吧，炮弹。</p>
<p>我们的炮弹概念非常简单，我们将创建20个向外爆开的圆，我们也可以制作各种各样的尾巴，还可以四处飞行，甚至做一些很酷的效果，但是那是之后的事情了，我们先完成这最基本的效果。</p>
<p>我们先创建一些变量。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">const PARTICLE_RADIUS = 30; // 炸开粒子的范围半径</div><div class="line">const PARTICLE_COUNT = [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20]; // 每个爆开有多少粒子</div><div class="line"></div><div class="line">//粒子的颜色变化域</div><div class="line">const PARTICLE_COLORS = [</div><div class="line">    &apos;rgba(54, 17, 52, 100)&apos;,</div><div class="line">    &apos;rgba(176, 34, 140, 100)&apos;,</div><div class="line">    &apos;rgba(234, 55, 136, 100)&apos;,</div><div class="line">    &apos;rgba(229, 107, 112, 100)&apos;,</div><div class="line">    &apos;rgba(243, 145, 160, 100)&apos;</div><div class="line">]</div></pre></td></tr></table></figure>
<p>PARTICLE_RADIUS定义了每个爆炸的范围有多大；PARTICLE_COUNT定义了粒子的数量；最后，PARTICLE_COLORS定义了粒子有多少种不同的颜色，所以，每个爆炸将在这几种颜色之间变化。<br>为了简单起见，我们将使每个粒子具有相同的颜色，这意味着我们只需要1个Animated.Value。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">var</span> _particleColor = <span class="keyword">new</span> Animated.Value(<span class="number">0</span>);</div><div class="line"><span class="keyword">var</span> _particleRadius = <span class="keyword">new</span> Animated.Value(<span class="number">0</span>);</div><div class="line"><span class="keyword">var</span> _coreOpacity = <span class="keyword">new</span> Animated.Value(<span class="number">1</span>);</div></pre></td></tr></table></figure>
<p>我们还需要一个Animated.Value作为我们的半径，默认为0，所以它开始隐藏。 另一个Animated.Value是透明的动画。当我们的炮弹炸开后隐藏它。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">var</span> _particlePositions = PARTICLE_COUNT.map(<span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">new</span> Animated.ValueXY(&#123;<span class="attr">x</span>: <span class="number">0</span>, <span class="attr">y</span>: <span class="number">0</span>&#125;));</div></pre></td></tr></table></figure>
<p>每个粒子将有不同的坐标，所以例子中我们需要20个Animated.ValueXY。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">this.state.fireworks.push(&#123;</div><div class="line">    shootingPosition: _shootingPosition,</div><div class="line">    shootingColor: _shootingColor,</div><div class="line">    particleColor: _particleColor,</div><div class="line">    particleRadius: _particleRadius,</div><div class="line">    coreOpacity: _coreOpacity,</div><div class="line">    particlePositions: _particlePositions</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>添加新的对象，过会我们就渲染它们。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">function getXYParticle(total, i, radius) &#123;</div><div class="line">    var angle = 360/total*i;</div><div class="line"></div><div class="line">    var x = Math.round((radius*2) * Math.cos(angle - (Math.PI/2)));</div><div class="line">    var y = Math.round((radius*2) * Math.sin(angle - (Math.PI/2)));</div><div class="line"></div><div class="line">    return &#123;</div><div class="line">        x: x,</div><div class="line">        y: y</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">var _animatedParticles = [</div><div class="line">    Animated.timing(_particleRadius, &#123;</div><div class="line">        duration: 700,</div><div class="line">        toValue: 1</div><div class="line">    &#125;),</div><div class="line">    Animated.timing(_coreOpacity, &#123;</div><div class="line">        duration: 200,</div><div class="line">        toValue: 0</div><div class="line">    &#125;)</div><div class="line">]</div><div class="line"></div><div class="line">var _movingParticles = _particlePositions.map((particle, i) =&gt; &#123;</div><div class="line">    var _xy = getXYParticle(PARTICLE_COUNT.length, i, PARTICLE_RADIUS);</div><div class="line">    return Animated.timing(particle, &#123;</div><div class="line">        duration: 250,</div><div class="line">        toValue: _xy</div><div class="line">    &#125;)</div><div class="line">&#125;)</div><div class="line"></div><div class="line">_animatedParticles = _animatedParticles.concat(_movingParticles);</div></pre></td></tr></table></figure>
<p>这些都是为我们接下来要做的事情做准备，将我们的动画都排成序列。</p>
<p>我们创建了一系列需要发生的动画。首先是扩展每个_particleRadius，我们已经确定完全炸开的动画时长为700毫秒。 _particleRadius实际上是粒子尺寸，也就是我们只是放大这个圆，看起来像是向外爆炸，但是这会在我们的渲染函数中显示出来。</p>
<p>我们将_coreOpacity（也就是我们的炮弹）设置为在200毫秒内消失。</p>
<p>我们需要为每个粒子创建动画，让粒子从我们目前的炮弹位置发射到粒子圆范围内的不同点。然后我们通过一个算法，计算粒子x,y的位置。</p>
<p>然后又用到Animated.timing，让粒子花费250毫秒到达它的位置。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">Animated.sequence([</div><div class="line">  Animated.timing(_shootingPosition, &#123;</div><div class="line">    duration: 300,</div><div class="line">    toValue: &#123;</div><div class="line">      y: e.nativeEvent.locationY,</div><div class="line">      x: e.nativeEvent.locationX</div><div class="line">    &#125;</div><div class="line">  &#125;),</div><div class="line">  Animated.parallel(_animatedParticles)</div><div class="line">]).start(this.removeSelf.bind(this, _shootingPosition));</div></pre></td></tr></table></figure>
<p>现在将我们的动画列队列。因为我们希望炮弹先射击，然后到达指定位置后爆炸。所以我们使用Animated.sequence实现这个先后顺序。</p>
<p>我们首先将我们的炮弹移动到用户触摸的位置。下一部分将我们所有的爆炸动画封装成Animated.parallel。这与Animated.sequence相反，它表示同时执行所有这些动画。</p>
<p>这样，我们的炮弹渐渐消失，我们的粒子膨胀，颜色变化，爆炸向外都会同时发生。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"></div><div class="line">adjustParticleFill = (_particleColor, value) =&gt; &#123;</div><div class="line">    var _currentFill = _particleColor.__getAnimatedValue(),</div><div class="line">    _particleFill = _currentFill === 5 ? 0 : _currentFill + 1;</div><div class="line"></div><div class="line">    Animated.timing(_particleColor, &#123;</div><div class="line">        duration: 16,</div><div class="line">        toValue: _particleFill</div><div class="line">    &#125;).start()</div><div class="line">&#125;</div><div class="line"></div><div class="line">_handleAddFirework = (e) =&gt; &#123;</div><div class="line">    //...</div><div class="line"></div><div class="line">    _shootingPosition.addListener(this.adjustShootingFill.bind(null, _shootingColor));</div><div class="line">    _particleRadius.addListener(this.adjustParticleFill.bind(null, _particleColor));</div><div class="line">    </div><div class="line">    //...</div><div class="line">    </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>最后我们需要去改变粒子的颜色。所以像之前那样，我们创建一个回调函数去监听粒子的半径变化。不同的是，现在我们有5种颜色需要变化。</p>
<p>现在我们要开始渲染新的效果了，我们将移到一个不同的函数里面去处理。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">&lt;Surface width=&#123;width&#125; height=&#123;height&#125;&gt;</div><div class="line">  &#123;this.getFireworks()&#125;</div><div class="line">&lt;/Surface&gt;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">getFireworks = () =&gt; &#123;</div><div class="line">       return this.state.fireworks.map((firework, i) =&gt; &#123;</div><div class="line"></div><div class="line">           var _shootingFill = firework.shootingColor.interpolate(&#123;</div><div class="line">               inputRange: [0,1],</div><div class="line">               outputRange: SHOOTING_COLORS</div><div class="line">           &#125;);</div><div class="line"></div><div class="line">           var _particleFill = firework.particleColor.interpolate(&#123;</div><div class="line">               inputRange: [0,1,2,3,4],</div><div class="line">               outputRange: PARTICLE_COLORS</div><div class="line">           &#125;);</div><div class="line"></div><div class="line">           return (</div><div class="line">               &lt;AnimatedGroup</div><div class="line">                   x=&#123;firework.shootingPosition.x&#125;</div><div class="line">                   y=&#123;firework.shootingPosition.y&#125;</div><div class="line">                   key=&#123;&quot;group_&quot;+i&#125;</div><div class="line">               &gt;</div><div class="line">                   &lt;AnimatedCircle</div><div class="line">                       opacity=&#123;firework.coreOpacity&#125;</div><div class="line">                       radius=&#123;MORTAR_RADIUS&#125;</div><div class="line">                       fill=&#123;_shootingFill&#125;</div><div class="line">                       key=&#123;&quot;circle_&quot;+i&#125;</div><div class="line">                   /&gt;</div><div class="line">                   &lt;Group&gt;</div><div class="line">                       &#123;</div><div class="line">                           PARTICLE_COUNT.map((v, j) =&gt; &#123;</div><div class="line">                               return &lt;AnimatedCircle</div><div class="line">                                   x=&#123;firework.particlePositions[j].x&#125;</div><div class="line">                                   y=&#123;firework.particlePositions[j].y&#125;</div><div class="line">                                   key=&#123;&quot;particles_&quot;+j&#125;</div><div class="line">                                   scaleX=&#123;firework.particleRadius&#125;</div><div class="line">                                   scaleY=&#123;firework.particleRadius&#125;</div><div class="line">                                   radius=&#123;PARTICLE_RADIUS&#125;</div><div class="line">                                   fill=&#123;_particleFill&#125;</div><div class="line">                               /&gt;</div><div class="line">                           &#125;)</div><div class="line">                       &#125;</div><div class="line">                   &lt;/Group&gt;</div><div class="line">               &lt;/AnimatedGroup&gt;</div><div class="line">           );</div><div class="line">       &#125;)</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<p>还是和之前变换炮弹颜色一样，我们还是使用interpolation来变化粒子的5种颜色。</p>
<p>这里不同的是使用AnimatedGroup，我们将坐标从x,y设置到AnimatedGroup中。</p>
<p>AnimatedGroup打包了炮弹和所有的粒子。这样我们可以让我们的粒子从0,0开始向外移动，AnimatedGroup将确保所有的坐标都能正确处理。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">&lt;AnimatedCircle</div><div class="line">  opacity=&#123;firework.coreOpacity&#125;</div><div class="line">  radius=&#123;MORTAR_RADIUS&#125;</div><div class="line">  fill=&#123;_shootingFill&#125;</div><div class="line">/&gt;</div></pre></td></tr></table></figure>
<p>可以看到把coreOpacity动画放在粒子这，然后他将在200毫秒内消失。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">&lt;Group&gt;</div><div class="line">  &#123;</div><div class="line">    PARTICLE_COUNT.map((v, j) =&gt; &#123;</div><div class="line">      return &lt;AnimatedCircle</div><div class="line">        x=&#123;firework.particlePositions[j].x&#125;</div><div class="line">        y=&#123;firework.particlePositions[j].y&#125;</div><div class="line">        key=&#123;&quot;particles_&quot;+j&#125;</div><div class="line">        scaleX=&#123;firework.particleRadius&#125;</div><div class="line">        scaleY=&#123;firework.particleRadius&#125;</div><div class="line">        radius=&#123;PARTICLE_RADIUS&#125;</div><div class="line">        fill=&#123;_particleFill&#125;</div><div class="line">      /&gt;</div><div class="line">    &#125;)</div><div class="line">  &#125;</div><div class="line">&lt;/Group&gt;</div></pre></td></tr></table></figure>
<p>我们把粒子都放在Group组件里。我们映射出20个粒子，x和y的值由getXYParticle函数来确定。</p>
<p>你可以注意到，我们把particleRadius传递给了scaleX和scaleY属性，因为AnimatedCircle带有的radius属性不具有可动画性，所以通过缩放到0的方式来完全隐藏。</p>
<p>这样，我们就可以将其扩大到完整的尺寸，并使其看起来像爆炸一样，这样实际上的效果更好。</p>
<p>最后我们使用在顶部定义的PARTICLE_RADIUS，也就是每个炮弹的大小，然后将_particleFill设置为这5种颜色的interpolation。</p>
<h2 id="发射"><a href="#发射" class="headerlink" title="发射"></a>发射</h2><p>完工！我们有了🎉！<br>运行起来就可以看到效果</p>
<p><img src="http://7oxfjd.com2.z0.glb.qiniucdn.com/2018-03-21-preview_3.gif" alt="preview_3"></p>
<h3 id="Final-Code"><a href="#Final-Code" class="headerlink" title="Final Code"></a>Final Code</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">import React, &#123;</div><div class="line">    Component</div><div class="line">&#125;from &apos;react&apos;;</div><div class="line"></div><div class="line">import &#123;</div><div class="line">    ART as Art,</div><div class="line">    StyleSheet,</div><div class="line">    View,</div><div class="line">    Dimensions,</div><div class="line">    TouchableWithoutFeedback,</div><div class="line">    Animated</div><div class="line">&#125; from &apos;react-native&apos;;</div><div class="line"></div><div class="line">var &#123;</div><div class="line">    width,</div><div class="line">    height</div><div class="line">&#125; = Dimensions.get(&apos;window&apos;);</div><div class="line"></div><div class="line">var &#123;</div><div class="line">    Surface,</div><div class="line">    Shape,</div><div class="line">    Path,</div><div class="line">    Group,</div><div class="line">    Transform</div><div class="line">&#125; = Art;</div><div class="line"></div><div class="line">var AnimatedShape = Animated.createAnimatedComponent(Shape);</div><div class="line">var AnimatedGroup = Animated.createAnimatedComponent(Group);</div><div class="line"></div><div class="line">const MORTAR_RADIUS = 5</div><div class="line"></div><div class="line">const SHOOTING_COLORS = [</div><div class="line">    &apos;rgb(234,238,112)&apos;, //Yellow</div><div class="line">    &apos;rgb(245,137,12)&apos; //Orange</div><div class="line">];</div><div class="line"></div><div class="line">const PARTICLE_RADIUS = 30; // 炸开粒子的范围半径</div><div class="line">const PARTICLE_COUNT = [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20]; // 每个爆开有多少粒子</div><div class="line"></div><div class="line">//粒子的颜色变化域</div><div class="line">const PARTICLE_COLORS = [</div><div class="line">    &apos;rgba(54, 17, 52, 100)&apos;,</div><div class="line">    &apos;rgba(176, 34, 140, 100)&apos;,</div><div class="line">    &apos;rgba(234, 55, 136, 100)&apos;,</div><div class="line">    &apos;rgba(229, 107, 112, 100)&apos;,</div><div class="line">    &apos;rgba(243, 145, 160, 100)&apos;</div><div class="line">]</div><div class="line"></div><div class="line">export default class App extends Component&lt;Props&gt; &#123;</div><div class="line">    state = &#123;</div><div class="line">        fireworks: []</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    adjustShootingFill = (_shootingColor, value) =&gt; &#123;</div><div class="line">        Animated.timing(_shootingColor, &#123;</div><div class="line">            duration: 16,</div><div class="line">            toValue: _shootingColor.__getAnimatedValue() == 0 ? 1 : 0</div><div class="line">        &#125;).start()</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    adjustParticleFill = (_particleColor, value) =&gt; &#123;</div><div class="line">        var _currentFill = _particleColor.__getAnimatedValue(),</div><div class="line">        _particleFill = _currentFill === 5 ? 0 : _currentFill + 1;</div><div class="line"></div><div class="line">        Animated.timing(_particleColor, &#123;</div><div class="line">            duration: 16,</div><div class="line">            toValue: _particleFill</div><div class="line">        &#125;).start()</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    _handleAddFirework = (e) =&gt; &#123;</div><div class="line">        var _shootingPosition = new Animated.ValueXY(&#123;x: width/2, y: height - MORTAR_RADIUS&#125;);</div><div class="line">        var _shootingColor = new Animated.Value(0);</div><div class="line">        var _particleColor = new Animated.Value(0);</div><div class="line">        var _particleRadius = new Animated.Value(0);</div><div class="line">        var _coreOpacity = new Animated.Value(1);</div><div class="line"></div><div class="line">        var _particlePositions = PARTICLE_COUNT.map(() =&gt; new Animated.ValueXY(&#123;x: 0, y: 0&#125;));</div><div class="line"></div><div class="line">        this.state.fireworks.push(&#123;</div><div class="line">            shootingPosition: _shootingPosition,</div><div class="line">            shootingColor: _shootingColor,</div><div class="line">            particleColor: _particleColor,</div><div class="line">            particleRadius: _particleRadius,</div><div class="line">            coreOpacity: _coreOpacity,</div><div class="line">            particlePositions: _particlePositions</div><div class="line">        &#125;);</div><div class="line"></div><div class="line">        _shootingPosition.addListener(this.adjustShootingFill.bind(null, _shootingColor));</div><div class="line">        _particleRadius.addListener(this.adjustParticleFill.bind(null, _particleColor));</div><div class="line"></div><div class="line">        function getXYParticle(total, i, radius) &#123;</div><div class="line">            var angle = 360/total*i;</div><div class="line"></div><div class="line">            var x = Math.round((radius*2) * Math.cos(angle - (Math.PI/2)));</div><div class="line">            var y = Math.round((radius*2) * Math.sin(angle - (Math.PI/2)));</div><div class="line"></div><div class="line">            return &#123;</div><div class="line">                x: x,</div><div class="line">                y: y</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        var _animatedParticles = [</div><div class="line">            Animated.timing(_particleRadius, &#123;</div><div class="line">                duration: 700,</div><div class="line">                toValue: 1</div><div class="line">            &#125;),</div><div class="line">            Animated.timing(_coreOpacity, &#123;</div><div class="line">                duration: 200,</div><div class="line">                toValue: 0</div><div class="line">            &#125;)</div><div class="line">        ]</div><div class="line"></div><div class="line">        var _movingParticles = _particlePositions.map((particle, i) =&gt; &#123;</div><div class="line">            var _xy = getXYParticle(PARTICLE_COUNT.length, i, PARTICLE_RADIUS);</div><div class="line">            return Animated.timing(particle, &#123;</div><div class="line">                duration: 250,</div><div class="line">                toValue: _xy</div><div class="line">            &#125;)</div><div class="line">        &#125;)</div><div class="line"></div><div class="line">        _animatedParticles = _animatedParticles.concat(_movingParticles);</div><div class="line"></div><div class="line">        Animated.sequence([</div><div class="line">            Animated.timing(_shootingPosition, &#123;</div><div class="line">                duration: 300,</div><div class="line">                toValue: &#123;</div><div class="line">                    y: e.nativeEvent.locationY,</div><div class="line">                    x: e.nativeEvent.locationX</div><div class="line">                &#125;</div><div class="line">            &#125;),</div><div class="line">            Animated.parallel(_animatedParticles)</div><div class="line">        ]).start(this.removeSelf.bind(this, _shootingPosition));</div><div class="line"></div><div class="line">        this.setState(this.state);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    removeSelf = (_shootingPosition)=&gt; &#123;</div><div class="line">        this.setState(&#123;</div><div class="line">            fireworks: this.state.fireworks.filter((firework) =&gt; firework.shootingPosition !== _shootingPosition)</div><div class="line">        &#125;);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    getFireworks = () =&gt; &#123;</div><div class="line">        return this.state.fireworks.map((firework, i) =&gt; &#123;</div><div class="line"></div><div class="line">            var _shootingFill = firework.shootingColor.interpolate(&#123;</div><div class="line">                inputRange: [0,1],</div><div class="line">                outputRange: SHOOTING_COLORS</div><div class="line">            &#125;);</div><div class="line"></div><div class="line">            var _particleFill = firework.particleColor.interpolate(&#123;</div><div class="line">                inputRange: [0,1,2,3,4],</div><div class="line">                outputRange: PARTICLE_COLORS</div><div class="line">            &#125;);</div><div class="line"></div><div class="line">            return (</div><div class="line">                &lt;AnimatedGroup</div><div class="line">                    x=&#123;firework.shootingPosition.x&#125;</div><div class="line">                    y=&#123;firework.shootingPosition.y&#125;</div><div class="line">                    key=&#123;&quot;group_&quot;+i&#125;</div><div class="line">                &gt;</div><div class="line">                    &lt;AnimatedCircle</div><div class="line">                        opacity=&#123;firework.coreOpacity&#125;</div><div class="line">                        radius=&#123;MORTAR_RADIUS&#125;</div><div class="line">                        fill=&#123;_shootingFill&#125;</div><div class="line">                        key=&#123;&quot;circle_&quot;+i&#125;</div><div class="line">                    /&gt;</div><div class="line">                    &lt;Group&gt;</div><div class="line">                        &#123;</div><div class="line">                            PARTICLE_COUNT.map((v, j) =&gt; &#123;</div><div class="line">                                return &lt;AnimatedCircle</div><div class="line">                                    x=&#123;firework.particlePositions[j].x&#125;</div><div class="line">                                    y=&#123;firework.particlePositions[j].y&#125;</div><div class="line">                                    key=&#123;&quot;particles_&quot;+j&#125;</div><div class="line">                                    scaleX=&#123;firework.particleRadius&#125;</div><div class="line">                                    scaleY=&#123;firework.particleRadius&#125;</div><div class="line">                                    radius=&#123;PARTICLE_RADIUS&#125;</div><div class="line">                                    fill=&#123;_particleFill&#125;</div><div class="line">                                /&gt;</div><div class="line">                            &#125;)</div><div class="line">                        &#125;</div><div class="line">                    &lt;/Group&gt;</div><div class="line">                &lt;/AnimatedGroup&gt;</div><div class="line">            );</div><div class="line">        &#125;)</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    render()&#123;</div><div class="line">        return (</div><div class="line">            &lt;View style=&#123;styles.container&#125;&gt;</div><div class="line">                &lt;TouchableWithoutFeedback onPress=&#123;this._handleAddFirework&#125; &gt;</div><div class="line">                    &lt;View&gt;</div><div class="line">                        &lt;Surface width=&#123;width&#125; height=&#123;height&#125;&gt;</div><div class="line">                            &#123;this.getFireworks()&#125;</div><div class="line">                        &lt;/Surface&gt;</div><div class="line">                    &lt;/View&gt;</div><div class="line">                &lt;/TouchableWithoutFeedback&gt;</div><div class="line">            &lt;/View&gt;</div><div class="line">        );</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">var styles = StyleSheet.create(&#123;</div><div class="line">    container: &#123;</div><div class="line">        flex: 1,</div><div class="line">        flexDirection: &apos;column&apos;</div><div class="line">    &#125;</div><div class="line">&#125;);</div><div class="line"></div><div class="line">class AnimatedCircle extends Component&lt;Props&gt; &#123;</div><div class="line">    render()&#123;</div><div class="line">        var radius = this.props.radius;</div><div class="line">        var path = Path().moveTo(0, -radius)</div><div class="line">            .arc(0, radius * 2, radius)</div><div class="line">            .arc(0, radius * -2, radius)</div><div class="line">            .close();</div><div class="line">        return (</div><div class="line">            &lt;AnimatedShape d=&#123;path&#125;  &#123;...this.props&#125;/&gt;</div><div class="line">        );</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/react-native/" rel="tag">#react-native</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/02/01/iOS低功耗蓝牙开发指西-译/" rel="next" title="iOS低功耗蓝牙开发指西[译]">
                <i class="fa fa-chevron-left"></i> iOS低功耗蓝牙开发指西[译]
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/03/26/React-Native-Animated-划重点：两个细节排查两个小时/" rel="prev" title="React-Native Animated 划重点：两个细节排查两个小时">
                React-Native Animated 划重点：两个细节排查两个小时 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            Inhaltsverzeichnis
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            Übersicht
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="David Woo" />
          <p class="site-author-name" itemprop="name">David Woo</p>
          <p class="site-description motion-element" itemprop="description"></p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/">
              <span class="site-state-item-count">112</span>
              <span class="site-state-item-name">Artikel</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              
                <span class="site-state-item-count">195</span>
                <span class="site-state-item-name">Kategorien</span>
              
            </div>
          

          
            <div class="site-state-item site-state-tags">
              
                <span class="site-state-item-count">5</span>
                <span class="site-state-item-name">Tags</span>
              
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">
            
              
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#介绍"><span class="nav-number">1.</span> <span class="nav-text">介绍</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#最终效果"><span class="nav-number">2.</span> <span class="nav-text">最终效果</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#start-project"><span class="nav-number">3.</span> <span class="nav-text">start project</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#让炮弹飞一会"><span class="nav-number">4.</span> <span class="nav-text">让炮弹飞一会</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#消失的炮弹"><span class="nav-number">5.</span> <span class="nav-text">消失的炮弹</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#逃离黑白世界"><span class="nav-number">6.</span> <span class="nav-text">逃离黑白世界</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#炸裂吧，炮弹"><span class="nav-number">7.</span> <span class="nav-text">炸裂吧，炮弹</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#发射"><span class="nav-number">8.</span> <span class="nav-text">发射</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Final-Code"><span class="nav-number">8.1.</span> <span class="nav-text">Final Code</span></a></li></ol></li></ol></div>
            
          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">David Woo</span>
</div>

<div class="powered-by">
  Erstellt mit  <a class="theme-link" href="https://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.0.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.0.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  



  




  
  

  

  

  

</body>
</html>
