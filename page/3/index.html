<!doctype html>



  


<html class="theme-next muse use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta property="og:type" content="website">
<meta property="og:title" content="大胃吴的闲话唠嗑">
<meta property="og:url" content="http://yoursite.com/page/3/index.html">
<meta property="og:site_name" content="大胃吴的闲话唠嗑">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="大胃吴的闲话唠嗑">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: 'Author'
    }
  };
</script>




  <link rel="canonical" href="http://yoursite.com/page/3/"/>

  <title> 大胃吴的闲话唠嗑 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">大胃吴的闲话唠嗑</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">扯扯技术，唠唠闲话 交流email-xiao303178394@gmail.com</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-首页">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            menu.首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-文章">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            menu.文章
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/07/13/2015-07-13-beginning-ios-pit-over-those-years-i/" itemprop="url">
                  初学IOS那些年踩过的坑（十）
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Veröffentlicht am</span>
            <time itemprop="dateCreated" datetime="2015-07-13T16:01:53+08:00" content="2015-07-13">
              2015-07-13
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="页面间pop和push导致的问题"><a href="#页面间pop和push导致的问题" class="headerlink" title="页面间pop和push导致的问题"></a>页面间pop和push导致的问题</h2><p>问题描述：问题大概是这样，一个运动中页面RunningViewController，一个首页IndexViewController，一个结果页RunResultViewController<br>运动：IndexViewController–Push–&gt;RunningViewController<br>结束：RunningViewController –Pop–&gt;IndexViewController–push–&gt;</p>
<p>结果IndexViewController的ViewWillAppear会弹出个UIAlertView，其逻辑会造成影响，在IOS8情况下UIAlertView不会弹出（应该是弹出后立马跳到了RunResultViewController），而IOS7情况下到RunResultViewController才弹出该UIAlertView。</p>
<p>该问题很简单，该逻辑其实放错位置了，应该放在ViewDidLoad中，但是从UIAlertView造成的错误逻辑去排查到该问题比较麻烦。</p>
<h2 id="TableView的load时机"><a href="#TableView的load时机" class="headerlink" title="TableView的load时机"></a>TableView的load时机</h2><p>问题描述：在使用FXForm做表单时候，在viewDidLoad中进行了初始化，但是初始化内容无效（同样也是排查比较麻烦，开始没怀疑这个问题）。IOS8是在ViewWillAppear之后（除非你调用了tableView.tableFooterView = … 之类方法，调用后）再进行loadView的操作，而IOS7则是在[super viewDidLoad]之后。最安全的做法就是在ViewWillAppear之后重新调用一次 [tableView reloadData];</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/06/29/2015-06-29-beginning-ios-pit-over-those-years-h/" itemprop="url">
                  初学IOS那些年踩过的坑（九）
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Veröffentlicht am</span>
            <time itemprop="dateCreated" datetime="2015-06-29T11:25:10+08:00" content="2015-06-29">
              2015-06-29
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="如何让小图片按钮的点击区域变大"><a href="#如何让小图片按钮的点击区域变大" class="headerlink" title="如何让小图片按钮的点击区域变大"></a>如何让小图片按钮的点击区域变大</h2><p>之前经常做的事情就是，用个imageView来放图片，然后用一个更大透明UIButton盖住他，这样有个问题就是，一旦按钮需要有点击高亮效果，就会很麻烦的（各种点击和释放的回调，然后去修改imageView的图片）。</p>
<p>最近发现了个方法，可以用setContentEdgeInsets来设置Button内容的区域。注意，top、bottom等，都是与其距离，比如bottom，就是与底部距离。开始我以为是从(left,top)到(right,bottom)这两个点的范围做图片的位置，然后导致无法得到想要的效果。</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//[self.runBtn setContentEdgeInsets:UIEdgeInsetsMake(&lt;#CGFloat top#&gt;, &lt;#CGFloat left#&gt;, &lt;#CGFloat bottom#&gt;, &lt;#CGFloat right#&gt;)];</span></div><div class="line">[<span class="keyword">self</span>.runBtn setContentEdgeInsets:<span class="built_in">UIEdgeInsetsMake</span>(<span class="number">8</span>, <span class="number">18</span>, <span class="number">8</span>, <span class="number">18</span>)];</div></pre></td></tr></table></figure>
<h2 id="view没有设置backgroundColor，setNeedsDisplay后触发drawRect，会导致重复绘制"><a href="#view没有设置backgroundColor，setNeedsDisplay后触发drawRect，会导致重复绘制" class="headerlink" title="view没有设置backgroundColor，setNeedsDisplay后触发drawRect，会导致重复绘制"></a>view没有设置backgroundColor，setNeedsDisplay后触发drawRect，会导致重复绘制</h2><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">-(<span class="keyword">void</span>)drawRect:(<span class="built_in">CGRect</span>)rect&#123;</div><div class="line"><span class="comment">//….</span></div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line">-(<span class="keyword">void</span>)touchesMoved:(<span class="built_in">NSSet</span> *)touches withEvent:(<span class="built_in">UIEvent</span> *)event&#123;</div><div class="line"><span class="comment">//….</span></div><div class="line">[<span class="keyword">self</span> setNeedsDisplay];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这时候drawRect中的内容会重复绘制，只要设置backgroundColor就不会重复绘制了。<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">lineChartView.backgroundColor = [<span class="built_in">UIColor</span> whiteColor];</div></pre></td></tr></table></figure></p>
<h2 id="ore-Data升级后导致数据升级失败"><a href="#ore-Data升级后导致数据升级失败" class="headerlink" title="ore-Data升级后导致数据升级失败"></a>ore-Data升级后导致数据升级失败</h2><p>用的是MagicRecord，AppDelegate代码中有初始化<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[MagicalRecord setupCoreDataStackWithAutoMigratingSqliteStoreNamed:SQLITE_NAME];</div><div class="line">[MagicalRecord shouldAutoCreateDefaultPersistentStoreCoordinator];</div><div class="line">[MagicalRecord setShouldDeleteStoreOnModelMismatch:<span class="literal">YES</span>];</div><div class="line">[MagicalRecord setupAutoMigratingCoreDataStack];<span class="comment">//这里报错</span></div></pre></td></tr></table></figure></p>
<p>报错内容为Can’t find or automatically infer mapping model for migration。</p>
<p>在SOF上找到了下文，具体原因不明，可能是添加版本时候有错误操作，这时候只要把版本先退回到上一个版本，然后删除新的版本，提交代码（不先提交SVN可能会出问题哦）。然后重新添加一次再提交就OK了。<br><a href="http://stackoverflow.com/questions/7708392/how-to-delete-an-old-unused-data-model-version-in-xcode-4" target="_blank" rel="external">参考</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/05/13/2015-05-13-running-and-being-reading-notes-a/" itemprop="url">
                  跑步圣经读书笔记（一）
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Veröffentlicht am</span>
            <time itemprop="dateCreated" datetime="2015-05-13T11:30:45+08:00" content="2015-05-13">
              2015-05-13
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="序——于嘉"><a href="#序——于嘉" class="headerlink" title="序——于嘉"></a>序——于嘉</h1><ul>
<li>跑步，没错——人一旦具备运动能力就会做的运动，完全渗透于我的生活中，让我时刻都能感受到它的魅力</li>
<li>我不承认跑步改变了我的生活，而是跑步成了我生活的一部分</li>
<li>这不正是生活在浮躁社会里、快节奏的生活中以及巨大压力之下的我们所迫切需要的吗？</li>
</ul>
<h1 id="序——安德鲁-希恩"><a href="#序——安德鲁-希恩" class="headerlink" title="序——安德鲁-希恩"></a>序——安德鲁-希恩</h1><ul>
<li>和他那一代的大部分人一样，大家毕业后就收起跑鞋，把全部精力奉献给工作和他的家庭（我：时代问题，美国日本都精力这段时期后开始注重运动，而我认为中国还处于这个时期，体育还未回归教育、运动精神尚难达全民，但是这几年貌似好转起来了，无数白领放弃睡懒觉开始晨跑、放弃夜店嗨开始夜跑）。</li>
</ul>
<h1 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h1><ul>
<li>跑步让这一切自然而然的发生了，创意必须是自发的，它不能被强迫，不能按照需求被生产出来。</li>
</ul>
<h1 id="第二章"><a href="#第二章" class="headerlink" title="第二章"></a>第二章</h1><ul>
<li>跑步开阔了我们的思维，把我们从每天模式化的活动或思考中挣脱出来，并重新安排我们的日常生活，比如用在吃饭、睡觉和其他休闲活动的时间。跑步不仅改变了我对工作和比赛的态度，改变了我对那些我欣赏的人和欣赏我的人的看法，还使我以一种全新的心态来体验生活——这种心态并非来源于外界，而来源于我的内心。</li>
<li>跑者们之所以选择跑步，并非他们身体单薄不适合打橄榄球，或者没有天赋打不出漂亮的冰球，而是他们真正喜欢上这项运动。跑步让人身体疲惫、肌肉酸疼，但这也不断地挑战着跑者身体的抗压能力，也正是这样的过程中，跑者充分发挥了自己的能力，并且做回真正的自己。</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/05/13/2015-05-13-beginning-ios-pit-over-those-years-g/" itemprop="url">
                  初学IOS那些年踩过的坑（八）
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Veröffentlicht am</span>
            <time itemprop="dateCreated" datetime="2015-05-13T11:25:59+08:00" content="2015-05-13">
              2015-05-13
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="毛玻璃效果实现"><a href="#毛玻璃效果实现" class="headerlink" title="毛玻璃效果实现"></a>毛玻璃效果实现</h2><p>不管是用FXBlurView还是用GPUImage实现，都会有卡顿的问题，所以在追求流畅度的时候可以考虑用一下代码替换。</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">UIVisualEffectView</span> *visualEffectView = [[<span class="built_in">UIVisualEffectView</span> alloc] initWithEffect:[<span class="built_in">UIBlurEffect</span> effectWithStyle:<span class="built_in">UIBlurEffectStyleLight</span>]];</div><div class="line">visualEffectView.frame = <span class="built_in">CGRectMake</span>(<span class="number">0</span>, _mapView.frame.size.height - <span class="keyword">self</span>.dataBed.frame.size.height, <span class="keyword">self</span>.dataBed.frame.size.width, <span class="keyword">self</span>.dataBed.frame.size.height);</div><div class="line">visualEffectView.alpha = <span class="number">0.92</span>;</div><div class="line">[_mapView addSubview:visualEffectView];</div><div class="line"></div><div class="line"><span class="comment">//注释掉的为旧代码</span></div><div class="line"><span class="comment">// if (nil == self.blurView) &#123;</span></div><div class="line"><span class="comment">// self.blurView = [[FXBlurView alloc]initWithFrame:CGRectMake(0, _mapView.frame.size.height - self.dataBed.frame.size.height, self.dataBed.frame.size.width, self.dataBed.frame.size.height)];</span></div><div class="line"><span class="comment">// [self.blurView setDynamic:YES];</span></div><div class="line"><span class="comment">// self.blurView.blurEnabled = YES;</span></div><div class="line"><span class="comment">// self.blurView.blurRadius = 5.0;</span></div><div class="line"><span class="comment">// self.blurView.tintColor = [UIColor clearColor];</span></div><div class="line"><span class="comment">// [_mapView addSubview:self.blurView];</span></div><div class="line"><span class="comment">// UIView *grayLine = [[UIView alloc]initWithFrame:CGRectMake(0, 0, self.blurView.frame.size.width, 1)];</span></div><div class="line"><span class="comment">// grayLine.backgroundColor = RUNMOVE_DARK_GRAY ;</span></div><div class="line"><span class="comment">// [self.blurView addSubview:grayLine];</span></div><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">// &#125;</span></div></pre></td></tr></table></figure>
<h2 id="NSTimer结束一定要释放"><a href="#NSTimer结束一定要释放" class="headerlink" title="NSTimer结束一定要释放"></a>NSTimer结束一定要释放</h2><p>因为NSTImer的创建会让你的ViewController计数加1，那么你的VC就不会释放，所以记得创建就一定要结束。</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//创建</span></div><div class="line">heartrateTime = [<span class="built_in">NSTimer</span> scheduledTimerWithTimeInterval:HEARTRATE_TIME_INTERVAL target:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(insertHeartrate) userInfo:<span class="literal">nil</span> repeats:<span class="literal">YES</span>];</div><div class="line"></div><div class="line"><span class="comment">//释放</span></div><div class="line"><span class="keyword">if</span> (heartrateTime) &#123;</div><div class="line">[heartrateTime invalidate];</div><div class="line">&#125;</div><div class="line">heartrateTime = <span class="literal">nil</span>;</div></pre></td></tr></table></figure>
<h2 id="CocoaPods的问题"><a href="#CocoaPods的问题" class="headerlink" title="CocoaPods的问题"></a>CocoaPods的问题</h2><p>CocoaPods的问题颇多，竟然会遇到Apple Mach-O Linker Error相关的问题，多看看错误日志进行相应的解决，大多数都是找不到目录，找不到头文件的原因，也有找不到控件.o文件的时候（原因为模拟器是i386架构，所以相应Pods的Building Setting中设置）。<br>在一切办法都无法解决时候可以试试把Pods文件（除了podfile）都删了，重新进行pod install。</p>
<h2 id="pod-install的问题"><a href="#pod-install的问题" class="headerlink" title="pod install的问题"></a>pod install的问题</h2><p>pod install后，编译出一堆问题，再删再装还是有问题，无法解决。可能是因为CocoaPods的控件缓存造成。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">rm -rf ~/Library/Caches/CocoaPods</div><div class="line">pod install</div></pre></td></tr></table></figure>
<p>就ok了</p>
<h2 id="用宏提速NSCoding"><a href="#用宏提速NSCoding" class="headerlink" title="用宏提速NSCoding"></a>用宏提速NSCoding</h2><p><a href="http://stablekernel.com/blog/speeding-up-nscoding-with-macros/" target="_blank" rel="external">http://stablekernel.com/blog/speeding-up-nscoding-with-macros/</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/05/07/2015-05-07-mysql-statistics-for-record/" itemprop="url">
                  用mysql对运动记录进行分时段统计
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Veröffentlicht am</span>
            <time itemprop="dateCreated" datetime="2015-05-07T22:11:52+08:00" content="2015-05-07">
              2015-05-07
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="为什么写"><a href="#为什么写" class="headerlink" title="为什么写"></a>为什么写</h2><p>之前做企业级应用都是使用Oracle的存储过程来做统计，用Job来定时执行。换成MySQL后一样用存储过程、视图、Event来完成相应的功能，只是函数和语法变得不大熟悉了，写篇博文来记录下。<br>这篇文章没什么特殊的，就是简单做点工作记录。</p>
<h2 id="做什么"><a href="#做什么" class="headerlink" title="做什么"></a>做什么</h2><p>其实很简单，就是每周定时执行，统计上一周各时段的运动情况总和。先来看看效果把。<br><img src="http://blog.davidandty.com/images/15/1.jpg" alt=""></p>
<h2 id="怎么做"><a href="#怎么做" class="headerlink" title="怎么做"></a>怎么做</h2><p>mysql存储过程和Oracle差别还是很大的，游标不能用了，除基础函数外的一个函数都不一致了，语法也不一样了，不好还好这些东西点点数据谷歌百度就可以查到了。</p>
<h2 id="存储过程"><a href="#存储过程" class="headerlink" title="# 存储过程"></a># 存储过程</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">CREATE</span> DEFINER=<span class="string">`runmove`</span>@<span class="string">`%`</span> <span class="keyword">PROCEDURE</span> <span class="string">`week_runcount_statistics`</span>(<span class="keyword">IN</span> last_count <span class="built_in">int</span>)</div><div class="line"><span class="keyword">BEGIN</span></div><div class="line">	<span class="keyword">Declare</span> tempDayBegin <span class="built_in">int</span>;</div><div class="line">	<span class="keyword">Declare</span> tempNightBegin <span class="built_in">int</span>;</div><div class="line">	<span class="keyword">Declare</span> timeRouteCount <span class="built_in">int</span>;</div><div class="line">	<span class="keyword">Declare</span> curr_week <span class="built_in">int</span>;</div><div class="line">    <span class="keyword">Declare</span> dateBegin <span class="built_in">Date</span>;</div><div class="line">    <span class="keyword">Declare</span> dateEnd <span class="built_in">Date</span>;</div><div class="line">	<span class="keyword">Declare</span> vSQL <span class="built_in">varchar</span>(<span class="number">2000</span>);</div><div class="line">	<span class="keyword">Declare</span> stmt <span class="built_in">varchar</span>(<span class="number">2100</span>);</div><div class="line">    <span class="keyword">set</span> tempDayBegin = <span class="number">0</span>;</div><div class="line">    <span class="keyword">set</span> tempNightBegin = <span class="number">24</span>;</div><div class="line">    if last_count = 0 then</div><div class="line">		<span class="keyword">set</span> dateEnd = <span class="built_in">date</span>(<span class="keyword">curdate</span>());</div><div class="line">		<span class="keyword">set</span> dateBegin = <span class="built_in">date</span>(<span class="keyword">date_sub</span>(<span class="keyword">curdate</span>(),<span class="built_in">interval</span> <span class="keyword">WEEKDAY</span>(<span class="keyword">curdate</span>()) <span class="keyword">day</span>));</div><div class="line">    else</div><div class="line">		if last_count = 1 then</div><div class="line">			<span class="keyword">set</span> dateEnd = <span class="built_in">date</span>(<span class="keyword">date_sub</span>(<span class="keyword">curdate</span>(),<span class="built_in">interval</span> <span class="keyword">WEEKDAY</span>(<span class="keyword">curdate</span>())+<span class="number">1</span> <span class="keyword">day</span>));</div><div class="line">			<span class="keyword">set</span> dateBegin = <span class="built_in">date</span>(<span class="keyword">date_sub</span>(dateEnd ,<span class="built_in">interval</span> <span class="number">7</span> <span class="keyword">day</span>));</div><div class="line">		else</div><div class="line">			<span class="keyword">set</span> dateEnd = <span class="built_in">date</span>(<span class="keyword">date_sub</span>(<span class="keyword">curdate</span>(),<span class="built_in">interval</span> <span class="keyword">WEEKDAY</span>(<span class="keyword">curdate</span>())+<span class="number">1</span>+(last_count<span class="number">-1</span>)*<span class="number">7</span> <span class="keyword">day</span>));</div><div class="line">			<span class="keyword">set</span> dateBegin = <span class="built_in">date</span>(<span class="keyword">date_sub</span>(dateEnd ,<span class="built_in">interval</span> <span class="number">7</span> <span class="keyword">day</span>));</div><div class="line">		<span class="keyword">end</span> <span class="keyword">if</span>;</div><div class="line">    <span class="keyword">end</span> <span class="keyword">if</span>;</div><div class="line">    <span class="keyword">delete</span> <span class="keyword">from</span> route_statistics_by_week <span class="keyword">where</span> <span class="keyword">week</span> = <span class="keyword">YEARWEEK</span>(dateBegin);</div><div class="line"></div><div class="line">    <span class="keyword">set</span> vSQL = <span class="string">' '</span>;</div><div class="line">	<span class="keyword">set</span> vSQL=<span class="keyword">CONCAT</span>(vSQL,<span class="string">' insert into route_statistics_by_week'</span>);</div><div class="line">	<span class="keyword">set</span> vSQL=<span class="keyword">CONCAT</span>(vSQL,<span class="string">' values ( date("'</span>,<span class="keyword">date_format</span>(dateBegin,<span class="string">'%Y-%m-%d'</span>),<span class="string">'"),date("'</span>,<span class="keyword">date_format</span>(dateEnd,<span class="string">'%Y-%m-%d'</span>),<span class="string">'"),'</span>,<span class="keyword">YEARWEEK</span>(dateBegin));</div><div class="line"></div><div class="line">    while tempDayBegin &lt; tempNightBegin do</div><div class="line"></div><div class="line">		<span class="keyword">SELECT</span> <span class="keyword">count</span>(r.id) <span class="keyword">into</span> timeRouteCount <span class="keyword">FROM</span> runmove.route r</div><div class="line">		<span class="keyword">WHERE</span> r.device_detail <span class="keyword">not</span> <span class="keyword">like</span> <span class="string">'%Simulator%'</span> <span class="keyword">and</span> r.flag = <span class="number">1</span> <span class="keyword">and</span></div><div class="line">        <span class="keyword">YEARWEEK</span>(<span class="keyword">date_format</span>(r.create_date,<span class="string">'%Y-%m-%d'</span>)) = <span class="keyword">YEARWEEK</span>(<span class="keyword">now</span>())-last_count <span class="keyword">and</span></div><div class="line">        (<span class="keyword">DATE_FORMAT</span>(r.create_date,<span class="string">'%H'</span>) <span class="keyword">between</span> tempDayBegin <span class="keyword">and</span> (tempDayBegin+<span class="number">1</span>) )</div><div class="line">		<span class="keyword">order</span> <span class="keyword">by</span> create_date <span class="keyword">desc</span>;</div><div class="line">		<span class="keyword">set</span> vSQL=<span class="keyword">CONCAT</span>(vSQL,<span class="string">','</span>,timeRouteCount);</div><div class="line"></div><div class="line">        <span class="keyword">set</span> tempDayBegin = tempDayBegin + <span class="number">1</span>;</div><div class="line"></div><div class="line">    <span class="keyword">end</span> <span class="keyword">while</span>;</div><div class="line">    <span class="keyword">set</span> vSQL=<span class="keyword">CONCAT</span>(vSQL,<span class="string">' )'</span>);</div><div class="line">    <span class="keyword">set</span> @sqltext:=vSQL;</div><div class="line">	<span class="keyword">prepare</span> stmt <span class="keyword">from</span> @sqltext;</div><div class="line">	<span class="keyword">execute</span> stmt;</div><div class="line"></div><div class="line"><span class="keyword">END</span></div></pre></td></tr></table></figure>
<h2 id="定时作业"><a href="#定时作业" class="headerlink" title="# 定时作业"></a># 定时作业</h2><p>event和Oracle的job定义逻辑也差不多，就是语法不大一样。</p>
<figure class="highlight sql"><figcaption><span>event</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">CREATE</span>  <span class="keyword">EVENT</span> <span class="keyword">IF</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span>  STAT</div><div class="line"><span class="keyword">ON</span>  SCHEDULE  EVERY  <span class="number">7</span>  <span class="keyword">DAY</span>  STARTS <span class="keyword">DATE_ADD</span>(<span class="keyword">DATE_ADD</span>(<span class="keyword">DATE_SUB</span>(<span class="keyword">CURDATE</span>(),<span class="built_in">INTERVAL</span> <span class="keyword">WEEKDAY</span>(<span class="keyword">CURDATE</span>())<span class="number">-1</span> <span class="keyword">DAY</span>), <span class="built_in">INTERVAL</span> <span class="number">7</span> <span class="keyword">DAY</span>),<span class="built_in">INTERVAL</span> <span class="number">1</span> <span class="keyword">HOUR</span>)</div><div class="line"><span class="keyword">ON</span>  COMPLETION  <span class="keyword">PRESERVE</span>  <span class="keyword">ENABLE</span></div><div class="line"><span class="keyword">DO</span> <span class="keyword">CALL</span> week_runcount_statistics(<span class="number">1</span>);</div></pre></td></tr></table></figure>
<p>为了显示效果，所以再加了一个视图去显示。</p>
<h2 id="视图"><a href="#视图" class="headerlink" title="# 视图"></a># 视图</h2><figure class="highlight sql"><figcaption><span>view</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">CREATE</span></div><div class="line">    ALGORITHM = UNDEFINED</div><div class="line">    DEFINER = <span class="string">`runmove`</span>@<span class="string">`%`</span></div><div class="line">    <span class="keyword">SQL</span> <span class="keyword">SECURITY</span> DEFINER</div><div class="line"><span class="keyword">VIEW</span> <span class="string">`v_route_statistics_by_week`</span> <span class="keyword">AS</span></div><div class="line">    <span class="keyword">SELECT</span></div><div class="line">        <span class="string">`route_statistics_by_week`</span>.<span class="string">`week`</span> <span class="keyword">AS</span> <span class="string">`week`</span>,</div><div class="line">        <span class="string">`route_statistics_by_week`</span>.<span class="string">`start_date`</span> <span class="keyword">AS</span> <span class="string">`start_date`</span>,</div><div class="line">        <span class="string">`route_statistics_by_week`</span>.<span class="string">`end_date`</span> <span class="keyword">AS</span> <span class="string">`end_date`</span>,</div><div class="line">        <span class="string">`route_statistics_by_week`</span>.<span class="string">`time_zone0`</span> <span class="keyword">AS</span> <span class="string">`0~1`</span>,</div><div class="line">        <span class="string">`route_statistics_by_week`</span>.<span class="string">`time_zone1`</span> <span class="keyword">AS</span> <span class="string">`1~2`</span>,</div><div class="line">        <span class="string">`route_statistics_by_week`</span>.<span class="string">`time_zone2`</span> <span class="keyword">AS</span> <span class="string">`2~3`</span>,</div><div class="line">        <span class="string">`route_statistics_by_week`</span>.<span class="string">`time_zone3`</span> <span class="keyword">AS</span> <span class="string">`3~4`</span>,</div><div class="line">        <span class="string">`route_statistics_by_week`</span>.<span class="string">`time_zone4`</span> <span class="keyword">AS</span> <span class="string">`4~5`</span>,</div><div class="line">        <span class="string">`route_statistics_by_week`</span>.<span class="string">`time_zone5`</span> <span class="keyword">AS</span> <span class="string">`5~6`</span>,</div><div class="line">        <span class="string">`route_statistics_by_week`</span>.<span class="string">`time_zone6`</span> <span class="keyword">AS</span> <span class="string">`6~7`</span>,</div><div class="line">        <span class="string">`route_statistics_by_week`</span>.<span class="string">`time_zone7`</span> <span class="keyword">AS</span> <span class="string">`7~8`</span>,</div><div class="line">        <span class="string">`route_statistics_by_week`</span>.<span class="string">`time_zone8`</span> <span class="keyword">AS</span> <span class="string">`8~9`</span>,</div><div class="line">        <span class="string">`route_statistics_by_week`</span>.<span class="string">`time_zone9`</span> <span class="keyword">AS</span> <span class="string">`9~10`</span>,</div><div class="line">        <span class="string">`route_statistics_by_week`</span>.<span class="string">`time_zone10`</span> <span class="keyword">AS</span> <span class="string">`10~11`</span>,</div><div class="line">        <span class="string">`route_statistics_by_week`</span>.<span class="string">`time_zone11`</span> <span class="keyword">AS</span> <span class="string">`11~12`</span>,</div><div class="line">        <span class="string">`route_statistics_by_week`</span>.<span class="string">`time_zone12`</span> <span class="keyword">AS</span> <span class="string">`12~13`</span>,</div><div class="line">        <span class="string">`route_statistics_by_week`</span>.<span class="string">`time_zone13`</span> <span class="keyword">AS</span> <span class="string">`13~14`</span>,</div><div class="line">        <span class="string">`route_statistics_by_week`</span>.<span class="string">`time_zone14`</span> <span class="keyword">AS</span> <span class="string">`14~15`</span>,</div><div class="line">        <span class="string">`route_statistics_by_week`</span>.<span class="string">`time_zone15`</span> <span class="keyword">AS</span> <span class="string">`15~16`</span>,</div><div class="line">        <span class="string">`route_statistics_by_week`</span>.<span class="string">`time_zone16`</span> <span class="keyword">AS</span> <span class="string">`16~17`</span>,</div><div class="line">        <span class="string">`route_statistics_by_week`</span>.<span class="string">`time_zone17`</span> <span class="keyword">AS</span> <span class="string">`17~18`</span>,</div><div class="line">        <span class="string">`route_statistics_by_week`</span>.<span class="string">`time_zone18`</span> <span class="keyword">AS</span> <span class="string">`18~19`</span>,</div><div class="line">        <span class="string">`route_statistics_by_week`</span>.<span class="string">`time_zone19`</span> <span class="keyword">AS</span> <span class="string">`19~20`</span>,</div><div class="line">        <span class="string">`route_statistics_by_week`</span>.<span class="string">`time_zone20`</span> <span class="keyword">AS</span> <span class="string">`20~21`</span>,</div><div class="line">        <span class="string">`route_statistics_by_week`</span>.<span class="string">`time_zone21`</span> <span class="keyword">AS</span> <span class="string">`21~22`</span>,</div><div class="line">        <span class="string">`route_statistics_by_week`</span>.<span class="string">`time_zone22`</span> <span class="keyword">AS</span> <span class="string">`22~23`</span>,</div><div class="line">        <span class="string">`route_statistics_by_week`</span>.<span class="string">`time_zone23`</span> <span class="keyword">AS</span> <span class="string">`23~00`</span></div><div class="line">    <span class="keyword">FROM</span></div><div class="line">        <span class="string">`route_statistics_by_week`</span></div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/05/07/2015-05-07-2015-04-20-beginning-ios-pit-over-those-years-f/" itemprop="url">
                  初学IOS那些年踩过的坑（七）
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Veröffentlicht am</span>
            <time itemprop="dateCreated" datetime="2015-05-07T14:21:16+08:00" content="2015-05-07">
              2015-05-07
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="地图的View退到后台后导致闪退"><a href="#地图的View退到后台后导致闪退" class="headerlink" title="地图的View退到后台后导致闪退"></a>地图的View退到后台后导致闪退</h2><p>错误信息为gpus_ReturnNotPermittedKillClient</p>
<h2 id="事因"><a href="#事因" class="headerlink" title="# 事因"></a># 事因</h2><p>情况大概是这样的，中间有个版本因为地图占用了内存，所以在4S上会有内存不足闪退的原因，然后做了一次修改就是进入后台的时候把地图销毁了，具体代码如下。</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[[<span class="built_in">NSNotificationCenter</span> defaultCenter] addObserver:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(applicationDidEnterBackgroundNotification:) name:RMApplicationDidEnterBackgroundNotification object:<span class="literal">nil</span>];</div><div class="line">[[<span class="built_in">NSNotificationCenter</span> defaultCenter] addObserver:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(applicationDidWillEnterForegroundNotification:) name:RMApplicationDidWillEnterForegroundNotification object:<span class="literal">nil</span>];</div></pre></td></tr></table></figure>
<p>销毁代码如下</p>
<figure class="highlight objc"><figcaption><span>RMMapView.m</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)applicationDidEnterBackgroundNotification:(<span class="built_in">NSNotification</span> *)notification &#123;</div><div class="line">    <span class="keyword">if</span> ([<span class="keyword">self</span> viewController] == [<span class="keyword">self</span> topViewController]) &#123;</div><div class="line">        [<span class="keyword">self</span> setHiddenMap:<span class="literal">YES</span>];</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)applicationDidWillEnterForegroundNotification:(<span class="built_in">NSNotification</span> *)notification &#123;</div><div class="line">    <span class="keyword">if</span> ([<span class="keyword">self</span> viewController] == [<span class="keyword">self</span> topViewController]) &#123;</div><div class="line">        [<span class="keyword">self</span> setHiddenMap:<span class="literal">NO</span>];</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)setHiddenMap:(<span class="built_in">BOOL</span>)hiddenMap &#123;</div><div class="line">    <span class="keyword">if</span> (hiddenMap == _hiddenMap) &#123;</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">self</span>.hidden = hiddenMap;</div><div class="line">    _hiddenMap = hiddenMap;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (hiddenMap) &#123;</div><div class="line">        <span class="keyword">if</span> (_mapViewClient) &#123;</div><div class="line">            _latitudeDelta = [_mapViewClient getMapRegionLatitudeDelta];</div><div class="line">            _longitudeDelta = [_mapViewClient getMapRegionLatitudeDelta];</div><div class="line">            _coordinate = [_mapViewClient getMapCenterLocationCoordinate2D];</div><div class="line">            [_mapViewClient removeMapView];</div><div class="line">            _changedMapLevel = <span class="literal">NO</span>;</div><div class="line">            _mapViewClient = <span class="literal">nil</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">else</span> &#123;</div><div class="line">        <span class="keyword">if</span> ([_mapViewClient getMapView] == <span class="literal">nil</span>) &#123;</div><div class="line"><span class="comment">//            [self performSelector:@selector(createMap) withObject:nil afterDelay:0.5];</span></div><div class="line">            _changedMapLevel = <span class="literal">NO</span>;</div><div class="line">            [<span class="keyword">self</span> createMap];</div><div class="line">            [<span class="keyword">self</span> drawLineForMapView];</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight objc"><figcaption><span>MapViewClient.m</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)removeMapView &#123;</div><div class="line">    <span class="keyword">if</span> (<span class="literal">nil</span> != mainMapView) &#123;</div><div class="line">        [mainMapView removeFromSuperview];</div><div class="line">    &#125;</div><div class="line">    mainMapView = <span class="literal">nil</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>然后就偶尔会出现退到后台会闪退的原因。Google了一些资料算是把自己误导了。<br>回答的意思基本上是销毁的方法不对（可能确实是销毁的有问题），但是回答也基本上都是设置成nil，要不就把delegate=nil，尝试了都没效果，还是一直会闪退。</p>
<h2 id="解决"><a href="#解决" class="headerlink" title="# 解决"></a># 解决</h2><p>最后换了个思路，放弃销毁，把销毁的代码全部去了，只是在地图的代理方法里加判断，判断是否为Active，不是则不执行。暂时测试还未发现闪退问题</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> ([<span class="built_in">UIApplication</span> sharedApplication].applicationState != <span class="built_in">UIApplicationStateActive</span>) &#123;</div><div class="line">    <span class="keyword">return</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/05/06/2015-05-06-whats-the-fucker-programmer/" itemprop="url">
                  程序员何苦为难程序员系列
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Veröffentlicht am</span>
            <time itemprop="dateCreated" datetime="2015-05-06T15:56:08+08:00" content="2015-05-06">
              2015-05-06
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="呵呵"><a href="#呵呵" class="headerlink" title="呵呵"></a>呵呵</h2><p>最近都在做UI，初学IOS那些年系列呵呵的进展很慢，然后又挖了一个坑来作死，充分发扬了一贯不负责任的传统。</p>
<h2 id="为啥呵呵"><a href="#为啥呵呵" class="headerlink" title="为啥呵呵"></a>为啥呵呵</h2><p>最近做的一个功能是把轨迹在服务端生成地图轨迹图片，然后存在小米的CDN上。然后功能都做好了，发现IOS客户端上图片无法显示，使用的SDWebImage，代码如下。</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[cell.leftTrackImageView sd_setImageWithURL:[<span class="built_in">NSURL</span> URLWithString:leftUrl]];</div></pre></td></tr></table></figure>
<p>报错信息如下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Error Domain=NSURLErrorDomain Code=406 &quot;The operation couldn’t be completed. (NSURLErrorDomain error 406.)&quot;</div></pre></td></tr></table></figure></p>
<h2 id="如何不呵呵"><a href="#如何不呵呵" class="headerlink" title="如何不呵呵"></a>如何不呵呵</h2><p>用charles拦截请求,可以看到请求头</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">Host: cdn.fds.api.xiaomi.com</div><div class="line">Accept-Encoding: gzip, deflate</div><div class="line">Accept: image/webp,image/*;q=0.8</div><div class="line">Accept-Language: zh-cn</div><div class="line">Connection: keep-alive</div><div class="line">User-Agent: Runmove/110 CFNetwork/711.2.23 Darwin/14.0.0</div></pre></td></tr></table></figure>
<p>然后用python的requests库来请求，发现可以正常获得，那看看python请求和相应的headers把。<br>请求如下：</p>
<figure class="highlight"><figcaption><span>request.headers</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&#123;'Connection': 'keep-alive', 'Accept-Encoding': 'gzip, deflate', 'Accept': '*/*', 'User-Agent': 'python-requests/2.6.0 CPython/2.7.6 Darwin/14.3.0'&#125;</div></pre></td></tr></table></figure>
<p>响应如下：</p>
<figure class="highlight"><figcaption><span>response.headers</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&#123;'content-length': '68236', 'access-control-allow-headers': 'DNT,X-Mx-ReqToken,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Authorization,Content-MD5', 'proxy-connection': 'Keep-alive', 'access-control-max-age': '1728000', 'cache-control': 'max-age=86400', 'x-via': '1.1 zw11:8080 (Cdn Cache Server V2.0), 1.1 xiazai199:4 (Cdn Cache Server V2.0)', 'server': 'Tengine', 'content-md5': 'b4f3f2a873822d8f56ef928ef0587b8b', 'last-modified': 'Wed, 06 May 2015 03:20:02 GMT', 'access-control-allow-credentials': 'true', 'date': 'Wed, 06 May 2015 11:55:34 GMT', 'access-control-allow-methods': 'GET, POST, PUT, HEAD, DELETE, OPTIONS', 'content-type': 'image/jpeg'&#125;</div></pre></td></tr></table></figure>
<p>发现客户端请求的Accept包含上面响应头的content-type（image/webp,image/<em>;q=0.8和image/jpeg）。而上面请求的请求头的Accept为</em>/*，这为默认的值，也是范围最广的。那么我在Python把请求头修改下试试。</p>
<h2 id="偷天换日"><a href="#偷天换日" class="headerlink" title="偷天换日"></a>偷天换日</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">headers = &#123;<span class="string">'Accept'</span>: <span class="string">'image/webp,image/*;q=0.8'</span>&#125;</div><div class="line">r = requests.get(<span class="string">'http://cdn.fds.api.xiaomi.com/ir-heatmap/pathmap/colorline/8122/53d501c213ba564c9958ead983d1b9c014ae2630-s788_640.jpg'</span>,headers=headers)</div><div class="line"><span class="comment">#r:&lt;Response [406]&gt;</span></div></pre></td></tr></table></figure>
<p>呵呵重现了，嘿嘿。果然是小米那帮坑货，对请求头做了限制。</p>
<h2 id="如何不呵呵-1"><a href="#如何不呵呵-1" class="headerlink" title="如何不呵呵"></a>如何不呵呵</h2><p>既然发现了原理，那么怎么可以不呵呵呢？<br>首先考虑，如果不设置，Accept应该是*/*的，肯定是被修改了，那么来看看SDWebImage的源码把。</p>
<figure class="highlight objc"><figcaption><span>SDWebImageDownloader.m</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">_HTTPHeaders = [<span class="built_in">NSMutableDictionary</span> dictionaryWithObject:<span class="string">@"image/webp,image/*;q=0.8"</span></div><div class="line">                                                  forKey:<span class="string">@"Accept"</span>];</div></pre></td></tr></table></figure>
<p>原来是SDWebImage内部修改了请求头，那么我们把它修改下就好了，SDWebImageDownloader是个单例，修改一次就全局修改了。</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[SDWebImageDownloader.sharedDownloader setValue:<span class="string">@"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8"</span></div><div class="line">                             forHTTPHeaderField:<span class="string">@"Accept"</span>];</div></pre></td></tr></table></figure>
<p>问题解决。</p>
<h2 id="呵呵总结"><a href="#呵呵总结" class="headerlink" title="呵呵总结"></a>呵呵总结</h2><p>程序员何苦为难程序员啊，挖了这么一个坑，谢谢你祖宗啊。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/04/20/2015-04-20-beginning-ios-pit-over-those-years-e/" itemprop="url">
                  初学IOS那些年踩过的坑（六）
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Veröffentlicht am</span>
            <time itemprop="dateCreated" datetime="2015-04-20T08:54:00+08:00" content="2015-04-20">
              2015-04-20
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>0、实现类似Eclipse的cmd+shift+r打开指定函数<br>一直以为没这功能，今天算发现了。在Xcode中可以用control+6打开所有函数的导航，然后可以进行输入检索，也可以按control+a显示所有。</p>
<p>1、用IOS自带NSJSONSerialization 去把Foundation对象转成JSON串在NSNumber转换精度上存在问题<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">NSMutableArray</span> *pointArray = [[<span class="built_in">NSMutableArray</span> alloc] init];</div><div class="line"><span class="keyword">for</span> (RunningPoint *point <span class="keyword">in</span> pointEnityArray) &#123;</div><div class="line">[pointArray addObject:@&#123;</div><div class="line"><span class="string">@"latitude"</span> : point.latitude,</div><div class="line"><span class="string">@"longitude"</span> : point.longitude,</div><div class="line"><span class="string">@"chinaLatitude"</span> : point.chinaLatitude,</div><div class="line"><span class="string">@"chinaLongitude"</span> : point.chinaLongitude,</div><div class="line"><span class="string">@"isCorrect"</span> : point.isCorrect,</div><div class="line"><span class="string">@"distance"</span> : point.distance,</div><div class="line"><span class="string">@"altitude"</span> : point.altitude,</div><div class="line"><span class="string">@"speed"</span> : point.speed,</div><div class="line"><span class="string">@"mark"</span> : point.mark,</div><div class="line"><span class="string">@"pause_mark"</span> : point.pauseMark,</div><div class="line"><span class="string">@"britishMark"</span> : point.britishMark,</div><div class="line"><span class="string">@"running_time"</span> : point.runningTime,</div><div class="line"><span class="string">@"step_count"</span> : point.stepCount,</div><div class="line"><span class="string">@"collect_time"</span> : [point.collectTime toString],</div><div class="line"><span class="string">@"step_count"</span> : point.stepCount,</div><div class="line"><span class="string">@"running_time"</span>: point.runningTime,</div><div class="line">&#125;];</div><div class="line">&#125;</div><div class="line">running.pointsData = [<span class="built_in">NSKeyedArchiver</span> archivedDataWithRootObject:pointArray];</div></pre></td></tr></table></figure></p>
<p>改为<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> (RunningPoint *point <span class="keyword">in</span> pointEnityArray) &#123;</div><div class="line">[pointArray addObject:@&#123;</div><div class="line"><span class="string">@"latitude"</span> : [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"%f"</span>,point.latitude.doubleValue],</div><div class="line"><span class="string">@"longitude"</span> : [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"%f"</span>,point.longitude.doubleValue],</div><div class="line"><span class="string">@"chinaLatitude"</span> : [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"%f"</span>,point.chinaLatitude.doubleValue],</div><div class="line"><span class="string">@"chinaLongitude"</span> : [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"%f"</span>,point.chinaLongitude.doubleValue],</div><div class="line"><span class="string">@"isCorrect"</span> : point.isCorrect,</div><div class="line"><span class="string">@"distance"</span> : point.distance,</div><div class="line"><span class="string">@"altitude"</span> : point.altitude,</div><div class="line"><span class="string">@"speed"</span> : point.speed,</div><div class="line"><span class="string">@"mark"</span> : point.mark,</div><div class="line"><span class="string">@"pause_mark"</span> : point.pauseMark,</div><div class="line"><span class="string">@"britishMark"</span> : point.britishMark,</div><div class="line"><span class="string">@"running_time"</span> : point.runningTime,</div><div class="line"><span class="string">@"step_count"</span> : point.stepCount,</div><div class="line"><span class="string">@"collect_time"</span> : [point.collectTime toString],</div><div class="line"><span class="string">@"step_count"</span> : point.stepCount,</div><div class="line"><span class="string">@"running_time"</span>: point.runningTime,</div><div class="line">&#125;];</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>2、table header and footer的高度问题<br>问题描述：这几天在重构一个页面，那个页面有一个tableview，因为重构把它从漂浮出来改成了加在底部。<br>结果在底部的tableview最地上出现了一个空行，因为没遇到过这种问题，也不知道那个界面是什么引起的。<br>问题排查：经过有经验的同事提示，知道了这类问题的排查方式。就是用模拟器运行，然后如下图打开。<br><img src="http://chuantu.biz/t2/3/1429520293x-954497745.jpg" alt=""><br>然后在界面上找到不知来历的界面，就会看到提示这是啥。<br><img src="http://chuantu.biz/t2/3/1429520387x1822611348.jpg" alt=""><br>原来是下面这个tableView的HeaderFooterView啊。那么怎么去掉他呢<br>要排查两个方面，一是代码中<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">- (<span class="built_in">CGFloat</span>)tableView:(<span class="built_in">UITableView</span> *)tableView heightForHeaderInSection:(<span class="built_in">NSInteger</span>)section &#123;</div><div class="line"></div><div class="line"><span class="keyword">return</span> <span class="number">50.0</span>f;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>而是nib文件中设置，如下图。这样这个问题应该就解决了。<br><img src="http://chuantu.biz/t2/3/1429520410x1822611348.jpg" alt=""></p>
<p>3、用了autolayout的界面中，要怎么实现位移动画呢？</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//x,y,z动画要偏移的量</span></div><div class="line"><span class="built_in">CATransform3D</span> transform = <span class="built_in">CATransform3DMakeTranslation</span>(x, y, z);</div><div class="line"><span class="built_in">CABasicAnimation</span> *animation = [<span class="built_in">CABasicAnimation</span> animationWithKeyPath:<span class="string">@"transform"</span>];</div><div class="line"><span class="comment">//view为要进行动画的view</span></div><div class="line">animation.fromValue = [view.layer.presentationLayer valueForKey:animation.keyPath];</div><div class="line">animation.toValue = [<span class="built_in">NSValue</span> valueWithCATransform3D:transform];</div><div class="line"><span class="comment">//opacityAnimation.timingFunction 是用来控制动画线性发展。</span></div><div class="line"><span class="comment">//其中[CAMediaTimingFunction functionWithControlPoints:1.0 :0.0 :1.0 :0.1] 是一个贝塞尔曲线的控制方法。</span></div><div class="line"><span class="comment">//这也可以令动画做到先慢后快或先快后慢的结果。</span></div><div class="line"><span class="comment">//效果参考http://netcetera.org/camtf-playground.html</span></div><div class="line">animation.timingFunction = [<span class="built_in">CAMediaTimingFunction</span> functionWithControlPoints:<span class="number">0</span> :size :<span class="number">0</span> :size*<span class="number">2</span>];</div><div class="line">animation.duration = <span class="number">0.6</span>;</div><div class="line">view.layer.transform = transform;</div><div class="line">[view.layer addAnimation:animation forKey:animation.keyPath];</div></pre></td></tr></table></figure>
<p>除此之外，用这种方式还可以做移动中大小变化<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">float</span> bigInfoViewScale = scale*<span class="number">0.6</span> + <span class="number">0.4</span>;</div><div class="line"><span class="keyword">float</span> bigInfoViewY = -GET(<span class="number">200</span>) + GET(<span class="number">200</span>) * scale;</div><div class="line"><span class="built_in">CATransform3D</span> scaleTransform = <span class="built_in">CATransform3DMakeScale</span>(bigInfoViewScale, bigInfoViewScale, <span class="number">1</span>);</div><div class="line"><span class="built_in">CATransform3D</span> transform = <span class="built_in">CATransform3DTranslate</span>(scaleTransform, <span class="number">0</span>, bigInfoViewY, <span class="number">0</span>);</div><div class="line"></div><div class="line"><span class="built_in">CABasicAnimation</span> *animation = [<span class="built_in">CABasicAnimation</span> animationWithKeyPath:<span class="string">@"transform"</span>];</div><div class="line">animation.fromValue = [<span class="keyword">self</span>.bigInfoView.layer.presentationLayer valueForKey:animation.keyPath];</div><div class="line">animation.toValue = [<span class="built_in">NSValue</span> valueWithCATransform3D:transform];</div><div class="line">animation.timingFunction = [<span class="built_in">CAMediaTimingFunction</span> functionWithControlPoints:<span class="number">0.3</span> :<span class="number">0.5</span> :<span class="number">0.9</span> :<span class="number">1.275</span>];</div><div class="line">animation.duration = duration;</div><div class="line"></div><div class="line"><span class="keyword">self</span>.bigInfoView.layer.transform = transform;</div><div class="line">[<span class="keyword">self</span>.bigInfoView.layer addAnimation:animation forKey:animation.keyPath];</div></pre></td></tr></table></figure></p>
<p>4、ViewController中，当一个界面只有一个scrollView时候，scrollView会自动偏移一个状态栏的高度<br>在ViewController的ViewDidLoad中加入下面代码可解决该问题。<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">self</span>.automaticallyAdjustsScrollViewInsets = <span class="literal">NO</span>;</div></pre></td></tr></table></figure></p>
<p>5、IOS中做类似GIF的动画<br>其实只要为每一帧切一张图，然后用如下代码就Ok了。<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">NSArray</span> *images = @[[<span class="built_in">UIImage</span> imageNamed:<span class="string">@"step1"</span>], [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"step2"</span>], [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"step3"</span>]];</div><div class="line"><span class="built_in">UIImage</span> *animateImage = [<span class="built_in">UIImage</span> animatedImageWithImages:images duration:<span class="number">1.2</span>];</div><div class="line"><span class="built_in">UIImageView</span> *imageView = [[<span class="built_in">UIImageView</span> alloc] initWithImage:animateImage];</div><div class="line"><span class="comment">// 默认是0 0代表无限循环</span></div><div class="line">imageView.animationRepeatCount = <span class="number">0</span>;</div><div class="line">[imageView startAnimating];</div></pre></td></tr></table></figure></p>
<p>6、主界面使用scrollView后，nib文件有警告<br>has ambigous scrollable content height<br>原因：scrollView需要确定的contentSize，而subViews并没有足够的约束可以确定contentSize<br>解决：在scrollView中套一层view，设置如下图<br><img src="http://chuantu.biz/t2/3/1429520432x1822611348.jpg" alt=""></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/03/07/2015-03-07-beginning-ios-pit-over-those-years-d/" itemprop="url">
                  初学IOS那些年踩过的坑(五)
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Veröffentlicht am</span>
            <time itemprop="dateCreated" datetime="2015-03-07T06:33:00+08:00" content="2015-03-07">
              2015-03-07
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>#集成友盟后报错<br>LOG：<br>15-02-12 09:26:47.206 Runmove[2532:13249] NSScanner: nil string argument<br>2015-02-12 09:26:47.206 Runmove[2532:13249] Umeng: Read binary image info failed!</p>
<p>其实不是友盟问题，是自己程序中有了个错误，只是打开了友盟的调试开关，所以报了友盟错误。<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//    [MobClick setLogEnabled:YES];</span></div></pre></td></tr></table></figure></p>
<p>注释该行代码后可以正常报告出程序中的异常</p>
<p>#tableview下方空白处的seprator line去除<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">self</span>.tableView.tableFooterView = [<span class="built_in">UIView</span> new];</div></pre></td></tr></table></figure></p>
<p>#navigationbar的左滑返回<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">    <span class="keyword">self</span>.navigationItem.leftBarButtonItem = [[<span class="built_in">UIBarButtonItem</span> alloc]</div><div class="line">                                         initWithImage:img</div><div class="line">                                         style:<span class="built_in">UIBarButtonItemStylePlain</span></div><div class="line">                                         target:<span class="keyword">self</span></div><div class="line">                                         action:<span class="keyword">@selector</span>(onBack:)];</div><div class="line"><span class="keyword">self</span>.navigationController.interactivePopGestureRecognizer.delegate = (<span class="keyword">id</span>)<span class="keyword">self</span>;</div></pre></td></tr></table></figure></p>
<p>#使用nib做界面，但是layoutAttribute有些又需要根据适配来适配，nib+手写混写好烦恼啊，感觉睡不着觉了<br>其实错了，混写其实很简单的，可以像拉button一样的拉你的约束.nslayoutattribute也是可以拉线的，这样一切都太平了</p>
<p>#画面不流畅可能是因为一些透明视图影响了fps，可以去掉这些透明视图<br>方法：Product-&gt;Profile-&gt;Core Animation-&gt;右下第二个选项卡中勾上Color Blended Layers<br>然后看到红色的就都是透明的视图，不需要透明效果的可以去掉透明</p>
<p>#UITableView拉倒底部最后行只显示一半问题<br>原因：计算UITableView高度的时候按整个屏幕来计算了，NavigationBar的高度被忽略。所以就少算了NavigationBar高度。</p>
<p>#UILongPressGestureRecognizer会触发两次，分别是开始和结束<br>所以如果只想触发一次，就需要加个判断了。<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">-(<span class="keyword">void</span>)longPress:(<span class="built_in">UILongPressGestureRecognizer</span> *)sender</div><div class="line">&#123;</div><div class="line">    <span class="keyword">if</span> (sender.state == <span class="built_in">UIGestureRecognizerStateBegan</span>) &#123;</div><div class="line">        [<span class="keyword">self</span> yourMethod];</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>#简单实现下拉到底刷新数据<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">-(void)scrollViewDidEndDecelerating:(UIScrollView *)scrollView</div><div class="line">&#123;</div><div class="line">    if([_photos count] &gt;= LOAD_COUNT_DEFAULT*(_loadPage+1) &amp;&amp; scrollView.contentOffset.y + (scrollView.frame.size.height) &gt; scrollView.contentSize.height*0.8)&#123;</div><div class="line">        [[RunService sharedInstance] loadPhotosWithPage:(_loadPage+1) count:LOAD_COUNT_DEFAULT complete:^(NSArray *photos) &#123;</div><div class="line">            _loadPage++;</div><div class="line">            [_photos addObjectsFromArray:photos];</div><div class="line">            [self loadPhoto];</div><div class="line">        &#125;                                         fail:^(NSString *msg) &#123;</div><div class="line">            </div><div class="line">        &#125;];</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>#数据持久化到NSUserDefaults<br>需要数据持久化的对象必须实现NSCoding<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#import <span class="meta-string">"NSObject+NSCoding.h"</span></span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ServerPhoto</span> : <span class="title">NSObject</span> &lt;<span class="title">NSCoding</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>实现文件中还要重写2个方法<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)encodeWithCoder:(<span class="built_in">NSCoder</span> *)coder &#123;</div><div class="line">    [<span class="keyword">self</span> autoEncodeWithCoder:coder];</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="keyword">id</span>)initWithCoder:(<span class="built_in">NSCoder</span> *)coder &#123;</div><div class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> init]) &#123;</div><div class="line">        [<span class="keyword">self</span> autoDecode:coder];</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>持久化<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">NSUserDefaults</span> *udf = [<span class="built_in">NSUserDefaults</span> standardUserDefaults];</div><div class="line"><span class="built_in">NSData</span> *photosData = [<span class="built_in">NSKeyedArchiver</span> archivedDataWithRootObject:_photos];</div><div class="line">[udf setObject:photosData forKey:_dataCacheName];</div><div class="line">[udf synchronize];</div></pre></td></tr></table></figure></p>
<p>反持久化<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">NSUserDefaults</span> *udf = [<span class="built_in">NSUserDefaults</span> standardUserDefaults];</div><div class="line"><span class="built_in">NSData</span> *data = [udf objectForKey:_dataCacheName];</div><div class="line"><span class="built_in">NSMutableArray</span> *photoData = [<span class="built_in">NSKeyedUnarchiver</span> unarchiveObjectWithData:data];</div><div class="line"><span class="keyword">if</span> (photoData &amp;&amp; photoData.count &gt; <span class="number">0</span>) &#123;</div><div class="line">    _photos = photoData;</div><div class="line">    [_photoTableView reloadData];</div><div class="line">&#125;</div><div class="line"><span class="keyword">else</span> &#123;</div><div class="line">    [SVProgressHUD showWithStatus:<span class="string">@"加载数据中"</span>];</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>10、SDWebImage<br>options用SDWebImageHighPriority，优先级高的话，会及时写入到磁盘<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[leftImageView sd_setImageWithURL:[<span class="built_in">NSURL</span> URLWithString:leftPhotoUrl] placeholderImage:[<span class="built_in">UIImage</span> new] options:SDWebImageHighPriority];</div></pre></td></tr></table></figure></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/02/28/2015-02-28-ios-common-library/" itemprop="url">
                  IOS常用库
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Veröffentlicht am</span>
            <time itemprop="dateCreated" datetime="2015-02-28T02:51:00+08:00" content="2015-02-28">
              2015-02-28
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>CoreData :MagicRecord<br>网络请求：AFNetworking<br>JSON处理：jsonKit<br>文件监控：UMAnalytics<br>网络图片加载和缓存：SDWebImage<br>扁平化风格按钮：FlatPillButton<br>协助调试：iconsole<br>加载等待框：SVProgressHUD<br>高德地图：AMap<br>地图轨迹绘制：GradientPolyline<br>图表绘制：CorePlot<br>圆环进度指示：DACircularProgress<br>网络状态监测：Reachability<br>快速集成下拉刷新：MJRefresh  </p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/11/">11</a><a class="extend next" rel="next" href="/page/4/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="David Woo" />
          <p class="site-author-name" itemprop="name">David Woo</p>
          <p class="site-description motion-element" itemprop="description"></p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/">
              <span class="site-state-item-count">110</span>
              <span class="site-state-item-name">Artikel</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              
                <span class="site-state-item-count">195</span>
                <span class="site-state-item-name">Kategorien</span>
              
            </div>
          

          
            <div class="site-state-item site-state-tags">
              
                <span class="site-state-item-count">5</span>
                <span class="site-state-item-name">Tags</span>
              
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">David Woo</span>
</div>

<div class="powered-by">
  Erstellt mit  <a class="theme-link" href="https://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  



  




  
  

  

  

  

</body>
</html>
