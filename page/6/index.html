<!doctype html>



  


<html class="theme-next muse use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta property="og:type" content="website">
<meta property="og:title" content="大胃吴的闲话唠嗑">
<meta property="og:url" content="http://yoursite.com/page/6/index.html">
<meta property="og:site_name" content="大胃吴的闲话唠嗑">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="大胃吴的闲话唠嗑">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: 'Author'
    }
  };
</script>




  <link rel="canonical" href="http://yoursite.com/page/6/"/>

  <title> 大胃吴的闲话唠嗑 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">大胃吴的闲话唠嗑</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">扯扯技术，唠唠闲话 交流email-xiao303178394@gmail.com</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-首页">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            menu.首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-文章">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            menu.文章
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2014/11/21/2014-11-21-programming-and-mathematics/" itemprop="url">
                  编程与数学
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Veröffentlicht am</span>
            <time itemprop="dateCreated" datetime="2014-11-21T04:43:00+08:00" content="2014-11-21">
              2014-11-21
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">in</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Python/" itemprop="url" rel="index">
                    <span itemprop="name">Python</span>
                  </a>
                </span>

                
                
                  . 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Python/函数/" itemprop="url" rel="index">
                    <span itemprop="name">函数</span>
                  </a>
                </span>

                
                
                  . 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Python/函数/LeetCode/" itemprop="url" rel="index">
                    <span itemprop="name">LeetCode</span>
                  </a>
                </span>

                
                
                  . 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Python/函数/LeetCode/链表循环起点/" itemprop="url" rel="index">
                    <span itemprop="name">链表循环起点</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>#瞎扯<br>这几天抽空在做<a href="https://oj.leetcode.com/problems" target="_blank" rel="external">leetcode</a>，越做越有种工作越久数学退化越厉害的感觉，很多题目有点数学方面的思维都会更容易很多，这边博文就拿一道找链表循环起点的题目来分析下。</p>
<p>#Linked List Cycle II</p>
<h2 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h2><p>Given a linked list, return the node where the cycle begins. If there is no cycle, return null.<br>Follow up:<br>Can you solve it without using extra space?</p>
<h2 id="解析"><a href="#解析" class="headerlink" title="解析"></a>解析</h2><p>这道题目分两部分，第一部分是求是否存在循环，这很简单，设置两个点去遍历链表，其中一个点一次移动一个节点，另一个一次移动两个，因此他们肯定会相遇，只要求是否相遇就能知道是否存在循环。<br>那么，如何求循环的起点呢？先看下这个图<br><img src="http://chuantu.biz/t/17/1416544742x1822610959.jpg" alt=""><br>图中从head到起点距离为x，相遇点里起点为y，周长为L，相遇时fast节点已经走了n次循环。<br>那么，设lSlow为相遇时慢节点走过的距离，lFast为相遇时快节点走过的距离<br>那么，lSlow = x+y ; lFast = x+y+n*L;lFast = 2lSlow;<br>从上面几个算式可以推导出，x = n*L - y<br>左边加1个L减1个L, x = (n-1)*L + (L-y)<br>转换成中文就是“Head到循环起点的距离 等于 几个循环 + 相遇点到循环起点的距离 ”<br>那么，把slow点丢回Head处，两个点同时一次走一个点的前进，那么slow点走过x后就会在循环起点处与fast点相遇，这样就可以求出相遇点。</p>
<h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><p>按上面思路，代码就可以这样写</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Definition for singly-linked list.</span></div><div class="line"><span class="comment"># class ListNode:</span></div><div class="line"><span class="comment">#     def __init__(self, x):</span></div><div class="line"><span class="comment">#         self.val = x</span></div><div class="line"><span class="comment">#         self.next = None</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></div><div class="line">    <span class="comment"># @param head, a ListNode</span></div><div class="line">    <span class="comment"># @return a boolean</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">detectCycle</span><span class="params">(self, head)</span>:</span></div><div class="line">        <span class="keyword">if</span> <span class="keyword">not</span> head <span class="keyword">or</span> <span class="keyword">not</span> head.next: <span class="keyword">return</span> <span class="keyword">None</span></div><div class="line">        slow = fast = head</div><div class="line">        <span class="keyword">while</span> fast <span class="keyword">and</span> fast.next:</div><div class="line">            fast = fast.next.next</div><div class="line">            slow = slow.next</div><div class="line">            <span class="keyword">if</span> fast == slow:</div><div class="line">                slow = head</div><div class="line">                <span class="keyword">while</span> slow != fast:</div><div class="line">                    fast = fast.next</div><div class="line">                    slow = slow.next</div><div class="line">                <span class="keyword">return</span> slow</div><div class="line">        <span class="keyword">return</span> <span class="keyword">None</span></div></pre></td></tr></table></figure>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>不要死脑筋思考逻辑问题，其实用高中的数学就能很好的解决该问题。通过这道题，也增加了一点以后写程序的思维方式吧。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2014/11/20/2014-11-20-november-2014-startup-weekend-summary/" itemprop="url">
                  2014年11月创业周末小结
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Veröffentlicht am</span>
            <time itemprop="dateCreated" datetime="2014-11-20T05:44:00+08:00" content="2014-11-20">
              2014-11-20
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">in</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/创业/" itemprop="url" rel="index">
                    <span itemprop="name">创业</span>
                  </a>
                </span>

                
                
                  . 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/创业/总结/" itemprop="url" rel="index">
                    <span itemprop="name">总结</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="简单总结"><a href="#简单总结" class="headerlink" title="简单总结"></a>简单总结</h2><p>Talk is cheap ,show me the work.</p>
<h2 id="啰嗦的总结"><a href="#啰嗦的总结" class="headerlink" title="啰嗦的总结"></a>啰嗦的总结</h2><p>以下总结可能语言略显尖锐，只是个人争对过程中出现的问题，用尖锐的方式来让自己记好这些问题。</p>
<p>#个人</p>
<ul>
<li>能力上很欠缺，论深度不足，论广度也不足，技能不够全面，对于App这一块基本无经验；</li>
<li>没组织意识，有时候已经发现其中问题，但是有种事不关己，任由其发展；</li>
<li>在恶劣环境下快速休息恢复体力不足，导致熬夜过多后体力不足，零碎的时间又休息质量差；</li>
<li>特殊情况下随机应变能力不足。</li>
</ul>
<p>#团队</p>
<ul>
<li>Leader很关键，业务场景的选择、市场及用户分析、清晰的蓝图和快速动手的意识非常关键，拿着一个原型再开始瞎扯总比指着空气好，如果你Talking more than working,please go home.Don’t kidding me.</li>
<li>产品经理很重要，如果产品经理无法明确核心价值和关键特性，只是说要有个地图，要有人在地图上移动，要能发言这些显性特性，那么我觉得你还是回家洗洗睡吧，别出来坑程序员</li>
<li>人员合理分配很重要，产品、市场、设计、研发需要均等，指手画脚漫天想象的人太多了，不利于产品，就算同时有Facebook，Google、twitter这么多个伟大的想法，也无法实践；</li>
<li>创业团队虽然不能像大组织那样条条框框，规矩连起来可以绕地球一圈，但至少开会讨论什么的，要有主持人控制时间，要有发起人说明清晰的目的和期望结果，要有人做记录，很多伟大的想法就是这样在指缝间溜走的。能说会道不如白板上写写画画，难道你写的难看画的扭曲我就会笑你吗？</li>
</ul>
<p>#产品的策划</p>
<ul>
<li>用户为什么用？内容提供者为什么提供（如何给内容提供者成就感和利益链）？</li>
<li>如何建立生态链？现有用户还是先有商家？</li>
<li>Leader要能一句话说明产品，内容包括解决问题和为什么做这个</li>
<li>用数据说服VO等。</li>
</ul>
<p>#产品的设计</p>
<ul>
<li>从Web交互到App交互的转变，APP的操作一般就是点、拉、拖拽</li>
<li>开始不要考虑框架规范什么的，最早那一套肯定是会推翻重做的，把他当做简单的Demo就好，重点在验证猜想</li>
</ul>
<p>#工作方式</p>
<ul>
<li>不到万不得已别熬夜，特别是因为没有目的的讨论去熬夜</li>
<li>每个人必须全能，至少能做很多事情，在资源稀缺的情况下，产品经理会切图都显得异常有价值</li>
<li>动手，动手，再动手。</li>
<li>发布，反馈，优化，发布，优化掉所有竞争对手</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2014/11/17/2014-11-17-my-resume/" itemprop="url">
                  我的简历
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Veröffentlicht am</span>
            <time itemprop="dateCreated" datetime="2014-11-17T14:49:00+08:00" content="2014-11-17">
              2014-11-17
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">in</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/个人简历/" itemprop="url" rel="index">
                    <span itemprop="name">个人简历</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="基础资料"><a href="#基础资料" class="headerlink" title="#基础资料"></a>#基础资料</h2><h2 id="吴迪玮"><a href="#吴迪玮" class="headerlink" title="吴迪玮"></a>吴迪玮</h2><p>男 | 本科 | 厦门理工学院 07~11 | 计算机科学与技术 | 三年工作经验<br>13599915039 | xiao303178394@gmail.com<br>Blog: <a href="http://yuezaixz.logdown.com/" target="_blank" rel="external">http://yuezaixz.logdown.com/</a><br>Github:<a href="https://github.com/yuezaixz" target="_blank" rel="external">https://github.com/yuezaixz</a></p>
<h2 id="工作经历"><a href="#工作经历" class="headerlink" title="#工作经历"></a>#工作经历</h2><h2 id="厦门巨龙信息科技有限公司-运维平台研发组组长-2012-11-现在"><a href="#厦门巨龙信息科技有限公司-运维平台研发组组长-2012-11-现在" class="headerlink" title="厦门巨龙信息科技有限公司 | 运维平台研发组组长 | 2012-11 - 现在"></a>厦门巨龙信息科技有限公司 | 运维平台研发组组长 | 2012-11 - 现在</h2><h2 id="厦门海迈科技股份有限公司-V3产品JAVA工程师-2011-02-2012-07"><a href="#厦门海迈科技股份有限公司-V3产品JAVA工程师-2011-02-2012-07" class="headerlink" title="厦门海迈科技股份有限公司 | V3产品JAVA工程师 | 2011-02 - 2012-07"></a>厦门海迈科技股份有限公司 | V3产品JAVA工程师 | 2011-02 - 2012-07</h2><h2 id="技术技能"><a href="#技术技能" class="headerlink" title="#技术技能"></a>#技术技能</h2><ul>
<li>在当前项目中负责架构设计、产品设计等工作，有一定相关经验；</li>
<li>熟练Java，3年的生产开发经验，由于所在团队一直采用敏捷开发，所以对设计接触的也较早较多，对于面对对象开发及设计模式、主流框架使用设计都有较深入掌握；</li>
<li>熟练Javascript，有一定基于jQuery、原型的组件开发经验，也熟悉Javascript的服务器端开发，如Node.js；</li>
<li>对Python及其Django框架通过自学有一定了解；</li>
<li>熟悉Sublime、Eclipse等开发，对IntelliJ、Vim使用也有过一些尝试；</li>
<li>熟悉敏捷Scrum开发，并有过组织敏捷转型经验，也有一年的敏捷项目管理经验；</li>
</ul>
<h2 id="主要项目经历"><a href="#主要项目经历" class="headerlink" title="#主要项目经历"></a>#主要项目经历</h2><p>#巨龙综合运维平台<br>2013年9月，由于该产品原定研发经理临时被调剂去协助另一个项目，所以在部门资源比较紧缺的情况下我申请负责该项目。接手之前由于原项目经理主要为兼职，推动的速度较慢，当时只完成了前期策划评估调研阶段。之后我推动了研发团队组建、需求分析、原型设计、架构框架设计、规范过程设计等。<br>该产品解决的主要问题为传统运维存在技术门槛高、无标准化、效率低、不及时性、无规范流程、成果不容易体现、无法考核等问题，该产品提供自动化的设备（如服务器、数据库）、应用、业务监控报警，产生运维工作并通过流程流转处置，处置的情况及运维情况都会是考核依据，处置的内容会归纳入知识库，最后通过报表、档案和图表的方式进行展现。</p>
<h2 id="用到的技术"><a href="#用到的技术" class="headerlink" title="用到的技术"></a>用到的技术</h2><ul>
<li>基于JAVA的S1SH，在S1基础上封装了一层，在实现Struts2基本功能同时又保持着比较好的轻量级、可裁剪、可扩展等功能；</li>
<li>基于Oracle数据库，由于一些业务数据的监控，数据库压力较大，因此使用Oracle比较合适；</li>
<li>基于Websphere6.1，这点取决于公司运维团队在该技术上有较好的基础，方便现场部署实施；</li>
<li>自己设计开发了一些JS组件，功能包括页面加载、弹窗、表单校验、Ajax方法封装、分页组件、模板引擎、自定义标签、气泡提示信息、所见即所得的调试、可视化关系图、可视化流程配置等；</li>
</ul>
<h2 id="技术细节"><a href="#技术细节" class="headerlink" title="技术细节"></a>技术细节</h2><p>该产品我参与了大多数核心模块的设计及开发，比如Struts1封装改造、JS组件开发、监控引擎、两级平台业务数据比对、设备关系预览页面、可视化流程页面、数据分析展现等。<br>项目迭代中也不断重构，比如监控模块的重构，当时写了一篇博文来总结，<a href="http://yuezaixz.logdown.com/posts/200757-jobs-and-bezos-product-monitoring-subsystem-module-refactoring" target="_blank" rel="external">地址</a>。<br>也做了一些组件开发，比如分页组件，在后端是定义了一个PageInfo的类，该类中有单页展现数量、当前页、最大页、排序字段、排序方式、数据列表等字段。封装的BaseDao采用策略模式，根据配置不同的数据库类型会组装不同的分页查询方法来修改PageInfo的值。页面上记录PageInfo中的相关属性，比如修改了单页跳数就会发起一个请求，根据当前页面的数据服务url，带上PageInfo中的相关参数发起刷新页面的请求。</p>
<p>#海迈清单造价平台V3</p>
<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>2011年我作为实习生参与了海迈清单造价系列产品的开发，该项目为C/S架构，该产品采用敏捷Scrum开发，把持动态经营、有损服务的策略，加入开发组时该产品差不多已经发布了10来个版本了，每个迭代版本都是在完善旧功能和实现新需求。<br>该产品的主要功能为根据手动填入清单定额或者导入海迈算量文件来生成工程造价，解决了以往造价工程投标中计算复杂、门槛高、效率低、成果无法复用、结果不准确等问题。</p>
<h2 id="用到的技术-1"><a href="#用到的技术-1" class="headerlink" title="用到的技术"></a>用到的技术</h2><ul>
<li>基于JAVA的Spring框架，自己通过DB-Util封装了持久化层；</li>
<li>基于RCP插件式开发，前端为SWT技术，数据库为DB2；</li>
<li>报表是使用IReport，在之上自己封装了数据字典等功能；</li>
</ul>
<h2 id="技术细节-1"><a href="#技术细节-1" class="headerlink" title="技术细节"></a>技术细节</h2><p>比如在该项目中做过的一个比较大的模块为撤销重做，主要用了命令模式，首先要把所有需要撤销重做的功能都重构成Command的实现类，Command接口有do、redo、undo函数，do和redo都会记录执行前需要记录的状态，undo则是将数据返回到那个记录的状态。另外用了一个堆栈CommandHistory去记录操作，do或redo后Command入栈，撤销则将顶层的command出栈执行undo操作。另外通过一个CommandManger类作为控制器，做一些命令的管理操作。比如根据配置的最大可撤销重做步数来限制堆栈的长度（不限制长度可能会内存溢出，因为有的command记录的数据量较多）。</p>
<h2 id="自我评价"><a href="#自我评价" class="headerlink" title="#自我评价"></a>#自我评价</h2><ul>
<li>善于思考总结，但在落地上执行力度不足，努力在试错中成长，不让错误重现；</li>
<li>乐爱编程，对于新技术保持好奇心，也不断巩固已掌握的知识；</li>
<li>崇尚工具，乐于学习新工具来提高效率，也相信方法论，特别是在时间管理上；</li>
<li>乐于分享，也乐于把学习、总结、工作中的经验写成博客；</li>
<li>擅长沟通，也通过项目组管理的经验对解决项目组成员沟通问题有一定经验；</li>
<li>乐爱运动，有时间都会去进行篮球、足球、羽毛球运动，没时间时候也会抽空跑跑步；</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2014/11/14/2014-11-14-yield-function-to-resolve-function-returns-a-list-of-all-the-questions/" itemprop="url">
                  yield函数，解决函数返回列表时的种种问题
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Veröffentlicht am</span>
            <time itemprop="dateCreated" datetime="2014-11-14T07:37:00+08:00" content="2014-11-14">
              2014-11-14
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>在开发中可能经常碰到这样的问题，举个比较简单的场景描述，比如我要获取1-100的整数集合，那么我第一反应会这样想这个函数。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getNumList</span><span class="params">(<span class="keyword">int</span> max)</span></span>&#123;</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; max; i++) &#123;</div><div class="line">		System.out.println(i);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>那么这么写的缺点有哪些呢？就是我无法获得这个集合，那么好吧，我就修改下这个函数。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> List&lt;IntegergetNumList(<span class="keyword">int</span> max)&#123;</div><div class="line">	List&lt;IntegernumList = <span class="keyword">new</span> ArrayList&lt;Integer&gt;();</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; max; i++) &#123;</div><div class="line">		numList.add(i);</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> numList;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>好了，这样是不是问题解决了，这篇博文就到这了呢？不是，这样还有个问题，就是当列表元素占用内存过大，并且列表元素过多时，这样操作是非常占用内存的。<br>好吧，有人说，他知道这么解决这个问题，多简单，看如下代码。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">NumList</span> <span class="keyword">implements</span> <span class="title">Iterable</span>&lt;<span class="title">Integer</span>&gt;</span>&#123;</div><div class="line">	<span class="keyword">private</span> <span class="keyword">int</span> index;</div><div class="line">	<span class="keyword">private</span> <span class="keyword">int</span> max;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="title">NumList</span><span class="params">(<span class="keyword">int</span> max)</span></span>&#123;</div><div class="line">		index = <span class="number">1</span>;</div><div class="line">		<span class="keyword">this</span>.max = max;</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="keyword">public</span> Iterator&lt;Integeriterator() &#123;</div><div class="line">		<span class="keyword">return</span> <span class="keyword">new</span> NumIterator();</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="class"><span class="keyword">class</span> <span class="title">NumIterator</span> <span class="keyword">implements</span> <span class="title">Iterator</span>&lt;<span class="title">Integer</span></span>&#123;</div><div class="line">		</div><div class="line">		</div><div class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasNext</span><span class="params">()</span> </span>&#123;</div><div class="line">			<span class="keyword">return</span> index != max;</div><div class="line">		&#125;</div><div class="line">		</div><div class="line">		<span class="function"><span class="keyword">public</span> Integer <span class="title">next</span><span class="params">()</span> </span>&#123;</div><div class="line">			<span class="keyword">return</span> ++index;</div><div class="line">		&#125;</div><div class="line">		</div><div class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">()</span> </span>&#123;</div><div class="line">			index++;</div><div class="line">		&#125;</div><div class="line">		</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>没错，用迭代器这问题是解决了，但是，这样的设计有点过于复杂。感觉小题大做了。在JAVA中有没有方法可以快速解决这个问题呢？我感觉是没有啦，那就让我们看看今天的主角，yield在python中是如何使用的。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">def numList(max): </div><div class="line">    n = 1</div><div class="line">    while n &lt;= max: </div><div class="line">    		# print n</div><div class="line">        yield n </div><div class="line">        n = n + 1</div><div class="line">def read_file(fpath): </div><div class="line">    BLOCK_SIZE = 1024 </div><div class="line">    with open(fpath, &apos;rb&apos;) as f: </div><div class="line">        while True: </div><div class="line">            block = f.read(BLOCK_SIZE) </div><div class="line">            if block: </div><div class="line">                yield block </div><div class="line">            else: </div><div class="line">                return</div><div class="line">def main():</div><div class="line">    for num in numList(10):</div><div class="line">        print num</div><div class="line"></div><div class="line">    for content in read_file(&apos;../README.md&apos;):</div><div class="line">        print content</div></pre></td></tr></table></figure></p>
<p>两个函数，第一个函数就是返回数列，是不是很神奇。简单地讲，yield 的作用就是把一个函数变成一个 generator，带有 yield 的函数不再是一个普通函数，Python 解释器会将其视为一个 generator，调用 fab(5) 不会执行 fab 函数，而是返回一个 iterable 对象！在 for 循环执行时，每次循环都会执行 fab 函数内部的代码，执行到 yield b 时，fab 函数就返回一个迭代值，下次迭代时，代码从 yield b 的下一条语句继续执行，而函数的本地变量看起来和上次中断执行前是完全一样的，于是函数继续执行，直到再次遇到 yield。也可以手动调用 fab(5) 的 next() 方法（因为 fab(5) 是一个 generator 对象，该对象具有 next() 方法），这样我们就可以更清楚地看到 fab 的执行流程：<br>在一个 generator function 中，如果没有 return，则默认执行至函数完毕，如果在执行过程中 return，则直接抛出 StopIteration 终止迭代。<br>一个带有 yield 的函数就是一个 generator，它和普通函数不同，生成一个 generator 看起来像函数调用，但不会执行任何函数代码，直到对其调用 next()（在 for 循环中会自动调用 next()）才开始执行。虽然执行流程仍按函数的流程执行，但每执行到一个 yield 语句就会中断，并返回一个迭代值，下次执行时从 yield 的下一个语句继续执行。看起来就好像一个函数在正常执行的过程中被 yield 中断了数次，每次中断都会通过 yield 返回当前的迭代值。</p>
<p>yield 的好处是显而易见的，把一个函数改写为一个 generator 就获得了迭代能力，比起用类的实例保存状态来计算下一个 next() 的值，不仅代码简洁，而且执行流程异常清晰。</p>
<p>如何判断一个函数是否是一个特殊的 generator 函数？可以利用 isgeneratorfunction 判断：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> inspect <span class="keyword">import</span> isgeneratorfunction </div><div class="line"><span class="keyword">print</span> isgeneratorfunction(numList)</div></pre></td></tr></table></figure></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2014/11/13/2014-11-13-problems-in-learning-django-framework-ii/" itemprop="url">
                  Django框架学习中的问题（二）
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Veröffentlicht am</span>
            <time itemprop="dateCreated" datetime="2014-11-13T15:19:00+08:00" content="2014-11-13">
              2014-11-13
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>#Django的工作原理<br>感觉大多数框架形形色色的思路基本都是一致的，就是哪些框架更灵活，哪些框架的去侵入性做的更好，哪些框架的中间件的拔插方式更方便，哪些框架的语法糖更易用，哪些框架带来了更大的生产力。<br>像Java中的SSH，基本都是带侵入式的，比如你要把Hibernate换成Mybatis基本上会头疼致死，而Django只需要修改下settings.py文件。<br>像Java中你需要添加很多拦截器来起到中间件效果，通过拦截器也使这些拦截器不再耦合，不过这些中间件基本上要针对你MVC各层框架，及持久化层框架，及业务来编写。而Django中这些基本的中间件基本上都有成熟的库，只需要针对业务做一些自己实现的中间件，这点很类似于node.js的express框架。<br>像Java中的路由控制，你需要通过struts或者SpringMVC，都需要编写Action（或者controller），经常会把业务集成在Action中，Django就更简单了点，urls.py只负责正则映射，调用指定的方法去做处理。职责更分明，做的事情也自然单一了。<br>而数据库的访问Django已经封装好了，只需要调用Model的相应方法即可，而业务逻辑也应当封装在Model中，Views中的函数只负责完成程序逻辑。<br>而视图层其实在各种框架中都差不多，基本都是模板加程序语言去实现。比如Django中有Django的模板方法，而ejs、jade、velocity、freemaker、jsp都有相应的方法。<br>Django的大致工作原理如下图：<br><img src="http://chuantu.biz/t/17/1415892562x-1376440137.jpg" alt=""></p>
<p>#几个命令<br>创建Django工程：django-admin.py startproject projectname<br>工程中创建新的APP：mange.py startapp appname<br>运行工程：mange.py runserver (None port or 0.0.0.0:prot)<br>在工程中同步数据库：mange.py syncdb</p>
<p>#python对应的数据库模块未安装<br><figure class="highlight python"><figcaption><span>settings.py</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">DATABASES = &#123;</div><div class="line">    <span class="string">'default'</span>: &#123;</div><div class="line">        <span class="string">'ENGINE'</span>: <span class="string">'django.db.backends.mysql'</span>,</div><div class="line">        <span class="string">'NAME'</span>: <span class="string">'TestDjango'</span>,</div><div class="line">        <span class="string">'PASSWORD'</span>: <span class="string">'123'</span>,</div><div class="line">        <span class="string">'HOST'</span>:<span class="string">''</span>,</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>运行命令后报错为： windows Error loading MySQLdb module: No module named MySQLdb<br>原因：python2.7不会自动安装对应的MySQLdb<br><a href="http://www.codegood.com/download/11/" target="_blank" rel="external">下载地址</a><br>安装到python的site-package目录下就OK了。</p>
<p>#用户漏了配置<br>配置后Access denied for user ‘ODBC’@’localhost’ (using password: YES)”)<br>原因：漏了配置用户名<br>改成如下代码就能正常了。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">DATABASES = &#123;</div><div class="line">    &apos;default&apos;: &#123;</div><div class="line">        &apos;ENGINE&apos;: &apos;django.db.backends.mysql&apos;,</div><div class="line">        &apos;USER&apos;: &apos;root&apos;,</div><div class="line">        &apos;NAME&apos;: &apos;TestDjango&apos;,</div><div class="line">        &apos;PASSWORD&apos;: &apos;123&apos;,</div><div class="line">        &apos;HOST&apos;:&apos;&apos;,</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>#POST提交表单，action需要/结尾<br>报错：You called this URL via POST, but the URL doesn’t end in a slash and you have APPEND_SLASH set<br>原因：action属性没有结尾，如下，/login/，最后的斜杠不能漏</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">class</span>=<span class="string">"navbar-form navbar-right"</span> <span class="attr">action</span>=<span class="string">"/login/"</span> <span class="attr">method</span>=<span class="string">"post"</span> <span class="attr">role</span>=<span class="string">"form"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">placeholder</span>=<span class="string">"用户名"</span> <span class="attr">class</span>=<span class="string">"form-control"</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">placeholder</span>=<span class="string">"密码"</span> <span class="attr">class</span>=<span class="string">"form-control"</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">class</span>=<span class="string">"btn btn-success"</span>&gt;</span>登 录<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></div></pre></td></tr></table></figure>
<p>#还是提交表单，又报错了<br>报错：CSRF verification failed. Request aborted.<br>原因：这是一个跨单访问的错误，去掉相应的中间件即可,看下列代码注释<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">MIDDLEWARE_CLASSES = (</div><div class="line">    &apos;django.contrib.sessions.middleware.SessionMiddleware&apos;,</div><div class="line">    &apos;django.middleware.common.CommonMiddleware&apos;,</div><div class="line">    #&apos;django.middleware.csrf.CsrfViewMiddleware&apos;,</div><div class="line">    &apos;django.contrib.auth.middleware.AuthenticationMiddleware&apos;,</div><div class="line">    &apos;django.contrib.auth.middleware.SessionAuthenticationMiddleware&apos;,</div><div class="line">    &apos;django.contrib.messages.middleware.MessageMiddleware&apos;,</div><div class="line">    &apos;django.middleware.clickjacking.XFrameOptionsMiddleware&apos;,</div><div class="line">    &apos;django.middleware.security.SecurityMiddleware&apos;,</div><div class="line">)</div></pre></td></tr></table></figure></p>
<p>如果需要使用跨单访问保护，又不想报错，那就需要在表单中加{\% csrf_token \%}，我没试过，先记下来需要时方便查询。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2014/11/11/2014-11-11-installation-and-initialization-of-the-django-framework-in-windows-projects/" itemprop="url">
                  Django框架在Windows的安装及初始化项目
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Veröffentlicht am</span>
            <time itemprop="dateCreated" datetime="2014-11-11T15:14:00+08:00" content="2014-11-11">
              2014-11-11
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>这里就是笔者自己记录过程中犯的错误，并没有详细阐述过程及原理。</p>
<p>#Django安装时出现No module named setuptools的问题<br>在windows在安装Python时（笔者安装为2.7），是不会将setuptools外部包安装工具一起安装的，因此在Django目录执行python setup.py install会出现 <figure class="highlight plain"><figcaption><span>No module named setuptools） ``` 的异常。</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div></pre></td><td class="code"><pre><div class="line">当然去安装setuptools也行，当然也有个快速便捷的方法。复制以下代码保存后在文件所在目录执行 ```python ez_setup.py``` 。</div><div class="line">```python ez_setup.py</div><div class="line">#!python</div><div class="line">&quot;&quot;&quot;Bootstrap setuptools installation</div><div class="line"></div><div class="line">If you want to use setuptools in your package&apos;s setup.py, just include this</div><div class="line">file in the same directory with it, and add this to the top of your setup.py::</div><div class="line"></div><div class="line">    from ez_setup import use_setuptools</div><div class="line">    use_setuptools()</div><div class="line"></div><div class="line">If you want to require a specific version of setuptools, set a download</div><div class="line">mirror, or use an alternate download directory, you can do so by supplying</div><div class="line">the appropriate options to ``use_setuptools()``.</div><div class="line"></div><div class="line">This file can also be run as a script to install or upgrade setuptools.</div><div class="line">&quot;&quot;&quot;</div><div class="line">import sys</div><div class="line">DEFAULT_VERSION = &quot;0.6c11&quot;</div><div class="line">DEFAULT_URL     = &quot;http://pypi.python.org/packages/%s/s/setuptools/&quot; % sys.version[:3]</div><div class="line"></div><div class="line">md5_data = &#123;</div><div class="line">    &apos;setuptools-0.6b1-py2.3.egg&apos;: &apos;8822caf901250d848b996b7f25c6e6ca&apos;,</div><div class="line">    &apos;setuptools-0.6b1-py2.4.egg&apos;: &apos;b79a8a403e4502fbb85ee3f1941735cb&apos;,</div><div class="line">    &apos;setuptools-0.6b2-py2.3.egg&apos;: &apos;5657759d8a6d8fc44070a9d07272d99b&apos;,</div><div class="line">    &apos;setuptools-0.6b2-py2.4.egg&apos;: &apos;4996a8d169d2be661fa32a6e52e4f82a&apos;,</div><div class="line">    &apos;setuptools-0.6b3-py2.3.egg&apos;: &apos;bb31c0fc7399a63579975cad9f5a0618&apos;,</div><div class="line">    &apos;setuptools-0.6b3-py2.4.egg&apos;: &apos;38a8c6b3d6ecd22247f179f7da669fac&apos;,</div><div class="line">    &apos;setuptools-0.6b4-py2.3.egg&apos;: &apos;62045a24ed4e1ebc77fe039aa4e6f7e5&apos;,</div><div class="line">    &apos;setuptools-0.6b4-py2.4.egg&apos;: &apos;4cb2a185d228dacffb2d17f103b3b1c4&apos;,</div><div class="line">    &apos;setuptools-0.6c1-py2.3.egg&apos;: &apos;b3f2b5539d65cb7f74ad79127f1a908c&apos;,</div><div class="line">    &apos;setuptools-0.6c1-py2.4.egg&apos;: &apos;b45adeda0667d2d2ffe14009364f2a4b&apos;,</div><div class="line">    &apos;setuptools-0.6c10-py2.3.egg&apos;: &apos;ce1e2ab5d3a0256456d9fc13800a7090&apos;,</div><div class="line">    &apos;setuptools-0.6c10-py2.4.egg&apos;: &apos;57d6d9d6e9b80772c59a53a8433a5dd4&apos;,</div><div class="line">    &apos;setuptools-0.6c10-py2.5.egg&apos;: &apos;de46ac8b1c97c895572e5e8596aeb8c7&apos;,</div><div class="line">    &apos;setuptools-0.6c10-py2.6.egg&apos;: &apos;58ea40aef06da02ce641495523a0b7f5&apos;,</div><div class="line">    &apos;setuptools-0.6c11-py2.3.egg&apos;: &apos;2baeac6e13d414a9d28e7ba5b5a596de&apos;,</div><div class="line">    &apos;setuptools-0.6c11-py2.4.egg&apos;: &apos;bd639f9b0eac4c42497034dec2ec0c2b&apos;,</div><div class="line">    &apos;setuptools-0.6c11-py2.5.egg&apos;: &apos;64c94f3bf7a72a13ec83e0b24f2749b2&apos;,</div><div class="line">    &apos;setuptools-0.6c11-py2.6.egg&apos;: &apos;bfa92100bd772d5a213eedd356d64086&apos;,</div><div class="line">    &apos;setuptools-0.6c2-py2.3.egg&apos;: &apos;f0064bf6aa2b7d0f3ba0b43f20817c27&apos;,</div><div class="line">    &apos;setuptools-0.6c2-py2.4.egg&apos;: &apos;616192eec35f47e8ea16cd6a122b7277&apos;,</div><div class="line">    &apos;setuptools-0.6c3-py2.3.egg&apos;: &apos;f181fa125dfe85a259c9cd6f1d7b78fa&apos;,</div><div class="line">    &apos;setuptools-0.6c3-py2.4.egg&apos;: &apos;e0ed74682c998bfb73bf803a50e7b71e&apos;,</div><div class="line">    &apos;setuptools-0.6c3-py2.5.egg&apos;: &apos;abef16fdd61955514841c7c6bd98965e&apos;,</div><div class="line">    &apos;setuptools-0.6c4-py2.3.egg&apos;: &apos;b0b9131acab32022bfac7f44c5d7971f&apos;,</div><div class="line">    &apos;setuptools-0.6c4-py2.4.egg&apos;: &apos;2a1f9656d4fbf3c97bf946c0a124e6e2&apos;,</div><div class="line">    &apos;setuptools-0.6c4-py2.5.egg&apos;: &apos;8f5a052e32cdb9c72bcf4b5526f28afc&apos;,</div><div class="line">    &apos;setuptools-0.6c5-py2.3.egg&apos;: &apos;ee9fd80965da04f2f3e6b3576e9d8167&apos;,</div><div class="line">    &apos;setuptools-0.6c5-py2.4.egg&apos;: &apos;afe2adf1c01701ee841761f5bcd8aa64&apos;,</div><div class="line">    &apos;setuptools-0.6c5-py2.5.egg&apos;: &apos;a8d3f61494ccaa8714dfed37bccd3d5d&apos;,</div><div class="line">    &apos;setuptools-0.6c6-py2.3.egg&apos;: &apos;35686b78116a668847237b69d549ec20&apos;,</div><div class="line">    &apos;setuptools-0.6c6-py2.4.egg&apos;: &apos;3c56af57be3225019260a644430065ab&apos;,</div><div class="line">    &apos;setuptools-0.6c6-py2.5.egg&apos;: &apos;b2f8a7520709a5b34f80946de5f02f53&apos;,</div><div class="line">    &apos;setuptools-0.6c7-py2.3.egg&apos;: &apos;209fdf9adc3a615e5115b725658e13e2&apos;,</div><div class="line">    &apos;setuptools-0.6c7-py2.4.egg&apos;: &apos;5a8f954807d46a0fb67cf1f26c55a82e&apos;,</div><div class="line">    &apos;setuptools-0.6c7-py2.5.egg&apos;: &apos;45d2ad28f9750e7434111fde831e8372&apos;,</div><div class="line">    &apos;setuptools-0.6c8-py2.3.egg&apos;: &apos;50759d29b349db8cfd807ba8303f1902&apos;,</div><div class="line">    &apos;setuptools-0.6c8-py2.4.egg&apos;: &apos;cba38d74f7d483c06e9daa6070cce6de&apos;,</div><div class="line">    &apos;setuptools-0.6c8-py2.5.egg&apos;: &apos;1721747ee329dc150590a58b3e1ac95b&apos;,</div><div class="line">    &apos;setuptools-0.6c9-py2.3.egg&apos;: &apos;a83c4020414807b496e4cfbe08507c03&apos;,</div><div class="line">    &apos;setuptools-0.6c9-py2.4.egg&apos;: &apos;260a2be2e5388d66bdaee06abec6342a&apos;,</div><div class="line">    &apos;setuptools-0.6c9-py2.5.egg&apos;: &apos;fe67c3e5a17b12c0e7c541b7ea43a8e6&apos;,</div><div class="line">    &apos;setuptools-0.6c9-py2.6.egg&apos;: &apos;ca37b1ff16fa2ede6e19383e7b59245a&apos;,</div><div class="line">&#125;</div><div class="line"></div><div class="line">import sys, os</div><div class="line">try: from hashlib import md5</div><div class="line">except ImportError: from md5 import md5</div><div class="line"></div><div class="line">def _validate_md5(egg_name, data):</div><div class="line">    if egg_name in md5_data:</div><div class="line">        digest = md5(data).hexdigest()</div><div class="line">        if digest != md5_data[egg_name]:</div><div class="line">            print &gt;&gt;sys.stderr, (</div><div class="line">                &quot;md5 validation of %s failed!  (Possible download problem?)&quot;</div><div class="line">                % egg_name</div><div class="line">            )</div><div class="line">            sys.exit(2)</div><div class="line">    return data</div><div class="line"></div><div class="line">def use_setuptools(</div><div class="line">    version=DEFAULT_VERSION, download_base=DEFAULT_URL, to_dir=os.curdir,</div><div class="line">    download_delay=15</div><div class="line">):</div><div class="line">    &quot;&quot;&quot;Automatically find/download setuptools and make it available on sys.path</div><div class="line"></div><div class="line">    `version` should be a valid setuptools version number that is available</div><div class="line">    as an egg for download under the `download_base` URL (which should end with</div><div class="line">    a &apos;/&apos;).  `to_dir` is the directory where setuptools will be downloaded, if</div><div class="line">    it is not already available.  If `download_delay` is specified, it should</div><div class="line">    be the number of seconds that will be paused before initiating a download,</div><div class="line">    should one be required.  If an older version of setuptools is installed,</div><div class="line">    this routine will print a message to ``sys.stderr`` and raise SystemExit in</div><div class="line">    an attempt to abort the calling script.</div><div class="line">    &quot;&quot;&quot;</div><div class="line">    was_imported = &apos;pkg_resources&apos; in sys.modules or &apos;setuptools&apos; in sys.modules</div><div class="line">    def do_download():</div><div class="line">        egg = download_setuptools(version, download_base, to_dir, download_delay)</div><div class="line">        sys.path.insert(0, egg)</div><div class="line">        import setuptools; setuptools.bootstrap_install_from = egg</div><div class="line">    try:</div><div class="line">        import pkg_resources</div><div class="line">    except ImportError:</div><div class="line">        return do_download()       </div><div class="line">    try:</div><div class="line">        pkg_resources.require(&quot;setuptools&gt;=&quot;+version); return</div><div class="line">    except pkg_resources.VersionConflict, e:</div><div class="line">        if was_imported:</div><div class="line">            print &gt;&gt;sys.stderr, (</div><div class="line">            &quot;The required version of setuptools (&gt;=%s) is not available, and\n&quot;</div><div class="line">            &quot;can&apos;t be installed while this script is running. Please install\n&quot;</div><div class="line">            &quot; a more recent version first, using &apos;easy_install -U setuptools&apos;.&quot;</div><div class="line">            &quot;\n\n(Currently using %r)&quot;</div><div class="line">            ) % (version, e.args[0])</div><div class="line">            sys.exit(2)</div><div class="line">    except pkg_resources.DistributionNotFound:</div><div class="line">        pass</div><div class="line"></div><div class="line">    del pkg_resources, sys.modules[&apos;pkg_resources&apos;]    # reload ok</div><div class="line">    return do_download()</div><div class="line"></div><div class="line">def download_setuptools(</div><div class="line">    version=DEFAULT_VERSION, download_base=DEFAULT_URL, to_dir=os.curdir,</div><div class="line">    delay = 15</div><div class="line">):</div><div class="line">    &quot;&quot;&quot;Download setuptools from a specified location and return its filename</div><div class="line"></div><div class="line">    `version` should be a valid setuptools version number that is available</div><div class="line">    as an egg for download under the `download_base` URL (which should end</div><div class="line">    with a &apos;/&apos;). `to_dir` is the directory where the egg will be downloaded.</div><div class="line">    `delay` is the number of seconds to pause before an actual download attempt.</div><div class="line">    &quot;&quot;&quot;</div><div class="line">    import urllib2, shutil</div><div class="line">    egg_name = &quot;setuptools-%s-py%s.egg&quot; % (version,sys.version[:3])</div><div class="line">    url = download_base + egg_name</div><div class="line">    saveto = os.path.join(to_dir, egg_name)</div><div class="line">    src = dst = None</div><div class="line">    if not os.path.exists(saveto):  # Avoid repeated downloads</div><div class="line">        try:</div><div class="line">            from distutils import log</div><div class="line">            if delay:</div><div class="line">                log.warn(&quot;&quot;&quot;</div><div class="line">---------------------------------------------------------------------------</div><div class="line">This script requires setuptools version %s to run (even to display</div><div class="line">help).  I will attempt to download it for you (from</div><div class="line">%s), but</div><div class="line">you may need to enable firewall access for this script first.</div><div class="line">I will start the download in %d seconds.</div><div class="line"></div><div class="line">(Note: if this machine does not have network access, please obtain the file</div><div class="line"></div><div class="line">   %s</div><div class="line"></div><div class="line">and place it in this directory before rerunning this script.)</div><div class="line">---------------------------------------------------------------------------&quot;&quot;&quot;,</div><div class="line">                    version, download_base, delay, url</div><div class="line">                ); from time import sleep; sleep(delay)</div><div class="line">            log.warn(&quot;Downloading %s&quot;, url)</div><div class="line">            src = urllib2.urlopen(url)</div><div class="line">            # Read/write all in one block, so we don&apos;t create a corrupt file</div><div class="line">            # if the download is interrupted.</div><div class="line">            data = _validate_md5(egg_name, src.read())</div><div class="line">            dst = open(saveto,&quot;wb&quot;); dst.write(data)</div><div class="line">        finally:</div><div class="line">            if src: src.close()</div><div class="line">            if dst: dst.close()</div><div class="line">    return os.path.realpath(saveto)</div><div class="line"></div><div class="line">def main(argv, version=DEFAULT_VERSION):</div><div class="line">    &quot;&quot;&quot;Install or upgrade setuptools and EasyInstall&quot;&quot;&quot;</div><div class="line">    try:</div><div class="line">        import setuptools</div><div class="line">    except ImportError:</div><div class="line">        egg = None</div><div class="line">        try:</div><div class="line">            egg = download_setuptools(version, delay=0)</div><div class="line">            sys.path.insert(0,egg)</div><div class="line">            from setuptools.command.easy_install import main</div><div class="line">            return main(list(argv)+[egg])   # we&apos;re done here</div><div class="line">        finally:</div><div class="line">            if egg and os.path.exists(egg):</div><div class="line">                os.unlink(egg)</div><div class="line">    else:</div><div class="line">        if setuptools.__version__ == &apos;0.0.1&apos;:</div><div class="line">            print &gt;&gt;sys.stderr, (</div><div class="line">            &quot;You have an obsolete version of setuptools installed.  Please\n&quot;</div><div class="line">            &quot;remove it from your system entirely before rerunning this script.&quot;</div><div class="line">            )</div><div class="line">            sys.exit(2)</div><div class="line"></div><div class="line">    req = &quot;setuptools&gt;=&quot;+version</div><div class="line">    import pkg_resources</div><div class="line">    try:</div><div class="line">        pkg_resources.require(req)</div><div class="line">    except pkg_resources.VersionConflict:</div><div class="line">        try:</div><div class="line">            from setuptools.command.easy_install import main</div><div class="line">        except ImportError:</div><div class="line">            from easy_install import main</div><div class="line">        main(list(argv)+[download_setuptools(delay=0)])</div><div class="line">        sys.exit(0) # try to force an exit</div><div class="line">    else:</div><div class="line">        if argv:</div><div class="line">            from setuptools.command.easy_install import main</div><div class="line">            main(argv)</div><div class="line">        else:</div><div class="line">            print &quot;Setuptools version&quot;,version,&quot;or greater has been installed.&quot;</div><div class="line">            print &apos;(Run &quot;ez_setup.py -U setuptools&quot; to reinstall or upgrade.)&apos;</div><div class="line"></div><div class="line">def update_md5(filenames):</div><div class="line">    &quot;&quot;&quot;Update our built-in md5 registry&quot;&quot;&quot;</div><div class="line"></div><div class="line">    import re</div><div class="line"></div><div class="line">    for name in filenames:</div><div class="line">        base = os.path.basename(name)</div><div class="line">        f = open(name,&apos;rb&apos;)</div><div class="line">        md5_data[base] = md5(f.read()).hexdigest()</div><div class="line">        f.close()</div><div class="line"></div><div class="line">    data = [&quot;    %r: %r,\n&quot; % it for it in md5_data.items()]</div><div class="line">    data.sort()</div><div class="line">    repl = &quot;&quot;.join(data)</div><div class="line"></div><div class="line">    import inspect</div><div class="line">    srcfile = inspect.getsourcefile(sys.modules[__name__])</div><div class="line">    f = open(srcfile, &apos;rb&apos;); src = f.read(); f.close()</div><div class="line"></div><div class="line">    match = re.search(&quot;\nmd5_data = &#123;\n([^&#125;]+)&#125;&quot;, src)</div><div class="line">    if not match:</div><div class="line">        print &gt;&gt;sys.stderr, &quot;Internal error!&quot;</div><div class="line">        sys.exit(2)</div><div class="line"></div><div class="line">    src = src[:match.start(1)] + repl + src[match.end(1):]</div><div class="line">    f = open(srcfile,&apos;w&apos;)</div><div class="line">    f.write(src)</div><div class="line">    f.close()</div><div class="line"></div><div class="line"></div><div class="line">if __name__==&apos;__main__&apos;:</div><div class="line">    if len(sys.argv)&gt;2 and sys.argv[1]==&apos;--md5update&apos;:</div><div class="line">        update_md5(sys.argv[2:])</div><div class="line">    else:</div><div class="line">        main(sys.argv[1:])</div></pre></td></tr></table></figure></p>
<p>然后再去安装Django就没问题了。</p>
<p>#创建Django项目<br>输入命令django-admin.py startproject mysite 用来创建一个网站项目mysite。<br>当然，执行该命令你需要先将Django的Bin添加到path中去。再进入目录输入manage.py runserver 开启网站。可以指定端口，默认为8000，如果想使用90端口，就写成 manage.py runserver 90。最后我们打开浏览器在地址栏里输入地址 <a href="http://localhost:8000" target="_blank" rel="external">http://localhost:8000</a> 就可以看到初始化项目自动生成好了。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2014/10/26/2014-10-26-use-one-month-after-sublime-skill-of-using-some-of-the-summary/" itemprop="url">
                  使用Sublime一个月后的一些使用技巧总结
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Veröffentlicht am</span>
            <time itemprop="dateCreated" datetime="2014-10-26T01:45:00+08:00" content="2014-10-26">
              2014-10-26
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">in</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Sublime/" itemprop="url" rel="index">
                    <span itemprop="name">Sublime</span>
                  </a>
                </span>

                
                
                  . 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Sublime/工具/" itemprop="url" rel="index">
                    <span itemprop="name">工具</span>
                  </a>
                </span>

                
                
                  . 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Sublime/工具/编辑器/" itemprop="url" rel="index">
                    <span itemprop="name">编辑器</span>
                  </a>
                </span>

                
                
                  . 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Sublime/工具/编辑器/提升工作效率/" itemprop="url" rel="index">
                    <span itemprop="name">提升工作效率</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>#废话<br>这个月开始从VIM转向使用Sublime，可能很多Sublime脑残粉会说，这工具你现在才开始用啊，也可能很多Vim脑残粉会说，Vim是最高级的编辑器，你竟然自我退化。确实Vim太高级了，我用不好，Sublime至少一个月内让我把IntelliJ的前端功能都摒弃了（以前html、css、JavaScript基本用他操作）。</p>
<p>#Feature<br>那就来说说我感受到的他的优点</p>
<h2 id="强大的命令模式"><a href="#强大的命令模式" class="headerlink" title="强大的命令模式"></a>强大的命令模式</h2><p>在编辑窗口按ctrl+shift+p就可以进入命令模式，命令模式即为在编辑窗口上方弹出了一个输入框，可以输入Sublime内置和插件所扩展的命令功能，而且支持模糊匹配。比如：</p>
<ul>
<li>set synax javascript 命令可以设置当前语法为javascript</li>
<li>安装Package Control后可以用Package Install命令来安装插件</li>
<li>minimap 可以关闭打开编辑器迷你图</li>
<li>等等等等</li>
</ul>
<h2 id="强大的Goto功能"><a href="#强大的Goto功能" class="headerlink" title="强大的Goto功能"></a>强大的Goto功能</h2><p>在编辑窗口输入ctrl+p就可以进入goto命令，与命令模式一样，在编辑窗口上方会弹出了一个输入框，可以输入goto的命令，可以是文件跳转，也可以是文件跳转行，也可以跳转到某个元素（函数、选择器等），也可以在页面中查找。</p>
<ul>
<li>@可以快速定位元素，比如js的函数，CSS文件的选择器，支持模糊匹配</li>
<li>#可以定位到页面内的内容，支持模糊匹配</li>
<li>：+行数 跳转到行</li>
</ul>
<h2 id="模糊匹配功能"><a href="#模糊匹配功能" class="headerlink" title="模糊匹配功能"></a>模糊匹配功能</h2><p>我认为的模糊分两种，一种是模糊缩写自动补全，一种是搜索的时候的模糊匹配，如下：</p>
<ul>
<li>模糊补全：在CSS文件中输入bgc按tab键就是自动键入background-color</li>
<li>模糊匹配：比如在命令模式输入ssjs，就会模糊匹配上 <strong>s</strong>et <strong>s</strong>ynax <strong>j</strong>ava <strong>s</strong>cript，粗体的字符为模糊匹配的字段；</li>
</ul>
<h2 id="强大的插件功能"><a href="#强大的插件功能" class="headerlink" title="强大的插件功能"></a>强大的插件功能</h2><p>基本上所有的语法都能找到很好的插件，比如对于Html就有Emmet，他极大的提升了前端开发的工作效率，这里就不一一细说该插件，有兴趣的可以Google下，这里稍微举个例子来看看。<br>ctrl+n创建个页面后，输入 !+[tab]，就可以自动生成html5的标准文档，如果需要HTML4的标准，就输入html:4s+[tab]。之后会自动生成如下代码。<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>然后在任意位置输入元素名字后按tab都能生成相应名字的元素，比如输入script+[tab]，就会生成script标签。如果输入div.className就会生成<figure class="highlight plain"><figcaption><span>class="className">``` ，是不是很神奇。更神奇的是，输入ul>.item$*5+[tab]（ *这里注意，>代表子元素，+代表并列。子元素的情况下默认子元素为div，但是ul的默认为li，tr的默认为td等* ），会自动生成以下代码：</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">```html</div><div class="line">&lt;ul&gt;</div><div class="line">        &lt;li class=&quot;item1&quot;&gt;&lt;/li&gt;</div><div class="line">        &lt;li class=&quot;item2&quot;&gt;&lt;/li&gt;</div><div class="line">        &lt;li class=&quot;item3&quot;&gt;&lt;/li&gt;</div><div class="line">        &lt;li class=&quot;item4&quot;&gt;&lt;/li&gt;</div><div class="line">        &lt;li class=&quot;item5&quot;&gt;&lt;/li&gt;</div><div class="line">&lt;/ul&gt;</div></pre></td></tr></table></figure></p>
<h2 id="多行编辑功能"><a href="#多行编辑功能" class="headerlink" title="多行编辑功能"></a>多行编辑功能</h2><p>就在上列html代码中，如果要同时编辑li元素中的内容，那么正常情况需要先编辑完一个后复制粘贴4次。Subilme的多行编辑功能很好的帮我们简化了这个操作（编码+鼠标+键盘+再鼠标+再键盘……），提升了我们的编码速率。<br>进入多行编辑模式有几种方式，如下：</p>
<ul>
<li>选中&gt;&lt;按alt+f3可以多行光标模式（这里输入的内容为需要匹配的共同点），这样做的坏处是共同点与其他页面元素相同时候不方便匹配，比较不灵活</li>
<li>争对上面的问题就有另一个办法，可以把鼠标放在&gt;&lt;之间按住shift用右键往下拖来就可以进行多行编辑，这样做的坏处是，如果需要多行编辑的元素不在一个垂直线并且不是末尾元素，将无法进行</li>
<li>再争对以上问题就又有一个办法，可以选中&gt;&lt;后用ctrl+d 和ctrl+k来选择跳过选中，这样的缺点就是太慢，尽可能还是在相同点按alt+f3吧</li>
</ul>
<p>多行选择后可以p{This is content}+[tab]来生成以下代码<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item1 "</span>&gt;</span><span class="tag">&lt;<span class="name">p</span>&gt;</span>This is content<span class="tag">&lt;/<span class="name">p</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item2 "</span>&gt;</span><span class="tag">&lt;<span class="name">p</span>&gt;</span>This is content<span class="tag">&lt;/<span class="name">p</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item3 "</span>&gt;</span><span class="tag">&lt;<span class="name">p</span>&gt;</span>This is content<span class="tag">&lt;/<span class="name">p</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item4 "</span>&gt;</span><span class="tag">&lt;<span class="name">p</span>&gt;</span>This is content<span class="tag">&lt;/<span class="name">p</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item5 "</span>&gt;</span><span class="tag">&lt;<span class="name">p</span>&gt;</span>This is content<span class="tag">&lt;/<span class="name">p</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></div></pre></td></tr></table></figure></p>
<h2 id="其他快捷键"><a href="#其他快捷键" class="headerlink" title="其他快捷键"></a>其他快捷键</h2><p>其中粗体的内容为我认为可以大幅度增加工作效率的功能，而且其他浏览器可能没有的（不是绝对没有，请勿喷）。<br>ctrl+tab切换正在编辑的文件（ctrl+shift+tab可以相反方向）<br>ctrl+H当前文件查找替换模式（类型其他编辑器的替换查找）<br>ctrl+f所有文件查找内容(使用完后按esc退出，之前一直不知道这个。。。)<br>ctrl+shift+f所有文件替换内容<br>ctrl+shift+d 复制当前或者复制选中内容<br>ctrl+shift+k 删除当前行<br>alt+. 闭合标签<br><strong>shift+f11</strong> 进入无干扰模式<br><strong>ctrl+enter</strong> 在下一行插入并移动光标到那<br><strong>ctrl+shift+enter</strong> 在上一行插入并移动光标到那<br><strong>ctrl+shift+v</strong> 带自动缩进的粘贴（正常复制后格式会乱，这种方式粘贴后省略了人工排版的问题）</p>
<p>#总结<br>好用，谁用谁知道！</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2014/10/26/2014-10-26-july-september-output-of-06-version-summary/" itemprop="url">
                  7-9月产品0.6版本总结
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Veröffentlicht am</span>
            <time itemprop="dateCreated" datetime="2014-10-26T01:40:00+08:00" content="2014-10-26">
              2014-10-26
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>这上半年的总结，其实也就是这两个月的总结。3月后，项目组由于人员离职，也就剩下我一个人，那时候也处于部门合并和新顶头上司的变换中。4月5月也非常忙，一个人把V0.5BETA版本做了发布前的最后调整。这项目往返的比较严重，确实让人疲劳，也一个人做的事情太杂，其实工作状态并不好。<br>    接着4月发布后，做了一次小型的重构，重构后让原来的设计更加灵活了一些，加班加点完成了这部分重构后开始了一段轻松的旅途，10天时间，5个城市，有点赶，但是魔都的迷幻、西塘水乡的惬意、苏州园林的精致、南京古都的庄严、雨后西湖的美轮美奂、灵隐寺的大气磅礴，未尝想过，夏天，没有想象中江南的细雨，但有着这么多不同风格的美景，加上旁边的挚爱的伴侣，真是让人乐不思蜀。<br>    回来后瞎折腾一个月，主要还是产品的方向、需求的打磨、进度的计划等，这段时间总之效率不高，一是还沉浸在那段旅途回忆中，另是事情太杂方向比较迷茫，确实比较力不从心。<br>    7月后项目组又兵强马壮了，重装再发。开始了产品V0.6版本的开发，这段时间确实比较多总结的。资源竞争等外因确实影响着我们，但这总结主要从自身出发，以下是我总结的几个点：</p>
<ul>
<li>其实，界面设计、交互设计、架构设计、模块设计都很难在开始的时候就做的周全，在开始就去追求一份最适合的答案，那必然是花费非常多的人力物力，并且到最后会有角度的设计是冗余的。因此，我们应该多在开发的过程中去思考，随着Sprint的进展，所掌握的知识也越充分，把自己负责的模块仔细考虑。这阶段整个项目组对这点做的很不到位，原因大致一是业务不足，二是缺少思考，三是进度太紧。等到测试阶段才发现设计问题，那重构的代价就比开发阶段大大提升了；</li>
<li>功能耦合较严重，其实在后台已经在代码设计上做到解耦，但是功能要做的比较有引导性，就容易将业务上有关系的模块揉在一起，那就导致很多地方可能改了一个问题，又出现一个问题，或者是改了一个问题，漏了一个问题，也就是我说的拆了东墙补西墙，拆了东墙漏西墙；</li>
<li>项目周期拉的太长了，让人疲劳，最好是能把Sprint压缩在3个工作周内，又不会无法完成完整功能，又不会时间太长；</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2014/09/03/2014-09-03-explore-the-browser-side-events-a-an-event-event-flow-profile-add-events/" itemprop="url">
                  浏览器端的事件探秘（一）---事件事件流简介、事件添加方式
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Veröffentlicht am</span>
            <time itemprop="dateCreated" datetime="2014-09-03T13:17:00+08:00" content="2014-09-03">
              2014-09-03
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">in</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/javascript/" itemprop="url" rel="index">
                    <span itemprop="name">javascript</span>
                  </a>
                </span>

                
                
                  . 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/javascript/事件流/" itemprop="url" rel="index">
                    <span itemprop="name">事件流</span>
                  </a>
                </span>

                
                
                  . 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/javascript/事件流/事件/" itemprop="url" rel="index">
                    <span itemprop="name">事件</span>
                  </a>
                </span>

                
                
                  . 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/javascript/事件流/事件/事件冒泡/" itemprop="url" rel="index">
                    <span itemprop="name">事件冒泡</span>
                  </a>
                </span>

                
                
                  . 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/javascript/事件流/事件/事件冒泡/添加事件方式/" itemprop="url" rel="index">
                    <span itemprop="name">添加事件方式</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Javascript的事件"><a href="#Javascript的事件" class="headerlink" title="Javascript的事件"></a>Javascript的事件</h2><p>#1 事件冒泡</p>
<h2 id="1-1-事件"><a href="#1-1-事件" class="headerlink" title="1.1 事件"></a>1.1 事件</h2><p>在IE4以后，浏览器的开发团队就开始给页面的每个部分都设定了特定的事件。多到鼠标点击，简单到鼠标滑过，甚至敲击键盘都会有特定的事件。</p>
<h2 id="1-2-事件流"><a href="#1-2-事件流" class="headerlink" title="1.2 事件流"></a>1.2 事件流</h2><p>如下图，点击页面的一部分DIV3的时候，那么浏览器就认为你点击这按钮的同时，也点击了这个按钮所在的容器。这个过程就是一个事件流。<br><img src="http://chuantu.biz/t/50/1409750064x1822611033.jpg" alt=""><br>事件描述的是从页面接受事件的顺序。IE的事件流方式是事件冒泡流，网景公司用的是事件捕获流。</p>
<h2 id="1-2-1-事件冒泡"><a href="#1-2-1-事件冒泡" class="headerlink" title="# 1.2.1 事件冒泡"></a># 1.2.1 事件冒泡</h2><p>即事件最开始有最具体的元素（文档中的嵌套层次最深的元素）接收，然后逐级上传到最不具体的元素（文档）。<br>比如下面这个程序，当你点按钮的时候，也会认为你点了div，然后在认为你点了body，然后又认为你点了html，然后在认为你点了document。<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"Content-Type"</span> <span class="attr">content</span>=<span class="string">"text/html;charset=utf-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>事件流<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="undefined"></span></div><div class="line"><span class="javascript">        <span class="function"><span class="keyword">function</span> <span class="title">showMsg</span>(<span class="params">txt</span>)</span>&#123;</span></div><div class="line"><span class="undefined">            alert(txt)</span></div><div class="line"><span class="undefined">        &#125;</span></div><div class="line"><span class="undefined"></span></div><div class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"box"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"按钮"</span> <span class="attr">id</span>=<span class="string">"btn"</span> <span class="attr">onclick</span>=<span class="string">"showMsg('按钮')"</span> /&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span></span></div></pre></td></tr></table></figure></p>
<h2 id="1-2-2-事件捕获"><a href="#1-2-2-事件捕获" class="headerlink" title="# 1.2.2 事件捕获"></a># 1.2.2 事件捕获</h2><p>不太具体的应该更早的接受到事件，具体的应该是最后接受到的。上面例子，document就是最先接收，最后是按钮。</p>
<h2 id="1-3-事件添加方法"><a href="#1-3-事件添加方法" class="headerlink" title="1.3 事件添加方法"></a>1.3 事件添加方法</h2><h2 id="1-3-1-html事件"><a href="#1-3-1-html事件" class="headerlink" title="# 1.3.1 html事件"></a># 1.3.1 html事件</h2><p>上述代码就是一个html事件，html事件会导致html代码和javascript代码连接过紧，如果修改javascript代码的函数名，那么也要同学修改html。</p>
<h2 id="1-3-2-DOM0级事件处理程序"><a href="#1-3-2-DOM0级事件处理程序" class="headerlink" title="# 1.3.2 DOM0级事件处理程序"></a># 1.3.2 DOM0级事件处理程序</h2><p>好处：简单，跨浏览器。<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"Content-Type"</span> <span class="attr">content</span>=<span class="string">"text/html;charset=utf-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>事件流<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="undefined"></span></div><div class="line"><span class="javascript">        <span class="function"><span class="keyword">function</span> <span class="title">init</span>(<span class="params"></span>)</span>&#123;</span></div><div class="line"><span class="javascript">            <span class="keyword">var</span> btn1 = <span class="built_in">document</span>.getElementById(<span class="string">"btn"</span>)</span></div><div class="line"><span class="javascript">            btn1.onclick=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></div><div class="line"><span class="javascript">                showMsg(<span class="keyword">this</span>.getAttribute(<span class="string">"value"</span>))</span></div><div class="line"><span class="undefined">            &#125;</span></div><div class="line"><span class="javascript">            <span class="keyword">var</span> btn2 = <span class="built_in">document</span>.getElementById(<span class="string">"btn2"</span>)</span></div><div class="line"><span class="javascript">            btn2.onclick=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></div><div class="line"><span class="javascript">                showMsg(<span class="keyword">this</span>.getAttribute(<span class="string">"value"</span>))</span></div><div class="line"><span class="javascript">                btn2.onclick = <span class="literal">null</span></span></div><div class="line"><span class="undefined">            &#125;</span></div><div class="line"><span class="undefined">        &#125;</span></div><div class="line"><span class="javascript">        <span class="function"><span class="keyword">function</span> <span class="title">showMsg</span>(<span class="params">txt</span>)</span>&#123;</span></div><div class="line"><span class="undefined">            alert(txt)</span></div><div class="line"><span class="undefined">        &#125;</span></div><div class="line"><span class="undefined"></span></div><div class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">onload</span>=<span class="string">"init()"</span> &gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"box"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"按钮"</span> <span class="attr">id</span>=<span class="string">"btn"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"按钮2"</span> <span class="attr">id</span>=<span class="string">"btn2"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure></p>
<h2 id="1-3-3-DOM2级事件处理"><a href="#1-3-3-DOM2级事件处理" class="headerlink" title="# 1.3.3 DOM2级事件处理"></a># 1.3.3 DOM2级事件处理</h2><p>定义了2个方法，用于处理指定和删除事件处理程序的操作。分别为addEventListener()和removeEventListener()。接受3个参数：要处理的事件名、作为事件处理程序的函数和布尔值（true是事件捕获，false是事件冒泡）。<br>addEventListener添加的事件只能通过removeEventListener来删除，且参数一致。<br>详细参考如下代码：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">&lt;html&gt;</div><div class="line">&lt;head&gt;</div><div class="line">    &lt;meta http-equiv=<span class="string">"Content-Type"</span> content=<span class="string">"text/html;charset=utf-8"</span>&gt;</div><div class="line">    &lt;title&gt;事件流&lt;<span class="regexp">/title&gt;</span></div><div class="line"><span class="regexp">    &lt;script type="text/</span>javascript<span class="string">"&gt;</span></div><div class="line"><span class="string">        function init()&#123;</span></div><div class="line"><span class="string">            var btn1 = document.getElementById("</span>btn<span class="string">")</span></div><div class="line"><span class="string">            btn1.addEventListener('click',clickBtn,false)</span></div><div class="line"><span class="string">            var btn2 = document.getElementById("</span>btn2<span class="string">")</span></div><div class="line"><span class="string">            btn2.addEventListener('click',clickBtn,false)</span></div><div class="line"><span class="string">            btn2.addEventListener('click',function()&#123;</span></div><div class="line"><span class="string">                btn2.removeEventListener('click',clickBtn,false)</span></div><div class="line"><span class="string">            &#125;,false)</span></div><div class="line"><span class="string">        &#125;</span></div><div class="line"><span class="string">        function clickBtn()&#123;</span></div><div class="line"><span class="string">            showMsg(this.getAttribute("</span>value<span class="string">"))</span></div><div class="line"><span class="string">        &#125;</span></div><div class="line"><span class="string">        function showMsg(txt)&#123;</span></div><div class="line"><span class="string">            alert(txt)</span></div><div class="line"><span class="string">        &#125;</span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string">    &lt;/script&gt;</span></div><div class="line"><span class="string">&lt;/head&gt;</span></div><div class="line"><span class="string">&lt;body onload="</span>init()<span class="string">" &gt;</span></div><div class="line"><span class="string">    &lt;div id="</span>box<span class="string">"&gt;</span></div><div class="line"><span class="string">        &lt;input type="</span>button<span class="string">" value="</span>按钮<span class="string">" id="</span>btn<span class="string">"/&gt;</span></div><div class="line"><span class="string">        &lt;input type="</span>button<span class="string">" value="</span>按钮<span class="number">2</span><span class="string">" id="</span>btn2<span class="string">"/&gt;</span></div><div class="line"><span class="string">    &lt;/div&gt;</span></div><div class="line"><span class="string">&lt;/body&gt;</span></div><div class="line"><span class="string">&lt;/html&gt;</span></div></pre></td></tr></table></figure></p>
<p>DOM2级还有一个好处就是可以给模块增加多个点击事件。如上btn2，就添加了多个click事件。</p>
<h2 id="1-3-4-IE事件处理程序"><a href="#1-3-4-IE事件处理程序" class="headerlink" title="# 1.3.4 IE事件处理程序"></a># 1.3.4 IE事件处理程序</h2><p>定义了2个方法，用于处理指定和删除事件处理程序的操作。分别为attachEvent ()和detachEvent ()。接受2个参数：要处理的事件名、作为事件处理程序的函数，事件处理方式就是冒泡。<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"Content-Type"</span> <span class="attr">content</span>=<span class="string">"text/html;charset=utf-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>事件流<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="undefined"></span></div><div class="line"><span class="javascript">        <span class="function"><span class="keyword">function</span> <span class="title">init</span>(<span class="params"></span>)</span>&#123;</span></div><div class="line"><span class="javascript">            <span class="keyword">var</span> btn1 = <span class="built_in">document</span>.getElementById(<span class="string">"btn"</span>)</span></div><div class="line"><span class="javascript">            btn1.attachEvent(<span class="string">'onclick'</span>,clickBtn)</span></div><div class="line"><span class="javascript">            <span class="keyword">var</span> btn2 = <span class="built_in">document</span>.getElementById(<span class="string">"btn2"</span>)</span></div><div class="line"><span class="javascript">            btn2.attachEvent(<span class="string">'onclick'</span>,clickBtn)</span></div><div class="line"><span class="javascript">            btn2.attachEvent(<span class="string">'onclick'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></div><div class="line"><span class="javascript">                btn2.detachEvent(<span class="string">'onclick'</span>,clickBtn)</span></div><div class="line"><span class="undefined">            &#125;)</span></div><div class="line"><span class="undefined">        &#125;</span></div><div class="line"><span class="javascript">        <span class="function"><span class="keyword">function</span> <span class="title">clickBtn</span>(<span class="params"></span>)</span>&#123;</span></div><div class="line"><span class="javascript">            showMsg(<span class="keyword">this</span>.value)</span></div><div class="line"><span class="javascript">            <span class="comment">//this.getAttribute("value")</span></span></div><div class="line"><span class="undefined">        &#125;</span></div><div class="line"><span class="javascript">        <span class="function"><span class="keyword">function</span> <span class="title">showMsg</span>(<span class="params">txt</span>)</span>&#123;</span></div><div class="line"><span class="undefined">            alert(txt)</span></div><div class="line"><span class="undefined">        &#125;</span></div><div class="line"><span class="undefined"></span></div><div class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">onload</span>=<span class="string">"init()"</span> &gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"box"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"按钮"</span> <span class="attr">id</span>=<span class="string">"btn"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"按钮2"</span> <span class="attr">id</span>=<span class="string">"btn2"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure></p>
<h2 id="1-3-5-跨浏览器事件处理"><a href="#1-3-5-跨浏览器事件处理" class="headerlink" title="# 1.3.5 跨浏览器事件处理"></a># 1.3.5 跨浏览器事件处理</h2><p>那就要做能力处理判断，那最好把这种处理放在一个对象中。<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"Content-Type"</span> <span class="attr">content</span>=<span class="string">"text/html;charset=utf-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>事件流<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="undefined"></span></div><div class="line"><span class="javascript">        <span class="function"><span class="keyword">function</span> <span class="title">EventUtil</span>(<span class="params"></span>)</span>&#123;</span></div><div class="line"><span class="undefined">        &#125;</span></div><div class="line"><span class="javascript">        EventUtil.prototype.addHandler = <span class="function"><span class="keyword">function</span>(<span class="params">element,type,handler</span>)</span>&#123;</span></div><div class="line"><span class="javascript">            <span class="keyword">if</span>(element.addEventListener)&#123;</span></div><div class="line"><span class="javascript">                element.addEventListener(type,handler,<span class="literal">false</span>);</span></div><div class="line"><span class="javascript">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(element.attachEvent)&#123;</span></div><div class="line"><span class="javascript">                element.attachEvent(<span class="string">'on'</span>+type,handler);</span></div><div class="line"><span class="javascript">            &#125;<span class="keyword">else</span>&#123;</span></div><div class="line"><span class="javascript">                <span class="comment">//在javascript中，所有用点的地方都能用中刮号</span></span></div><div class="line"><span class="javascript">                element[<span class="string">'on'</span>+type] = handler;</span></div><div class="line"><span class="undefined">            &#125;</span></div><div class="line"><span class="undefined">        &#125;</span></div><div class="line"><span class="javascript">        EventUtil.prototype.removeHandler = <span class="function"><span class="keyword">function</span>(<span class="params">element,type,handler</span>)</span>&#123;</span></div><div class="line"><span class="javascript">            <span class="keyword">if</span>(element.removeEventListener)&#123;</span></div><div class="line"><span class="javascript">                element.removeEventListener(type,handler,<span class="literal">false</span>);</span></div><div class="line"><span class="javascript">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(element.detachEvent)&#123;</span></div><div class="line"><span class="javascript">                element.detachEvent(<span class="string">'on'</span>+type,handler);</span></div><div class="line"><span class="javascript">            &#125;<span class="keyword">else</span>&#123;</span></div><div class="line"><span class="javascript">                <span class="comment">//在javascript中，所有用点的地方都能用中刮号</span></span></div><div class="line"><span class="javascript">                element[<span class="string">'on'</span>+type] = <span class="literal">null</span>;</span></div><div class="line"><span class="undefined">            &#125;</span></div><div class="line"><span class="undefined">        &#125;</span></div><div class="line"><span class="javascript">        <span class="function"><span class="keyword">function</span> <span class="title">init</span>(<span class="params"></span>)</span>&#123;</span></div><div class="line"><span class="javascript">            <span class="keyword">var</span> eventUtil = <span class="keyword">new</span> EventUtil();</span></div><div class="line"><span class="javascript">            <span class="keyword">var</span> btn1 = <span class="built_in">document</span>.getElementById(<span class="string">"btn"</span>)</span></div><div class="line"><span class="javascript">            eventUtil.addHandler(btn1,<span class="string">'click'</span>,clickBtn)</span></div><div class="line"><span class="javascript">            <span class="keyword">var</span> btn2 = <span class="built_in">document</span>.getElementById(<span class="string">"btn2"</span>)</span></div><div class="line"><span class="javascript">            eventUtil.addHandler(btn2,<span class="string">'click'</span>,clickBtn)</span></div><div class="line"><span class="javascript">            eventUtil.addHandler(btn2,<span class="string">'click'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></div><div class="line"><span class="javascript">                eventUtil.removeHandler(btn2,<span class="string">'click'</span>,clickBtn)</span></div><div class="line"><span class="undefined">            &#125;)</span></div><div class="line"><span class="undefined">        &#125;</span></div><div class="line"><span class="javascript">        <span class="function"><span class="keyword">function</span> <span class="title">clickBtn</span>(<span class="params"></span>)</span>&#123;</span></div><div class="line"><span class="javascript">            <span class="keyword">if</span>(<span class="keyword">this</span>.value)&#123;</span></div><div class="line"><span class="javascript">                showMsg(<span class="keyword">this</span>.value)</span></div><div class="line"><span class="javascript">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="keyword">this</span>.attributes)&#123;</span></div><div class="line"><span class="javascript">                showMsg(<span class="keyword">this</span>.attributes[<span class="string">"value"</span>])</span></div><div class="line"><span class="javascript">            &#125; <span class="keyword">else</span>&#123;</span></div><div class="line"><span class="javascript">                showMsg(<span class="string">"Hello World"</span>)</span></div><div class="line"><span class="undefined">            &#125;</span></div><div class="line"><span class="undefined"></span></div><div class="line"><span class="javascript">            <span class="comment">//this.getAttribute("value")</span></span></div><div class="line"><span class="undefined">        &#125;</span></div><div class="line"><span class="javascript">        <span class="function"><span class="keyword">function</span> <span class="title">showMsg</span>(<span class="params">txt</span>)</span>&#123;</span></div><div class="line"><span class="undefined">            alert(txt)</span></div><div class="line"><span class="undefined">        &#125;</span></div><div class="line"><span class="undefined"></span></div><div class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">onload</span>=<span class="string">"init()"</span> &gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"box"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"按钮"</span> <span class="attr">id</span>=<span class="string">"btn"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"按钮2"</span> <span class="attr">id</span>=<span class="string">"btn2"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2014/09/02/2014-09-02-refactoring-code-example/" itemprop="url">
                  重构-代码示例
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Veröffentlicht am</span>
            <time itemprop="dateCreated" datetime="2014-09-02T13:58:00+08:00" content="2014-09-02">
              2014-09-02
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">in</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/重构/" itemprop="url" rel="index">
                    <span itemprop="name">重构</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>#Round.1案例<br>这里的案例是从重构这本书上直接拿来的，但是我通过不同的理解，做了些不一样的重构，总在先上源码。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Movie</span> </span>&#123;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> CHILDRENS = <span class="number">2</span>;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> NEW_RELEASE = <span class="number">1</span>;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> REGULAR = <span class="number">0</span>;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> String _title;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> _priceCode;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Movie</span><span class="params">(String title, <span class="keyword">int</span> priceCode)</span> </span>&#123;</div><div class="line">        _title = title;</div><div class="line">        _priceCode = priceCode;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getPriceCode</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> _priceCode;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPriceCode</span><span class="params">(<span class="keyword">int</span> arg)</span> </span>&#123;</div><div class="line">        _priceCode = arg;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getTitle</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> _title;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Rental</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> Movie _movie;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> _daysRented;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Rental</span><span class="params">(Movie movie, <span class="keyword">int</span> daysRented)</span> </span>&#123;</div><div class="line">        _movie = movie;</div><div class="line">        _daysRented = daysRented;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getDaysRented</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> _daysRented;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> Movie <span class="title">getMovie</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> _movie;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Customer</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> String _name;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> List&lt;Rental_rentals = <span class="keyword">new</span> ArrayList&lt;Rental&gt;();</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Customer</span><span class="params">(String name)</span> </span>&#123;</div><div class="line">        _name = name;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addRental</span><span class="params">(Rental arg)</span> </span>&#123;</div><div class="line">        _rentals.add(arg);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> _name;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">statement</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">double</span> totalAmount = <span class="number">0</span>;</div><div class="line">        <span class="keyword">int</span> frequentRenterPoints = <span class="number">0</span>;</div><div class="line">        String result = <span class="string">"Rental record for "</span> + getName() + <span class="string">"\n"</span>;</div><div class="line"></div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> index = <span class="number">0</span>; index &lt; _rentals.size(); index++) &#123;</div><div class="line">            <span class="keyword">double</span> thisAmount = <span class="number">0</span>;</div><div class="line">            Rental each = (Rental) _rentals.get(index);</div><div class="line"></div><div class="line">            <span class="keyword">switch</span> (each.getMovie().getPriceCode()) &#123;</div><div class="line">            <span class="keyword">case</span> Movie.REGULAR:</div><div class="line">                thisAmount += <span class="number">2</span>;</div><div class="line">                <span class="keyword">if</span> (each.getDaysRented() <span class="number">2</span>)</div><div class="line">                    thisAmount += (each.getDaysRented() - <span class="number">2</span>) * <span class="number">1.5</span>;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> Movie.NEW_RELEASE:</div><div class="line">                thisAmount += each.getDaysRented() * <span class="number">3</span>;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> Movie.CHILDRENS:</div><div class="line">                thisAmount += <span class="number">1.5</span>;</div><div class="line">                <span class="keyword">if</span> (each.getDaysRented() <span class="number">3</span>)</div><div class="line">                    thisAmount += (each.getDaysRented() - <span class="number">3</span>) * <span class="number">1.5</span>;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            &#125;</div><div class="line">            frequentRenterPoints++;</div><div class="line">            <span class="keyword">if</span> (each.getMovie().getPriceCode() == Movie.NEW_RELEASE</div><div class="line">                    &amp;&amp; each.getDaysRented() <span class="number">1</span>)</div><div class="line">                frequentRenterPoints++;</div><div class="line"></div><div class="line">            result += <span class="string">"\t"</span> + each.getMovie().getTitle() + <span class="string">"\t"</span></div><div class="line">                    + String.valueOf(thisAmount) + <span class="string">"\n"</span>;</div><div class="line">            totalAmount += thisAmount;</div><div class="line">        &#125;</div><div class="line">        result += <span class="string">"Amount owed is "</span> + String.valueOf(totalAmount) + <span class="string">"\n"</span>;</div><div class="line">        result += <span class="string">"You earned "</span> + String.valueOf(frequentRenterPoints)</div><div class="line">                + <span class="string">"frequent renter points"</span>;</div><div class="line">        <span class="keyword">return</span> result;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Cp1Demo1</span></span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        Customer cuntomer = <span class="keyword">new</span> Customer(<span class="string">"David"</span>);</div><div class="line">        cuntomer.addRental(<span class="keyword">new</span> Rental(<span class="keyword">new</span> Movie(<span class="string">"Lost Template"</span>, Movie.NEW_RELEASE), <span class="number">5</span>));</div><div class="line">        cuntomer.addRental(<span class="keyword">new</span> Rental(<span class="keyword">new</span> Movie(<span class="string">"The Great Gatsby"</span>, Movie.REGULAR), <span class="number">4</span>));</div><div class="line">        cuntomer.addRental(<span class="keyword">new</span> Rental(<span class="keyword">new</span> Movie(<span class="string">"Wolf and Sheep"</span>, Movie.CHILDRENS), <span class="number">2</span>));</div><div class="line">        cuntomer.addRental(<span class="keyword">new</span> Rental(<span class="keyword">new</span> Movie(<span class="string">"Star Trek"</span>, Movie.REGULAR), <span class="number">2</span>));</div><div class="line">        System.out.println(cuntomer.statement());</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>#Round.2 让代码变得可测试（增加单元测试）<br>首先，先改造Customer类，让statement中的核心计算方法（算价格和算积分的方法）抽出。<br><figure class="highlight java"><figcaption><span>Customer.java</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Customer</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> String name;</div><div class="line"></div><div class="line">    <span class="comment">//......省略部分代码</span></div><div class="line"></div><div class="line">    <span class="comment">//去除statement和main部分</span></div><div class="line"></div><div class="line">    <span class="comment">//对于statement中的方法，抽出两个关键的核心方法</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">amountTotalConsume</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">double</span> totalAmount = <span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> index = <span class="number">0</span>; index &lt; getRentals().size(); index++) &#123;</div><div class="line">            <span class="keyword">double</span> thisAmount = <span class="number">0</span>;</div><div class="line">            Rental each = (Rental) getRentals().get(index);</div><div class="line"></div><div class="line">            <span class="keyword">switch</span> (each.getMovie().getPriceCode()) &#123;</div><div class="line">            <span class="keyword">case</span> Movie.REGULAR:</div><div class="line">                thisAmount += <span class="number">2</span>;</div><div class="line">                <span class="keyword">if</span> (each.getDaysRented() <span class="number">2</span>)</div><div class="line">                    thisAmount += (each.getDaysRented() - <span class="number">2</span>) * <span class="number">1.5</span>;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> Movie.NEW_RELEASE:</div><div class="line">                thisAmount += each.getDaysRented() * <span class="number">3</span>;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> Movie.CHILDRENS:</div><div class="line">                thisAmount += <span class="number">1.5</span>;</div><div class="line">                <span class="keyword">if</span> (each.getDaysRented() <span class="number">3</span>)</div><div class="line">                    thisAmount += (each.getDaysRented() - <span class="number">3</span>) * <span class="number">1.5</span>;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            &#125;</div><div class="line">            <span class="comment">// 日志</span></div><div class="line">            System.out.println(<span class="string">"\t"</span> + each.getMovie().getTitle() + <span class="string">"\t"</span></div><div class="line">                    + String.valueOf(thisAmount));</div><div class="line">            totalAmount += thisAmount;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> totalAmount;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">countFrequentRenterPoints</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> frequentRenterPoints = <span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> index = <span class="number">0</span>; index &lt; getRentals().size(); index++) &#123;</div><div class="line">            Rental each = (Rental) getRentals().get(index);</div><div class="line"></div><div class="line">            frequentRenterPoints++;</div><div class="line">            <span class="keyword">if</span> (each.getMovie().getPriceCode() == Movie.NEW_RELEASE</div><div class="line">                    &amp;&amp; each.getDaysRented() <span class="number">1</span>)</div><div class="line">                frequentRenterPoints++;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> frequentRenterPoints;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>抽出后，也留有打印信息的事务入口，将入口创建一个新的类CustomerConsumeClinent<br><figure class="highlight java"><figcaption><span>CustomerConsumeClinent.java</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomerConsumeClinent</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">statement</span><span class="params">(Customer customer)</span> </span>&#123;</div><div class="line">        System.out.println(<span class="string">"Rental record for "</span> + customer.getName());</div><div class="line">        StringBuilder resultSb = <span class="keyword">new</span> StringBuilder();</div><div class="line">        resultSb.append(<span class="string">"Amount owed is "</span>)</div><div class="line">                .append(String.valueOf(customer.amountTotalConsume()))</div><div class="line">                .append(<span class="string">"\n"</span>).append(<span class="string">"You earned "</span>)</div><div class="line">                .append(String.valueOf(customer.countFrequentRenterPoints()))</div><div class="line">                .append(<span class="string">" frequent renter points"</span>);</div><div class="line">        <span class="keyword">return</span> resultSb.toString();</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        Customer customer = <span class="keyword">new</span> Customer(<span class="string">"David"</span>);</div><div class="line">        customer.addRental(<span class="keyword">new</span> Rental(<span class="keyword">new</span> Movie(<span class="string">"Lost Template"</span>,</div><div class="line">                Movie.NEW_RELEASE), <span class="number">2</span>));</div><div class="line">        customer.addRental(<span class="keyword">new</span> Rental(<span class="keyword">new</span> Movie(<span class="string">"Lost Template2"</span>,</div><div class="line">                Movie.NEW_RELEASE), <span class="number">2</span>));</div><div class="line">        customer.addRental(<span class="keyword">new</span> Rental(<span class="keyword">new</span> Movie(<span class="string">"The Great Gatsby"</span>,</div><div class="line">                Movie.REGULAR), <span class="number">2</span>));</div><div class="line">        customer.addRental(<span class="keyword">new</span> Rental(<span class="keyword">new</span> Movie(<span class="string">"Wolf and Sheep"</span>,</div><div class="line">                Movie.CHILDRENS), <span class="number">2</span>));</div><div class="line">        customer.addRental(<span class="keyword">new</span> Rental(<span class="keyword">new</span> Movie(<span class="string">"Star Trek"</span>, Movie.REGULAR), <span class="number">2</span>));</div><div class="line">        System.out.println(<span class="keyword">new</span> CustomerConsumeClinent().statement(customer));</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>然后添加单元测试，这里使用的是Junit4加上cucumber-java（Ruby中cucumber的java版本）进行BDD。<br>先修改maven的配置文件。<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></div><div class="line"><span class="tag">	<span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd"</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.david.codejourney<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>refactoring-book<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line"></div><div class="line">	<span class="tag">&lt;<span class="name">build</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">plugins</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">plugin</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">version</span>&gt;</span>2.5.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">configuration</span>&gt;</span></div><div class="line">					<span class="tag">&lt;<span class="name">encoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">encoding</span>&gt;</span></div><div class="line">					<span class="tag">&lt;<span class="name">source</span>&gt;</span>1.6<span class="tag">&lt;/<span class="name">source</span>&gt;</span></div><div class="line">					<span class="tag">&lt;<span class="name">target</span>&gt;</span>1.6<span class="tag">&lt;/<span class="name">target</span>&gt;</span></div><div class="line">				<span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></div><div class="line">			<span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></div><div class="line"></div><div class="line">			<span class="tag">&lt;<span class="name">plugin</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-surefire-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">version</span>&gt;</span>2.12.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">configuration</span>&gt;</span></div><div class="line">					<span class="tag">&lt;<span class="name">useFile</span>&gt;</span>false<span class="tag">&lt;/<span class="name">useFile</span>&gt;</span></div><div class="line">				<span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></div><div class="line">			<span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">build</span>&gt;</span></div><div class="line"></div><div class="line">	<span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>info.cukes<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cucumber-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>info.cukes<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cucumber-junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.rubiconproject.oss<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jchronic<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">version</span>&gt;</span>0.2.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">version</span>&gt;</span>4.11<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">properties</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">file.encoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">file.encoding</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">properties</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>然后写功能描述文件，也就是单元测试的依据。这里不详细说明cucumber如何使用，有兴趣的自己去搜索相关知识再来看这部分代码，没兴趣的就跳过，知道他是在单元测试就好。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">Feature: Refactoring Book</div><div class="line">  In order to study.</div><div class="line"></div><div class="line">  Scenario Outline: potter tests</div><div class="line">    Given Init the customer</div><div class="line">    And customer rental &lt;number of 1st moviedays of REGULAR movie</div><div class="line">    And customer rental &lt;number of 2nd moviedays of REGULAR movie</div><div class="line">    And customer rental &lt;number of 3rd moviedays of NEW_RELEASE movie</div><div class="line">    And customer rental &lt;number of 4th moviedays of NEW_RELEASE movie</div><div class="line">    And customer rental &lt;number of 5th moviedays of REGULAR movie</div><div class="line">    When I calculate the price and point</div><div class="line">    Then I should get the lowest price &lt;total amountand frequent points &lt;frequent renter points&gt;</div><div class="line"></div><div class="line">  Examples: test basics</div><div class="line">    | number of 1st movie| number of 2nd movie| number of 3rd movie| number of 4th movie| number of 5th movie| total amount | frequent renter points |</div><div class="line">    |         5          |           3        |           4        |         2          |          2         |       32.5   |           7            |</div><div class="line">    |         2          |           2        |           2        |         2          |          2         |       17.5   |           7            |</div><div class="line"></div><div class="line">  Examples: test simple discounts</div><div class="line">    | number of 1st movie| number of 2nd movie| number of 3rd movie| number of 4th movie| number of 5th movie| total amount | frequent renter points |</div><div class="line">    |         1          |           1        |           1        |         1          |          1         |       11.5   |           5            |</div></pre></td></tr></table></figure></p>
<p>然后写单元测试类，该类需要和前面的功能文件对应。<br><figure class="highlight java"><figcaption><span>RefactoringStepdefs.java</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RefactoringStepdefs</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> Customer customer;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> bookCount;</div><div class="line"></div><div class="line">    <span class="meta">@Given</span>(<span class="string">"^Init the customer$"</span>)</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> <span class="keyword">throws</span> Throwable </span>&#123;</div><div class="line">        customer = <span class="keyword">new</span> Customer(<span class="string">"David"</span>);</div><div class="line">        bookCount = <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Given</span>(<span class="string">"^customer rental (\\d+) days of (\\w+) movie$"</span>)</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">customerRentalMovieSimpleTest</span><span class="params">(<span class="keyword">int</span> days, String movieType)</span></span></div><div class="line"><span class="function">            <span class="keyword">throws</span> Throwable </span>&#123;</div><div class="line">        bookCount++;</div><div class="line">        customer.addRental(<span class="keyword">new</span> Rental(<span class="keyword">new</span> Movie(<span class="string">"Movie "</span> + bookCount, movieType</div><div class="line">                .equals(<span class="string">"REGULAR"</span>) ? <span class="number">0</span> : movieType.equals(<span class="string">"NEW_RELEASE"</span>) ? <span class="number">1</span></div><div class="line">                : <span class="number">2</span>), days));</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@When</span>(<span class="string">"^I calculate the price and point$"</span>)</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">calcAndCount</span><span class="params">()</span> <span class="keyword">throws</span> Throwable </span>&#123;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Then</span>(<span class="string">"I should get the lowest price (\\S+) and frequent points (\\d+)$"</span>)</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">I_should_get_the_lowest_price</span><span class="params">(<span class="keyword">double</span> totalAmout,</span></span></div><div class="line"><span class="function"><span class="params">            <span class="keyword">int</span> frequentRenterPoints)</span> <span class="keyword">throws</span> Throwable </span>&#123;</div><div class="line"></div><div class="line">        assertEquals(<span class="string">"failure - not the same with expected amout"</span>,</div><div class="line">                totalAmout, customer.amountTotalConsume(),<span class="number">5</span>);</div><div class="line">        assertEquals(<span class="string">"failure - not the same with expected point"</span>,</div><div class="line">                frequentRenterPoints, customer.countFrequentRenterPoints());</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>#Round.3 大胆的进行重构<br>现在已经有了单元测试的保证了，可以大胆进行重构了，按前篇博文中说到的进行。</p>
<h2 id="用简洁易懂的句法，控制一个函数类代码的数量，让一个函数只做一件事情"><a href="#用简洁易懂的句法，控制一个函数类代码的数量，让一个函数只做一件事情" class="headerlink" title="用简洁易懂的句法，控制一个函数类代码的数量，让一个函数只做一件事情"></a>用简洁易懂的句法，控制一个函数类代码的数量，让一个函数只做一件事情</h2><p>这个round2已经做了，不在让一个打印输出的方法，又同时做计算价格、统计积分等事情。</p>
<h2 id="修改变量名"><a href="#修改变量名" class="headerlink" title="修改变量名"></a>修改变量名</h2><p>这个较多地方都有问题，比如round1中的成员变量命名不是java的规范，全部重新写过。还比如遍历中用each作为变量名，很难表达变量的意思。</p>
<h2 id="相同的逻辑出现3次，抽方法"><a href="#相同的逻辑出现3次，抽方法" class="headerlink" title="相同的逻辑出现3次，抽方法"></a>相同的逻辑出现3次，抽方法</h2><p>这里功能比较简单，会重复出现的方法已经抽出来了，所以这里用不到该方法。</p>
<h2 id="一个类中的一个方法出现与另一个类进行更多的交流时，考虑搬移函数到该类中，然后该方法中直接调用该类的新方法"><a href="#一个类中的一个方法出现与另一个类进行更多的交流时，考虑搬移函数到该类中，然后该方法中直接调用该类的新方法" class="headerlink" title="一个类中的一个方法出现与另一个类进行更多的交流时，考虑搬移函数到该类中，然后该方法中直接调用该类的新方法"></a>一个类中的一个方法出现与另一个类进行更多的交流时，考虑搬移函数到该类中，然后该方法中直接调用该类的新方法</h2><p>这里对于每个Rental的计算积分和计算价格方法，都更应该移动到Rental中，因为看代码可以看到，他调用了很多次Rental的方法。<br>重构后的代码<br><figure class="highlight java"><figcaption><span>Customer.java</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Customer</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> String name;</div><div class="line">    <span class="keyword">private</span> List&lt;Rentalrentals = <span class="keyword">new</span> ArrayList&lt;Rental&gt;();</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Customer</span><span class="params">(String name)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.name = name;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addRental</span><span class="params">(Rental arg)</span> </span>&#123;</div><div class="line">        rentals.add(arg);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.name;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">public</span> List&lt;RentalgetRentals() &#123;</div><div class="line">        <span class="keyword">return</span> rentals;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">amountTotalConsume</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">double</span> result = <span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span> (Rental aRental : getRentals()) &#123;</div><div class="line">            result += aRental.getCharge();</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> result;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">countFrequentRenterPoints</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> frequentRenterPoints = <span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span> (Rental aRental : getRentals()) &#123;</div><div class="line">            frequentRenterPoints += aRental.getFrquentRenterPoints();</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> frequentRenterPoints;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight java"><figcaption><span>Rental.java</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Rental</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> Movie movie;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> daysRented;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Rental</span><span class="params">(Movie movie, <span class="keyword">int</span> daysRented)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.movie = movie;</div><div class="line">        <span class="keyword">this</span>.daysRented = daysRented;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getDaysRented</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.daysRented;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> Movie <span class="title">getMovie</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.movie;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getFrquentRenterPoints</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> frequentRenterPoints = <span class="number">0</span>;</div><div class="line">        frequentRenterPoints++;</div><div class="line">        <span class="keyword">if</span> (getMovie().getPriceCode() == Movie.NEW_RELEASE</div><div class="line">                &amp;&amp; getDaysRented() <span class="number">1</span>) &#123;</div><div class="line">            frequentRenterPoints++;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> frequentRenterPoints;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">getCharge</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">double</span> thisAmount = <span class="number">0</span>;</div><div class="line">        <span class="keyword">switch</span> (getMovie().getPriceCode()) &#123;</div><div class="line">        <span class="comment">// 这里的数量和定价策略可以先不改变，当增加新功能需要的时候</span></div><div class="line">        <span class="keyword">case</span> Movie.REGULAR:</div><div class="line">            thisAmount += <span class="number">2</span>;</div><div class="line">            <span class="keyword">if</span> (getDaysRented() <span class="number">2</span>)</div><div class="line">                thisAmount += (getDaysRented() - <span class="number">2</span>) * <span class="number">1.5</span>;</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        <span class="keyword">case</span> Movie.NEW_RELEASE:</div><div class="line">            thisAmount += getDaysRented() * <span class="number">3</span>;</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        <span class="keyword">case</span> Movie.CHILDRENS:</div><div class="line">            thisAmount += <span class="number">1.5</span>;</div><div class="line">            <span class="keyword">if</span> (getDaysRented() <span class="number">3</span>)</div><div class="line">                thisAmount += (getDaysRented() - <span class="number">3</span>) * <span class="number">1.5</span>;</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// 日志</span></div><div class="line">        System.out.println(<span class="string">"\t"</span> + getMovie().getTitle() + <span class="string">"\t"</span></div><div class="line">                + String.valueOf(thisAmount));</div><div class="line">        <span class="keyword">return</span> thisAmount;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight java"><figcaption><span>Movie.java</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Movie</span> </span>&#123;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> CHILDRENS = <span class="number">2</span>;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> NEW_RELEASE = <span class="number">1</span>;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> REGULAR = <span class="number">0</span>;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> String title;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> priceCode;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Movie</span><span class="params">(String title, <span class="keyword">int</span> priceCode)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.title = title;</div><div class="line">        <span class="keyword">this</span>.priceCode = priceCode;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getPriceCode</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.priceCode;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPriceCode</span><span class="params">(<span class="keyword">int</span> arg)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.priceCode = arg;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getTitle</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.title;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>重构完后，运行下单元测试，没问题，那么很好，完美收工。</p>
<p>#Round.4 如果发现增加一个功能很差，那么继续重构吧<br>一般情况下，做到第3步已经够了，第四部主要是说明，当你遇到新的需求，增加这个需求需要改动过大时候，那么说明代码的设计不够可维护可扩展可复用。<br>如下重构则为当需要增加一个类型，或者更改价格、积分计算策略时候的调整。</p>
<h2 id="开始重构，用多态替换逻辑判断"><a href="#开始重构，用多态替换逻辑判断" class="headerlink" title="开始重构，用多态替换逻辑判断"></a>开始重构，用多态替换逻辑判断</h2><p>首先，把getCharge与getFrquentRenterPoints方法移动到Movie中，因为我们需要用多态来代替逻辑状态判断。<br><figure class="highlight java"><figcaption><span>Rental.java</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Rental</span> </span>&#123;</div><div class="line">		<span class="comment">//...省略</span></div><div class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getFrquentRenterPoints</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> getMovie().getFrquentRenterPoints(daysRented);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">getCharge</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> getMovie().getCharge(daysRented);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight java"><figcaption><span>Movie.java</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Movie</span> </span>&#123;</div><div class="line">		<span class="comment">//...省略部分代码，然后把priceType变量替换成一个枚举类型的变量</span></div><div class="line">    <span class="keyword">private</span> MovieTypeEnum movieType;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Movie</span><span class="params">(String title, <span class="keyword">int</span> movieTypeCode)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.title = title;</div><div class="line">        movieType = MovieTypeEnum.convertByCode(String.valueOf(movieTypeCode));</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Movie</span><span class="params">(String title, String movieTypeName)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.title = title;</div><div class="line">        movieType = MovieTypeEnum.convertByName(movieTypeName);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getFrquentRenterPoints</span><span class="params">(<span class="keyword">int</span> daysRented)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> movieType.getFrquentRenterPoints(daysRented);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">getCharge</span><span class="params">(<span class="keyword">int</span> daysRented)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> movieType.getCharge(daysRented);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getPriceCode</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> Integer.valueOf(<span class="keyword">this</span>.movieType.getCode());</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPriceCode</span><span class="params">(<span class="keyword">int</span> movieTypeCode)</span> </span>&#123;</div><div class="line">        movieType = MovieTypeEnum.convertByCode(String.valueOf(movieTypeCode));</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> MovieTypeEnum <span class="title">getMovieType</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> movieType;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMovieType</span><span class="params">(MovieTypeEnum movieType)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.movieType = movieType;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getTitle</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.title;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="创建枚举"><a href="#创建枚举" class="headerlink" title="创建枚举"></a>创建枚举</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">enum</span> MovieTypeEnum &#123;</div><div class="line"><span class="comment">//这部分代码是我重构过程中犯下的低级错误，但是只要有单元测试，就能保证错误一旦出现，很快就能发现</span></div><div class="line"><span class="comment">//    CHILDRENS("2","CHILDRENS",new ChildrensPriceHandler(),new DefaultPointHandler()),</span></div><div class="line"><span class="comment">//    NEW_RELEASE("1","NEW_RELEASE",new ChildrensPriceHandler(),new DefaultPointHandler()),</span></div><div class="line"><span class="comment">//    REGULAR("0","REGULAR",new ChildrensPriceHandler(),new DefaultPointHandler());</span></div><div class="line"></div><div class="line">    CHILDRENS(<span class="string">"2"</span>,<span class="string">"CHILDRENS"</span>,<span class="keyword">new</span> ChildrensPriceHandler(),<span class="keyword">new</span> DefaultPointHandler()),</div><div class="line">    NEW_RELEASE(<span class="string">"1"</span>,<span class="string">"NEW_RELEASE"</span>,<span class="keyword">new</span> NewReleasePriceHandler(),<span class="keyword">new</span> NewReleasePointHandler()),</div><div class="line">    REGULAR(<span class="string">"0"</span>,<span class="string">"REGULAR"</span>,<span class="keyword">new</span> RegularPriceHandler(),<span class="keyword">new</span> DefaultPointHandler());</div><div class="line">    <span class="keyword">public</span> <span class="keyword">final</span> String code;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">final</span> String name;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">final</span> IPriceHandler priceHandler;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">final</span> IPointHandler pointHandler;</div><div class="line">    MovieTypeEnum(String code,String name,IPriceHandler priceHandler , IPointHandler pointHandler)&#123;</div><div class="line">        <span class="keyword">this</span>.code = code;</div><div class="line">        <span class="keyword">this</span>.name = name;</div><div class="line">        <span class="keyword">this</span>.priceHandler = priceHandler;</div><div class="line">        <span class="keyword">this</span>.pointHandler = pointHandler;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getCode</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> code;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> name;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> IPriceHandler <span class="title">getPriceHandler</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> priceHandler;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> IPointHandler <span class="title">getPointHandler</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> pointHandler;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getFrquentRenterPoints</span><span class="params">(<span class="keyword">int</span> daysRented)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> pointHandler.getFrquentRenterPoints(daysRented);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">getCharge</span><span class="params">(<span class="keyword">int</span> daysRented)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> priceHandler.getCharge(daysRented);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> MovieTypeEnum <span class="title">convertByCode</span><span class="params">(String code)</span></span>&#123;</div><div class="line">        <span class="keyword">if</span>(MovieTypeEnum.CHILDRENS.getCode().equals(code))&#123;</div><div class="line">            <span class="keyword">return</span> MovieTypeEnum.CHILDRENS;</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(MovieTypeEnum.NEW_RELEASE.getCode().equals(code))&#123;</div><div class="line">            <span class="keyword">return</span> MovieTypeEnum.NEW_RELEASE;</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(MovieTypeEnum.REGULAR.getCode().equals(code))&#123;</div><div class="line">            <span class="keyword">return</span> MovieTypeEnum.REGULAR;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> MovieTypeEnum <span class="title">convertByName</span><span class="params">(String name)</span></span>&#123;</div><div class="line">        <span class="keyword">if</span>(MovieTypeEnum.CHILDRENS.getName().equals(name))&#123;</div><div class="line">            <span class="keyword">return</span> MovieTypeEnum.CHILDRENS;</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(MovieTypeEnum.NEW_RELEASE.getName().equals(name))&#123;</div><div class="line">            <span class="keyword">return</span> MovieTypeEnum.NEW_RELEASE;</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(MovieTypeEnum.REGULAR.getName().equals(name))&#123;</div><div class="line">            <span class="keyword">return</span> MovieTypeEnum.REGULAR;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="处理器"><a href="#处理器" class="headerlink" title="处理器"></a>处理器</h2><p>这里分别实现了价格处理器和积分处理器，接口如下：<br><figure class="highlight java"><figcaption><span>IPointHandler.java</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IPointHandler</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getFrquentRenterPoints</span><span class="params">(<span class="keyword">int</span> daysRented)</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight java"><figcaption><span>IPriceHandler.java</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IPriceHandler</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">getCharge</span><span class="params">(<span class="keyword">int</span> daysRented)</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>具体处理器的实现这里就举一个例子，顺便看看同个处理逻辑两段代码的实现有多大差别。下面两段代码功能一样，代码前者多了那么多代码和临时变量。可以看出，写的优美的代码，不但易懂，而且优美。</p>
<figure class="highlight java"><figcaption><span>旧NewReleasePointHandler.java</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NewReleasePointHandler</span> <span class="keyword">extends</span> <span class="title">DefaultPointHandler</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getFrquentRenterPoints</span><span class="params">(<span class="keyword">int</span> daysRented)</span> </span>&#123;</div><div class="line">				<span class="keyword">int</span> frequentRenterPoints = <span class="number">1</span>;</div><div class="line">        <span class="keyword">if</span> (daysRented <span class="number">1</span>) &#123;</div><div class="line">            frequentRenterPoints++;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> frequentRenterPoints;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight java"><figcaption><span>新NewReleasePointHandler.java</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NewReleasePointHandler</span> <span class="keyword">extends</span> <span class="title">DefaultPointHandler</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getFrquentRenterPoints</span><span class="params">(<span class="keyword">int</span> daysRented)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> (daysRented <span class="number">1</span>) ? <span class="number">2</span> : <span class="number">1</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>运行单元而是，没问题，很好，又可以收工了（当然中间有出现错误，还有很多的调试）。</p>
<p>#Round.5 to be continue<br>重构不是一种状态，他是不断根据环境、需求、设计的变化去变化的。俗话说，只有变化是不变的，因此，重构一定会陪伴着整个软件过程，有了重构，也不用再怕这些变化了。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/5/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><span class="page-number current">6</span><a class="page-number" href="/page/7/">7</a><span class="space">&hellip;</span><a class="page-number" href="/page/12/">12</a><a class="extend next" rel="next" href="/page/7/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="David Woo" />
          <p class="site-author-name" itemprop="name">David Woo</p>
          <p class="site-description motion-element" itemprop="description"></p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/">
              <span class="site-state-item-count">113</span>
              <span class="site-state-item-name">Artikel</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              
                <span class="site-state-item-count">195</span>
                <span class="site-state-item-name">Kategorien</span>
              
            </div>
          

          
            <div class="site-state-item site-state-tags">
              
                <span class="site-state-item-count">5</span>
                <span class="site-state-item-name">Tags</span>
              
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">David Woo</span>
</div>

<div class="powered-by">
  Erstellt mit  <a class="theme-link" href="https://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  



  




  
  

  

  

  

</body>
</html>
