<!doctype html>



  


<html class="theme-next muse use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta property="og:type" content="website">
<meta property="og:title" content="å¤§èƒƒå´çš„é—²è¯å” å—‘">
<meta property="og:url" content="http://yoursite.com/page/2/index.html">
<meta property="og:site_name" content="å¤§èƒƒå´çš„é—²è¯å” å—‘">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="å¤§èƒƒå´çš„é—²è¯å” å—‘">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: 'Author'
    }
  };
</script>




  <link rel="canonical" href="http://yoursite.com/page/2/"/>

  <title> å¤§èƒƒå´çš„é—²è¯å” å—‘ </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">å¤§èƒƒå´çš„é—²è¯å” å—‘</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">æ‰¯æ‰¯æŠ€æœ¯ï¼Œå” å” é—²è¯ äº¤æµemail-xiao303178394@gmail.com</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-é¦–é¡µ">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            menu.é¦–é¡µ
          </a>
        </li>
      
        
        <li class="menu-item menu-item-æ–‡ç« ">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            menu.æ–‡ç« 
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2018/03/21/åœ¨React-Nativeåº”ç”¨ä¸­é€šè¿‡React-Artå®ç°ç‚¹å‡»ç¤¼èŠ±æ•ˆæœ/" itemprop="url">
                  åœ¨React-Nativeåº”ç”¨ä¸­é€šè¿‡React-Artå®ç°ç‚¹å‡»ç¤¼èŠ±æ•ˆæœ
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">VerÃ¶ffentlicht am</span>
            <time itemprop="dateCreated" datetime="2018-03-21T14:15:52+08:00" content="2018-03-21">
              2018-03-21
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h2><p>å®é™…ä¸Šè¿™ä¸ªä¾‹å­å¹¶ä¸éœ€è¦ä½¿ç”¨react-artå°±èƒ½å®ç°ï¼Œä½†æ˜¯æˆ‘ä»¬å°†ä½¿ç”¨react-artæ¥å®ç°ä¸€ç§è‰¯å¥½çš„æ•ˆæœã€‚é‚£è¿™ä¸ªä¾‹å­ä¸­æˆ‘ä»¬è¦å®Œæˆçš„æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿç¤¼èŠ±ğŸ‰ç§€ã€‚å¹¶ä¸èŠ±å“¨ï¼Œåªéœ€è¦ç‚¹å‡»å±å¹•ï¼Œä¸€æœµç¤¼èŠ±å°±å°†è¦å‘å°„åˆ°ä½ ç‚¹å‡»çš„åœ°æ–¹å¹¶å±•å¼€ã€‚</p>
<h2 id="æœ€ç»ˆæ•ˆæœ"><a href="#æœ€ç»ˆæ•ˆæœ" class="headerlink" title="æœ€ç»ˆæ•ˆæœ"></a>æœ€ç»ˆæ•ˆæœ</h2><p>è¿™å°±æ˜¯æˆ‘ä»¬è¦å®ç°çš„æ•ˆæœã€‚</p>
<p><img src="http://7oxfjd.com2.z0.glb.qiniucdn.com/2018-03-21-preview_3.gif" alt="preview_3"></p>
<h2 id="start-project"><a href="#start-project" class="headerlink" title="start project"></a>start project</h2><p>å°±åƒæ™®é€šçš„é¡¹ç›®é‚£æ ·ï¼Œåˆ›å»ºä¸€ä¸ªç©ºç™½çš„React-Nativeå·¥ç¨‹ï¼Œç„¶åæŠŠindex.jsé‡Œçš„è‡ªåŠ¨ç”Ÿæˆä»£ç æ”¹ä¸º</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">import React, &#123;</div><div class="line">    Component</div><div class="line">&#125;from &apos;react&apos;;</div><div class="line"></div><div class="line">import &#123;</div><div class="line">    ART as Art,</div><div class="line">    StyleSheet,</div><div class="line">    View,</div><div class="line">    Dimensions,</div><div class="line">    TouchableWithoutFeedback,</div><div class="line">    Animated</div><div class="line">&#125; from &apos;react-native&apos;;</div><div class="line"></div><div class="line">var &#123;</div><div class="line">    width,</div><div class="line">    height</div><div class="line">&#125; = Dimensions.get(&apos;window&apos;);</div><div class="line"></div><div class="line">var &#123;</div><div class="line">    Surface,</div><div class="line">    Shape,</div><div class="line">    Path,</div><div class="line">    Group,</div><div class="line">    Transform</div><div class="line">&#125; = Art;</div><div class="line"></div><div class="line">var AnimatedShape = Animated.createAnimatedComponent(Shape);</div><div class="line">var AnimatedGroup = Animated.createAnimatedComponent(Group);</div></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å¼•å…¥äº†Animated APIï¼Œreact-artåº“ï¼Œè¿˜æœ‰ä¸€äº›ARTçš„ç»„ä»¶ã€‚ç„¶åæˆ‘è¦åˆ›å»ºAnimatedShapeå’ŒAnimatedGroupï¼Œè¿™äº›è®©æˆ‘ä»¬å¯ä»¥è®¾ç½®fill, opacity, x, yè¿™äº›åŠ¨ç”»å±æ€§ï¼Œå¯ä»¥è®©åŠ¨ç”»æ•ˆæœå‡†ç¡®æœ‰æ•ˆã€‚</p>
<p>æ¥ç€ï¼Œæˆ‘ä»¬åˆ›å»ºstyles</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">var styles = StyleSheet.create(&#123;</div><div class="line">  container: &#123;</div><div class="line">    flex: 1,</div><div class="line">    flexDirection: &apos;column&apos;</div><div class="line">  &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>æ˜¯çš„ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬åŠ¨ç”»çš„å‘ç”Ÿçš„ç»„ä»¶äº†ã€‚</p>
<p>ç„¶ååˆ›å»ºæˆ‘ä»¬çš„ç»„ä»¶ç±»</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">export default class App extends Component&lt;Props&gt; &#123;</div><div class="line">    state = &#123;</div><div class="line">        fireworks: []</div><div class="line">    &#125;</div><div class="line">    render()&#123;</div><div class="line">        return (</div><div class="line">            &lt;View style=&#123;styles.container&#125;&gt;</div><div class="line">                &lt;TouchableWithoutFeedback&gt;</div><div class="line">                    &lt;View&gt;</div><div class="line">                        &lt;Surface width=&#123;width&#125; height=&#123;height&#125;&gt;</div><div class="line">                        &lt;/Surface&gt;</div><div class="line">                    &lt;/View&gt;</div><div class="line">                &lt;/TouchableWithoutFeedback&gt;</div><div class="line">            &lt;/View&gt;</div><div class="line">        );</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è¿™æ ·æˆ‘ä»¬çš„å¯åŠ¨ç©ºç™½å·¥ç¨‹å°±å®Œæˆäº†ã€‚ä¸€ä¸ªå®¹å™¨Viewï¼ŒåŒ…å«TouchableWithoutFeedbackè®©æˆ‘ä»¬èƒ½è·å–ç‚¹å‡»çš„åæ ‡ã€‚åœ¨Touchableä¸­éœ€è¦æœ‰ä¸€ä¸ªViewåœ¨åŒ…è£…æˆ‘ä»¬çš„react-art Surfaceç»„ä»¶ï¼Œå®ƒå¯ä»¥è®¾ç½®å®½é«˜ã€‚æˆ‘ä»¬çš„ä¾‹å­éœ€è¦ä¸€ä¸ªå…¨å±çš„ç”»å¸ƒï¼Œæ‰€ä»¥æˆ‘ä»¬é€šè¿‡è·å–å±å¹•å°ºå¯¸å¹¶è®¾ç½®ç»™Surfaceç»„ä»¶ã€‚</p>
<h2 id="è®©ç‚®å¼¹é£ä¸€ä¼š"><a href="#è®©ç‚®å¼¹é£ä¸€ä¼š" class="headerlink" title="è®©ç‚®å¼¹é£ä¸€ä¼š"></a>è®©ç‚®å¼¹é£ä¸€ä¼š</h2><p>è®©æˆ‘ä»¬æƒ³è±¡å‘é€ç‚®å¼¹çš„æƒ…æ™¯ï¼šä¸€ä¸ªç‚®å¼¹ä»å±å¹•åº•éƒ¨ä¸­å¤®å¤„å‘å°„åˆ°æˆ‘ä»¬åœ¨å±å¹•ä¸Šç‚¹å‡»çš„ä½ç½®ã€‚</p>
<p>é‚£ä¹Ÿå°±æ˜¯æˆ‘ä»¬è¦é€šè¿‡react-artç»˜åˆ¶ä¸€ä¸ªåœ†ï¼›è¿˜è¦æœ‰ä¸€ä¸ªå¯ä»¥è§¦åœ°ç‚¹å‡»äº‹ä»¶çš„å‡½æ•°å»è·å–æˆ‘ä»¬ç‚¹å‡»çš„ä½ç½®ï¼›è¿˜è¦é€šè¿‡Animatedå°†åœ†å‘å°„åˆ°ç‚¹å‡»çš„ä½ç½®ï¼›æœ€ååœ¨ç‚¹å‡»çš„ä½ç½®æ¸²æŸ“å‡ºè¿™ä¸ªç‚®å¼¹ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">&lt;TouchableWithoutFeedback onPress=&#123;this._handleAddFirework&#125;&gt;</div></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å°†ä½¿ç”¨TouchableWithoutFeedbackåœ¨ç”¨æˆ·ç‚¹å‡»å±å¹•æ—¶å€™å›è°ƒå‡½æ•°å»å¢åŠ ç¤¼èŠ±åˆ°é˜Ÿåˆ—ä¸­ã€‚ç„¶åæ¸²æŸ“æ—¶å€™åœ¨é˜Ÿåˆ—ä¸­è¯»å–ç‚®å¼¹å¹¶ç»˜åˆ¶ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">class AnimatedCircle extends Component&lt;Props&gt; &#123;</div><div class="line">    render()&#123;</div><div class="line">        var radius = this.props.radius;</div><div class="line">        var path = Path().moveTo(0, -radius)</div><div class="line">            .arc(0, radius * 2, radius)</div><div class="line">            .arc(0, radius * -2, radius)</div><div class="line">            .close();</div><div class="line">        return (</div><div class="line">            &lt;AnimatedShape d=&#123;path&#125;  &#123;...this.props&#125;/&gt;</div><div class="line">        );</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>çœ‹èµ·æ¥æˆ‘ä»¬åªæ˜¯æŠŠAnimatedShapeåŒ…è£…èµ·æ¥ï¼Œä¹Ÿå°±æ˜¯ç»„ä»¶åŒ–ï¼Œè¿™æ ·å¯ä»¥å°½å¯èƒ½æ˜¯å¤ç”¨ä»£ç ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">const MORTAR_RADIUS = 5</div><div class="line">///...</div><div class="line">_handleAddFirework = (e) =&gt; &#123;</div><div class="line">    var _shootingPosition = new Animated.ValueXY(&#123;x: width/2, y: height - MORTAR_RADIUS&#125;);</div><div class="line"></div><div class="line">    this.state.fireworks.push(&#123;</div><div class="line">        shootingPosition: _shootingPosition,</div><div class="line">    &#125;);</div><div class="line"></div><div class="line">    Animated.timing(_shootingPosition, &#123;</div><div class="line">        duration: 300,</div><div class="line">        toValue: &#123;</div><div class="line">            y: e.nativeEvent.locationY,</div><div class="line">            x: e.nativeEvent.locationX</div><div class="line">        &#125;</div><div class="line">    &#125;).start()</div><div class="line"></div><div class="line">    this.setState(this.state);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å¥½çš„ï¼Œè®©æˆ‘ä»¬åœä¸‹æ¥åˆ†æä¸‹ä»£ç ã€‚</p>
<p>å‡½æ•°çš„ç¬¬ä¸€è¡Œ_shootingPositionï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªAnimatedçš„å‘é‡å€¼ç±»å‹ï¼Œè¿™æ˜¯é»˜è®¤å€¼ï¼Œä¹Ÿå°±æ˜¯ç‚®å¼¹å‘é€å‡ºæ¥çš„åœ°æ–¹ï¼Œå°±æ˜¯æ°´å¹³ä¸­å¤®ï¼Œå¹¶è·ç¦»åº•éƒ¨MORTAR_RADIUSçš„è·ç¦»ï¼Œä½¿ç”¨å¸¸é‡æ–¹ä¾¿æˆ‘ä»¬ä¿®æ”¹å°ºå¯¸æ—¶å€™å¯ä»¥ä¸ç”¨ä¿®æ”¹ä»£ç ï¼ŒMORTAR_RADIUSä¼šè®¾ç½®ä¸º5ï¼Œå› ä¸ºæˆ‘ä»¬ç‚®å¼¹çš„åŠå¾„ä¹Ÿæ˜¯5.</p>
<p>ç„¶åæˆ‘ä»¬å°†å®ƒæ·»åŠ åˆ°ä¸€ä¸ªç¤¼èŠ±çš„æ•°ç»„ä¸­ï¼Œç¨ä¼šæˆ‘ä»¬å°±è¦å‘å°„ä»–ä»¬äº†ã€‚</p>
<p>ç„¶åæˆ‘ä»¬å¼€å§‹åˆ›å»ºåŠ¨ç”»ã€‚æˆ‘ä»¬æƒ³è®©ç‚®å¼¹ç»è¿‡300æ¯«ç§’åˆ°è¾¾ç”¨æˆ·ç‚¹å‡»çš„ä½ç½®ï¼Œæ‰€ä»¥æˆ‘ä»¬è®¾ç½®toValueä¸ºç”¨æˆ·ç‚¹å‡»çš„ä½ç½®ã€‚ç„¶åæˆ‘ä»¬æ‰§è¡ŒåŠ¨ç”»ã€‚å¯¹ï¼Œæˆ‘ä»¬è¿˜æ²¡æœ‰æ¸²æŸ“ä»»ä½•ä¸œè¥¿ä½†ç›¸ä¿¡æˆ‘é©¬ä¸Šæˆ‘ä»¬å°±è¦çœ‹åˆ°ç¬¬ä¸€æ­¥çš„æ•ˆæœäº†ã€‚</p>
<p>æœ€åæˆ‘ä»¬è®¾ç½®stateï¼Œä»–ä¼šå¼•å‘å†æ¸²æŸ“ï¼Œç„¶åæˆ‘ä»¬å°±å¯ä»¥æ¸²æŸ“æˆ‘ä»¬çš„ç¤¼èŠ±äº†ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">&lt;Surface width=&#123;width&#125; height=&#123;height&#125;&gt;</div><div class="line">    &#123;</div><div class="line">        this.state.fireworks.map((firework, index) =&gt; &#123;</div><div class="line">            return &lt;AnimatedCircle</div><div class="line">                radius=&#123;MORTAR_RADIUS&#125;</div><div class="line">                x=&#123;firework.shootingPosition.x&#125;</div><div class="line">                y=&#123;firework.shootingPosition.y&#125;</div><div class="line">                key=&#123;&quot;circle&quot;+index&#125;</div><div class="line">                fill=&quot;#000&quot;</div><div class="line">            /&gt;</div><div class="line">        &#125;)</div><div class="line">    &#125;</div><div class="line">&lt;/Surface&gt;</div></pre></td></tr></table></figure>
<p>ä¸Šé¢ä»£ç ä¸­æˆ‘ä»¬æ˜ å°„äº†stateä¸­çš„æ¯ä¸ªç‚®å¼¹æˆAnimatedCircleï¼Œå¹¶è®¾ç½®ç›¸åº”çš„x,yå€¼ã€‚åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬è¦ç»™ç‚®å¼¹å¡«å……é»‘è‰²ä¸ºåˆå§‹é¢œè‰²ã€‚</p>
<p>åˆ°æ­¤ä½ç½®ï¼Œè¿è¡Œä»£ç å¯ä»¥çœ‹åˆ°åˆæ­¥çš„æ•ˆæœäº†ã€‚</p>
<p><img src="http://7oxfjd.com2.z0.glb.qiniucdn.com/2018-03-21-preview_1.gif" alt="preview_1"></p>
<h2 id="æ¶ˆå¤±çš„ç‚®å¼¹"><a href="#æ¶ˆå¤±çš„ç‚®å¼¹" class="headerlink" title="æ¶ˆå¤±çš„ç‚®å¼¹"></a>æ¶ˆå¤±çš„ç‚®å¼¹</h2><p>æ˜¯çš„ï¼Œç‚®å¼¹å¹¶ä¸æ˜¯è¿™æ ·ç²˜è´´åœ¨å±å¹•ä¸Šçš„ã€‚æ‰€ä»¥æˆ‘ä»¬è¦è®©ä»–ä»¬æ¶ˆå¤±ã€‚start()å‡½æ•°å¯ä»¥è®¾ç½®ä¸€ä¸ªå›è°ƒï¼Œå½“åŠ¨ç”»ç»“æŸåä¼šå›è°ƒä»–ã€‚</p>
<p>æ‰€ä»¥æ•°ç»„ä¸­çš„ç‚®å¼¹éœ€è¦å”¯ä¸€æ ‡è¯†ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨shootingPositionæ¥æ ‡è¯†å®ƒä»¬å¹¶è¿‡æ»¤å‡ºä»–ä»¬æ¥ã€‚</p>
<p>åƒä¸‹é¢è¿™æ ·</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">Animated.timing(_shootingPosition, &#123;</div><div class="line">    duration: 300,</div><div class="line">    toValue: &#123;</div><div class="line">        y: e.nativeEvent.locationY,</div><div class="line">        x: e.nativeEvent.locationX</div><div class="line">    &#125;</div><div class="line">&#125;).start(this.removeSelf.bind(this, _shootingPosition))</div><div class="line"></div><div class="line">this.setState(this.state);</div><div class="line">//...</div><div class="line"></div><div class="line">removeSelf = (_shootingPosition)=&gt; &#123;</div><div class="line">    this.setState(&#123;</div><div class="line">        fireworks: this.state.fireworks.filter((firework) =&gt; firework.shootingPosition !== _shootingPosition)</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ç»ˆäºå®ƒè¿è¡Œèµ·æ¥åƒä¸ªç‚®å¼¹äº†ã€‚</p>
<h2 id="é€ƒç¦»é»‘ç™½ä¸–ç•Œ"><a href="#é€ƒç¦»é»‘ç™½ä¸–ç•Œ" class="headerlink" title="é€ƒç¦»é»‘ç™½ä¸–ç•Œ"></a>é€ƒç¦»é»‘ç™½ä¸–ç•Œ</h2><p>ç°åœ¨æˆ‘ä»¬å¼€å§‹è®©ç‚®å¼¹ä¸åªæ˜¯ä¸€ä¸ªé»‘ç‚¹ã€‚è®©æˆ‘ä»¬å‡è®¾å®ƒæ˜¯ä¸ªç«çƒï¼Œé‚£æˆ‘ä»¬å¯ä»¥è®©ä»–åœ¨é»„å’Œæ©™è‰²ä¹‹é—´å˜æ¢é¢œè‰²ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">const SHOOTING_COLORS = [</div><div class="line">    &apos;rgb(234,238,112)&apos;, //Yellow</div><div class="line">    &apos;rgb(245,137,12)&apos; //Orange</div><div class="line">];</div></pre></td></tr></table></figure>
<p>æˆ‘ä»¬è¦è°ƒç”¨çš„interpolateå‡½æ•°åªé€‚ç”¨äºrgbï¼Œå› æ­¤ä½¿ç”¨rgbè€Œä¸æ˜¯hexã€‚</p>
<p>ç°åœ¨æˆ‘ä»¬å°±åˆ›å»ºå¦ä¸€ä¸ªAnimated valueï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">adjustShootingFill = (_shootingColor, value) =&gt; &#123;</div><div class="line">    Animated.timing(_shootingColor, &#123;</div><div class="line">        duration: 16,</div><div class="line">        toValue: _shootingColor.__getAnimatedValue() == 0 ? 1 : 0</div><div class="line">    &#125;).start()</div><div class="line">&#125;</div><div class="line"></div><div class="line">_handleAddFirework = (e) =&gt; &#123;</div><div class="line">    var _shootingPosition = new Animated.ValueXY(&#123;x: width/2, y: height - MORTAR_RADIUS&#125;);</div><div class="line">    var _shootingColor = new Animated.Value(0);</div><div class="line"></div><div class="line">    this.state.fireworks.push(&#123;</div><div class="line">        shootingPosition: _shootingPosition,</div><div class="line">        shootingColor: _shootingColor,</div><div class="line">    &#125;);</div><div class="line"></div><div class="line">    _shootingPosition.addListener(this.adjustShootingFill.bind(null, _shootingColor));</div><div class="line"></div><div class="line">    Animated.timing(_shootingPosition, &#123;</div><div class="line">        duration: 300,</div><div class="line">        toValue: &#123;</div><div class="line">            y: e.nativeEvent.locationY,</div><div class="line">            x: e.nativeEvent.locationX</div><div class="line">        &#125;</div><div class="line">    &#125;).start(this.removeSelf.bind(this, _shootingPosition))</div><div class="line"></div><div class="line">    this.setState(this.state);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å¼€å§‹æˆ‘ä»¬æ·»åŠ äº†ä¸€ä¸ªAnimated.Valueï¼Œé»˜è®¤è®¾ç½®ä¸º0.æˆ‘ä»¬æŠŠå®ƒæ·»åŠ åˆ°æˆ‘ä»¬çš„ç‚®å¼¹é›†åˆä¸­ã€‚</p>
<p>ç„¶åæˆ‘ä»¬æ·»åŠ äº†ä¸€ä¸ªç›‘å¬å™¨åœ¨_shootingPositionï¼Œè¿™æ ·å½“ç‚®å¼¹ä½ç½®å‘ç”Ÿå˜åŒ–çš„æ—¶å€™å°†è°ƒç”¨è®¾ç½®çš„å›è°ƒå‡½æ•°ã€‚å›è°ƒä¸­æˆ‘ä»¬ä¸æ–­çš„é€šè¿‡å˜æ¢é»„å’Œæ©™è‰²ã€‚é€šè¿‡Animated.timingå‡½æ•°æ‰§è¡Œå˜è‰²åŠ¨ç”»ï¼Œè¿™ä¸ªåŠ¨ç”»åœ¨16å†…å®Œæˆï¼Œ__getAnimatedValueå¯ä»¥è·å–å½“å‰å€¼å¹¶ä¸”å˜æ¢æˆå¦ä¸€ä¸ªã€‚</p>
<p>æ‰€ä»¥ï¼Œæ¯16æ¯«ç§’ï¼Œç‚®å¼¹çš„é¢œè‰²éƒ½æ˜¯é»„â†’æ©™â†’é»„â†’æ©™â€¦â€¦å¾ªç¯ä¸‹å»ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">&lt;Surface width=&#123;width&#125; height=&#123;height&#125;&gt;</div><div class="line">    &#123;</div><div class="line">        this.state.fireworks.map((firework, index) =&gt; &#123;</div><div class="line">            var _shootingFill = firework.shootingColor.interpolate(&#123;</div><div class="line">                inputRange: [0,1],</div><div class="line">                outputRange: SHOOTING_COLORS</div><div class="line">            &#125;);</div><div class="line">            return &lt;AnimatedCircle</div><div class="line">                radius=&#123;MORTAR_RADIUS&#125;</div><div class="line">                key=&#123;&quot;circle&quot;+index&#125;</div><div class="line">                x=&#123;firework.shootingPosition.x&#125;</div><div class="line">                y=&#123;firework.shootingPosition.y&#125;</div><div class="line">                fill=&#123;_shootingFill&#125;</div><div class="line">            /&gt;</div><div class="line">        &#125;)</div><div class="line">    &#125;</div><div class="line">&lt;/Surface&gt;</div></pre></td></tr></table></figure>
<p>æˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªinterpolatorï¼Œå®ƒå°è£…äº†Animated Valueåˆ°é¢œè‰²æ˜ å°„çš„é€»è¾‘ï¼Œæ˜ å°„æ˜¯åƒè¿™æ ·çš„</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">0 =&gt; yellow</div><div class="line">1 =&gt; orange</div></pre></td></tr></table></figure>
<p>ç„¶åï¼Œæˆ‘ä»¬çš„æ•ˆæœç¦»é¢„æœŸå³è¿‘ä¸€æ­¥äº†ã€‚</p>
<p><img src="http://7oxfjd.com2.z0.glb.qiniucdn.com/2018-03-21-preview_2.gif" alt="preview_2"></p>
<h2 id="ç‚¸è£‚å§ï¼Œç‚®å¼¹"><a href="#ç‚¸è£‚å§ï¼Œç‚®å¼¹" class="headerlink" title="ç‚¸è£‚å§ï¼Œç‚®å¼¹"></a>ç‚¸è£‚å§ï¼Œç‚®å¼¹</h2><p>æœ‰è¶£çš„æ—¶é—´åˆ°äº†ï¼Œç‚¸è£‚å§ï¼Œç‚®å¼¹ã€‚</p>
<p>æˆ‘ä»¬çš„ç‚®å¼¹æ¦‚å¿µéå¸¸ç®€å•ï¼Œæˆ‘ä»¬å°†åˆ›å»º20ä¸ªå‘å¤–çˆ†å¼€çš„åœ†ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åˆ¶ä½œå„ç§å„æ ·çš„å°¾å·´ï¼Œè¿˜å¯ä»¥å››å¤„é£è¡Œï¼Œç”šè‡³åšä¸€äº›å¾ˆé…·çš„æ•ˆæœï¼Œä½†æ˜¯é‚£æ˜¯ä¹‹åçš„äº‹æƒ…äº†ï¼Œæˆ‘ä»¬å…ˆå®Œæˆè¿™æœ€åŸºæœ¬çš„æ•ˆæœã€‚</p>
<p>æˆ‘ä»¬å…ˆåˆ›å»ºä¸€äº›å˜é‡ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">const PARTICLE_RADIUS = 30; // ç‚¸å¼€ç²’å­çš„èŒƒå›´åŠå¾„</div><div class="line">const PARTICLE_COUNT = [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20]; // æ¯ä¸ªçˆ†å¼€æœ‰å¤šå°‘ç²’å­</div><div class="line"></div><div class="line">//ç²’å­çš„é¢œè‰²å˜åŒ–åŸŸ</div><div class="line">const PARTICLE_COLORS = [</div><div class="line">    &apos;rgba(54, 17, 52, 100)&apos;,</div><div class="line">    &apos;rgba(176, 34, 140, 100)&apos;,</div><div class="line">    &apos;rgba(234, 55, 136, 100)&apos;,</div><div class="line">    &apos;rgba(229, 107, 112, 100)&apos;,</div><div class="line">    &apos;rgba(243, 145, 160, 100)&apos;</div><div class="line">]</div></pre></td></tr></table></figure>
<p>PARTICLE_RADIUSå®šä¹‰äº†æ¯ä¸ªçˆ†ç‚¸çš„èŒƒå›´æœ‰å¤šå¤§ï¼›PARTICLE_COUNTå®šä¹‰äº†ç²’å­çš„æ•°é‡ï¼›æœ€åï¼ŒPARTICLE_COLORSå®šä¹‰äº†ç²’å­æœ‰å¤šå°‘ç§ä¸åŒçš„é¢œè‰²ï¼Œæ‰€ä»¥ï¼Œæ¯ä¸ªçˆ†ç‚¸å°†åœ¨è¿™å‡ ç§é¢œè‰²ä¹‹é—´å˜åŒ–ã€‚<br>ä¸ºäº†ç®€å•èµ·è§ï¼Œæˆ‘ä»¬å°†ä½¿æ¯ä¸ªç²’å­å…·æœ‰ç›¸åŒçš„é¢œè‰²ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬åªéœ€è¦1ä¸ªAnimated.Valueã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">var</span> _particleColor = <span class="keyword">new</span> Animated.Value(<span class="number">0</span>);</div><div class="line"><span class="keyword">var</span> _particleRadius = <span class="keyword">new</span> Animated.Value(<span class="number">0</span>);</div><div class="line"><span class="keyword">var</span> _coreOpacity = <span class="keyword">new</span> Animated.Value(<span class="number">1</span>);</div></pre></td></tr></table></figure>
<p>æˆ‘ä»¬è¿˜éœ€è¦ä¸€ä¸ªAnimated.Valueä½œä¸ºæˆ‘ä»¬çš„åŠå¾„ï¼Œé»˜è®¤ä¸º0ï¼Œæ‰€ä»¥å®ƒå¼€å§‹éšè—ã€‚ å¦ä¸€ä¸ªAnimated.Valueæ˜¯é€æ˜çš„åŠ¨ç”»ã€‚å½“æˆ‘ä»¬çš„ç‚®å¼¹ç‚¸å¼€åéšè—å®ƒã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">var</span> _particlePositions = PARTICLE_COUNT.map(<span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">new</span> Animated.ValueXY(&#123;<span class="attr">x</span>: <span class="number">0</span>, <span class="attr">y</span>: <span class="number">0</span>&#125;));</div></pre></td></tr></table></figure>
<p>æ¯ä¸ªç²’å­å°†æœ‰ä¸åŒçš„åæ ‡ï¼Œæ‰€ä»¥ä¾‹å­ä¸­æˆ‘ä»¬éœ€è¦20ä¸ªAnimated.ValueXYã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">this.state.fireworks.push(&#123;</div><div class="line">    shootingPosition: _shootingPosition,</div><div class="line">    shootingColor: _shootingColor,</div><div class="line">    particleColor: _particleColor,</div><div class="line">    particleRadius: _particleRadius,</div><div class="line">    coreOpacity: _coreOpacity,</div><div class="line">    particlePositions: _particlePositions</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>æ·»åŠ æ–°çš„å¯¹è±¡ï¼Œè¿‡ä¼šæˆ‘ä»¬å°±æ¸²æŸ“å®ƒä»¬ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">function getXYParticle(total, i, radius) &#123;</div><div class="line">    var angle = 360/total*i;</div><div class="line"></div><div class="line">    var x = Math.round((radius*2) * Math.cos(angle - (Math.PI/2)));</div><div class="line">    var y = Math.round((radius*2) * Math.sin(angle - (Math.PI/2)));</div><div class="line"></div><div class="line">    return &#123;</div><div class="line">        x: x,</div><div class="line">        y: y</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">var _animatedParticles = [</div><div class="line">    Animated.timing(_particleRadius, &#123;</div><div class="line">        duration: 700,</div><div class="line">        toValue: 1</div><div class="line">    &#125;),</div><div class="line">    Animated.timing(_coreOpacity, &#123;</div><div class="line">        duration: 200,</div><div class="line">        toValue: 0</div><div class="line">    &#125;)</div><div class="line">]</div><div class="line"></div><div class="line">var _movingParticles = _particlePositions.map((particle, i) =&gt; &#123;</div><div class="line">    var _xy = getXYParticle(PARTICLE_COUNT.length, i, PARTICLE_RADIUS);</div><div class="line">    return Animated.timing(particle, &#123;</div><div class="line">        duration: 250,</div><div class="line">        toValue: _xy</div><div class="line">    &#125;)</div><div class="line">&#125;)</div><div class="line"></div><div class="line">_animatedParticles = _animatedParticles.concat(_movingParticles);</div></pre></td></tr></table></figure>
<p>è¿™äº›éƒ½æ˜¯ä¸ºæˆ‘ä»¬æ¥ä¸‹æ¥è¦åšçš„äº‹æƒ…åšå‡†å¤‡ï¼Œå°†æˆ‘ä»¬çš„åŠ¨ç”»éƒ½æ’æˆåºåˆ—ã€‚</p>
<p>æˆ‘ä»¬åˆ›å»ºäº†ä¸€ç³»åˆ—éœ€è¦å‘ç”Ÿçš„åŠ¨ç”»ã€‚é¦–å…ˆæ˜¯æ‰©å±•æ¯ä¸ª_particleRadiusï¼Œæˆ‘ä»¬å·²ç»ç¡®å®šå®Œå…¨ç‚¸å¼€çš„åŠ¨ç”»æ—¶é•¿ä¸º700æ¯«ç§’ã€‚ _particleRadiuså®é™…ä¸Šæ˜¯ç²’å­å°ºå¯¸ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬åªæ˜¯æ”¾å¤§è¿™ä¸ªåœ†ï¼Œçœ‹èµ·æ¥åƒæ˜¯å‘å¤–çˆ†ç‚¸ï¼Œä½†æ˜¯è¿™ä¼šåœ¨æˆ‘ä»¬çš„æ¸²æŸ“å‡½æ•°ä¸­æ˜¾ç¤ºå‡ºæ¥ã€‚</p>
<p>æˆ‘ä»¬å°†_coreOpacityï¼ˆä¹Ÿå°±æ˜¯æˆ‘ä»¬çš„ç‚®å¼¹ï¼‰è®¾ç½®ä¸ºåœ¨200æ¯«ç§’å†…æ¶ˆå¤±ã€‚</p>
<p>æˆ‘ä»¬éœ€è¦ä¸ºæ¯ä¸ªç²’å­åˆ›å»ºåŠ¨ç”»ï¼Œè®©ç²’å­ä»æˆ‘ä»¬ç›®å‰çš„ç‚®å¼¹ä½ç½®å‘å°„åˆ°ç²’å­åœ†èŒƒå›´å†…çš„ä¸åŒç‚¹ã€‚ç„¶åæˆ‘ä»¬é€šè¿‡ä¸€ä¸ªç®—æ³•ï¼Œè®¡ç®—ç²’å­x,yçš„ä½ç½®ã€‚</p>
<p>ç„¶ååˆç”¨åˆ°Animated.timingï¼Œè®©ç²’å­èŠ±è´¹250æ¯«ç§’åˆ°è¾¾å®ƒçš„ä½ç½®ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">Animated.sequence([</div><div class="line">  Animated.timing(_shootingPosition, &#123;</div><div class="line">    duration: 300,</div><div class="line">    toValue: &#123;</div><div class="line">      y: e.nativeEvent.locationY,</div><div class="line">      x: e.nativeEvent.locationX</div><div class="line">    &#125;</div><div class="line">  &#125;),</div><div class="line">  Animated.parallel(_animatedParticles)</div><div class="line">]).start(this.removeSelf.bind(this, _shootingPosition));</div></pre></td></tr></table></figure>
<p>ç°åœ¨å°†æˆ‘ä»¬çš„åŠ¨ç”»åˆ—é˜Ÿåˆ—ã€‚å› ä¸ºæˆ‘ä»¬å¸Œæœ›ç‚®å¼¹å…ˆå°„å‡»ï¼Œç„¶ååˆ°è¾¾æŒ‡å®šä½ç½®åçˆ†ç‚¸ã€‚æ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨Animated.sequenceå®ç°è¿™ä¸ªå…ˆåé¡ºåºã€‚</p>
<p>æˆ‘ä»¬é¦–å…ˆå°†æˆ‘ä»¬çš„ç‚®å¼¹ç§»åŠ¨åˆ°ç”¨æˆ·è§¦æ‘¸çš„ä½ç½®ã€‚ä¸‹ä¸€éƒ¨åˆ†å°†æˆ‘ä»¬æ‰€æœ‰çš„çˆ†ç‚¸åŠ¨ç”»å°è£…æˆAnimated.parallelã€‚è¿™ä¸Animated.sequenceç›¸åï¼Œå®ƒè¡¨ç¤ºåŒæ—¶æ‰§è¡Œæ‰€æœ‰è¿™äº›åŠ¨ç”»ã€‚</p>
<p>è¿™æ ·ï¼Œæˆ‘ä»¬çš„ç‚®å¼¹æ¸æ¸æ¶ˆå¤±ï¼Œæˆ‘ä»¬çš„ç²’å­è†¨èƒ€ï¼Œé¢œè‰²å˜åŒ–ï¼Œçˆ†ç‚¸å‘å¤–éƒ½ä¼šåŒæ—¶å‘ç”Ÿã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"></div><div class="line">adjustParticleFill = (_particleColor, value) =&gt; &#123;</div><div class="line">    var _currentFill = _particleColor.__getAnimatedValue(),</div><div class="line">    _particleFill = _currentFill === 5 ? 0 : _currentFill + 1;</div><div class="line"></div><div class="line">    Animated.timing(_particleColor, &#123;</div><div class="line">        duration: 16,</div><div class="line">        toValue: _particleFill</div><div class="line">    &#125;).start()</div><div class="line">&#125;</div><div class="line"></div><div class="line">_handleAddFirework = (e) =&gt; &#123;</div><div class="line">    //...</div><div class="line"></div><div class="line">    _shootingPosition.addListener(this.adjustShootingFill.bind(null, _shootingColor));</div><div class="line">    _particleRadius.addListener(this.adjustParticleFill.bind(null, _particleColor));</div><div class="line">    </div><div class="line">    //...</div><div class="line">    </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æœ€åæˆ‘ä»¬éœ€è¦å»æ”¹å˜ç²’å­çš„é¢œè‰²ã€‚æ‰€ä»¥åƒä¹‹å‰é‚£æ ·ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå›è°ƒå‡½æ•°å»ç›‘å¬ç²’å­çš„åŠå¾„å˜åŒ–ã€‚ä¸åŒçš„æ˜¯ï¼Œç°åœ¨æˆ‘ä»¬æœ‰5ç§é¢œè‰²éœ€è¦å˜åŒ–ã€‚</p>
<p>ç°åœ¨æˆ‘ä»¬è¦å¼€å§‹æ¸²æŸ“æ–°çš„æ•ˆæœäº†ï¼Œæˆ‘ä»¬å°†ç§»åˆ°ä¸€ä¸ªä¸åŒçš„å‡½æ•°é‡Œé¢å»å¤„ç†ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">&lt;Surface width=&#123;width&#125; height=&#123;height&#125;&gt;</div><div class="line">  &#123;this.getFireworks()&#125;</div><div class="line">&lt;/Surface&gt;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">getFireworks = () =&gt; &#123;</div><div class="line">       return this.state.fireworks.map((firework, i) =&gt; &#123;</div><div class="line"></div><div class="line">           var _shootingFill = firework.shootingColor.interpolate(&#123;</div><div class="line">               inputRange: [0,1],</div><div class="line">               outputRange: SHOOTING_COLORS</div><div class="line">           &#125;);</div><div class="line"></div><div class="line">           var _particleFill = firework.particleColor.interpolate(&#123;</div><div class="line">               inputRange: [0,1,2,3,4],</div><div class="line">               outputRange: PARTICLE_COLORS</div><div class="line">           &#125;);</div><div class="line"></div><div class="line">           return (</div><div class="line">               &lt;AnimatedGroup</div><div class="line">                   x=&#123;firework.shootingPosition.x&#125;</div><div class="line">                   y=&#123;firework.shootingPosition.y&#125;</div><div class="line">                   key=&#123;&quot;group_&quot;+i&#125;</div><div class="line">               &gt;</div><div class="line">                   &lt;AnimatedCircle</div><div class="line">                       opacity=&#123;firework.coreOpacity&#125;</div><div class="line">                       radius=&#123;MORTAR_RADIUS&#125;</div><div class="line">                       fill=&#123;_shootingFill&#125;</div><div class="line">                       key=&#123;&quot;circle_&quot;+i&#125;</div><div class="line">                   /&gt;</div><div class="line">                   &lt;Group&gt;</div><div class="line">                       &#123;</div><div class="line">                           PARTICLE_COUNT.map((v, j) =&gt; &#123;</div><div class="line">                               return &lt;AnimatedCircle</div><div class="line">                                   x=&#123;firework.particlePositions[j].x&#125;</div><div class="line">                                   y=&#123;firework.particlePositions[j].y&#125;</div><div class="line">                                   key=&#123;&quot;particles_&quot;+j&#125;</div><div class="line">                                   scaleX=&#123;firework.particleRadius&#125;</div><div class="line">                                   scaleY=&#123;firework.particleRadius&#125;</div><div class="line">                                   radius=&#123;PARTICLE_RADIUS&#125;</div><div class="line">                                   fill=&#123;_particleFill&#125;</div><div class="line">                               /&gt;</div><div class="line">                           &#125;)</div><div class="line">                       &#125;</div><div class="line">                   &lt;/Group&gt;</div><div class="line">               &lt;/AnimatedGroup&gt;</div><div class="line">           );</div><div class="line">       &#125;)</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<p>è¿˜æ˜¯å’Œä¹‹å‰å˜æ¢ç‚®å¼¹é¢œè‰²ä¸€æ ·ï¼Œæˆ‘ä»¬è¿˜æ˜¯ä½¿ç”¨interpolationæ¥å˜åŒ–ç²’å­çš„5ç§é¢œè‰²ã€‚</p>
<p>è¿™é‡Œä¸åŒçš„æ˜¯ä½¿ç”¨AnimatedGroupï¼Œæˆ‘ä»¬å°†åæ ‡ä»x,yè®¾ç½®åˆ°AnimatedGroupä¸­ã€‚</p>
<p>AnimatedGroupæ‰“åŒ…äº†ç‚®å¼¹å’Œæ‰€æœ‰çš„ç²’å­ã€‚è¿™æ ·æˆ‘ä»¬å¯ä»¥è®©æˆ‘ä»¬çš„ç²’å­ä»0,0å¼€å§‹å‘å¤–ç§»åŠ¨ï¼ŒAnimatedGroupå°†ç¡®ä¿æ‰€æœ‰çš„åæ ‡éƒ½èƒ½æ­£ç¡®å¤„ç†ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">&lt;AnimatedCircle</div><div class="line">  opacity=&#123;firework.coreOpacity&#125;</div><div class="line">  radius=&#123;MORTAR_RADIUS&#125;</div><div class="line">  fill=&#123;_shootingFill&#125;</div><div class="line">/&gt;</div></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°æŠŠcoreOpacityåŠ¨ç”»æ”¾åœ¨ç²’å­è¿™ï¼Œç„¶åä»–å°†åœ¨200æ¯«ç§’å†…æ¶ˆå¤±ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">&lt;Group&gt;</div><div class="line">  &#123;</div><div class="line">    PARTICLE_COUNT.map((v, j) =&gt; &#123;</div><div class="line">      return &lt;AnimatedCircle</div><div class="line">        x=&#123;firework.particlePositions[j].x&#125;</div><div class="line">        y=&#123;firework.particlePositions[j].y&#125;</div><div class="line">        key=&#123;&quot;particles_&quot;+j&#125;</div><div class="line">        scaleX=&#123;firework.particleRadius&#125;</div><div class="line">        scaleY=&#123;firework.particleRadius&#125;</div><div class="line">        radius=&#123;PARTICLE_RADIUS&#125;</div><div class="line">        fill=&#123;_particleFill&#125;</div><div class="line">      /&gt;</div><div class="line">    &#125;)</div><div class="line">  &#125;</div><div class="line">&lt;/Group&gt;</div></pre></td></tr></table></figure>
<p>æˆ‘ä»¬æŠŠç²’å­éƒ½æ”¾åœ¨Groupç»„ä»¶é‡Œã€‚æˆ‘ä»¬æ˜ å°„å‡º20ä¸ªç²’å­ï¼Œxå’Œyçš„å€¼ç”±getXYParticleå‡½æ•°æ¥ç¡®å®šã€‚</p>
<p>ä½ å¯ä»¥æ³¨æ„åˆ°ï¼Œæˆ‘ä»¬æŠŠparticleRadiusä¼ é€’ç»™äº†scaleXå’ŒscaleYå±æ€§ï¼Œå› ä¸ºAnimatedCircleå¸¦æœ‰çš„radiuså±æ€§ä¸å…·æœ‰å¯åŠ¨ç”»æ€§ï¼Œæ‰€ä»¥é€šè¿‡ç¼©æ”¾åˆ°0çš„æ–¹å¼æ¥å®Œå…¨éšè—ã€‚</p>
<p>è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥å°†å…¶æ‰©å¤§åˆ°å®Œæ•´çš„å°ºå¯¸ï¼Œå¹¶ä½¿å…¶çœ‹èµ·æ¥åƒçˆ†ç‚¸ä¸€æ ·ï¼Œè¿™æ ·å®é™…ä¸Šçš„æ•ˆæœæ›´å¥½ã€‚</p>
<p>æœ€åæˆ‘ä»¬ä½¿ç”¨åœ¨é¡¶éƒ¨å®šä¹‰çš„PARTICLE_RADIUSï¼Œä¹Ÿå°±æ˜¯æ¯ä¸ªç‚®å¼¹çš„å¤§å°ï¼Œç„¶åå°†_particleFillè®¾ç½®ä¸ºè¿™5ç§é¢œè‰²çš„interpolationã€‚</p>
<h2 id="å‘å°„"><a href="#å‘å°„" class="headerlink" title="å‘å°„"></a>å‘å°„</h2><p>å®Œå·¥ï¼æˆ‘ä»¬æœ‰äº†ğŸ‰ï¼<br>è¿è¡Œèµ·æ¥å°±å¯ä»¥çœ‹åˆ°æ•ˆæœ</p>
<p><img src="http://7oxfjd.com2.z0.glb.qiniucdn.com/2018-03-21-preview_3.gif" alt="preview_3"></p>
<h3 id="Final-Code"><a href="#Final-Code" class="headerlink" title="Final Code"></a>Final Code</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">import React, &#123;</div><div class="line">    Component</div><div class="line">&#125;from &apos;react&apos;;</div><div class="line"></div><div class="line">import &#123;</div><div class="line">    ART as Art,</div><div class="line">    StyleSheet,</div><div class="line">    View,</div><div class="line">    Dimensions,</div><div class="line">    TouchableWithoutFeedback,</div><div class="line">    Animated</div><div class="line">&#125; from &apos;react-native&apos;;</div><div class="line"></div><div class="line">var &#123;</div><div class="line">    width,</div><div class="line">    height</div><div class="line">&#125; = Dimensions.get(&apos;window&apos;);</div><div class="line"></div><div class="line">var &#123;</div><div class="line">    Surface,</div><div class="line">    Shape,</div><div class="line">    Path,</div><div class="line">    Group,</div><div class="line">    Transform</div><div class="line">&#125; = Art;</div><div class="line"></div><div class="line">var AnimatedShape = Animated.createAnimatedComponent(Shape);</div><div class="line">var AnimatedGroup = Animated.createAnimatedComponent(Group);</div><div class="line"></div><div class="line">const MORTAR_RADIUS = 5</div><div class="line"></div><div class="line">const SHOOTING_COLORS = [</div><div class="line">    &apos;rgb(234,238,112)&apos;, //Yellow</div><div class="line">    &apos;rgb(245,137,12)&apos; //Orange</div><div class="line">];</div><div class="line"></div><div class="line">const PARTICLE_RADIUS = 30; // ç‚¸å¼€ç²’å­çš„èŒƒå›´åŠå¾„</div><div class="line">const PARTICLE_COUNT = [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20]; // æ¯ä¸ªçˆ†å¼€æœ‰å¤šå°‘ç²’å­</div><div class="line"></div><div class="line">//ç²’å­çš„é¢œè‰²å˜åŒ–åŸŸ</div><div class="line">const PARTICLE_COLORS = [</div><div class="line">    &apos;rgba(54, 17, 52, 100)&apos;,</div><div class="line">    &apos;rgba(176, 34, 140, 100)&apos;,</div><div class="line">    &apos;rgba(234, 55, 136, 100)&apos;,</div><div class="line">    &apos;rgba(229, 107, 112, 100)&apos;,</div><div class="line">    &apos;rgba(243, 145, 160, 100)&apos;</div><div class="line">]</div><div class="line"></div><div class="line">export default class App extends Component&lt;Props&gt; &#123;</div><div class="line">    state = &#123;</div><div class="line">        fireworks: []</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    adjustShootingFill = (_shootingColor, value) =&gt; &#123;</div><div class="line">        Animated.timing(_shootingColor, &#123;</div><div class="line">            duration: 16,</div><div class="line">            toValue: _shootingColor.__getAnimatedValue() == 0 ? 1 : 0</div><div class="line">        &#125;).start()</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    adjustParticleFill = (_particleColor, value) =&gt; &#123;</div><div class="line">        var _currentFill = _particleColor.__getAnimatedValue(),</div><div class="line">        _particleFill = _currentFill === 5 ? 0 : _currentFill + 1;</div><div class="line"></div><div class="line">        Animated.timing(_particleColor, &#123;</div><div class="line">            duration: 16,</div><div class="line">            toValue: _particleFill</div><div class="line">        &#125;).start()</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    _handleAddFirework = (e) =&gt; &#123;</div><div class="line">        var _shootingPosition = new Animated.ValueXY(&#123;x: width/2, y: height - MORTAR_RADIUS&#125;);</div><div class="line">        var _shootingColor = new Animated.Value(0);</div><div class="line">        var _particleColor = new Animated.Value(0);</div><div class="line">        var _particleRadius = new Animated.Value(0);</div><div class="line">        var _coreOpacity = new Animated.Value(1);</div><div class="line"></div><div class="line">        var _particlePositions = PARTICLE_COUNT.map(() =&gt; new Animated.ValueXY(&#123;x: 0, y: 0&#125;));</div><div class="line"></div><div class="line">        this.state.fireworks.push(&#123;</div><div class="line">            shootingPosition: _shootingPosition,</div><div class="line">            shootingColor: _shootingColor,</div><div class="line">            particleColor: _particleColor,</div><div class="line">            particleRadius: _particleRadius,</div><div class="line">            coreOpacity: _coreOpacity,</div><div class="line">            particlePositions: _particlePositions</div><div class="line">        &#125;);</div><div class="line"></div><div class="line">        _shootingPosition.addListener(this.adjustShootingFill.bind(null, _shootingColor));</div><div class="line">        _particleRadius.addListener(this.adjustParticleFill.bind(null, _particleColor));</div><div class="line"></div><div class="line">        function getXYParticle(total, i, radius) &#123;</div><div class="line">            var angle = 360/total*i;</div><div class="line"></div><div class="line">            var x = Math.round((radius*2) * Math.cos(angle - (Math.PI/2)));</div><div class="line">            var y = Math.round((radius*2) * Math.sin(angle - (Math.PI/2)));</div><div class="line"></div><div class="line">            return &#123;</div><div class="line">                x: x,</div><div class="line">                y: y</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        var _animatedParticles = [</div><div class="line">            Animated.timing(_particleRadius, &#123;</div><div class="line">                duration: 700,</div><div class="line">                toValue: 1</div><div class="line">            &#125;),</div><div class="line">            Animated.timing(_coreOpacity, &#123;</div><div class="line">                duration: 200,</div><div class="line">                toValue: 0</div><div class="line">            &#125;)</div><div class="line">        ]</div><div class="line"></div><div class="line">        var _movingParticles = _particlePositions.map((particle, i) =&gt; &#123;</div><div class="line">            var _xy = getXYParticle(PARTICLE_COUNT.length, i, PARTICLE_RADIUS);</div><div class="line">            return Animated.timing(particle, &#123;</div><div class="line">                duration: 250,</div><div class="line">                toValue: _xy</div><div class="line">            &#125;)</div><div class="line">        &#125;)</div><div class="line"></div><div class="line">        _animatedParticles = _animatedParticles.concat(_movingParticles);</div><div class="line"></div><div class="line">        Animated.sequence([</div><div class="line">            Animated.timing(_shootingPosition, &#123;</div><div class="line">                duration: 300,</div><div class="line">                toValue: &#123;</div><div class="line">                    y: e.nativeEvent.locationY,</div><div class="line">                    x: e.nativeEvent.locationX</div><div class="line">                &#125;</div><div class="line">            &#125;),</div><div class="line">            Animated.parallel(_animatedParticles)</div><div class="line">        ]).start(this.removeSelf.bind(this, _shootingPosition));</div><div class="line"></div><div class="line">        this.setState(this.state);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    removeSelf = (_shootingPosition)=&gt; &#123;</div><div class="line">        this.setState(&#123;</div><div class="line">            fireworks: this.state.fireworks.filter((firework) =&gt; firework.shootingPosition !== _shootingPosition)</div><div class="line">        &#125;);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    getFireworks = () =&gt; &#123;</div><div class="line">        return this.state.fireworks.map((firework, i) =&gt; &#123;</div><div class="line"></div><div class="line">            var _shootingFill = firework.shootingColor.interpolate(&#123;</div><div class="line">                inputRange: [0,1],</div><div class="line">                outputRange: SHOOTING_COLORS</div><div class="line">            &#125;);</div><div class="line"></div><div class="line">            var _particleFill = firework.particleColor.interpolate(&#123;</div><div class="line">                inputRange: [0,1,2,3,4],</div><div class="line">                outputRange: PARTICLE_COLORS</div><div class="line">            &#125;);</div><div class="line"></div><div class="line">            return (</div><div class="line">                &lt;AnimatedGroup</div><div class="line">                    x=&#123;firework.shootingPosition.x&#125;</div><div class="line">                    y=&#123;firework.shootingPosition.y&#125;</div><div class="line">                    key=&#123;&quot;group_&quot;+i&#125;</div><div class="line">                &gt;</div><div class="line">                    &lt;AnimatedCircle</div><div class="line">                        opacity=&#123;firework.coreOpacity&#125;</div><div class="line">                        radius=&#123;MORTAR_RADIUS&#125;</div><div class="line">                        fill=&#123;_shootingFill&#125;</div><div class="line">                        key=&#123;&quot;circle_&quot;+i&#125;</div><div class="line">                    /&gt;</div><div class="line">                    &lt;Group&gt;</div><div class="line">                        &#123;</div><div class="line">                            PARTICLE_COUNT.map((v, j) =&gt; &#123;</div><div class="line">                                return &lt;AnimatedCircle</div><div class="line">                                    x=&#123;firework.particlePositions[j].x&#125;</div><div class="line">                                    y=&#123;firework.particlePositions[j].y&#125;</div><div class="line">                                    key=&#123;&quot;particles_&quot;+j&#125;</div><div class="line">                                    scaleX=&#123;firework.particleRadius&#125;</div><div class="line">                                    scaleY=&#123;firework.particleRadius&#125;</div><div class="line">                                    radius=&#123;PARTICLE_RADIUS&#125;</div><div class="line">                                    fill=&#123;_particleFill&#125;</div><div class="line">                                /&gt;</div><div class="line">                            &#125;)</div><div class="line">                        &#125;</div><div class="line">                    &lt;/Group&gt;</div><div class="line">                &lt;/AnimatedGroup&gt;</div><div class="line">            );</div><div class="line">        &#125;)</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    render()&#123;</div><div class="line">        return (</div><div class="line">            &lt;View style=&#123;styles.container&#125;&gt;</div><div class="line">                &lt;TouchableWithoutFeedback onPress=&#123;this._handleAddFirework&#125; &gt;</div><div class="line">                    &lt;View&gt;</div><div class="line">                        &lt;Surface width=&#123;width&#125; height=&#123;height&#125;&gt;</div><div class="line">                            &#123;this.getFireworks()&#125;</div><div class="line">                        &lt;/Surface&gt;</div><div class="line">                    &lt;/View&gt;</div><div class="line">                &lt;/TouchableWithoutFeedback&gt;</div><div class="line">            &lt;/View&gt;</div><div class="line">        );</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">var styles = StyleSheet.create(&#123;</div><div class="line">    container: &#123;</div><div class="line">        flex: 1,</div><div class="line">        flexDirection: &apos;column&apos;</div><div class="line">    &#125;</div><div class="line">&#125;);</div><div class="line"></div><div class="line">class AnimatedCircle extends Component&lt;Props&gt; &#123;</div><div class="line">    render()&#123;</div><div class="line">        var radius = this.props.radius;</div><div class="line">        var path = Path().moveTo(0, -radius)</div><div class="line">            .arc(0, radius * 2, radius)</div><div class="line">            .arc(0, radius * -2, radius)</div><div class="line">            .close();</div><div class="line">        return (</div><div class="line">            &lt;AnimatedShape d=&#123;path&#125;  &#123;...this.props&#125;/&gt;</div><div class="line">        );</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2018/02/01/iOSä½åŠŸè€—è“ç‰™å¼€å‘æŒ‡è¥¿-è¯‘/" itemprop="url">
                  iOSä½åŠŸè€—è“ç‰™å¼€å‘æŒ‡è¥¿[è¯‘]
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">VerÃ¶ffentlicht am</span>
            <time itemprop="dateCreated" datetime="2018-02-01T11:05:20+08:00" content="2018-02-01">
              2018-02-01
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="iOSä½åŠŸè€—è“ç‰™å¼€å‘æŒ‡è¥¿-è¯‘"><a href="#iOSä½åŠŸè€—è“ç‰™å¼€å‘æŒ‡è¥¿-è¯‘" class="headerlink" title="iOSä½åŠŸè€—è“ç‰™å¼€å‘æŒ‡è¥¿[è¯‘]"></a>iOSä½åŠŸè€—è“ç‰™å¼€å‘æŒ‡è¥¿[è¯‘]</h1><h2 id="è¯‘æ–‡"><a href="#è¯‘æ–‡" class="headerlink" title="è¯‘æ–‡"></a>è¯‘æ–‡</h2><p>é“¾æ¥ï¼š<a href="https://codeburst.io/getting-started-with-bluetooth-low-energy-on-ios-ada3090fc9cc" target="_blank" rel="external">Getting started with Bluetooth Low Energy on iOS</a><br>ä½œè€…ï¼š<a href="https://codeburst.io/@yostane?source=post_header_lockup" target="_blank" rel="external">Yassine benabbas</a></p>
<h2 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h2><p>ä½åŠŸè€—è“ç‰™(BLE)æ˜¯è“ç‰™4.0æœ€é‡è¦çš„ç‰¹æ€§ä¹‹ä¸€ã€‚ä½¿ç”¨BLEè¿›è¡Œè®¾å¤‡é—´é€šä¿¡çš„åŠŸè€—å¯¹æ¯”ä¼ ç»Ÿè“ç‰™å¤§å¤§çš„é™ä½äº†ã€‚å¦ä¸€ä¸ªé‡å¤§çš„è¿›æ­¥å°±æ˜¯ç”¨æˆ·ç”¨ç³»ç»Ÿè®¾ç½®å–ä»£äº†æ‰‹åŠ¨é…å¯¹ã€‚è¿™ç¯‡æ–‡ç« çš„æ ¸å¿ƒå†…å®¹ä¸ºå¿«é€Ÿä»‹ç»BLEåŠå±•ç¤ºä»é›¶å¼€å§‹åˆ›å»ºiOSåº”ç”¨å»è¿æ¥ä¸€ä¸ªBLEå¤–è®¾ã€‚</p>
<h2 id="å®šä¹‰"><a href="#å®šä¹‰" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h2><p>ä½åŠŸè€—è“ç‰™ç¼©å†™ä¸ºBLEã€‚é¦–å…ˆè¦æ¾„æ¸…ï¼Œè“ç‰™4.0å®šä¹‰äº†åŒ…æ‹¬ç»å…¸è“ç‰™åè®®ã€é«˜é€Ÿè“ç‰™åè®®å’Œä½åŠŸè€—è“ç‰™åè®®åœ¨å†…çš„ä¸€ç³»åˆ—çš„æŠ€æœ¯è§„èŒƒï¼Œæ‰€ä»¥è¯·ä»”ç»†æ£€æŸ¥å¤–è®¾å¯¹äºBLEçš„å…¼å®¹æ€§ã€‚</p>
<p>è¦è¯†åˆ«ä¸€ä¸ªå¤–è®¾æ˜¯å¦ä¸ºBLEå¤–è®¾ï¼Œå¯ä»¥æ£€æŸ¥å®ƒæ˜¯å¦å¸¦æœ‰ã€Bluetooth smartã€ã€ã€Bluetooth Low Energyã€æˆ–ã€BLEã€æ ‡è¯†ã€‚</p>
<p>ç°åœ¨æˆ‘ä»¬æœ‰äº†ä¸€äº›BLEå¤–è®¾ï¼Œæˆ‘ä»¬å°†åœ¨ä¸‹ä¸€èŠ‚çœ‹åˆ°å®ƒä»¬å¦‚ä½•é€šä¿¡ã€‚</p>
<h2 id="ä¸­å¿ƒè®¾å¤‡å’Œå¤–è®¾çš„BLEé€šä¿¡"><a href="#ä¸­å¿ƒè®¾å¤‡å’Œå¤–è®¾çš„BLEé€šä¿¡" class="headerlink" title="ä¸­å¿ƒè®¾å¤‡å’Œå¤–è®¾çš„BLEé€šä¿¡"></a>ä¸­å¿ƒè®¾å¤‡å’Œå¤–è®¾çš„BLEé€šä¿¡</h2><p>åœ¨BLEä¸–ç•Œæœ‰ä¸¤ç§è®¾å¤‡ï¼šå¤–è®¾å’Œä¸­å¿ƒè®¾å¤‡ã€‚</p>
<p>å¤–è®¾æ˜¯ä¸€ä¸ªè®¾å¤‡æš´éœ²å‡ºä¸€äº›æœåŠ¡ï¼Œæä¾›æ•°æ®çš„è¯»å†™ã€‚</p>
<p>ä¸­å¿ƒè®¾å¤‡æ˜¯ä¸€ä¸ªè®¾å¤‡å¯ä»¥è¿æ¥å¤šä¸ªå¤–è®¾å¹¶ä¸ä»–ä»¬è¿›è¡Œæ•°æ®çš„è¯»å†™ã€‚é€šä¿¡çš„è¿æ¥æ˜¯ç”±ä¸­å¿ƒè®¾å¤‡æ¥å‘èµ·å¹¶åˆå§‹åŒ–çš„ã€‚</p>
<p>åœ¨ä¸€ä¸ªC/Sæ¶æ„æ¨¡å‹ä¸­ï¼Œä¸­å¿ƒè®¾å¤‡å¯ä»¥è®¤ä¸ºæ˜¯å®¢æˆ·ç«¯ï¼Œå¤–è®¾å¯ä»¥çœ‹åšæ˜¯æœåŠ¡ç«¯ã€‚</p>
<p>ä¸€äº›è®¾å¤‡å¯ä»¥åŒæ—¶ä½œä¸ºä¸­å¿ƒè®¾å¤‡å’Œå¤–è®¾å­˜åœ¨ï¼Œæ¯”å¦‚iOSå’ŒMacè®¾å¤‡ã€‚</p>
<p>å¤–è®¾/ä¸­å¿ƒè®¾å¤‡ä¾‹å­ï¼š</p>
<ul>
<li>åƒå°ç±³æ‰‹ç¯è¿™ç±»å‹æ™ºèƒ½æ‰‹ç¯å°±æ˜¯ä¸€ä¸ªå¤–è®¾</li>
<li>iPhoneæ‰‹æœºè¿æ¥äº†ä¸€ä¸ªåªèƒ½æ‰‹ç¯ï¼Œå°±æ‰®æ¼”äº†ä¸­å¿ƒè®¾å¤‡çš„è§’è‰²</li>
</ul>
<p><img src="http://7oxfjd.com2.z0.glb.qiniucdn.com/2018-02-01-15173883632616.png" alt=""></p>
<div align="center"><font color="blue" size="2" face="verdana">æºè‡ª:<a href="https://learn.adafruit.com/introduction-to-bluetooth-low-energy/gatt" target="_blank" rel="external">https://learn.adafruit.com/introduction-to-bluetooth-low-energy/gatt</a></font></div>

<p>åœ¨ä¸‹ä¸€ç« èŠ‚ï¼Œæˆ‘ä»¬å°†ä»‹ç»BLEä¸­å­˜åœ¨çš„é€šä¿¡æ–¹å¼ã€‚</p>
<h2 id="BLEé€šä¿¡æ–¹å¼"><a href="#BLEé€šä¿¡æ–¹å¼" class="headerlink" title="BLEé€šä¿¡æ–¹å¼"></a>BLEé€šä¿¡æ–¹å¼</h2><p>æœ‰ä¸¤ç§é€šä¿¡æ–¹å¼ï¼š</p>
<ul>
<li>å¹¿æ’­é€šä¿¡æ¨¡å¼(Advertising mode)ï¼šå¤–è®¾å®šæ—¶çš„å¹¿æ’­é™„å¸¦ä¸€äº›ä¿¡æ¯ï¼Œå‘¨å›´å¯èƒ½å‘ç°å¹¿æ’­çš„ä¸­å¿ƒè®¾å¤‡éƒ½å¯ä»¥æ¥æ”¶è¿™äº›ä¿¡æ¯ã€‚è¿™ç§æ¨¡å¼å…è®¸ä¸€ä¸ªå¤–è®¾è¢«ä¸­å¿ƒè®¾å¤‡å‘ç°ï¼Œå› æ­¤æŠŠä»–å«åšå¹¿å‘Šï¼ˆadvertisingï¼‰ã€‚åœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼Œå¯ä»¥ç›´æ¥é€šè¿‡GAPå¹¿æ’­è¿›è¡Œäº¤æ¢ç®€å•çš„ä¿¡æ¯ã€‚ä»å¤–è®¾è§’åº¦çœ‹ï¼Œè¿™æ˜¯ä¸€ä¸ªå¤–è®¾å¯¹åº”å¤šä¸ªä¸­å¿ƒè®¾å¤‡çš„æ¨¡å¼ã€‚</li>
<li>è¿æ¥æ¨¡å¼(Connected mode)ï¼šå…è®¸ä¸€ä¸ªä¸­å¿ƒè®¾å¤‡å’Œå¤–è®¾äº¤æ¢å¤æ‚çš„æ•°æ®ã€‚GATTåè®®æè¿°äº†è¿™ç§æ¨¡å¼æ˜¯å¦‚ä½•åˆ›å»ºä¼šè¯è¿›è¡Œé€šä¿¡çš„ã€‚ä»å¤–è®¾è§’åº¦è¯´ï¼Œè¿™æ˜¯ç§ä¸€å¯¹ä¸€çš„æ¨¡å¼ã€‚</li>
</ul>
<p>ä½†æœ‰ä¸€äº›è§„åˆ™ï¼š</p>
<ul>
<li>ä¸€ä¸ªä¸­å¿ƒè®¾å¤‡ä¸èƒ½è¿æ¥å¦ä¸€ä¸ªä¸­å¿ƒè®¾å¤‡ï¼Œä¸€ä¸ªå¤–è®¾ä¸èƒ½è¿æ¥å¦ä¸€ä¸ªå¤–è®¾</li>
<li>ä¸€ä¸ªå¤–è®¾åŒæ—¶æ—¶é—´åªèƒ½è¿æ¥ä¸€ä¸ªä¸­å¿ƒè®¾å¤‡</li>
</ul>
<p>åœ¨ä¸‹ä¸€ç« èŠ‚ï¼Œæˆ‘ä»¬é™æ›´æ·±å…¥çš„é’»ç ”è¿æ¥æ¨¡å¼é€šä¿¡çš„ç»†èŠ‚ã€‚</p>
<h2 id="BLEåœ¨è¿æ¥æ¨¡å¼çš„é€šä¿¡"><a href="#BLEåœ¨è¿æ¥æ¨¡å¼çš„é€šä¿¡" class="headerlink" title="BLEåœ¨è¿æ¥æ¨¡å¼çš„é€šä¿¡"></a>BLEåœ¨è¿æ¥æ¨¡å¼çš„é€šä¿¡</h2><h3 id="æœåŠ¡ä¸ç‰¹å¾"><a href="#æœåŠ¡ä¸ç‰¹å¾" class="headerlink" title="æœåŠ¡ä¸ç‰¹å¾"></a>æœåŠ¡ä¸ç‰¹å¾</h3><p>GATTåè®®å®šä¹‰äº†ä¸­å¿ƒè®¾å¤‡å¦‚ä½•ä¸å¯è¿æ¥çš„å¤–è®¾é€šä¿¡ã€‚é¦–å…ˆæ•°æ®çš„ç»“æ„æ˜¯è¿™æ ·å®šä¹‰çš„ï¼š</p>
<ul>
<li>å¤–è®¾æš´éœ²ä¸­å¿ƒè®¾å¤‡å¯è¿›è¡Œè¯»ã€å†™ä¸è¢«é€šçŸ¥çš„å±æ€§ã€‚è¿™äº›å±æ€§æ¯ä¸€ä¸ªéƒ½è¢«ç§°ä½œä¸ºç‰¹å¾(characteristic)ã€‚ä¸€ä¸ªç‰¹å¾ä¹Ÿä¼´éšç€ä¸€ä¸ªæè¿°ç¬¦(descriptor)æ¥è§£é‡Šå®ƒï¼›</li>
<li>ç‰¹å¾è¢«åˆ†ç»„ä¸ºæœåŠ¡(service)ï¼›</li>
<li>æˆ‘ä»¬ä¹Ÿå¯ä»¥å°†æœåŠ¡åˆ†ç»„æˆä¸€ä¸ªé…ç½®æ–‡ä»¶(profile)ã€‚</li>
</ul>
<p>è®©æˆ‘ä»¬ä¸¾ä¸€ä¸ªä¾‹å­ï¼šå¿ƒç‡ç›‘æµ‹å™¨æ˜¯ä¸€ä¸ªBLEå¤–è®¾ï¼Œä»–æœ‰ä¸€ä¸ªå¿ƒç‡é…ç½®æ–‡ä»¶ï¼Œè¯¥é…ç½®æ–‡ä»¶æœ‰ä¸¤ä¸ªæœåŠ¡ï¼ˆå¿ƒç‡æœåŠ¡åŠè®¾å¤‡ä¿¡æ¯æœåŠ¡ï¼‰ã€‚å¿ƒç‡æœåŠ¡å®šä¹‰äº†ä¸€ä¸ªè¯»ç‰¹å¾å¯ä»¥æä¾›æµ‹é‡çš„å¿ƒç‡ç»“æœã€‚å®ƒä¹Ÿå®šä¹‰äº†ä¸€ä¸ªå†™ç‰¹å¾ç”¨äºå‘Šè¯‰å¤–è®¾å®ƒç°åœ¨å¤„äºèº«ä½“çš„ä»€ä¹ˆä½ç½®ã€‚ç„¶åè®¾å¤‡ä¿¡æ¯æœåŠ¡åŒ…å«å…³äºæ¨¡å‹ã€å›ºä»¶ç‰ˆæœ¬ç­‰è®¾å¤‡ä¿¡æ¯ã€‚</p>
<p>æ¯ä¸ªç‰¹å¾å’ŒæœåŠ¡éƒ½è¢«å®šä¹‰äº†å”¯ä¸€æ ‡è¯†ï¼Œè¿™ä¸ªå”¯ä¸€æ ‡è¯†è¢«ç§°ä½œUUIDã€‚æœ‰ä¸€äº›é¢„å®šä¹‰å¥½çš„æ ‡å‡†æœåŠ¡ä¸ç‰¹å¾çš„UUIDï¼Œå¦‚æœä½ æœ‰å…´è¶£ï¼Œå¯ä»¥åœ¨è¯¥<a href="https://www.bluetooth.com/specifications/gatt/services and https://www.bluetooth.com/specifications/gatt/characteristics" target="_blank" rel="external">é“¾æ¥</a>ä¸­å»¶ä¼¸é˜…è¯»ã€‚å½“ç„¶ï¼Œä½ å¯ä»¥ä¸ºä½ è‡ªå·±çš„æœåŠ¡å’Œç‰¹å¾å®šä¹‰UUIDã€‚ä½ ä¹Ÿæ²¡æœ‰ä¹‰åŠ¡å»å›é¿é¢„å®šä¹‰çš„UUIDã€‚æ ‡å‡†çš„UUIDæ˜¯16ä½çš„ï¼Œè‡ªå®šä¹‰çš„åˆ™æ˜¯128ä½çš„ï¼Œä»–ä»¬ä¸€èˆ¬ç”¨åå…­è¿›åˆ¶è¡¨ç¤ºã€‚ä¾‹å¦‚å¿ƒç‡æœåŠ¡çš„UUIDæ˜¯16ä½çš„ï¼š0x180Dï¼Œè€Œè‡ªå®šä¹‰å¯ä»¥æ˜¯:6E400001-B5A3-F393-E0A9-E50E24DCCA9Eã€‚<br><img src="http://7oxfjd.com2.z0.glb.qiniucdn.com/2018-02-01-15173911787186.png" alt=""></p>
<p>ä¸‹ä¸€ç« èŠ‚æˆ‘ä»¬å°†ä»‹ç»å…¸å‹çš„BLEä½¿ç”¨æ¡ˆä¾‹ã€‚</p>
<h2 id="å…¸å‹çš„è“ç‰™ä½¿ç”¨æ¡ˆä¾‹"><a href="#å…¸å‹çš„è“ç‰™ä½¿ç”¨æ¡ˆä¾‹" class="headerlink" title="å…¸å‹çš„è“ç‰™ä½¿ç”¨æ¡ˆä¾‹"></a>å…¸å‹çš„è“ç‰™ä½¿ç”¨æ¡ˆä¾‹</h2><p>è¯¥ç« èŠ‚æˆ‘ä»¬å°†ä»‹ç»å…¸å‹çš„BLEä½¿ç”¨æ¡ˆä¾‹ã€‚æœ‰éå¸¸å¤šå¯èƒ½çš„BLEä½¿ç”¨åœºæ™¯ï¼Œä½†æˆ‘ä»¬å°†æè¿°æœ€å¸¸è§çš„è¿™ç§ã€‚</p>
<p>BLEæœç´¢APPï¼šä»–çš„ç”¨é€”ä¸ºåœ¨ä½ æƒ³è¦å‘ç°å¹¶æµ‹è¯•BLEçš„ä½ç½®å‘ç°å‘¨å›´è“ç‰™è®¾å¤‡çš„æƒ…å†µï¼Œå…·ä½“ä¸ºä»¥ä¸‹åŠŸèƒ½ï¼š</p>
<ul>
<li>å‘ç°å¤–è®¾çš„å¹¿æ’­æœåŠ¡</li>
<li>ä¸­å¿ƒè®¾å¤‡å‘ç°è¿™äº›å¹¿æ’­æœåŠ¡å¹¶æŠŠå®ƒä»¬æ˜¾ç¤ºç»™ç”¨æˆ·</li>
<li>ç”¨æˆ·ä»åˆ—è¡¨ä¸­é€‰æ‹©ä¸€ä¸ªå¤–è®¾</li>
<li>ä¸­å¿ƒè®¾å¤‡è¿æ¥é€‰ä¸­çš„å¤–è®¾å¹¶æŠŠè¯¥å¤–è®¾æ‰€æœ‰çš„æœåŠ¡å±•ç°ç»™ç”¨æˆ·</li>
<li>ç”¨æˆ·å¯ä»¥é€‰æ‹©ä¸€ä¸ªæœåŠ¡</li>
<li>ä¸­å¿ƒè®¾å¤‡è¯¢é—®å¤–è®¾å½“å‰é€‰æ‹©çš„æœåŠ¡æœ‰å“ªäº›ç‰¹å¾å¹¶å±•ç¤ºç»™ç”¨æˆ·</li>
<li>ç”¨æˆ·å¯ä»¥é€‰æ‹©ä¸€é¡¹ç‰¹å¾å¹¶æ‰§è¡Œä¸€äº›å…è®¸çš„æ“ä½œ(æ¯”å¦‚è¯»ï¼Œæˆ–è€…å†™ï¼Œåˆæˆ–è€…è¢«é€šçŸ¥)</li>
</ul>
<p>è¿™ç±»å‹çš„åº”ç”¨æœ‰BlueCapå’ŒLightBlueï¼Œå¯ä»¥ä»AppStoreä¸­ä¸‹è½½ã€‚</p>
<p>è¿˜æœ‰å¾ˆå¤šç»å…¸çš„ä½¿ç”¨æ¡ˆä¾‹ï¼Œæ¯”å¦‚ï¼š</p>
<ul>
<li>APPå¯ä»¥æ‰«æä¸€äº›ç‰¹å®šçš„å¹¿æ’­æœåŠ¡çš„è®¾å¤‡</li>
<li>APPå¯ä»¥è¿æ¥ç‰¹å®šçš„è®¾å¤‡ï¼Œæ¯”å¦‚æ™ºèƒ½æ‰‹ç¯</li>
<li>APPæ¥ç€å¯ä»¥é€šè¿‡ç‰¹å®šçš„ç‰¹å¾å’Œå†³å®šå¥½çš„æœåŠ¡æ¥è·å–ä¸€äº›ä¿¡æ¯ï¼Œæ¯”å¦‚æ­¥æ•°</li>
<li>APPå¯ä»¥æ–­å¼€å¤–è®¾çš„è¿æ¥ï¼Œä¸‹ä¸€æ¬¡å¯ä»¥ç«‹å³é‡è¿ä¸Š</li>
</ul>
<p>è¿™ç§ç±»å‹çš„åº”ç”¨ä½¿ç”¨èµ·æ¥æ›´åŠ ç®€æ˜“ä¸Šæ‰‹ï¼Œåªéœ€è¦ç”¨æˆ·è¿›è¡Œäº†ç¬¬ä¸€æ¬¡è¿æ¥ï¼Œä¹‹åå°±å¯ä»¥è‡ªåŠ¨çš„å¿«é€Ÿè¿æ¥ä¸Šï¼Œå½“å‰å¾ˆå¤šæ™ºèƒ½è®¾å¤‡çš„äº¤äº’éƒ½éµå¾ªè¯¥æ€è·¯ï¼Œæœ‰çš„ç”šè‡³æ›´åŠ ç®€æ˜“ã€‚ ä¾‹å¦‚ï¼Œå°ç±³æ‰‹ç¯çš„å®˜æ–¹åº”ç”¨ï¼Œæˆ‘ä»¬ä¹Ÿå°†åœ¨æœ¬æ–‡æœ«å°¾å¼€å‘éµå¾ªè¯¥è§„èŒƒçš„å°ç±³æ‰‹ç¯åº”ç”¨ç¨‹åº</p>
<p>ä¸‹ä¸€ç« èŠ‚ï¼Œæˆ‘ä»¬å°†æ£€æŸ¥æˆ‘ä»¬çš„è‹¹æœè®¾å¤‡æ˜¯å¦æ”¯æŒBLEã€‚</p>
<h2 id="BLEä¸Apple"><a href="#BLEä¸Apple" class="headerlink" title="BLEä¸Apple"></a>BLEä¸Apple</h2><p>è‹¹æœå¾ˆæ—©çš„å°±åœ¨ä»–ä»¬çš„è½¯ç¡¬ä»¶ä¸­æ”¯æŒBLEäº†ï¼Œè¿™é‡Œæœ‰ä¸€äº›å›é¡¾</p>
<ul>
<li>iOS5çš„SDKå¼•å…¥äº†è“ç‰™æ ¸å¿ƒ(Core Bluetooth)æ¡†æ¶ï¼Œè¯¥æ¡†æ¶å…è®¸BLEè®¾å¤‡ä½œä¸ºä¸­å¤®è®¾å¤‡æˆ–å¤–è®¾è¿›è¡Œäº¤äº’</li>
<li>ä»iPhone 4Så¼€å§‹ï¼Œæ‰€æœ‰çš„iOSè®¾å¤‡éƒ½æ”¯æŒBLE</li>
<li>å¦‚æœä½ çš„Macæ”¯æŒBLEï¼Œé‚£ä¹ˆä½ çš„iOSæ¨¡æ‹Ÿå™¨ä¹Ÿæ”¯æŒã€‚</li>
</ul>
<p>æ”¯æŒBLEçš„é¦–æ‰¹Macç”µè„‘æœ‰</p>
<ul>
<li>2011å¹´ä¸­çš„MacBook Air</li>
<li>2011å¹´å¹´ä¸­çš„Mac mini</li>
<li>2012å¹´ä¸­æœŸè§†ç½‘è†œ(retina)åŠéè§†ç½‘è†œç‰ˆæœ¬çš„MacBook Pro</li>
<li>2012å¹´åº•çš„iMacs</li>
</ul>
<p>äº†è§£äº†è¿™ç‚¹ï¼Œå¹¶ä¸”æ‚¨ç›®å‰æ‹¥æœ‰Macã€iPhoneæˆ–iPadï¼Œé‚£ä¹ˆå°±å¯ä»¥å¼€å§‹ç¼–å†™ä¸€äº›BLEåº”ç”¨ç¨‹åºã€‚</p>
<h2 id="åœ¨iOSä¸Šå¼€å‘è“ç‰™åº”ç”¨ç¨‹åº"><a href="#åœ¨iOSä¸Šå¼€å‘è“ç‰™åº”ç”¨ç¨‹åº" class="headerlink" title="åœ¨iOSä¸Šå¼€å‘è“ç‰™åº”ç”¨ç¨‹åº"></a>åœ¨iOSä¸Šå¼€å‘è“ç‰™åº”ç”¨ç¨‹åº</h2><p>å½“ä½ è¦å¼€å‘ä¸€æ¬¾é€šè¿‡BLEä¸å…¶ä»–ç¡¬ä»¶äº¤äº’çš„åº”ç”¨ç¨‹åºï¼Œä½ éœ€è¦å…ˆé—®è‡ªå·±ä¸‰ä¸ªé—®é¢˜ï¼š</p>
<ul>
<li>æˆ‘æ˜¯è¦ä¸ä¸­å¿ƒè®¾å¤‡äº¤äº’ï¼Œè¿˜æ˜¯ä¸å¤–è®¾äº¤äº’ï¼Ÿ</li>
<li>é…ç½®æ–‡ä»¶æ˜¯ä»€ä¹ˆï¼Ÿä¹Ÿå°±æ˜¯å¤–è®¾æœ‰å“ªäº›æœåŠ¡å’Œç‰¹å¾ï¼Ÿ</li>
<li>æˆ‘å°†ä½¿ç”¨åˆ°å“ªä¸ªæ¡†æ¶æˆ–åº“ï¼Ÿ</li>
</ul>
<p>é¦–å…ˆï¼Œç¬¬ä¸€ä¸ªé—®é¢˜çš„ç­”æ¡ˆå†³å®šäº†åº”ç”¨ç¨‹åºå°†å®ç°é‚£ç§ç±»å‹çš„BLEè®¾å¤‡ã€‚å¦‚æœæˆ‘ä»¬æƒ³è¦äº¤äº’çš„è®¾å¤‡æ˜¯ä¸€ä¸ªä¸­å¿ƒè®¾å¤‡ï¼Œé‚£ä¹ˆAPPå°†æ‰®æ¼”çš„å°±æ˜¯å¤–è®¾çš„è§’è‰²ã€‚åä¹‹ï¼Œå¦‚æœæˆ‘ä»¬æƒ³ä¸ä¸€ä¸ªå¤–è®¾é€šä¿¡ï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„APPå°±å°†æ˜¯ä¸€ä¸ªä¸­å¿ƒè®¾å¤‡ã€‚</p>
<p>å…¶æ¬¡ï¼Œå®ç°æ˜ç¡®å¥½æœåŠ¡ä¸ç‰¹å¾å¯ä»¥è®©åº”ç”¨ç¨‹åºä¸BLEè®¾å¤‡å¾ˆå¿«çš„æ— ç¼å¯¹æ¥ã€‚å¦åˆ™å°†ä¸çŸ¥é“å¦‚ä½•è¿›è¡Œé€šä¿¡ã€‚</p>
<p>æœ€åï¼Œå¼€å‘BLEåº”ç”¨ï¼Œé€‰æ‹©ä¸€ä¸ªæœ€é€‚åˆçš„æ¡†æ¶æ˜¯éå¸¸çš„é‡è¦ã€‚å¯¹æˆ‘æ¥è¯´ï¼Œè¿™æ˜¯æœ€é‡è¦çš„åŸå› æœ‰ä¸¤ä¸ªï¼Œç¬¬ä¸€ä¸ªæ˜¯åœ¨å¼€å§‹ä¼ é€’æ•°æ®å‰ç”±å¾ˆå¤šçš„å¼‚æ­¥ä»»åŠ¡ï¼Œç¬¬äºŒä¸ªæ˜¯è¿™ä¸ªè¿‡ç¨‹å¯èƒ½ä¼šå› ä¸ºå¾ˆå¤šåŸå› å¤±è´¥ï¼Œé‚£ä¹ˆï¼Œé€‰æ‹©ä¸€ä¸ªç®€åŒ–è¿™äº›ä»»åŠ¡çš„æ¡†æ¶å°±æ˜¯éå¸¸é‡è¦çš„äº†ã€‚</p>
<p>ä»¥æˆ‘çš„ç»å†æ¥è¯´ï¼Œæˆ‘é€‰æ‹©è¿‡ä¸¤ç§æ¡†æ¶ï¼š</p>
<ul>
<li>Core Bluetoothï¼Œä»–æ˜¯è‹¹æœå¼€å‘çš„BLEæ¡†æ¶ï¼Œä»iOS5å¼€å§‹å°±åŒ…å«åœ¨iOS SDKä¸­ã€‚è¿™ä¸ªæ¡†æ¶ä¸¥é‡ä¾èµ–äºä»£ç†(delegate)ï¼Œå¹¶ä¸”ä»–æœ‰ä¸°å¯Œè€Œå®Œå–„çš„æ–‡æ¡£åŠç¤ºä¾‹ä»£ç ã€‚å”¯ä¸€ä¸è¶³çš„å°±æ˜¯è¿™ä¸ªæ¡†æ¶æœ‰äº›æ—¶é—´é•¿äº†ï¼Œä¸å¤Ÿæ–°é¢–ã€‚</li>
<li>BlueCapï¼Œå®ƒæ˜¯ä¸€ä¸ªåœ¨Core Bluetoothä¹‹ä¸Šçš„swiftè½¯ä»¶åŒ…ã€‚ä»–æ”¯æŒiOS9ä»¥ä¸Šçš„ç³»ç»Ÿï¼Œéœ€è¦Xcode 8.2æ¥å¼€å‘ã€‚ä»–ä¾èµ–äºFutureè€Œä¸æ˜¯Delegateï¼Œå¦‚æœä½ ä¸æ˜¯å¾ˆç†Ÿæ‚‰Futureï¼Œé‚£ä¹ˆè¿™å°†èŠ±è´¹ä½ ä¸€äº›æ—¶é—´å»ç†Ÿæ‚‰å®ƒï¼Œä½†ç›¸ä¿¡æˆ‘ï¼Œè¿™äº›æ˜¯å€¼å¾—çš„ï¼Œæ¯”èµ·delegateï¼Œè¿™å°†è®©ä½ æ„Ÿåˆ°æ›´è‡ªç„¶ã€‚</li>
</ul>
<p>ç”±äºæˆ‘ä»¬å°†è¦å¼€å‘çš„è¿™ä¸ªé¡¹ç›®æ”¯æŒiOS11ï¼Œå¹¶ä¸”ç”¨Swift4ç¼–å†™ï¼Œæˆ‘æ¯«æ— çŠ¹è±«çš„é€‰æ‹©äº†BlueCap ï¼šï¼‰ã€‚åœ¨ä¸‹ä¸€èŠ‚ä¸­ï¼Œæˆ‘å°†è¦åˆ›å»ºä¸€ä¸ªç®€å•çš„ä¸­å¿ƒè®¾å¤‡åº”ç”¨ï¼Œä»–å°†ä¸ä¸€ä¸ªMacä¸Šé€šè¿‡Blenoæ¨¡æ‹Ÿçš„å¤–è®¾è¿›è¡Œé€šä¿¡ã€‚</p>
<h2 id="å®ç°ä¸­å¿ƒè®¾å¤‡çš„iOSåº”ç”¨"><a href="#å®ç°ä¸­å¿ƒè®¾å¤‡çš„iOSåº”ç”¨" class="headerlink" title="å®ç°ä¸­å¿ƒè®¾å¤‡çš„iOSåº”ç”¨"></a>å®ç°ä¸­å¿ƒè®¾å¤‡çš„iOSåº”ç”¨</h2><p>é¦–å…ˆï¼Œæˆ‘ä»¬å°†é€šè¿‡Macæ¨¡æ‹Ÿä¸€ä¸ªå¤–è®¾ï¼Œå¦‚æœä½ æœ‰ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨è‡ªå·±çš„å¤–è®¾ã€‚</p>
<h3 id="é€šè¿‡Macæ¨¡æ‹Ÿä¸€ä¸ªå¤–è®¾"><a href="#é€šè¿‡Macæ¨¡æ‹Ÿä¸€ä¸ªå¤–è®¾" class="headerlink" title="é€šè¿‡Macæ¨¡æ‹Ÿä¸€ä¸ªå¤–è®¾"></a>é€šè¿‡Macæ¨¡æ‹Ÿä¸€ä¸ªå¤–è®¾</h3><p>æœ‰å¾ˆå¤šä¸åŒçš„æŠ€æœ¯å¯ä»¥é€šè¿‡Macæ¨¡æ‹Ÿä¸€ä¸ªBLEå¤–è®¾ã€‚ç¬¬ä¸€ä¸ªé—ªç°åœ¨æˆ‘è„‘å­é‡Œçš„æƒ³æ³•å°±æ˜¯åˆ›å»ºä¸€ä¸ªåŸºäºCore Bluetoothçš„Mac APPæ¥æ‰®æ¼”å¤–è®¾çš„è§’è‰²ã€‚è¿™ä¹Ÿæœ‰ä¸ªå«<a href="https://github.com/sandeepmistry/bleno" target="_blank" rel="external">bleno</a> çš„node.jsæ¨¡å—ï¼Œä»–å¯ä»¥å¾ˆå¿«çš„å®ç°ä¸€ä¸ªBLEå¤–è®¾ã€‚æœ¬æ–‡ä¸­æˆ‘ä»¬å°†ä½¿ç”¨blenoã€‚è¿™é‡Œæˆ‘ä»‹ç»ä¸‹å¿«é€Ÿå¯ç”¨å®ƒçš„è¿‡ç¨‹ï¼š</p>
<ul>
<li>å®‰è£…Xcode</li>
<li>å®‰è£…node.js</li>
<li>æ‰“å¼€ä¸€ä¸ªç»ˆç«¯ï¼Œé€šè¿‡ <figure class="highlight plain"><figcaption><span>install bleno``` å‘½ä»¤æ¥å®‰è£…blenoæ¨¡å—</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"> * ä¸‹è½½blenoçš„githubä»“åº“(https://github.com/sandeepmistry/bleno)[https://github.com/sandeepmistry/bleno]</div><div class="line"> * æ‰“å¼€ä¸€ä¸ªç»ˆç«¯å¹¶è¿›å…¥ examples/echo æ–‡ä»¶å¤¹</div><div class="line"> * è¿è¡Œ ```node main.js``` ã€‚å¦‚æœä½ é‡åˆ°â€œmissing moduleâ€çš„é”™è¯¯æç¤ºï¼Œä½ éœ€è¦ä½¿ç”¨npmå®‰è£…â€œmoduleâ€ï¼Œç„¶åå†è¯•ä¸€æ¬¡</div><div class="line"></div><div class="line">æ•´ä¸ªè¿‡ç¨‹çš„å‘½ä»¤å¦‚ä¸‹ï¼š</div><div class="line"></div><div class="line"> ```bash</div><div class="line"> $git clone https://github.com/sandeepmistry/bleno bleno</div><div class="line"> $cd bleno</div><div class="line"> $npm install bleno</div><div class="line"> $cd examples/echo</div><div class="line"> # $npm install module</div><div class="line"> $ node main.js</div><div class="line">bleno - echo</div><div class="line">on -&gt; stateChange: poweredOn</div><div class="line">on -&gt; advertisingStart: success</div></pre></td></tr></table></figure></li>
</ul>
<p>å¦‚æœä½ çœ‹åˆ°æœ€åçš„è¾“å‡ºï¼Œè¯´æ˜ä½ æˆåŠŸäº†ã€‚<br>ä½ å·²ç»åœ¨ä½ çš„ç”µè„‘ä¸Šæ¨¡æ‹Ÿäº†ä¸€ä¸ªLocal Nameä¸ºã€echoã€çš„BLEå¤–è®¾ï¼Œå¹¿æ’­æœåŠ¡çš„UUIDä¸ºEC00ï¼Œä½ å¯ä»¥æŸ¥çœ‹main.jsæ–‡ä»¶çœ‹çœ‹ä»–æ˜¯å¦‚ä½•è¿è¡Œçš„ã€‚<br>å½“æˆ‘ä»¬è¿æ¥ä¸Šï¼Œå¯ä»¥å‘ç°ä¸€ä¸ªUUIDä¸º â€œec0eâ€ çš„ç‰¹å¾å¯ç”¨äºè¯»ã€å†™å’Œé€šçŸ¥ã€‚è¿™äº›éƒ½å®šä¹‰åœ¨characteristics.jsä¸­ï¼Œæ–‡ä»¶ä¸­è¿˜å®šä¹‰äº†å¦‚ä½•å¤„ç†è¯»ã€å†™å’Œé€šçŸ¥ã€‚</p>
<p>ç°åœ¨æˆ‘ä»¬æœ‰äº†ä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„å¤–è®¾ï¼Œé‚£è®©æˆ‘ä»¬å¼€å§‹å¼€å‘ä¸€ä¸ªå¾®å‹çš„iOSåº”ç”¨ä¸è¿™ä¸ªå¤–è®¾è¿›è¡Œäº¤äº’å§ã€‚</p>
<h3 id="iOSä¸­å¿ƒè®¾å¤‡åº”ç”¨"><a href="#iOSä¸­å¿ƒè®¾å¤‡åº”ç”¨" class="headerlink" title="iOSä¸­å¿ƒè®¾å¤‡åº”ç”¨"></a>iOSä¸­å¿ƒè®¾å¤‡åº”ç”¨</h3><p>è¿™ä¸­å¿ƒè®¾å¤‡APPå°†éå¸¸ç®€æ´ã€‚ä»–æœç´¢å¹¿æ’­ä¸ºechoçš„è®¾å¤‡ï¼Œç¬¬ä¸€ä¸ªå‘ç°çš„å°±ç›´æ¥è¿ä¸Šã€‚æ¥ç€ï¼ŒAPPè®©æˆ‘ä»¬ä»ec0eç‰¹å¾è¯»å†™æ•°æ®ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹æ­¥éª¤æ¥åˆå§‹åŒ–å·¥ç¨‹ï¼š</p>
<ul>
<li>åˆ›å»ºä¸€ä¸ªç®€å•çš„åº”ç”¨</li>
</ul>
<p><img src="http://7oxfjd.com2.z0.glb.qiniucdn.com/2018-02-01-15174493294792.jpg" alt=""></p>
<ul>
<li>ç»™ä½ çš„åº”ç”¨å‘½åä¸ºSimpleBleCentralï¼Œå¹¶ä¸”é€‰æ‹©Swift</li>
</ul>
<p><img src="http://7oxfjd.com2.z0.glb.qiniucdn.com/2018-02-01-15174494036052.jpg" alt=""></p>
<p>ç°åœ¨ï¼Œå·¥ç¨‹å·²ç»åˆ›å»ºå¥½äº†ï¼Œæˆ‘ä»¬å°†æ·»åŠ BlueCapæ¡†æ¶(<a href="https://github.com/troystribling/BlueCap)[https://github.com/troystribling/BlueCap]ã€‚æœ‰å¾ˆå¤šä¸åŒçš„æ–¹æ³•æ·»åŠ ï¼Œæ¯”å¦‚Cocoapodsã€Carthageï¼Œè¿™é‡Œç”¨Cocoapodsæ–¹å¼å¯¼å…¥ï¼Œè¿™é‡Œä¸è¯¦ç»†ä»‹ç»å¦‚ä½•ä½¿ç”¨Cocoapodså¯¼å…¥ç¬¬ä¸‰æ–¹åº“ã€‚" target="_blank" rel="external">https://github.com/troystribling/BlueCap)[https://github.com/troystribling/BlueCap]ã€‚æœ‰å¾ˆå¤šä¸åŒçš„æ–¹æ³•æ·»åŠ ï¼Œæ¯”å¦‚Cocoapodsã€Carthageï¼Œè¿™é‡Œç”¨Cocoapodsæ–¹å¼å¯¼å…¥ï¼Œè¿™é‡Œä¸è¯¦ç»†ä»‹ç»å¦‚ä½•ä½¿ç”¨Cocoapodså¯¼å…¥ç¬¬ä¸‰æ–¹åº“ã€‚</a></p>
<p>æˆ‘ä»¬ä¹Ÿè¦æ·»åŠ CoreBluetoothæ¡†æ¶åˆ°é¡¹ç›®ä¸­ï¼Œå› ä¸ºBlueCapæ˜¯ä¾èµ–äºCoreBluetoothdeã€‚<br><img src="http://7oxfjd.com2.z0.glb.qiniucdn.com/2018-02-01-15174508768320.jpg" alt=""></p>
<p>ä¸‹ä¸€æ­¥æ˜¯åœ¨é¡¹ç›®çš„å±æ€§ä¸­æ·»åŠ ä¸­å¿ƒè®¾å¤‡åŠŸèƒ½ã€‚è¦åšçš„å°±æ˜¯è¿è¡Œåå°æ¨¡å¼å¹¶æ£€æŸ¥Bluetooth LEçš„å¯è®¿é—®æ€§ã€‚</p>
<p><img src="http://7oxfjd.com2.z0.glb.qiniucdn.com/2018-02-01-15174511314563.jpg" alt=""></p>
<p>æˆ‘ä»¬çš„storyboardåŒ…å«äº†ä¸€ä¸ªViewControllerï¼Œä»–å¯ä»¥åœ¨æ‰«ææˆ‘ä»¬æƒ³è¦ä½¿ç”¨ç‰¹å¾çš„æ—¶å€™å±•ç¤ºä¸€ä¸ªç­‰å¾…æŒ‡ç¤ºå™¨ã€‚å½“æˆ‘ä»¬å‘ç°äº†ç‰¹å¾ï¼ŒViewControlleråˆ™å±•ç°å‡ºä¸€ä¸ªå¯äº¤äº’çš„è§†å›¾ä¾›è¯»å†™è¯¥ç‰¹å¾ã€‚</p>
<p><img src="http://7oxfjd.com2.z0.glb.qiniucdn.com/2018-02-01-15174520548884.jpg" alt=""></p>
<p>æˆ‘ä»¬çš„view controllerè¦å®Œæˆä»¥ä¸‹ä»»åŠ¡ï¼š</p>
<ul>
<li>åˆå§‹åŒ–CentralManagerï¼Œä»–æ˜¯BlueCapKitçš„ä¸€ä¸ªä¸­å¿ƒè®¾å¤‡ç±»ï¼Œå¯ç”¨æ¥æ‰«æå¤–è®¾</li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//åˆå§‹åŒ–å¹¶å®šä¹‰ä¸€ä¸ªæ ‡è¯†çš„Keyï¼Œè¿™ä¸ªKeyä¹‹åå¯ä»¥ç”¨æ¥é‡ç”¨è¯¥Manageç±»</span></div><div class="line"><span class="keyword">let</span> manager = <span class="type">CentralManager</span>(options: [<span class="type">CBCentralManagerOptionRestoreIdentifierKey</span> : <span class="string">"CentralMangerKey"</span> <span class="keyword">as</span> <span class="type">NSString</span>])</div><div class="line"></div><div class="line"><span class="comment">//ä¸€ä¸ªfetureæµï¼Œå½“è¯¥ç®¡ç†ç±»çŠ¶æ€å‘ç”Ÿå˜åŒ–çš„æ—¶å€™ï¼Œä»–ä¼šé€šçŸ¥æˆ‘ä»¬</span></div><div class="line"><span class="keyword">let</span> stateChangeFuture = manager.whenStateChanges()</div></pre></td></tr></table></figure>
<ul>
<li>æ‰«æå¹¿æ’­åŒ…å«ec00æœåŠ¡çš„å¤–è®¾</li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//å¦‚æœè“ç‰™æ˜¯å¼€å¯çš„ï¼Œé‚£ä¹ˆå°±å¯ä»¥æ‰«æ</span></div><div class="line"><span class="keyword">let</span> scanFuture = stateChangeFuture.flatMap &#123; state -&gt; <span class="type">FutureStream</span>&lt;<span class="type">Peripheral</span>&gt; <span class="keyword">in</span></div><div class="line">    <span class="keyword">switch</span> state &#123;</div><div class="line">    <span class="keyword">case</span> .poweredOn:</div><div class="line">        <span class="type">DispatchQueue</span>.main.async &#123;</div><div class="line">            <span class="keyword">self</span>.connectionStatusLabel.text = <span class="string">"start scanning"</span></div><div class="line">            <span class="built_in">print</span>(<span class="keyword">self</span>.connectionStatusLabel.text!)</div><div class="line">        &#125;</div><div class="line">        <span class="comment">//æ‰«æå¹¿æ’­äº†æœåŠ¡ä¸ºec00çš„è®¾å¤‡</span></div><div class="line">        <span class="keyword">return</span> manager.startScanning(forServiceUUIDs: [serviceUUID])</div><div class="line">    <span class="keyword">case</span> .poweredOff:</div><div class="line">        <span class="keyword">throw</span> <span class="type">AppError</span>.poweredOff</div><div class="line">    <span class="keyword">case</span> .unauthorized, .unsupported:</div><div class="line">        <span class="keyword">throw</span> <span class="type">AppError</span>.invalidState</div><div class="line">    <span class="keyword">case</span> .resetting:</div><div class="line">        <span class="keyword">throw</span> <span class="type">AppError</span>.resetting</div><div class="line">    <span class="keyword">case</span> .unknown:</div><div class="line">        <span class="keyword">throw</span> <span class="type">AppError</span>.unknown</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>ç¬¬ä¸€ä¸ªæ‰¾åˆ°æœ‰è¯¥æœåŠ¡çš„ç±»ï¼Œæˆ‘ä»¬è¿æ¥ä»–</li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//è¿æ¥ç¬¬ä¸€ä¸ªæ‰¾åˆ°çš„è®¾å¤‡</span></div><div class="line"><span class="keyword">let</span> connectionFuture = scanFuture.flatMap &#123; peripheral -&gt; <span class="type">FutureStream</span>&lt;<span class="type">Peripheral</span>&gt; <span class="keyword">in</span></div><div class="line">    <span class="comment">//æ‰¾åˆ°äº†ç«‹å³åœæ­¢æ‰«æ</span></div><div class="line">    manager.stopScanning()</div><div class="line">    <span class="type">DispatchQueue</span>.main.async &#123;</div><div class="line">        <span class="keyword">self</span>.connectionStatusLabel.text = <span class="string">"Found peripheral \(peripheral.identifier.uuidString). Trying to connect"</span></div><div class="line">        <span class="built_in">print</span>(<span class="keyword">self</span>.connectionStatusLabel.text!)</div><div class="line">    &#125;</div><div class="line">    <span class="comment">//è¿æ¥</span></div><div class="line">    <span class="keyword">return</span> peripheral.connect(connectionTimeout: <span class="number">10</span>, capacity: <span class="number">5</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>æ¥ç€ï¼Œæˆ‘ä»¬å¯»æ‰¾ä¸ºâ€œec00â€çš„æœåŠ¡ï¼Œè¿™æ­¥æœ‰ç‚¹åƒé‡å¤äº†ä¸Šä¸€æ­¥ï¼Œä½†æ˜¯å®ä¾‹åŒ–æœåŠ¡å¯¹è±¡æ˜¯éå¸¸é‡è¦çš„ï¼Œå®ƒå°†å¸®æˆ‘ä»¬æ‰¾åˆ°éœ€è¦çš„ç‰¹å¾</li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//æ‰¾åˆ°"ec00"çš„æœåŠ¡ï¼Œå¹¶è®¿é—®ä»–çš„ç‰¹å¾</span></div><div class="line"><span class="keyword">let</span> discoveryFuture = connectionFuture.flatMap &#123; peripheral -&gt; <span class="type">Future</span>&lt;<span class="type">Peripheral</span>&gt; <span class="keyword">in</span></div><div class="line">    <span class="keyword">return</span> peripheral.discoverServices([serviceUUID])</div><div class="line">    &#125;.flatMap &#123; discoveredPeripheral -&gt; <span class="type">Future</span>&lt;<span class="type">Service</span>&gt; <span class="keyword">in</span></div><div class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> service = discoveredPeripheral.service(serviceUUID) <span class="keyword">else</span> &#123;</div><div class="line">            <span class="keyword">throw</span> <span class="type">AppError</span>.serviceNotFound</div><div class="line">        &#125;</div><div class="line">        peripheral = discoveredPeripheral</div><div class="line">        <span class="type">DispatchQueue</span>.main.async &#123;</div><div class="line">            <span class="keyword">self</span>.connectionStatusLabel.text = <span class="string">"Discovered service \(service.uuid.uuidString). Trying to discover characteristics"</span></div><div class="line">            <span class="built_in">print</span>(<span class="keyword">self</span>.connectionStatusLabel.text!)</div><div class="line">        &#125;</div><div class="line">        <span class="comment">//å¼€å§‹æ£€æŸ¥æ‰¾åˆ°çš„æœåŠ¡ï¼Œå¯»æ‰¾ä¸º"ec0e"çš„ç‰¹å¾</span></div><div class="line">        <span class="keyword">return</span> service.discoverCharacteristics([dateCharacteristicUUID])</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>æ‰¾åˆ°â€ec0eâ€çš„ç‰¹å¾ï¼Œç„¶åæ³¨å†Œé€šçŸ¥</li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> 1- æ£€æŸ¥è¿™ç‰¹å¾æ˜¯å¦è¢«æ‰¾åˆ°</span></div><div class="line"><span class="comment"> 2- æ³¨å†Œé€šçŸ¥</span></div><div class="line"><span class="comment">*/</span></div><div class="line"><span class="keyword">let</span> dataFuture = discoveryFuture.flatMap &#123; service -&gt; <span class="type">Future</span>&lt;<span class="type">Characteristic</span>&gt; <span class="keyword">in</span></div><div class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> dataCharacteristic = service.characteristic(dateCharacteristicUUID) <span class="keyword">else</span> &#123;</div><div class="line">        <span class="keyword">throw</span> <span class="type">AppError</span>.dataCharactertisticNotFound</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">self</span>.dataCharacteristic = dataCharacteristic</div><div class="line">    <span class="type">DispatchQueue</span>.main.async &#123;</div><div class="line">        <span class="keyword">self</span>.connectionStatusLabel.text = <span class="string">"Discovered characteristic \(dataCharacteristic.uuid.uuidString). COOL :)"</span></div><div class="line">        <span class="built_in">print</span>(<span class="keyword">self</span>.connectionStatusLabel.text!)</div><div class="line">    &#125;</div><div class="line">    <span class="comment">//å½“æˆ‘ä»¬æ‰¾åˆ°äº†è¯¥ç‰¹å¾ï¼Œæˆ‘ä»¬å¯ä»¥å±•ç¤ºç‰¹å¾äº¤äº’è§†å›¾</span></div><div class="line">    <span class="type">DispatchQueue</span>.main.async &#123;</div><div class="line">        <span class="keyword">self</span>.loadingView.isHidden = <span class="literal">true</span></div><div class="line">        <span class="keyword">self</span>.characteristicView.isHidden = <span class="literal">false</span></div><div class="line">    &#125;</div><div class="line">    <span class="comment">//ä»ç‰¹å¾è¯»å–æ•°æ®</span></div><div class="line">    <span class="keyword">self</span>.read()</div><div class="line">    <span class="comment">//å‘Šè¯‰ç‰¹å¾å¼€å¯å€¼å˜åŒ–çš„é€šçŸ¥</span></div><div class="line">    <span class="keyword">return</span> dataCharacteristic.startNotifying()</div><div class="line">    &#125;.flatMap &#123; characteristic -&gt; <span class="type">FutureStream</span>&lt;(characteristic: <span class="type">Characteristic</span>, data: <span class="type">Data</span>?)&gt; <span class="keyword">in</span></div><div class="line">        <span class="comment">//æ³¨å†Œæ¥æ”¶å€¼å˜åŒ–é€šçŸ¥</span></div><div class="line">        <span class="keyword">return</span> characteristic.receiveNotificationUpdates(capacity: <span class="number">10</span>)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//æ¯å½“å€¼å˜åŒ–ï¼Œéƒ½ä¼šè°ƒç”¨è¯¥é—­åŒ…</span></div><div class="line">dataFuture.onSuccess &#123; (<span class="number">_</span>, data) <span class="keyword">in</span></div><div class="line">    <span class="keyword">let</span> s = <span class="type">String</span>(data:data!, encoding: .utf8)</div><div class="line">    <span class="type">DispatchQueue</span>.main.async &#123;</div><div class="line">        <span class="keyword">self</span>.notifiedValueLabel.text = <span class="string">"notified value is \(s)"</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸€ä¸ªç®€å•çš„å‡½æ•°é“¾æ¥å®Œæˆä»¥ä¸Šæ‰€æœ‰æ­¥éª¤ã€‚<br>è·å¾—äº†ç‰¹å¾å¯¹è±¡ï¼Œæˆ‘ä»¬å°±èƒ½å¯¹å®ƒè¯»å†™æ•°æ®äº†ã€‚</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">read</span><span class="params">()</span></span>&#123;</div><div class="line">    <span class="comment">//read a value from the characteristic</span></div><div class="line">    <span class="keyword">let</span> readFuture = <span class="keyword">self</span>.dataCharacteristic?.read(timeout: <span class="number">5</span>)</div><div class="line">    readFuture?.onSuccess &#123; (<span class="number">_</span>) <span class="keyword">in</span></div><div class="line">        <span class="comment">//the value is in the dataValue property</span></div><div class="line">        <span class="keyword">let</span> s = <span class="type">String</span>(data:(<span class="keyword">self</span>.dataCharacteristic?.dataValue)!, encoding: .utf8)</div><div class="line">        <span class="type">DispatchQueue</span>.main.async &#123;</div><div class="line">            <span class="keyword">self</span>.valueLabel.text = <span class="string">"Read value is \(s)"</span></div><div class="line">            <span class="built_in">print</span>(<span class="keyword">self</span>.valueLabel.text!)</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    readFuture?.onFailure &#123; (<span class="number">_</span>) <span class="keyword">in</span></div><div class="line">        <span class="keyword">self</span>.valueLabel.text = <span class="string">"read error"</span></div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">write</span><span class="params">()</span></span>&#123;</div><div class="line">    <span class="keyword">self</span>.valueToWriteTextField.resignFirstResponder()</div><div class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> text = <span class="keyword">self</span>.valueToWriteTextField.text <span class="keyword">else</span>&#123;</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">//write a value to the characteristic</span></div><div class="line">    <span class="keyword">let</span> writeFuture = <span class="keyword">self</span>.dataCharacteristic?.write(data:text.data(using: .utf8)!)</div><div class="line">    writeFuture?.onSuccess(completion: &#123; (<span class="number">_</span>) <span class="keyword">in</span></div><div class="line">        <span class="built_in">print</span>(<span class="string">"write succes"</span>)</div><div class="line">    &#125;)</div><div class="line">    writeFuture?.onFailure(completion: &#123; (e) <span class="keyword">in</span></div><div class="line">        <span class="built_in">print</span>(<span class="string">"write failed"</span>)</div><div class="line">    &#125;)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h2><p>æœ¬æ–‡æ˜¯å¯¹è“ç‰™ä½åŠŸè€—çš„ç²—æµ…çš„å­¦ä¹ ã€‚BLEæ˜¯ä¸€ä¸ªè“ç‰™æ ‡å‡†ï¼Œå…è®¸æ— éœ€åœ¨ç³»ç»Ÿè®¾ç½®ä¸­è¿›è¡Œé…å¯¹çš„è¿›è¡Œè¿æ¥é€šä¿¡ä»¥é™ä½é€šä¿¡çš„åŠŸè€—ã€‚æˆ‘ä»¬å†iOSä¸Šå®ç°äº†ä¸€ä¸ªè“ç‰™ä¸­å¿ƒè®¾å¤‡ï¼Œå®ƒè¿æ¥åˆ°äº†Macä¸Šæ¨¡æ‹Ÿçš„å¤–è®¾ã€‚<br>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨BLEåšå¾ˆå¤šçš„äº‹æƒ…ã€‚ä¾‹å¦‚æˆ‘ä»¬å¯ä»¥åœ¨æ™ºèƒ½æ‰‹ç¯ä¸Šç¼–å†™æˆ‘ä»¬è‡ªå·±çš„åº”ç”¨ç¨‹åºã€‚åˆä¾‹å¦‚ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨Arduinoä¸»æ¿ä¸Šå®‰è£…BLEèŠ¯ç‰‡ï¼Œé€šè¿‡ä»–å®ç°å¾ˆå¤šæœ‰è¶£çš„åº”ç”¨ã€‚è¯‘è€…æ¥è§¦è¿‡çš„å¾ˆå¤šä¸ªæ™ºèƒ½äº§å“çš„é¡¹ç›®ï¼Œæ ¸å¿ƒèŠ¯ç‰‡éƒ½æ˜¯Nordicã€‚</p>
<p>è¯¥é¡¹ç›®çš„æºç å¯ä»¥åœ¨GitHubä¸Šçœ‹åˆ°ï¼Œ(<a href="https://github.com/yostane/iOS-BlueCap-Example)[https://github.com/yostane/iOS-BlueCap-Example]ã€‚" target="_blank" rel="external">https://github.com/yostane/iOS-BlueCap-Example)[https://github.com/yostane/iOS-BlueCap-Example]ã€‚</a></p>
<p>èµ¶ç´§åŠ¨æ‰‹å®ç°ä¸‹æ‰æ˜¯æœ€å¿«ä¹çš„äº‹æƒ…:)ã€‚</p>
<h2 id="å¼•ç”¨"><a href="#å¼•ç”¨" class="headerlink" title="å¼•ç”¨"></a>å¼•ç”¨</h2><p><a href="https://oleb.net/blog/2013/04/starting-bluetooth-low-energy-development-ios/" target="_blank" rel="external">https://oleb.net/blog/2013/04/starting-bluetooth-low-energy-development-ios/</a></p>
<p><a href="https://docs.mbed.com/docs/ble-intros/en/latest/Introduction/BLEInDepth/" target="_blank" rel="external">https://docs.mbed.com/docs/ble-intros/en/latest/Introduction/BLEInDepth/</a></p>
<p><a href="https://stackoverflow.com/questions/17732321/peripheral-and-central-at-the-same-time-on-ios" target="_blank" rel="external">https://stackoverflow.com/questions/17732321/peripheral-and-central-at-the-same-time-on-ios</a></p>
<p><a href="https://learn.adafruit.com/introduction-to-bluetooth-low-energy/gatt" target="_blank" rel="external">https://learn.adafruit.com/introduction-to-bluetooth-low-energy/gatt</a></p>
<p><a href="https://www.bluetooth.com/specifications/generic-attributes-overvie" target="_blank" rel="external">https://www.bluetooth.com/specifications/generic-attributes-overvie</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/08/16/Xcode-9-0-beta5-ç¼–è¾‘Storyboardæ—¶é—ªé€€é—®é¢˜/" itemprop="url">
                  Xcode 9.0 beta5,ç¼–è¾‘Storyboardæ—¶é—ªé€€é—®é¢˜
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">VerÃ¶ffentlicht am</span>
            <time itemprop="dateCreated" datetime="2017-08-16T10:37:01+08:00" content="2017-08-16">
              2017-08-16
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="èµ·å› "><a href="#èµ·å› " class="headerlink" title="èµ·å› "></a>èµ·å› </h1><p>æœ€è¿‘åƒèƒèŸ¹ï¼Œä¸€ç›´ä½¿ç”¨Xcode9 Betaç‰ˆæœ¬ï¼ˆå…¶å®å°±æ˜¯æ–°é¡¹ç›®ç›´æ¥ç”¨Swift4å†™äº†ï¼Œçœå¾—åˆ°æ—¶å€™è¿˜è¦å†åšé€‚é…ï¼‰ã€‚ç„¶è€Œé‡åˆ°äº†å¾ˆå¤šé—®é¢˜ï¼Œä¸€äº›é—®é¢˜ä¹Ÿå°±ä¸è¯´äº†ï¼Œä½†è¿™æ¬¡é‡åˆ°è¿™ä¸ªé—®é¢˜ï¼Œå®åœ¨ä¸èƒ½å¿ï¼Œå‡çº§åˆ°Xcode 9.0 beta5åï¼Œé¡¹ç›®çš„ä¸»Storyboardæ‰“ä¸å¼€äº†ã€‚</p>
<h1 id="æ—¥å¿—"><a href="#æ—¥å¿—" class="headerlink" title="æ—¥å¿—"></a>æ—¥å¿—</h1><p>Xcodeé—ªé€€æ—¥å¿—å¦‚ä¸‹</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div></pre></td><td class="code"><pre><div class="line">Process:               Xcode [33099]  </div><div class="line">Path:                  /Applications/Xcode-beta.app/Contents/MacOS/Xcode  </div><div class="line">Identifier:            com.apple.dt.Xcode  </div><div class="line">Version:               9.0 (13226.5)  </div><div class="line">Build Info:            IDEFrameworks-13226005000000000~14  </div><div class="line">Code Type:             X86-64 (Native)  </div><div class="line">Parent Process:        ??? [1]  </div><div class="line">Responsible:           Xcode [33099]  </div><div class="line">User ID:               1700997662  </div><div class="line">  </div><div class="line">  </div><div class="line">Date/Time:             2017-08-10 15:45:59.315 -0400  </div><div class="line">OS Version:            Mac OS X 10.12.6 (16G29)  </div><div class="line">Report Version:        12  </div><div class="line">Anonymous UUID:        4C707867-0F4B-A4D5-CFF4-F497B7B7F058  </div><div class="line">  </div><div class="line">  </div><div class="line">  </div><div class="line">  </div><div class="line">Time Awake Since Boot: 1200000 seconds  </div><div class="line">  </div><div class="line">  </div><div class="line">System Integrity Protection: enabled  </div><div class="line">  </div><div class="line">  </div><div class="line">Crashed Thread:        0  Dispatch queue: com.apple.main-thread  </div><div class="line">  </div><div class="line">  </div><div class="line">Exception Type:        EXC_CRASH (SIGABRT)  </div><div class="line">Exception Codes:       0x0000000000000000, 0x0000000000000000  </div><div class="line">Exception Note:        EXC_CORPSE_NOTIFY  </div><div class="line">  </div><div class="line">  </div><div class="line">Application Specific Information:  </div><div class="line">ProductBuildVersion: 9M202q  </div><div class="line">ASSERTION FAILURE in /Library/Caches/com.apple.xbs/Sources/IDEInterfaceBuilder/IDEInterfaceBuilder-13178.6/InterfaceBuilderKit/Document/StoryboardDocument/Metrics/IBStoryboardMetricsInferrer.m:128  </div><div class="line">Details:  Failed to push inherited simulated metrics to all scenes.  </div><div class="line">Object:   &lt;IBStoryboardMetricsInferrer: 0x7fb91138a690&gt;  </div><div class="line">Method:   -rebuildInferredMetrics  </div><div class="line">Thread:   &lt;NSThread: 0x7fb907c18050&gt;&#123;number = 1, name = main&#125;  </div><div class="line">Hints:   </div><div class="line">  0: Replacement view is installing: &lt;IBStoryboardCanvasViewController: 0x7fb911167ee0 representing: (null)&gt;  </div><div class="line">Backtrace:  </div><div class="line">  0   -[IDEAssertionHandler handleFailureInMethod:object:fileName:lineNumber:assertionSignature:messageFormat:arguments:] (in IDEKit)  </div><div class="line">  1   _DVTAssertionHandler (in DVTFoundation)  </div><div class="line">  2   _DVTAssertionFailureHandler (in DVTFoundation)  </div><div class="line">  3   -[IBStoryboardMetricsInferrer rebuildInferredMetrics] (in IDEInterfaceBuilderKit)  </div><div class="line">  4   -[DVTDelayedInvocation runBlock:] (in DVTFoundation)  </div><div class="line">  5   -[DVTDelayedInvocation invokeIfNeeded] (in DVTFoundation)  </div><div class="line">  6   -[DVTDelayedInvocation invoke] (in DVTFoundation)  </div><div class="line">  7   -[IBCocoaTouchDocumentPlatformAdapter updateDocumentSimulatedMetricsWithDeviceConfiguration:] (in IDEInterfaceBuilderCocoaTouchIntegration)  </div><div class="line">  8   -[IBDocument switchToDeviceConfigurationWithoutFrameDeciding:] (in IDEInterfaceBuilderKit)  </div><div class="line">  9   -[IBDocument switchToDeviceConfiguration:] (in IDEInterfaceBuilderKit)  </div><div class="line">10   -[IBCanvasViewController _addDeviceBarIfNeeded] (in IDEInterfaceBuilderKit)  </div><div class="line">11   -[IBAbstractDocumentEditor didFinishLoadingSubViewControllers] (in IDEInterfaceBuilderKit)  </div><div class="line">12   -[IBAbstractDocumentEditor replacementView:didInstallViewController:] (in IDEInterfaceBuilderKit)  </div><div class="line">13   __42-[DVTReplacementView _setupViewController]_block_invoke (in DVTKit)  </div><div class="line">14   DVTInvokeWithFailureHint (in DVTFoundation)  </div><div class="line">15   -[DVTReplacementView _setupViewController] (in DVTKit)  </div><div class="line">16   -[DVTReplacementView installedViewController] (in DVTKit)  </div><div class="line">17   -[IBAbstractDocumentEditor viewDidInstall] (in IDEInterfaceBuilderKit)  </div><div class="line">18   -[IBStoryboardDocumentEditor viewDidInstall] (in IDEInterfaceBuilderKit)  </div><div class="line">19   -[DVTViewController _viewDidInstall] (in DVTKit)  </div><div class="line">20   -[_DVTViewController_ViewLifecycleInterpositions viewDidMoveToWindow] (in DVTKit)  </div><div class="line">21   -[NSView _setWindow:] (in AppKit)  </div><div class="line">22   -[NSView addSubview:] (in AppKit)  </div><div class="line">23   -[NSView setSubviews:] (in AppKit)  </div><div class="line">24   -[DVTBorderedView setContentView:] (in DVTKit)  </div><div class="line">25   -[IDEEditorContext _setEditorView] (in IDEKit)  </div><div class="line">26   -[IDEEditorContext setupNewEditor:] (in IDEKit)  </div><div class="line">27   __91-[IDEEditorContext _openNavigableItem:documentExtension:document:shouldInstallEditorBlock:]_block_invoke (in IDEKit)  </div><div class="line">28   -[IDEEditorContext _performBlockInsideReentrantGuard:] (in IDEKit)  </div><div class="line">29   -[IDEEditorContext _openNavigableItem:documentExtension:document:shouldInstallEditorBlock:] (in IDEKit)  </div><div class="line">30   -[IDEEditorContext _openNavigableItem:withContentsOfURL:documentExtension:shouldInstallEditorBlock:] (in IDEKit)  </div><div class="line">31   -[IDEEditorContext _notifyDelegateAndOpenNavigableItem:withContentsURL:documentExtensionIdentifier:locationToSelect:annotationRepresentedObject:stateDictionary:annotationWantsIndicatorAnimation:exploreAnnotationRepresentedObject:highlightSelection:alwaysReplaceExistingNavigableItem:skipSubDocumentNavigationUnlessEditorIsReplaced:] (in IDEKit)  </div><div class="line">32   -[IDEEditorContext _notifyDelegateAndOpenEditorOpenSpecifier:updateHistory:] (in IDEKit)  </div><div class="line">33   -[IDEEditorContext openEditorOpenSpecifier:updateHistory:] (in IDEKit)  </div><div class="line">34   -[IDEEditorContext openEditorOpenSpecifier:] (in IDEKit)  </div><div class="line">35   -[IDEEditorModeViewController openEditorOpenSpecifier:editorContext:] (in IDEKit)  </div><div class="line">36   -[IDEEditorArea _openEditorOpenSpecifier:editorContext:takeFocus:] (in IDEKit)  </div><div class="line">37   __108+[IDEEditorCoordinator _doOpenEditorOpenSpecifier:forWorkspaceTabController:editorContext:target:takeFocus:]_block_invoke_2 (in IDEKit)  </div><div class="line">38   __108+[IDEEditorCoordinator _doOpenEditorOpenSpecifier:forWorkspaceTabController:editorContext:target:takeFocus:]_block_invoke (in IDEKit)  </div><div class="line">39   +[IDEEditorCoordinator _doOpenWithWorkspaceTabController:editorContext:target:allowFallback:documentURL:usingBlock:] (in IDEKit)  </div><div class="line">40   +[IDEEditorCoordinator _doOpenEditorOpenSpecifier:forWorkspaceTabController:editorContext:target:takeFocus:] (in IDEKit)  </div><div class="line">41   -[_IDEOpenRequest _primitiveRunIfNecessary] (in IDEKit)  </div><div class="line">42   -[_IDEOpenRequest _runIfNecessary] (in IDEKit)  </div><div class="line">43   __NSFireDelayedPerform (in Foundation)  </div><div class="line">44   __CFRUNLOOP_IS_CALLING_OUT_TO_A_TIMER_CALLBACK_FUNCTION__ (in CoreFoundation)  </div><div class="line">45   __CFRunLoopDoTimer (in CoreFoundation)  </div><div class="line">46   __CFRunLoopDoTimers (in CoreFoundation)  </div><div class="line">47   __CFRunLoopRun (in CoreFoundation)  </div><div class="line">48   CFRunLoopRunSpecific (in CoreFoundation)  </div><div class="line">49   RunCurrentEventLoopInMode (in HIToolbox)  </div><div class="line">50   ReceiveNextEventCommon (in HIToolbox)  </div><div class="line">51   _BlockUntilNextEventMatchingListInModeWithFilter (in HIToolbox)  </div><div class="line">52   _DPSNextEvent (in AppKit)  </div><div class="line">53   -[NSApplication(NSEvent) _nextEventMatchingEventMask:untilDate:inMode:dequeue:] (in AppKit)  </div><div class="line">54   -[DVTApplication nextEventMatchingMask:untilDate:inMode:dequeue:] (in DVTKit)  </div><div class="line">55   -[NSApplication run] (in AppKit)  </div><div class="line">56   NSApplicationMain (in AppKit)  </div><div class="line">57   start (in libdyld.dylib)</div></pre></td></tr></table></figure>
<h1 id="å¯»æ‰¾è§£å†³æ–¹æ¡ˆ"><a href="#å¯»æ‰¾è§£å†³æ–¹æ¡ˆ" class="headerlink" title="å¯»æ‰¾è§£å†³æ–¹æ¡ˆ"></a>å¯»æ‰¾è§£å†³æ–¹æ¡ˆ</h1><p>çœ‹åˆ°Apple Developer Forumsä¸Šå¾ˆå¤šäººæäº†ç±»ä¼¼çš„é—®é¢˜ï¼Œä½†å¹¶æ²¡æœ‰äººè¸¢å‡ºè§£å†³æ–¹æ¡ˆã€‚</p>
<p>ä»æ—¥å¿—çœ‹ï¼Œåªæœ‰å…³é”®è¯inheritedï¼Œä½†æŠŠç›¸å…³çš„éƒ½å»æ‰äº†ï¼Œä¹Ÿå¹¶æ²¡æœ‰æ•ˆæœã€‚</p>
<h1 id="è§£å†³æ–¹æ³•"><a href="#è§£å†³æ–¹æ³•" class="headerlink" title="è§£å†³æ–¹æ³•"></a>è§£å†³æ–¹æ³•</h1><p>é€šè¿‡å°è¯•é‡æ–°åˆ›å»ºStoryboardè¿›è¡Œæµ‹è¯•ï¼Œè¿˜æœ‰å°±æ˜¯gitå¾€å‰å›é€€æ‰¾ä¸€ä¸ªä¸é—ªé€€ç‰ˆæœ¬çš„Storyboardï¼Œé€šè¿‡ä»–ä»¬ä¹‹é—´çš„æ¯”è¾ƒï¼ŒçŒœæµ‹å¯èƒ½æ˜¯gestureRecognizersçš„é—®é¢˜ã€‚</p>
<p>ç„¶åï¼ŒæŠŠgestureRecognizersç›¸å…³çš„éƒ¨åˆ†éƒ½åˆ äº†ï¼Œé€šè¿‡ä»£ç å®ç°gestureï¼Œå°±ä¸ä¼šå‡ºç°é—ªé€€é—®é¢˜äº†ï¼ŒçœŸæ˜¯è¿æ°”å¥½ã€‚</p>
<p>åˆ é™¤ä»¥ä¸‹3éƒ¨åˆ†ä»£ç ã€‚</p>
<pre><code>&lt;!-- åˆ é™¤&lt;gestureRecognizers/&gt; --&gt;

&lt;!--
&lt;connections&gt;
    &lt;outletCollection property=&quot;gestureRecognizers&quot; destination=&quot;ngk-1s-19f&quot; appends=&quot;YES&quot; id=&quot;xDu-EO-3XT&quot;/&gt;
&lt;/connections&gt;
--&gt;

&lt;!--
&lt;tapGestureRecognizer id=&quot;ngk-1s-19f&quot;&gt;
    &lt;connections&gt;
        &lt;action selector=&quot;tapConnectGestureAction:&quot; destination=&quot;TSL-wS-yk1&quot; id=&quot;VZS-RM-dhp&quot;/&gt;
        &lt;segue destination=&quot;7YZ-oH-7MN&quot; kind=&quot;presentation&quot; id=&quot;WjS-a1-0BG&quot;/&gt;
    &lt;/connections&gt;
&lt;/tapGestureRecognizer&gt;
--&gt;
</code></pre>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/10/26/ç»ˆç«¯é€šè¿‡Shadowsocksç§‘å­¦ä¸Šç½‘/" itemprop="url">
                  ç»ˆç«¯é€šè¿‡Shadowsocksç§‘å­¦ä¸Šç½‘
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">VerÃ¶ffentlicht am</span>
            <time itemprop="dateCreated" datetime="2016-10-26T21:09:12+08:00" content="2016-10-26">
              2016-10-26
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="ç»ˆç«¯é€šè¿‡Shadowsocksç§‘å­¦ä¸Šç½‘"><a href="#ç»ˆç«¯é€šè¿‡Shadowsocksç§‘å­¦ä¸Šç½‘" class="headerlink" title="ç»ˆç«¯é€šè¿‡Shadowsocksç§‘å­¦ä¸Šç½‘"></a>ç»ˆç«¯é€šè¿‡Shadowsocksç§‘å­¦ä¸Šç½‘</h1><h2 id="å®‰è£…polipo"><a href="#å®‰è£…polipo" class="headerlink" title="å®‰è£…polipo"></a>å®‰è£…polipo</h2><p>polipoæ˜¯ä¸€ä¸ªè½»é‡çº§çš„ç¼“å­˜webä»£ç†ç¨‹åº</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ sudo brew install polipo</div></pre></td></tr></table></figure>
<h2 id="è®¾ç½®è‡ªåŠ¨å¯åŠ¨"><a href="#è®¾ç½®è‡ªåŠ¨å¯åŠ¨" class="headerlink" title="è®¾ç½®è‡ªåŠ¨å¯åŠ¨"></a>è®¾ç½®è‡ªåŠ¨å¯åŠ¨</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ ln -sfv /usr/local/opt/polipo/*.plist ~/Library/LaunchAgents</div><div class="line">/Users/David_Woo/Library/LaunchAgents/homebrew.mxcl.polipo.plist -&gt; /usr/local/opt/polipo/homebrew.mxcl.polipo.plist</div></pre></td></tr></table></figure>
<h2 id="ä¿®æ”¹é…ç½®"><a href="#ä¿®æ”¹é…ç½®" class="headerlink" title="ä¿®æ”¹é…ç½®"></a>ä¿®æ”¹é…ç½®</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$sudo vim /usr/local/opt/polipo/homebrew.mxcl.polipo.plist</div></pre></td></tr></table></figure>
<p>å¢åŠ ä¸€è¡Œ\<string>socksParentProxy=localhost:1080\</string>,å®Œå…¨æ›¿æ¢åº”è¯¥ä¹Ÿæ˜¯okçš„</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</div><div class="line">&lt;!DOCTYPE plist PUBLIC &quot;-//Apple//DTD PLIST 1.0//EN&quot; &quot;http://www.apple.com/DTDs/PropertyList-1.0.dtd&quot;&gt;</div><div class="line">&lt;plist version=&quot;1.0&quot;&gt;</div><div class="line">  &lt;dict&gt;</div><div class="line">    &lt;key&gt;Label&lt;/key&gt;</div><div class="line">    &lt;string&gt;homebrew.mxcl.polipo&lt;/string&gt;</div><div class="line">    &lt;key&gt;RunAtLoad&lt;/key&gt;</div><div class="line">    &lt;true/&gt;</div><div class="line">    &lt;key&gt;KeepAlive&lt;/key&gt;</div><div class="line">    &lt;true/&gt;</div><div class="line">    &lt;key&gt;ProgramArguments&lt;/key&gt;</div><div class="line">    &lt;array&gt;</div><div class="line">        &lt;string&gt;/usr/local/opt/polipo/bin/polipo&lt;/string&gt;</div><div class="line">        &lt;string&gt;socksParentProxy=localhost:1080&lt;/string&gt;</div><div class="line">    &lt;/array&gt;</div><div class="line">    &lt;key&gt;SoftResourceLimits&lt;/key&gt;</div><div class="line">    &lt;dict&gt;</div><div class="line">      &lt;key&gt;NumberOfFiles&lt;/key&gt;</div><div class="line">      &lt;integer&gt;20480&lt;/integer&gt;</div><div class="line">    &lt;/dict&gt;</div><div class="line">  &lt;/dict&gt;</div><div class="line">&lt;/plist&gt;</div></pre></td></tr></table></figure>
<h2 id="é‡å¯åŠå¯åŠ¨"><a href="#é‡å¯åŠå¯åŠ¨" class="headerlink" title="é‡å¯åŠå¯åŠ¨"></a>é‡å¯åŠå¯åŠ¨</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ launchctl unload ~/Library/LaunchAgents/homebrew.mxcl.polipo.plist</div><div class="line">$ launchctl load ~/Library/LaunchAgents/homebrew.mxcl.polipo.plist</div></pre></td></tr></table></figure>
<h2 id="éªŒè¯æ˜¯å¦æˆåŠŸ"><a href="#éªŒè¯æ˜¯å¦æˆåŠŸ" class="headerlink" title="éªŒè¯æ˜¯å¦æˆåŠŸ"></a>éªŒè¯æ˜¯å¦æˆåŠŸ</h2><p>ä¹‹åå‘½ä»¤éƒ½ä»¥ http_proxy=<a href="http://localhost:8123" target="_blank" rel="external">http://localhost:8123</a> å¼€å¤´</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">wudiweideMacBook-Pro-2:~ David_Woo$ curl ip.gs</div><div class="line">å½“å‰ IPï¼š27.152.75.207 æ¥è‡ªï¼šä¸­å›½ç¦å»ºå¦é—¨ ç”µä¿¡</div><div class="line">wudiweideMacBook-Pro-2:~ David_Woo$ http_proxy=http://localhost:8123 curl ip.gs</div><div class="line">å½“å‰ IPï¼š23.83.239.21 æ¥è‡ªï¼šç¾å›½åŠ åˆ©ç¦å°¼äºšå·è´¹åˆ©è’™</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/09/12/Core-Ploté’ˆå¯¹è®¾è®¡çš„ä¸€äº›åº”ç”¨/" itemprop="url">
                  Core Ploté’ˆå¯¹è®¾è®¡çš„ä¸€äº›åº”ç”¨
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">VerÃ¶ffentlicht am</span>
            <time itemprop="dateCreated" datetime="2016-09-12T11:27:16+08:00" content="2016-09-12">
              2016-09-12
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Core-Ploté’ˆå¯¹è®¾è®¡çš„ä¸€äº›åº”ç”¨"><a href="#Core-Ploté’ˆå¯¹è®¾è®¡çš„ä¸€äº›åº”ç”¨" class="headerlink" title="Core Ploté’ˆå¯¹è®¾è®¡çš„ä¸€äº›åº”ç”¨"></a>Core Ploté’ˆå¯¹è®¾è®¡çš„ä¸€äº›åº”ç”¨</h1><h2 id="è®¾è®¡æ ·å¼"><a href="#è®¾è®¡æ ·å¼" class="headerlink" title="è®¾è®¡æ ·å¼"></a>è®¾è®¡æ ·å¼</h2><p>è¿™æ¬¡APPç»“æœé¡µç•Œé¢æ”¹ç‰ˆï¼Œæ”¶åˆ°äº†è¿™ä¸ªå›¾è¡¨æ ·å¼çš„è®¾è®¡ï¼Œä¹‹å‰å›¾è¡¨ä½¿ç”¨çš„åº“ï¼Œä¸€éƒ¨åˆ†ç”¨Core Plotï¼Œä¸€éƒ¨åˆ†ç”¨è‡ªå·±å®ç°çš„ä¸€ä¸ªè½»é‡çº§æ›²çº¿å›¾ï¼ˆåªæ”¯æŒç”»æ›²çº¿å’Œä¸€äº›æ›²çº¿åŠ¨ç”»æ•ˆæœï¼‰ï¼Œç”±äºæ—¶é—´æ¯”è¾ƒç´§ï¼Œæ²¡æœ‰æ‰“ç®—åœ¨è‡ªå·±å®ç°çš„æ›²çº¿å›¾ä¸Šå¢åŠ å¦‚æ­¤å¤šçš„è‡ªå®šä¹‰åŠŸèƒ½ï¼Œæ‰€ä»¥æŠŠCore Plotç ”ç©¶äº†ä¸‹ï¼Œäº†è§£ä¸‹è¿™äº›è®¾è®¡è¦å¦‚ä½•è‡ªå®šä¹‰ã€‚<br><img src="http://7oxfjd.com2.z0.glb.qiniucdn.com/2016-09-12-1.png" alt="1"></p>
<h2 id="æ‹†åˆ†ç»†èŠ‚"><a href="#æ‹†åˆ†ç»†èŠ‚" class="headerlink" title="æ‹†åˆ†ç»†èŠ‚"></a>æ‹†åˆ†ç»†èŠ‚</h2><p>å…ˆè¦åˆ†æä¸‹ï¼Œè¿™ä¸ªå›¾è¡¨æœ‰å“ªäº›ä¸œè¥¿éœ€è¦è‡ªå®šä¹‰</p>
<ul>
<li>æ›²çº¿éœ€è¦æ‰“ç‚¹ï¼Œæ‰“ç‚¹çš„å›¾å½¢æ˜¯ä¸¤ä¸ªåœ†å åŠ å‡ºæ¥çš„ï¼Œè€Œä¸”æ‰“çš„ç‚¹æœ‰4ç§æ ·å¼ï¼šå¤„äºé˜ˆå€¼èŒƒå›´å†…ç‚¹ï¼ˆå°ç™½ç»¿ç‚¹ï¼‰ï¼Œè¶…å‡ºé˜ˆå€¼èŒƒå›´ç‚¹ï¼ˆå°ç™½çº¢ç‚¹ï¼‰ï¼Œå½“å‰ç‚¹å¤„äºé˜ˆå€¼èŒƒå›´å†…ç‚¹ï¼ˆå¤§ç™½ç»¿ç‚¹ï¼‰ï¼Œå½“æœŸç‚¹è¶…å‡ºé˜ˆå€¼èŒƒå›´ç‚¹ï¼ˆå¤§ç™½çº¢ç‚¹ï¼‰</li>
<li>xè½´labelï¼ˆå½“å‰ç‚¹labelé¢œè‰²ä¸ä¸€æ ·ï¼‰å’Œç‚¹ä¸Šæ–¹çš„labelå®ç°</li>
<li>æ›²çº¿çš„èŒƒå›´ä¸å›ºå®šï¼Œæ›²çº¿çš„é˜ˆå€¼èŒƒå›´æ˜¯å¤§äºç­‰äºæŸå€¼æˆ–å°äºç­‰äºæŸå€¼ï¼Œæ‰€ä»¥ç»¿å’Œçº¢çš„æ˜¯ä¸å›ºå®šçš„</li>
<li>yè½´labelåˆ†2ç§é¢œè‰²ï¼ŒmajorTickLineä¹Ÿåˆ†ä¸¤ç§é¢œè‰²</li>
</ul>
<p>é¢„æœŸå¤–é—®é¢˜</p>
<ul>
<li>xè½´å’Œyè½´çš„labelï¼Œä¼šè¶…å‡ºèŒƒå›´ï¼Œå°±æ˜¯åœ¨å›¾è¡¨èŒƒå›´å¤–äº†ï¼Œæ‰€ä»¥ä¸æ˜¾ç¤ºå‡ºæ¥</li>
</ul>
<h2 id="è§£å†³é—®é¢˜"><a href="#è§£å†³é—®é¢˜" class="headerlink" title="è§£å†³é—®é¢˜"></a>è§£å†³é—®é¢˜</h2><h3 id="ä¸¤ä¸ªåœ†å åŠ çš„æ‰“ç‚¹"><a href="#ä¸¤ä¸ªåœ†å åŠ çš„æ‰“ç‚¹" class="headerlink" title="ä¸¤ä¸ªåœ†å åŠ çš„æ‰“ç‚¹"></a>ä¸¤ä¸ªåœ†å åŠ çš„æ‰“ç‚¹</h3><p>è¿™ä¸ªå…¶å®å°±æ˜¯æ™®é€šçš„æ‰“ç‚¹ç”»åœ†ï¼Œä½†æ˜¯è¿œå¤–å±‚lineçš„å®½åº¦è®¾ç½®å¤§ä¸€ç‚¹ï¼Œå°±å¯ä»¥å®ç°è¿™ä¸ªæ•ˆæœäº†ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">CPTScatterPlot *rightScatterPlot_ = [[CPTScatterPlot alloc] init];</div><div class="line">rightScatterPlot_.identifier = <span class="string">@"rightScatterPlot"</span>;</div><div class="line">rightScatterPlot_.interpolation = CPTScatterPlotInterpolationCurved;</div><div class="line"><span class="comment">// æ³¨æ„ï¼šè¿™é‡Œä¸ºä»€ä¹ˆæˆnilï¼Œåé¢ä¸€èŠ‚å°±è¯´åˆ°</span></div><div class="line">rightScatterPlot_.dataLineStyle = <span class="literal">nil</span>;</div><div class="line">rightScatterPlot_.dataSource    = <span class="keyword">self</span>;</div><div class="line">rightScatterPlot_.areaBaseValue = CPTDecimalFromString ( <span class="string">@"0.0"</span> );</div><div class="line"></div><div class="line"><span class="comment">// Add plot symbols: è¡¨ç¤ºæ•°å€¼çš„ç¬¦å·çš„å½¢çŠ¶</span></div><div class="line">CPTMutableLineStyle * symbolLineStyle = [CPTMutableLineStyle lineStyle];</div><div class="line">symbolLineStyle.lineColor = [CPTColor whiteColor];</div><div class="line">symbolLineStyle.lineWidth = <span class="number">3.0</span>;<span class="comment">//ç™½è‰²èŒƒå›´å®½åº¦3</span></div><div class="line"></div><div class="line">CPTPlotSymbol * plotSymbol = [CPTPlotSymbol ellipsePlotSymbol];</div><div class="line">plotSymbol.fill          = [CPTFill fillWithColor:[CPTColor colorWithComponentRed:<span class="number">65.0</span>/<span class="number">255.0</span> green:<span class="number">117.0</span>/<span class="number">255.0</span> blue:<span class="number">5.0</span>/<span class="number">255.0</span> alpha:<span class="number">1.0</span>]];<span class="comment">//ç»¿è‰²</span></div><div class="line">plotSymbol.lineStyle     = symbolLineStyle;</div><div class="line">plotSymbol.size          = <span class="built_in">CGSizeMake</span>(<span class="number">10.0</span>, <span class="number">10.0</span>);<span class="comment">//æ•´ä¸ªåœ†çš„å¤§å°ï¼Œå¤§ç»¿ç‚¹å°±æŠŠè¿™ä¸ªåœ†å¤§ä¸€äº›ï¼Œlineçš„å®½åº¦ä¹Ÿå¤§ä¸€äº›</span></div><div class="line">rightScatterPlot_.plotSymbol = plotSymbol;</div><div class="line"></div><div class="line">[graph_ addPlot:rightScatterPlot_];</div></pre></td></tr></table></figure>
<h3 id="å¤šç§æ‰“ç‚¹çš„æ ·å¼"><a href="#å¤šç§æ‰“ç‚¹çš„æ ·å¼" class="headerlink" title="å¤šç§æ‰“ç‚¹çš„æ ·å¼"></a>å¤šç§æ‰“ç‚¹çš„æ ·å¼</h3><p>è¿™é‡ŒCore Plotå¹¶ä¸æ”¯æŒï¼Œä¸ºäº†å®ç°è¯¥è®¾è®¡ï¼Œç”¨äº†ä¸€ä¸ªæ–¹æ³•ï¼Œå°±æ˜¯è¿™ç§å›¾è¡¨ï¼Œå…¶å®æˆ‘ç”»äº†4ä¸ªCPTScatterPlotæ¥å®ç°ï¼Œä¹Ÿå°±æ˜¯ä¸Šä¸€èŠ‚ã€rightScatterPlot_.dataLineStyle = nil;ã€çš„åŸå› ï¼Œå› ä¸ºæˆ‘åªä¸ºäº†æ‰“ç‚¹ï¼Œä¸ç”»æ›²çº¿ã€‚<br>ç„¶ååœ¨datasourceçš„ä»£ç†æ–¹æ³•ä¸­æ ¹æ®identifieræ¥è¿”å›æ•°æ®ï¼Œè¿”å›çš„æ˜¯nilå°±æ˜¯è¯¥ç‚¹åœ¨è¯¥xå€¼ä¸Šä¸ç”»ï¼Œå¦‚ä¸‹ä»£ç </p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> ([plot.identifier isEqual:<span class="string">@"dataScatterPlot"</span>]) &#123;<span class="comment">//ç”»æ›²çº¿</span></div><div class="line">    <span class="keyword">return</span> [[datas_ objectAtIndex:[datas_ count] - index<span class="number">-1</span>] valueForKey:key_];</div><div class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> ([plot.identifier isEqual:<span class="string">@"rightScatterPlot"</span>]) &#123;<span class="comment">//ç”»é˜ˆå€¼èŒƒå›´å†…ç‚¹</span></div><div class="line">    <span class="keyword">if</span> (index == [datas_ count] - <span class="number">1</span>) &#123;</div><div class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">if</span> (isMore_) &#123;<span class="comment">//isMore_ä¸ºåˆå§‹åŒ–å‚æ•°ï¼Œè§„å®šé˜ˆå€¼çš„æ¯”è¾ƒæ˜¯å¤§äºç­‰äºè¿˜æ˜¯å°äºç­‰äº</span></div><div class="line">        <span class="keyword">return</span> [[[datas_ objectAtIndex:[datas_ count] - index<span class="number">-1</span>] valueForKey:key_] floatValue] &lt;= threshold_ ? [[datas_ objectAtIndex:[datas_ count] - index<span class="number">-1</span>] valueForKey:key_] : <span class="literal">nil</span> ;<span class="comment">//ä¸æ˜¯é˜ˆå€¼èŒƒå›´å†…çš„ç‚¹ï¼Œå°±ä¸ç”»å°ç»¿ç‚¹äº†</span></div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="keyword">return</span> [[[datas_ objectAtIndex:[datas_ count] - index<span class="number">-1</span>] valueForKey:key_] floatValue] &gt;= threshold_ ? [[datas_ objectAtIndex:[datas_ count] - index<span class="number">-1</span>] valueForKey:key_] : <span class="literal">nil</span> ;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> ([plot.identifier isEqual:<span class="string">@"errorScatterPlot"</span>]) &#123;<span class="comment">//ç”»é˜ˆå€¼èŒƒå›´å¤–çš„ç‚¹</span></div><div class="line">    <span class="keyword">if</span> (index == [datas_ count] - <span class="number">1</span>) &#123;</div><div class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">if</span> (isMore_) &#123;</div><div class="line">        <span class="keyword">return</span> [[[datas_ objectAtIndex:[datas_ count] - index<span class="number">-1</span>] valueForKey:key_] floatValue] &gt;= threshold_ ? [[datas_ objectAtIndex:[datas_ count] - index<span class="number">-1</span>] valueForKey:key_] : <span class="literal">nil</span> ;</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="keyword">return</span> [[[datas_ objectAtIndex:[datas_ count] - index<span class="number">-1</span>] valueForKey:key_] floatValue] &lt;= threshold_ ? [[datas_ objectAtIndex:[datas_ count] - index<span class="number">-1</span>] valueForKey:key_] : <span class="literal">nil</span> ;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> ([plot.identifier isEqual:<span class="string">@"currentScatterPlot"</span>]) &#123;<span class="comment">//ç”»å½“å‰ç‚¹</span></div><div class="line">    <span class="keyword">if</span> (index == [datas_ count] - <span class="number">1</span>) &#123;<span class="comment">//æ˜¯å½“å‰ç‚¹æ‰ç”»</span></div><div class="line">        <span class="keyword">return</span> [[datas_ objectAtIndex:[datas_ count] - index<span class="number">-1</span>] valueForKey:key_];</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="literal">nil</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="ç‚¹ä¸Šæ–¹çš„labelçš„å®ç°"><a href="#ç‚¹ä¸Šæ–¹çš„labelçš„å®ç°" class="headerlink" title="ç‚¹ä¸Šæ–¹çš„labelçš„å®ç°"></a>ç‚¹ä¸Šæ–¹çš„labelçš„å®ç°</h3><p> å°±åœ¨å½“å‰ç‚¹çš„CPTScatterPlotä¸Šå®ç°å°±å¥½äº†</p>
 <figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//å­—ä½“æ ·å¼</span></div><div class="line">CPTMutableTextStyle *currentTextStyle = [CPTMutableTextStyle textStyle];</div><div class="line">currentTextStyle.color     = [CPTColor colorWithComponentRed:<span class="number">208.0</span>/<span class="number">255.0</span> green:<span class="number">2.0</span>/<span class="number">255.0</span> blue:<span class="number">27.0</span>/<span class="number">255.0</span> alpha:<span class="number">1.0</span>];</div><div class="line">currentTextStyle.fontSize = <span class="number">13</span>;</div><div class="line"></div><div class="line"><span class="comment">//æ‰“ç‚¹çš„æ ·å¼</span></div><div class="line">CPTPlotSymbol * plotSymbol = [CPTPlotSymbol ellipsePlotSymbol];</div><div class="line">plotSymbol.fill          = [CPTFill fillWithColor:[CPTColor colorWithComponentRed:<span class="number">208.0</span>/<span class="number">255.0</span> green:<span class="number">2.0</span>/<span class="number">255.0</span> blue:<span class="number">27.0</span>/<span class="number">255.0</span> alpha:<span class="number">1.0</span>]];</div><div class="line"></div><div class="line"><span class="comment">//é¢œè‰²æ§åˆ¶</span></div><div class="line"><span class="keyword">if</span> ( ( isMore_ &amp;&amp; [[[datas_ firstObject] objectForKey:key_] floatValue] &lt;= threshold_ ) || (!isMore_ &amp;&amp; [[[datas_ firstObject] objectForKey:key_] floatValue] &gt;= threshold_)) &#123;</div><div class="line">    currentTextStyle.color     = [CPTColor colorWithComponentRed:<span class="number">65.0</span>/<span class="number">255.0</span> green:<span class="number">117.0</span>/<span class="number">255.0</span> blue:<span class="number">5.0</span>/<span class="number">255.0</span> alpha:<span class="number">1.0</span>];</div><div class="line">    plotSymbol.fill          = [CPTFill fillWithColor:[CPTColor colorWithComponentRed:<span class="number">65.0</span>/<span class="number">255.0</span> green:<span class="number">117.0</span>/<span class="number">255.0</span> blue:<span class="number">5.0</span>/<span class="number">255.0</span> alpha:<span class="number">1.0</span>]];</div><div class="line">&#125;</div><div class="line">plotSymbol.lineStyle     = symbolLineStyle;</div><div class="line">plotSymbol.size          = <span class="built_in">CGSizeMake</span>(<span class="number">15.0</span>, <span class="number">15.0</span>);</div><div class="line">currentScatterPlot_.plotSymbol = plotSymbol;</div><div class="line"><span class="comment">//labelä½ç½®åç§»é‡ï¼Œæ­£æ•°ä¸ºå‘ä¸Šåç§»</span></div><div class="line">currentScatterPlot_.labelOffset = <span class="number">10</span>;</div><div class="line">currentScatterPlot_.labelTextStyle = currentTextStyle;</div></pre></td></tr></table></figure>
<h3 id="yè½´labelçš„å®ç°"><a href="#yè½´labelçš„å®ç°" class="headerlink" title="yè½´labelçš„å®ç°"></a>yè½´labelçš„å®ç°</h3><p>yè½´ä¸Šå¤šä¸ªlabelï¼Œåœ¨MAXå’ŒMINç›¸å·®è¿‡å¤§æƒ…å†µä¸‹ç”»å‡ºæ¥ä¸å¥½çœ‹ï¼Œå’Œè®¾è®¡å•†é‡åæ”¹ç”¨åªç”»é˜ˆå€¼çº¿çš„æ–¹å¼</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">-(<span class="built_in">BOOL</span>)axis:(CPTAxis *)axis shouldUpdateAxisLabelsAtLocations:(<span class="built_in">NSSet</span> *)locations</div><div class="line">&#123;</div><div class="line">    CPTXYAxisSet *axisSet = (CPTXYAxisSet *)graph_.axisSet;</div><div class="line">    <span class="keyword">if</span> (axis == axisSet.xAxis) &#123;</div><div class="line">        <span class="comment">//â€¦â€¦æ¯”è¾ƒç®€å•ï¼Œè¿”å›æ—¥æœŸçš„labelå³å¯ï¼Œä¸åšè¯´æ˜</span></div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="comment">//yè½´å®ç°</span></div><div class="line">        <span class="built_in">NSNumberFormatter</span> *formatter = [[<span class="built_in">NSNumberFormatter</span> alloc] init];</div><div class="line">        formatter.numberStyle = <span class="built_in">NSNumberFormatterRoundCeiling</span>;</div><div class="line">        <span class="built_in">CGFloat</span> labelOffset             = axis.labelOffset;</div><div class="line">        CPTMutableTextStyle * newStyle = [axis.labelTextStyle mutableCopy];</div><div class="line">        newStyle.color = [CPTColor colorWithComponentRed:<span class="number">233.0</span>/<span class="number">255.0</span> green:<span class="number">85.0</span>/<span class="number">255.0</span> blue:<span class="number">19.0</span>/<span class="number">255.0</span> alpha:<span class="number">1.0</span>];<span class="comment">//æ©™è‰²</span></div><div class="line">        CPTTextStyle *theLabelTextStyle = newStyle;</div><div class="line">        CPTTextLayer * newLabelLayer= [[CPTTextLayer alloc] initWithText:threshold_ &gt; <span class="number">50</span> ?[<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"%ld"</span>,(<span class="keyword">long</span>)threshold_] : [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"%.1f"</span>,threshold_] style:theLabelTextStyle];<span class="comment">//è¿™é‡Œå†™æ¯”è¾ƒæ­»ï¼Œå› ä¸ºå›¾è¡¨åˆ†ä¸¤ç§ï¼Œæ­¥é¢‘çš„æ›²çº¿å°±ä¸ç”¨æ˜¾ç¤ºå°æ•°ç‚¹äº†</span></div><div class="line">        CPTAxisLabel * newLabel     = [[CPTAxisLabel alloc] initWithContentLayer:newLabelLayer];</div><div class="line">        newLabel.tickLocation       = [<span class="built_in">NSDecimalNumber</span> numberWithDouble:threshold_].decimalValue;</div><div class="line">        newLabel.offset             = labelOffset;</div><div class="line">        </div><div class="line">        axis.majorTickLocations = [<span class="built_in">NSSet</span> setWithObjects:[<span class="built_in">NSDecimalNumber</span> numberWithDouble:threshold_], <span class="literal">nil</span>];</div><div class="line">        axis.axisLabels = [<span class="built_in">NSSet</span> setWithObjects:newLabel,<span class="literal">nil</span>];<span class="comment">//è¿™é‡Œlabelå¤šåˆ›å»ºå‡ ä¸ªï¼Œå°±èƒ½å®ç°å¤šä¸ªlabelå’ŒmajorTickLineçš„æ•ˆæœï¼Œæ ·å¼ä¸ä¸€è‡´åªè¦ä¸åŒlabelç”¨ä¸åŒæ ·å¼çš„ContentLayerå°±å¥½äº†</span></div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    </div><div class="line">    <span class="keyword">return</span> <span class="literal">NO</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="labelè¶…å‡ºèŒƒå›´è¢«é®ç›–çš„é—®é¢˜"><a href="#labelè¶…å‡ºèŒƒå›´è¢«é®ç›–çš„é—®é¢˜" class="headerlink" title="labelè¶…å‡ºèŒƒå›´è¢«é®ç›–çš„é—®é¢˜"></a>labelè¶…å‡ºèŒƒå›´è¢«é®ç›–çš„é—®é¢˜</h3><p>ç”±äºgraghèŒƒå›´é™åˆ¶äº†ï¼Œå›¾è¡¨å€¼åŸŸèŒƒå›´ä¹Ÿç¡®å®šäº†ï¼ˆxï¼š0~7ï¼Œyï¼š0~maxï¼‰ï¼Œxè½´labelå±…å·¦ï¼Œyè½´labelå±…ä¸‹çš„è¯ï¼Œå°±è¶…å‡ºgraghçš„èŒƒå›´äº†<br>é‚£ä¹ˆè§£å†³åŠæ³•å…¶å®å°±æ˜¯æŠŠå€¼åŸŸèŒƒå›´è®¾ç½®å¤§ä¸€äº›ï¼Œç„¶åè®¾ç½®åæ ‡è½´åŸç‚¹åœ¨ï¼ˆ0ï¼Œ0ï¼‰å¤„å³å¯ã€‚</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div></pre></td><td class="code"><pre><div class="line">    CPTXYPlotSpace *plotSpace = (CPTXYPlotSpace *)graph_.defaultPlotSpace;</div><div class="line">    </div><div class="line">    <span class="comment">// x y è½´</span></div><div class="line">    CPTMutableLineStyle *majorGridLineStyle = [CPTMutableLineStyle lineStyle];</div><div class="line">    majorGridLineStyle.lineWidth = <span class="number">1.0</span>;</div><div class="line">    majorGridLineStyle.lineColor = [CPTColor colorWithComponentRed:<span class="number">233.0</span>/<span class="number">255.0</span> green:<span class="number">85.0</span>/<span class="number">255.0</span> blue:<span class="number">19.0</span>/<span class="number">255.0</span> alpha:<span class="number">1.0</span>];</div><div class="line">    </div><div class="line">    CPTXYAxisSet *axisSet = (CPTXYAxisSet *)graph_.axisSet;</div><div class="line">    CPTXYAxis *x          = axisSet.xAxis;</div><div class="line">    &#123;</div><div class="line">        x.axisLineStyle               = <span class="literal">nil</span>;</div><div class="line">        x.majorTickLineStyle          = <span class="literal">nil</span>;</div><div class="line">        x.minorTickLineStyle          = <span class="literal">nil</span>;</div><div class="line">        x.majorIntervalLength         = CPTDecimalFromDouble(<span class="number">1</span>);</div><div class="line">        <span class="keyword">if</span> (min_ &gt; <span class="number">0</span>) &#123;</div><div class="line">            x.orthogonalCoordinateDecimal = CPTDecimalFromDouble(min_ + (max_ - min_)/<span class="number">8</span>);</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            x.orthogonalCoordinateDecimal = CPTDecimalFromDouble(<span class="number">0.0</span>);</div><div class="line">        &#125;</div><div class="line">        x.minorTicksPerInterval       = <span class="number">1.0</span>;</div><div class="line">        x.tickDirection = CPTSignNegative; <span class="comment">//CPTSignNegative Â å·¦  CPTSignPositive  å³</span></div><div class="line"><span class="comment">//        x.labelingPolicy = CPTAxisLabelingPolicyNone;</span></div><div class="line">        x.plotSpace = plotSpace;</div><div class="line">        </div><div class="line">        x.delegate = <span class="keyword">self</span>;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    CPTXYAxis *y = axisSet.yAxis;</div><div class="line">    &#123;</div><div class="line">        y.orthogonalCoordinateDecimal = CPTDecimalFromDouble(<span class="number">-0.1</span>);</div><div class="line">        y.majorGridLineStyle          = <span class="literal">nil</span>;</div><div class="line">        y.axisLineStyle               = <span class="literal">nil</span>;</div><div class="line">        y.minorTickLineStyle          = <span class="literal">nil</span>;</div><div class="line">        y.majorTickLineStyle          = majorGridLineStyle;</div><div class="line">        y.tickDirection = CPTSignPositive; <span class="comment">//CPTSignNegative Â å·¦  CPTSignPositive  å³</span></div><div class="line">        y.labelOffset = <span class="number">-25.5</span>;</div><div class="line">        y.majorTickLength = <span class="keyword">self</span>.frame.size.width<span class="number">-35</span>;</div><div class="line">        y.majorTickLocations = [<span class="built_in">NSSet</span> setWithObjects:[<span class="built_in">NSDecimalNumber</span> numberWithDouble:<span class="number">3.3</span>], <span class="literal">nil</span>];</div><div class="line">        </div><div class="line">        y.delegate = <span class="keyword">self</span>;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="comment">//åˆå§‹åŒ–èŒƒå›´</span></div><div class="line">    plotSpace.momentumAnimationCurve = CPTAnimationCurveCubicIn;</div><div class="line">    plotSpace.bounceAnimationCurve = CPTAnimationCurveBackIn;</div><div class="line">    plotSpace.momentumAcceleration = <span class="number">20000.0</span>;</div><div class="line">    </div><div class="line">    </div><div class="line">    plotSpace.xRange = [CPTPlotRange plotRangeWithLocation:CPTDecimalFromDouble(<span class="number">-0.9</span>) length:CPTDecimalFromDouble(<span class="number">8</span>)];</div><div class="line">    </div><div class="line">    plotSpace.yRange = [CPTPlotRange plotRangeWithLocation:CPTDecimalFromDouble(min_) length:CPTDecimalFromDouble(max_-min_)];</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/09/12/ä»é›¶æ­å»ºFlask-Celery-Redisåå°ä»»åŠ¡æœåŠ¡å™¨/" itemprop="url">
                  ä»é›¶æ­å»ºFlask+Celery+Redisåå°ä»»åŠ¡æœåŠ¡å™¨
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">VerÃ¶ffentlicht am</span>
            <time itemprop="dateCreated" datetime="2016-09-12T11:27:16+08:00" content="2016-09-12">
              2016-09-12
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="ä»é›¶æ­å»ºFlask-Celery-Redisåå°ä»»åŠ¡æœåŠ¡å™¨"><a href="#ä»é›¶æ­å»ºFlask-Celery-Redisåå°ä»»åŠ¡æœåŠ¡å™¨" class="headerlink" title="ä»é›¶æ­å»ºFlask+Celery+Redisåå°ä»»åŠ¡æœåŠ¡å™¨"></a>ä»é›¶æ­å»ºFlask+Celery+Redisåå°ä»»åŠ¡æœåŠ¡å™¨</h1><h2 id="éœ€æ±‚"><a href="#éœ€æ±‚" class="headerlink" title="éœ€æ±‚"></a>éœ€æ±‚</h2><p>è®°å½•è¿åŠ¨è½¨è¿¹ï¼Œé‚£ä¹ˆåœ¨è®°å½•ä¸Šä¼ æœåŠ¡å™¨åï¼Œè¦æ ¹æ®è½¨è¿¹ç”Ÿæˆå‡ å¼ æ‰€éœ€è¦çš„è½¨è¿¹çƒ­å›¾ï¼Œä¹Ÿå°±æ˜¯æ ¹æ®ä¼ æ¥çš„ç»çº¬åº¦é›†åˆï¼ŒæŠ“å–é€‚åˆçš„ç“¦ç‰‡å›¾ï¼Œåœ¨ä¸Šé¢ç»˜åˆ¶è½¨è¿¹ä»¥åŠåŠ è’™ç‰ˆç­‰ï¼Œ ç”Ÿæˆçš„å›¾ç‰‡å¦‚ä¸‹ã€‚</p>
<p><img src="http://pathmap-10048881.file.myqcloud.com/pathmap/v0/colorline/RM/a0085622f4a26b1cb5912d82e97763bb/map.jpg" alt="çƒ­åŠ›å›¾"></p>
<p>æœ¬æ–‡å¹¶ä¸æ˜¯è¦è¯´çƒ­åŠ›å›¾ç”Ÿæˆçš„é€»è¾‘ï¼Œåªæ˜¯è¯´è¯´æ•´ä¸ªæœåŠ¡çš„æ¶æ„ä¸é…ç½®å®ç°ã€‚</p>
<p><strong><em><font color="red">PS.æœ¬æ–‡ä¸»è¦ç”¨ä½œè‡ªå·±è®°å½•ï¼Œæœ‰å…´è¶£çš„å¯ä»¥äº¤æµæ²Ÿé€šï¼Œé‚®ç®±ï¼šxiao303178394@gmail.com</font></em></strong></p>
<h2 id="å¤§ä½“æ¶æ„"><a href="#å¤§ä½“æ¶æ„" class="headerlink" title="å¤§ä½“æ¶æ„"></a>å¤§ä½“æ¶æ„</h2><p>æ‰‹æ®‹ç”»äº†ç”»</p>
<p><img src="http://7oxfjd.com2.z0.glb.qiniucdn.com/2016-10-26-1.jpg" alt="1"></p>
<h2 id="æ­å»ºç¯å¢ƒ"><a href="#æ­å»ºç¯å¢ƒ" class="headerlink" title="æ­å»ºç¯å¢ƒ"></a>æ­å»ºç¯å¢ƒ</h2><p>ç¯å¢ƒï¼šUbuntu 14.04 Python 2.7</p>
<h3 id="å®‰è£…gitä»¥åŠä¸‹è½½æºç "><a href="#å®‰è£…gitä»¥åŠä¸‹è½½æºç " class="headerlink" title="å®‰è£…gitä»¥åŠä¸‹è½½æºç "></a>å®‰è£…gitä»¥åŠä¸‹è½½æºç </h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ sudo apt-get update</div><div class="line">$ sudo apt-get install git</div><div class="line">$ sudo git clone https://git.coding.net/David_woo/rm-map-api.git rm_api</div></pre></td></tr></table></figure>
<h3 id="å®‰è£…Pillowçš„ä¸€äº›åº•å±‚ä¾èµ–"><a href="#å®‰è£…Pillowçš„ä¸€äº›åº•å±‚ä¾èµ–" class="headerlink" title="å®‰è£…Pillowçš„ä¸€äº›åº•å±‚ä¾èµ–"></a>å®‰è£…Pillowçš„ä¸€äº›åº•å±‚ä¾èµ–</h3><p>ç”±äºçƒ­å›¾ç»˜åˆ¶ç”¨åˆ°Pillowï¼Œæ‰€ä»¥éœ€è¦è¿™éƒ¨ï¼Œä¸ç”¨Pillowå¯ä»¥æ— è§†</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ sudo apt-get install libjpeg-dev zlib1g*</div><div class="line">$ sudo apt-get install libtiff5-dev libjpeg8-dev zlib1g-dev libfreetype6-dev liblcms2-dev libwebp-dev tcl8.6-dev tk8.6-dev python-tk</div></pre></td></tr></table></figure>
<h3 id="å®‰è£…Pythonçš„ä¸€äº›ä¾èµ–åº“"><a href="#å®‰è£…Pythonçš„ä¸€äº›ä¾èµ–åº“" class="headerlink" title="å®‰è£…Pythonçš„ä¸€äº›ä¾èµ–åº“"></a>å®‰è£…Pythonçš„ä¸€äº›ä¾èµ–åº“</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ sudo apt-get install -y python-pip python-dev build-essential</div><div class="line">$ sudo pip install -r requirements.txt</div><div class="line">$ sudo pip install gunicorn</div></pre></td></tr></table></figure>
<h3 id="å®‰è£…nginx"><a href="#å®‰è£…nginx" class="headerlink" title="å®‰è£…nginx"></a>å®‰è£…nginx</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo apt-get install nginx</div></pre></td></tr></table></figure>
<h2 id="é…ç½®åå°æœåŠ¡"><a href="#é…ç½®åå°æœåŠ¡" class="headerlink" title="é…ç½®åå°æœåŠ¡"></a>é…ç½®åå°æœåŠ¡</h2><p>è¿™é‡Œç”¨gunicornåšwsgiè¿è¡Œç¨‹åºï¼Œç„¶ånginxåšæœåŠ¡å™¨ã€‚</p>
<h3 id="gunicornè¿è¡Œç¨‹åº"><a href="#gunicornè¿è¡Œç¨‹åº" class="headerlink" title="gunicornè¿è¡Œç¨‹åº"></a>gunicornè¿è¡Œç¨‹åº</h3><p>ç¨‹åºæºç æ ¹ç›®å½•ä¸‹ï¼Œåˆ›å»ºwsgi.pyæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹å³å¯ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/env python</span></div><div class="line"><span class="comment"># -*- coding: utf-8 -*-</span></div><div class="line"></div><div class="line">__doc__ = <span class="string">"""</span></div><div class="line"><span class="string">"""</span></div><div class="line"></div><div class="line"><span class="keyword">from</span> api <span class="keyword">import</span> create_app</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment"># application = create_app('api/config_dev.cfg')</span></div><div class="line">application = create_app(<span class="string">'api/config_qcloud.cfg'</span>)`</div></pre></td></tr></table></figure>
<p>åŒæ ·åœ¨æ ¹ç›®å½•ä¸‹ï¼Œåˆ›å»ºgunicorn.cfgï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> multiprocessing</div><div class="line"></div><div class="line">bind = <span class="string">"0.0.0.0:8092"</span></div><div class="line">daemon = <span class="keyword">True</span></div><div class="line">worker_class=<span class="string">"gevent"</span></div><div class="line">pidfile = <span class="string">"/var/run/gunicorn.pid"</span></div><div class="line">workers = multiprocessing.cpu_count() * <span class="number">2</span> + <span class="number">1</span></div><div class="line">worker_connections=<span class="number">1000</span></div><div class="line">backlog = <span class="number">2048</span></div><div class="line">errorlog = <span class="string">"/data/www/rm_api/gunicorn-error.log"</span></div><div class="line">loglevel = <span class="string">"info"</span></div></pre></td></tr></table></figure>
<p>æ‰§è¡Œå‘½ä»¤ï¼Œå°±æŠŠç¨‹åºåœ¨ 127.0.0.1:8092ä¸Šè·‘èµ·æ¥äº†ï¼Œè®°ä½è¿™ä¸ªåœ°å€ï¼Œä¹‹ååœ¨nginxçš„é…ç½®ä¸Šè¦ç”¨åˆ°</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">[david@XXX rmserver]$ sudo /usr/local/bin/python /usr/local/bin/gunicorn -c gunicorn.cfg wsgi:application</div><div class="line">[david@XXX rmserver]$ ps aux | grep gunicorn</div><div class="line">root     30836  0.6  0.1 210704 12696 ?        S    17:21   0:00 /usr/local/bin/python /usr/local/bin/gunicorn -c gunicorn.cfg wsgi:application</div><div class="line">root     30841  9.3  0.4 258636 35516 ?        S    17:21   0:00 /usr/local/bin/python /usr/local/bin/gunicorn -c gunicorn.cfg wsgi:application</div><div class="line">root     30842 10.6  0.4 340304 37748 ?        Sl   17:21   0:00 /usr/local/bin/python /usr/local/bin/gunicorn -c gunicorn.cfg wsgi:application</div><div class="line">root     30843 10.3  0.4 340308 37752 ?        Sl   17:21   0:00 /usr/local/bin/python /usr/local/bin/gunicorn -c gunicorn.cfg wsgi:application</div><div class="line">root     30846  9.3  0.4 258660 35540 ?        S    17:21   0:00 /usr/local/bin/python /usr/local/bin/gunicorn -c gunicorn.cfg wsgi:application</div><div class="line">root     30851  9.3  0.4 258668 35548 ?        S    17:21   0:00 /usr/local/bin/python /usr/local/bin/gunicorn -c gunicorn.cfg wsgi:application</div><div class="line">root     30854  9.3  0.4 258684 35560 ?        S    17:21   0:00 /usr/local/bin/python /usr/local/bin/gunicorn -c gunicorn.cfg wsgi:application</div><div class="line">root     30857  9.0  0.4 258688 35548 ?        S    17:21   0:00 /usr/local/bin/python /usr/local/bin/gunicorn -c gunicorn.cfg wsgi:application</div><div class="line">root     30860  9.0  0.4 258700 35552 ?        S    17:21   0:00 /usr/local/bin/python /usr/local/bin/gunicorn -c gunicorn.cfg wsgi:application</div><div class="line">root     30863 10.0  0.4 340364 37676 ?        Sl   17:21   0:00 /usr/local/bin/python /usr/local/bin/gunicorn -c gunicorn.cfg wsgi:application</div><div class="line">david    30872  0.0  0.0 103248   848 pts/0    S+   17:21   0:00 grep gunicorn</div></pre></td></tr></table></figure>
<h3 id="é€šè¿‡nginxä½œä¸ºæœåŠ¡å™¨"><a href="#é€šè¿‡nginxä½œä¸ºæœåŠ¡å™¨" class="headerlink" title="é€šè¿‡nginxä½œä¸ºæœåŠ¡å™¨"></a>é€šè¿‡nginxä½œä¸ºæœåŠ¡å™¨</h3><p>æŠŠnginxçš„é…ç½®æ”¾åœ¨æºç æ ¹ç›®å½•ä¸‹ï¼Œé€šè¿‡è½¯é“¾æ¥åˆ°nginx/sites-enabledé‡Œï¼Œæˆ‘è§‰å¾—æ˜¯ä¸€ä¸ªæ¯”è¾ƒå¥½çš„æ–¹å¼ï¼Œä¿è¯æœåŠ¡å™¨çš„é…ç½®ä¸ä¼šä¸¢å¤±ã€‚<br>å½“ç„¶ï¼Œå¦‚æœç”¨Dockeræ›´å¥½äº†</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ sudo ln -s rm_api_nginx.conf /etc/nginx/sites-enabled/</div></pre></td></tr></table></figure>
<p>å†…å®¹å¤§æ¦‚å¦‚ä¸‹,127.0.0.1:8092è¿™é‡Œå°±ç”¨åˆ°äº†</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">server &#123;</div><div class="line">    listen 8552;</div><div class="line">    server_name  xxx.xxx.xxx.xxx;</div><div class="line"></div><div class="line">    access_log  logs/nginx_rm_api_https.access.log;</div><div class="line">    error_log  logs/nginx_rm_api_https.error.log;</div><div class="line">    root   html;</div><div class="line">    index  index.html index.htm index.php;</div><div class="line"></div><div class="line">    location ~*$ &#123;</div><div class="line">        resolver xxx.xxx.xxx.xxx;</div><div class="line"></div><div class="line">          proxy_pass            http://127.0.0.1:8092;</div><div class="line">          proxy_redirect        off;</div><div class="line">          proxy_set_header      Host             $host;</div><div class="line">          proxy_set_header      X-Real-IP        $remote_addr;</div><div class="line">          proxy_set_header      X-Forwarded-For  $proxy_add_x_forwarded_for;</div><div class="line">          client_max_body_size  30m;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    location / &#123;</div><div class="line">          proxy_pass            http://127.0.0.1:8092;</div><div class="line">          proxy_redirect        off;</div><div class="line">          proxy_set_header      Host             $host;</div><div class="line">          proxy_set_header      X-Real-IP        $remote_addr;</div><div class="line">          proxy_set_header      X-Forwarded-For  $proxy_add_x_forwarded_for;</div><div class="line">          client_max_body_size  10m;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="redis"><a href="#redis" class="headerlink" title="redis"></a>redis</h2><p>redisè¿™é‡Œç”¨åˆ°äº†è…¾è®¯çš„redisæœåŠ¡ï¼Œä¸€æ˜¯ç”¨æ¥åšæ¶ˆæ¯é˜Ÿåˆ—ï¼Œè€Œæ˜¯ç”¨æ¥åšç“¦ç‰‡å›¾çš„ç¼“å­˜ã€‚</p>
<p>ç“¦ç‰‡å›¾ç¼“å­˜çš„ç›¸å…³ã€‚</p>
<h3 id="æ¶ˆæ¯é˜Ÿåˆ—çš„redisé…ç½®åŠwokerçš„å¯åŠ¨"><a href="#æ¶ˆæ¯é˜Ÿåˆ—çš„redisé…ç½®åŠwokerçš„å¯åŠ¨" class="headerlink" title="æ¶ˆæ¯é˜Ÿåˆ—çš„redisé…ç½®åŠwokerçš„å¯åŠ¨"></a>æ¶ˆæ¯é˜Ÿåˆ—çš„redisé…ç½®åŠwokerçš„å¯åŠ¨</h3><p>åœ¨æºç æ ¹ç›®å½•åˆ›å»ºcelery_tasks.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/env python</span></div><div class="line"><span class="comment">#coding=utf-8</span></div><div class="line"></div><div class="line"><span class="keyword">from</span> api <span class="keyword">import</span> create_app</div><div class="line"><span class="keyword">from</span> celery <span class="keyword">import</span> Celery, platforms</div><div class="line"><span class="keyword">from</span> celery.app.amqp <span class="keyword">import</span> Queue,Exchange</div><div class="line"></div><div class="line">app = create_app(<span class="string">'api/config_qcloud.cfg'</span>)</div><div class="line"><span class="comment"># app = create_app('api/config_dev.cfg')</span></div><div class="line"><span class="comment"># rootæ‰§è¡Œä»»åŠ¡ï¼Œå°±å¿…é¡»å¼€å¯</span></div><div class="line">platforms.C_FORCE_ROOT = <span class="keyword">True</span></div><div class="line"></div><div class="line">celery = Celery(app.import_name, broker=app.config[<span class="string">'CELERY_BROKER_URL'</span>])<span class="comment">#redisçš„urlã€å¯†ç </span></div><div class="line">celery.conf.update(app.config)</div><div class="line">celery.conf.CELERY_DEFAULT_QUEUE = <span class="string">'rm.map.api'</span></div><div class="line">celery.conf.CELERY_ENABLE_REMOTE_CONTROL = <span class="keyword">False</span></div></pre></td></tr></table></figure>
<p>é€šè¿‡ä¸‹é¢å‘½ä»¤æ‰§è¡Œï¼Œå°±é€šè¿‡daemonæ–¹å¼å¯åŠ¨äº†woker</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo celery -A celery_tasks.celery multi start worker  --loglevel=info -P processes -c 4</div></pre></td></tr></table></figure>
<p>æƒ³è¦å…³é—­çš„è¯</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo celery multi stopwait worker</div></pre></td></tr></table></figure>
<p><a href="http://docs.celeryproject.org/en/latest/tutorials/daemonizing.html#service-file-celery-service" target="_blank" rel="external">å®˜ç½‘å‚è€ƒæ–‡çŒ®</a></p>
<p>è¿™æ—¶å€™å·²ç»å¯åŠ¨æ¶ˆæ¯é˜Ÿåˆ—çš„æ¶ˆè´¹è€…äº†ï¼Œä½†æ˜¯æ¶ˆæ¯é˜Ÿåˆ—çš„ç”Ÿäº§è€…è¿˜æ²¡æœ‰è¯´</p>
<p>å¦‚ä¸‹æ˜¯extension.pyï¼Œé‡Œé¢åˆå§‹åŒ–äº†celery</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/env python</span></div><div class="line"><span class="comment">#coding=utf-8</span></div><div class="line"></div><div class="line"><span class="keyword">from</span> utils.redis_utils <span class="keyword">import</span> RedisConnectionPool</div><div class="line"></div><div class="line"><span class="keyword">from</span> celery <span class="keyword">import</span> Celery</div><div class="line"></div><div class="line"></div><div class="line">__all__ = [<span class="string">'redis'</span>, <span class="string">'fds_client'</span> ,<span class="string">'celery'</span>]</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment"># ä½¿ç”¨ Redis Cache åšç¼“å­˜</span></div><div class="line">redis = RedisConnectionPool(<span class="string">'MAPCACHE'</span>)</div><div class="line"></div><div class="line"><span class="comment"># ä½¿ç”¨ celery åšåˆ†å¸ƒå¼æ¡†æ¶</span></div><div class="line">celery = Celery()</div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">make_celery</span><span class="params">(app)</span>:</span></div><div class="line">    <span class="keyword">global</span> celery</div><div class="line">    <span class="comment">#TODO æ”¹æˆredis</span></div><div class="line">    celery = Celery(app.import_name, broker=app.config[<span class="string">'CELERY_BROKER_URL'</span>])</div><div class="line">    celery.conf.update(app.config)</div><div class="line">    celery.conf.CELERY_DEFAULT_QUEUE = <span class="string">'rm.map.api'</span></div><div class="line">    celery.conf.CELERY_ENABLE_REMOTE_CONTROL = <span class="keyword">False</span></div><div class="line"></div><div class="line">    TaskBase = celery.Task</div><div class="line">    <span class="class"><span class="keyword">class</span> <span class="title">ContextTask</span><span class="params">(TaskBase)</span>:</span></div><div class="line">        abstract = <span class="keyword">True</span></div><div class="line">        <span class="function"><span class="keyword">def</span> <span class="title">__call__</span><span class="params">(self, *args, **kwargs)</span>:</span></div><div class="line">            <span class="keyword">with</span> app.app_context():</div><div class="line">                <span class="keyword">return</span> TaskBase.__call__(self, *args, **kwargs)</div><div class="line">    celery.Task = ContextTask</div><div class="line">    <span class="keyword">return</span> celery</div></pre></td></tr></table></figure>
<p>ç„¶ååœ¨å‡½æ•°ä¸Šé€šè¿‡è£…é¥°å™¨æ–¹å¼ä¿®é¥°ä»»åŠ¡å‡½æ•°</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> ..extensions <span class="keyword">import</span> celery</div><div class="line"></div><div class="line"><span class="string">'''</span></div><div class="line"><span class="string">ç”ŸæˆçŸ©å½¢è½¨è¿¹è·¯çº¿å›¾</span></div><div class="line"><span class="string">'''</span></div><div class="line"><span class="meta">@celery.task(name='get_pathmap', acks_late=True)</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_pathmap</span><span class="params">(path_map, heat_path)</span>:</span></div><div class="line">		<span class="comment">#......ï¼Œä»»åŠ¡ä»£ç </span></div></pre></td></tr></table></figure>
<p>æœ€åå¦‚ä¸‹è°ƒç”¨å³å¯</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#é€šè¿‡é…ç½®å†³å®šæ˜¯å¦ç”¨æ¶ˆæ¯é˜Ÿåˆ—ï¼Œæ–¹ä¾¿è°ƒè¯•åŠŸèƒ½</span></div><div class="line"><span class="keyword">if</span> current_app.config.get(<span class="string">'IS_CELERY_WORK'</span>):</div><div class="line">	get_pathmap.delay(path_map, heat_path)</div><div class="line"><span class="keyword">else</span>:</div><div class="line">	get_pathmap(path_map, heat_path)</div></pre></td></tr></table></figure>
<h3 id="ç“¦ç‰‡å›¾çš„reidsç¼“å­˜"><a href="#ç“¦ç‰‡å›¾çš„reidsç¼“å­˜" class="headerlink" title="ç“¦ç‰‡å›¾çš„reidsç¼“å­˜"></a>ç“¦ç‰‡å›¾çš„reidsç¼“å­˜</h3><p>redis_utils.pyå†…å®¹å¦‚ä¸‹</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> redis</div><div class="line"><span class="keyword">import</span> socket</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">RedisConnectionPool</span>:</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name=<span class="string">''</span>, app=None)</span>:</span></div><div class="line">        self.name = name</div><div class="line">        self._pool = <span class="keyword">None</span></div><div class="line">        self.max_try = <span class="number">3</span></div><div class="line"></div><div class="line">        <span class="keyword">if</span> app <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:</div><div class="line">            self.app = app</div><div class="line">            self.init_app(self.app)</div><div class="line">        <span class="keyword">else</span>:</div><div class="line">            self.app = <span class="keyword">None</span></div><div class="line"></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">init_app</span><span class="params">(self, app)</span>:</span></div><div class="line">        self._pool = redis.BlockingConnectionPool(</div><div class="line">            host=app.config.get(<span class="string">"REDIS_%s_HOST"</span>%self.name),</div><div class="line">            port=app.config.get(<span class="string">"REDIS_%s_PORT"</span>%self.name),</div><div class="line">            db=app.config.get(<span class="string">"REDIS_%s_DB"</span>%self.name),</div><div class="line">            password=app.config.get(<span class="string">"REDIS_%s_PASSWORD"</span>%self.name),</div><div class="line">            socket_timeout=app.config.get(<span class="string">"REDIS_%s_TIMEOUT"</span>%self.name),</div><div class="line">            max_connections=app.config.get(<span class="string">"REDIS_%s_POOL_MAX"</span>%self.name),</div><div class="line">            timeout=app.config.get(<span class="string">"REDIS_%s_POOL_MAXWAIT"</span>%self.name)</div><div class="line">        )</div><div class="line">        self.app = app</div><div class="line"></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_redis</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">return</span> redis.Redis(connection_pool=self._pool)</div><div class="line"></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__getattr__</span><span class="params">(self, item)</span>:</span></div><div class="line">        <span class="function"><span class="keyword">def</span> <span class="title">__call_with_retries</span><span class="params">(*args)</span>:</span></div><div class="line">            <span class="keyword">if</span> <span class="keyword">None</span> == self.app:</div><div class="line">                <span class="keyword">raise</span> Exception(<span class="string">'the redis client is not initial!'</span>)</div><div class="line"></div><div class="line">            retry = <span class="number">0</span></div><div class="line">            <span class="keyword">while</span> retry &lt; self.max_try:</div><div class="line">                <span class="keyword">try</span>:</div><div class="line">                  <span class="keyword">return</span> getattr(self.get_redis(), item)(*args)</div><div class="line">                <span class="keyword">except</span> socket.timeout, se:</div><div class="line">                  <span class="keyword">if</span> retry &lt; self.max_try:</div><div class="line">                    retry += <span class="number">1</span></div><div class="line">                  <span class="keyword">else</span>:</div><div class="line">                    <span class="keyword">raise</span> se</div><div class="line"></div><div class="line">        <span class="keyword">return</span> __call_with_retries</div></pre></td></tr></table></figure>
<p>è°ƒç”¨æ—¶å€™ï¼Œåˆ¤æ–­æ˜¯å¦å‘½ä¸­å³å¯</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> redis.exists(redis_key) <span class="keyword">and</span> <span class="keyword">not</span> force_refresh:</div><div class="line">   <span class="keyword">return</span> redis.get(redis_key)</div><div class="line"><span class="keyword">else</span>:</div><div class="line">   str_tile_data = download_tilemap_file(lang, tile_x, tile_y, zoom)</div><div class="line">   ex_dt = timedelta(days=<span class="number">60</span>)</div><div class="line">   redis.set(redis_key, str_tile_data, ex_dt)</div><div class="line">   <span class="keyword">return</span> str_tile_data</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/08/30/å®‰å“è“ç‰™æ¨¡å—è¸©å‘é›†åˆ/" itemprop="url">
                  å®‰å“è“ç‰™æ¨¡å—è¸©å‘é›†åˆ
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">VerÃ¶ffentlicht am</span>
            <time itemprop="dateCreated" datetime="2016-08-30T14:31:40+08:00" content="2016-08-30">
              2016-08-30
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="å®‰å“è“ç‰™æ¨¡å—è¸©å‘é›†åˆ"><a href="#å®‰å“è“ç‰™æ¨¡å—è¸©å‘é›†åˆ" class="headerlink" title="å®‰å“è“ç‰™æ¨¡å—è¸©å‘é›†åˆ"></a>å®‰å“è“ç‰™æ¨¡å—è¸©å‘é›†åˆ</h1><h2 id="å¯¹ç‰¹å®šçš„è®¾å¤‡è¿›è¡Œæœç´¢"><a href="#å¯¹ç‰¹å®šçš„è®¾å¤‡è¿›è¡Œæœç´¢" class="headerlink" title="å¯¹ç‰¹å®šçš„è®¾å¤‡è¿›è¡Œæœç´¢"></a>å¯¹ç‰¹å®šçš„è®¾å¤‡è¿›è¡Œæœç´¢</h2><p>API <figure class="highlight plain"><figcaption><span>BluetoothAdapter.LeScanCallback) ```æ˜¯å®‰å“ç³»ç»Ÿç‰¹åœ°æä¾›å‡ºæ¥å¯¹ç‰¹å®šçš„è®¾å¤‡è¿›è¡Œæœç´¢çš„ï¼Œå®˜æ–¹APIè¯´æ˜</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">``` If you want to scan for only specific types of peripherals, you can instead call startLeScan(UUID[], BluetoothAdapter.LeScanCallback), providing an array of UUID objects that specify the GATT services your app supports.</div></pre></td></tr></table></figure></p>
<p>æ•…äº‹å¬èµ·æ¥éƒ½æ˜¯ç¾å¥½çš„ï¼Œå®é™…ä¸Šï¼Œäººç”Ÿå¾ˆè‰°éš¾</p>
<ul>
<li>å…ˆæ˜¯è¿™ä¸ªAPIè®¾è®¡çš„å¾ˆæœ‰é—®é¢˜ï¼Œä»– <code>UUID[]</code>æ˜¯å¹¶é›†è€Œä¸æ˜¯åˆé›†ï¼Œå°±æ˜¯è¯´ï¼Œæˆ‘åªèƒ½æœä¸€ä¸ªè®¾å¤‡åŒæ—¶å…¼å¤‡ä¸¤ä¸ªUUIDï¼Œè€Œä¸æ˜¯è¿™ä¸¤ä¸ªUUIDçš„è®¾å¤‡éƒ½è¿›è¡Œæœç´¢ï¼Œè¿™ç‚¹iOS APIè®¾è®¡å°±åˆç†å¾ˆå¤šäº†ã€‚</li>
<li>ç„¶åæ˜¯ï¼Œè¿™ä¸ªAPIåœ¨å®‰å“4.3 4.4å‹æ ¹ä¸æ”¯æŒï¼Œè¿™å°±æ˜¯æœ€å‘çˆ¹çš„äººï¼ŒæŠ˜è…¾äº†åŠå¤©ï¼Œæœ€åä¸æ”¯æŒï¼</li>
</ul>
<h2 id="æœç´¢çš„å›è°ƒ"><a href="#æœç´¢çš„å›è°ƒ" class="headerlink" title="æœç´¢çš„å›è°ƒ"></a>æœç´¢çš„å›è°ƒ</h2><p>è¿™ç‚¹å€’ä¸ç®—å‘ï¼Œå°±æ˜¯è¦æ³¨æ„çš„åœ°æ–¹<code>BluetoothAdapter.LeScanCallback.onLeScan()</code> ä¸ºæœç´¢ç»“æœçš„å›è°ƒï¼Œè¯¥æ–¹æ³•å°½å¯èƒ½å°½å¿«æŠŠè´Ÿè´£çš„è¿‡æ»¤ã€åˆ¤æ–­æŠ›åˆ°å…¶ä»–çº¿ç¨‹å»åšï¼Œå°½å¿«å°†å›è°ƒè°ƒç”¨è¿”å›äº†ã€‚</p>
<h2 id="åŒæ—¶åªèƒ½å¯¹ä¸€ä¸ªè®¾å¤‡è¿›è¡Œè¿æ¥"><a href="#åŒæ—¶åªèƒ½å¯¹ä¸€ä¸ªè®¾å¤‡è¿›è¡Œè¿æ¥" class="headerlink" title="åŒæ—¶åªèƒ½å¯¹ä¸€ä¸ªè®¾å¤‡è¿›è¡Œè¿æ¥"></a>åŒæ—¶åªèƒ½å¯¹ä¸€ä¸ªè®¾å¤‡è¿›è¡Œè¿æ¥</h2><p><code>BluetoothDevice.connectGatt()</code>æ–¹æ³•è¦æ§åˆ¶å¥½ï¼Œä¸èƒ½åŒæ—¶å¯¹å¤šä¸ªè®¾å¤‡è¿›è¡Œè¿æ¥ï¼Œè¿™ç‚¹ä¹Ÿå°±ä¸èƒ½åƒiOSé‚£æ ·ï¼Œè¿›è¡Œé¢„è¿æ¥çš„æ ¹æºå‘ã€‚</p>
<p>å¦‚æœè¿æ¥å¤±è´¥äº†ï¼ˆä¾‹å¦‚å‡ºé”™ï¼Œæˆ–è€…è¿æ¥è¶…æ—¶å¤±è´¥ï¼‰ï¼Œè¦é©¬ä¸Šè°ƒç”¨ BluetoothGatt.disconnect() æ¥é‡Šæ”¾å»ºç«‹è¿æ¥è¯·æ±‚ï¼Œç„¶åå¤„ç†ä¸‹ä¸€ä¸ªè®¾å¤‡è¿æ¥è¯·æ±‚ï¼Œå¦åˆ™å°±ç­‰133å‡ºç°ï¼</p>
<h2 id="å¯¹äºå±æ€§çš„æ“ä½œï¼ŒåŒæ—¶åªèƒ½æœ‰ä¸€ä¸ª"><a href="#å¯¹äºå±æ€§çš„æ“ä½œï¼ŒåŒæ—¶åªèƒ½æœ‰ä¸€ä¸ª" class="headerlink" title="å¯¹äºå±æ€§çš„æ“ä½œï¼ŒåŒæ—¶åªèƒ½æœ‰ä¸€ä¸ª"></a>å¯¹äºå±æ€§çš„æ“ä½œï¼ŒåŒæ—¶åªèƒ½æœ‰ä¸€ä¸ª</h2><p>ä¸ç®¡æ˜¯<code>writeCharacteristic()</code>å†™æ•°æ®ï¼Œè¿˜æ˜¯è®¾ç½®notifyï¼Œéƒ½æ˜¯å¼‚æ­¥çš„ï¼ŒåŒæ—¶åªèƒ½æœ‰ä¸€ä¸ªï¼Œå¦åˆ™å¯èƒ½ä¸²çº¿ï¼Œæˆ–è€…ä¸¢å¤±ã€‚æ‰€ä»¥ï¼Œä¸€å®šè¦åœ¨ä¸Šä¸€ä¸ªå†™æˆåŠŸçš„å›è°ƒåæ‰èƒ½è¿›è¡Œä¸‹ä¸€ä¸ªæ“ä½œï¼Œå°±è¿™æ ·ï¼Œè¿˜æœ‰å¯èƒ½ä¼šå‡ºç°è¯¥é—®é¢˜ï¼Œæ‰€ä»¥åœ¨ä¸€äº›æœ‰å¯èƒ½è¦åŒæ—¶æ“ä½œçš„åœ°æ–¹ï¼Œæˆ‘æ˜¯ç­‰æ”¶åˆ°äº†æ•°æ®æ‰è¿›è¡Œä¸‹ä¸€ä¸ªæ“ä½œã€‚æ¯”å¦‚è¿æ¥ä¸ŠPodooné‹å«åè¦è¿›è¡Œæ—¶é—´æ ¡æ­£ã€è¯»ç‰ˆæœ¬å·ã€è¯»æ‰¹æ¬¡å·ã€è¯»åè®®æ ˆï¼Œå°±æ˜¯åœ¨å‰ä¸€ä¸ªnotifyæ•°æ®åï¼Œæ‰æ‰§è¡Œä¸‹ä¸€ä¸ªï¼Œå¦å¤–ç‰¹åœ°åšäº†ä¸€ä¸ªTimerå¾ªç¯çš„å»æ£€æŸ¥ã€‚</p>
<h2 id="æœç´¢ã€è¿æ¥ã€æ–­å¼€è¿æ¥æœ€å¥½æ”¾åœ¨ä¸»çº¿ç¨‹"><a href="#æœç´¢ã€è¿æ¥ã€æ–­å¼€è¿æ¥æœ€å¥½æ”¾åœ¨ä¸»çº¿ç¨‹" class="headerlink" title="æœç´¢ã€è¿æ¥ã€æ–­å¼€è¿æ¥æœ€å¥½æ”¾åœ¨ä¸»çº¿ç¨‹"></a>æœç´¢ã€è¿æ¥ã€æ–­å¼€è¿æ¥æœ€å¥½æ”¾åœ¨ä¸»çº¿ç¨‹</h2><p>è¿™ç‚¹çœ‹æ–‡æ¡£çœ‹åˆ°çš„ï¼Œå…·ä½“æœ‰æ²¡æœ‰æ•ˆæœä¸æ¸…æ¥šï¼ŒSDKæ˜¯åˆ›å»ºä¸€ä¸ª <code>new Handler(context.getMainLooper());</code> ï¼ŒæŠŠæ¶ˆæ¯å‘é€åˆ°è¿™ä¸ª Handler ä¸­ã€‚</p>
<h2 id="è¿æ¥è¿‡ç¨‹å¾ˆè€—ç”µï¼Œå°½é‡æ—¶é—´çŸ­"><a href="#è¿æ¥è¿‡ç¨‹å¾ˆè€—ç”µï¼Œå°½é‡æ—¶é—´çŸ­" class="headerlink" title="è¿æ¥è¿‡ç¨‹å¾ˆè€—ç”µï¼Œå°½é‡æ—¶é—´çŸ­"></a>è¿æ¥è¿‡ç¨‹å¾ˆè€—ç”µï¼Œå°½é‡æ—¶é—´çŸ­</h2><p>å¯¹BLEè®¾å¤‡è¿æ¥ï¼Œè¿æ¥è¿‡ç¨‹è¦å°½é‡çŸ­ï¼Œå¦‚æœè¿æ¥ä¸ä¸Šï¼Œä¸è¦ç›²ç›®è¿›è¡Œé‡è¿ï¼Œå¦è¿™ä½ çš„ç”µæ± ä¼šå¾ˆå¿«è¢«æ¶ˆè€—æ‰</p>
<h2 id="ä½œä¸ºä¸­å¿ƒè®¾å¤‡ï¼Œæœ€å¤šåªèƒ½åŒæ—¶è¿6ï¼ˆä¸æ˜¯éå¸¸ç¡®å®šï¼Œä½†æ˜¯æ˜¯æœ‰é™çš„ï¼‰ä¸ªBLEè®¾å¤‡"><a href="#ä½œä¸ºä¸­å¿ƒè®¾å¤‡ï¼Œæœ€å¤šåªèƒ½åŒæ—¶è¿6ï¼ˆä¸æ˜¯éå¸¸ç¡®å®šï¼Œä½†æ˜¯æ˜¯æœ‰é™çš„ï¼‰ä¸ªBLEè®¾å¤‡" class="headerlink" title="ä½œä¸ºä¸­å¿ƒè®¾å¤‡ï¼Œæœ€å¤šåªèƒ½åŒæ—¶è¿6ï¼ˆä¸æ˜¯éå¸¸ç¡®å®šï¼Œä½†æ˜¯æ˜¯æœ‰é™çš„ï¼‰ä¸ªBLEè®¾å¤‡"></a>ä½œä¸ºä¸­å¿ƒè®¾å¤‡ï¼Œæœ€å¤šåªèƒ½åŒæ—¶è¿6ï¼ˆä¸æ˜¯éå¸¸ç¡®å®šï¼Œä½†æ˜¯æ˜¯æœ‰é™çš„ï¼‰ä¸ªBLEè®¾å¤‡</h2><p>è¶…è¿‡äº†å°±å¾ˆå¯èƒ½ä¼šè¿æ¥å¤±è´¥ã€‚å¦‚æœè¿æ¥åèµ„æºæœªè¢«é‡Šæ”¾ï¼Œä¹Ÿä¼šè®°åšè¿æ¥çš„è®¾å¤‡è¿›è¡Œè®¡ç®—ã€‚</p>
<h2 id="èµ„æºæœªè¢«é‡Šæ”¾å¯¼è‡´133é—®é¢˜"><a href="#èµ„æºæœªè¢«é‡Šæ”¾å¯¼è‡´133é—®é¢˜" class="headerlink" title="èµ„æºæœªè¢«é‡Šæ”¾å¯¼è‡´133é—®é¢˜"></a>èµ„æºæœªè¢«é‡Šæ”¾å¯¼è‡´133é—®é¢˜</h2><p>è¿æ¥è“ç‰™è®¾å¤‡åï¼Œåœ¨æ–­å¼€æ—¶å€™å°½å¯èƒ½å¯¹å…¶è¿›è¡Œcloseæ“ä½œï¼Œå¦åˆ™å°±æœ‰å¯èƒ½å› ä¸ºèµ„æºæœªé‡Šæ”¾å¹²å‡€åˆè¿æ¥åŒä¸€ä¸ªè®¾å¤‡å‡ºç°133çš„é”™è¯¯</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/06/07/2016-06-07-dockercong-0dao-1de-bi-ji/" itemprop="url">
                  Dockerä»0åˆ°1çš„ç¬”è®°
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">VerÃ¶ffentlicht am</span>
            <time itemprop="dateCreated" datetime="2016-06-07T14:25:06+08:00" content="2016-06-07">
              2016-06-07
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Dockerä»0åˆ°1çš„ç¬”è®°"><a href="#Dockerä»0åˆ°1çš„ç¬”è®°" class="headerlink" title="Dockerä»0åˆ°1çš„ç¬”è®°"></a>Dockerä»0åˆ°1çš„ç¬”è®°</h1><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><h3 id="httpsæ”¯æŒåŠGPG-keyæ·»åŠ "><a href="#httpsæ”¯æŒåŠGPG-keyæ·»åŠ " class="headerlink" title="httpsæ”¯æŒåŠGPG keyæ·»åŠ "></a>httpsæ”¯æŒåŠGPG keyæ·»åŠ </h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ sudo apt-get update</div><div class="line">$ sudo apt-get install apt-transport-https ca-certificates</div><div class="line">$ sudo apt-key adv --keyserver hkp://p80.pool.sks-keyservers.net:80 --recv-keys 58118E89F3A912897C070ADBF76221572C52609D</div></pre></td></tr></table></figure>
<h3 id="è®¾ç½®dockeré•œåƒæº"><a href="#è®¾ç½®dockeré•œåƒæº" class="headerlink" title="è®¾ç½®dockeré•œåƒæº"></a>è®¾ç½®dockeré•œåƒæº</h3><p>ç¼–è¾‘<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"></div></pre></td></tr></table></figure></p>
<p>deb <a href="https://apt.dockerproject.org/repo" target="_blank" rel="external">https://apt.dockerproject.org/repo</a> ubuntu-trusty main<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">### æ—§ç‰ˆæœ¬çš„æ¸…ç†åŠéªŒè¯</div><div class="line"></div><div class="line">```bash</div><div class="line">$ sudo apt-get update</div><div class="line">$ sudo apt-get purge lxc-docker</div><div class="line">$ apt-cache policy docker-engine</div></pre></td></tr></table></figure></p>
<h3 id="æ·»åŠ å†…æ ¸åŒ…"><a href="#æ·»åŠ å†…æ ¸åŒ…" class="headerlink" title="æ·»åŠ å†…æ ¸åŒ…"></a>æ·»åŠ å†…æ ¸åŒ…</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ sudo apt-get update</div><div class="line">$ sudo apt-get install linux-image-extra-$(uname -r)</div><div class="line">$ sudo apt-get install apparmor</div></pre></td></tr></table></figure>
<h3 id="å®‰è£…å¹¶å¯åŠ¨docker"><a href="#å®‰è£…å¹¶å¯åŠ¨docker" class="headerlink" title="å®‰è£…å¹¶å¯åŠ¨docker"></a>å®‰è£…å¹¶å¯åŠ¨docker</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ sudo apt-get update</div><div class="line">$ sudo apt-get install docker-engine</div><div class="line">$ sudo service docker start</div></pre></td></tr></table></figure>
<h3 id="éªŒè¯dockerå·²å¯åŠ¨"><a href="#éªŒè¯dockerå·²å¯åŠ¨" class="headerlink" title="éªŒè¯dockerå·²å¯åŠ¨"></a>éªŒè¯dockerå·²å¯åŠ¨</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ sudo docker run hello-world</div></pre></td></tr></table></figure>
<h3 id="å…¶ä»–dockerå¯é€‰é…ç½®"><a href="#å…¶ä»–dockerå¯é€‰é…ç½®" class="headerlink" title="å…¶ä»–dockerå¯é€‰é…ç½®"></a>å…¶ä»–dockerå¯é€‰é…ç½®</h3><p>è¿˜ä¸€äº›dockeré…ç½®ï¼Œæ¯”å¦‚groupè¿™é‡Œå°±æ²¡åšæµ‹è¯•ï¼Œåªæ˜¯å•æœºä¸Šæµ‹è¯•ä¸‹ç®€å•çš„åŠŸèƒ½ã€‚</p>
<h2 id="ä½¿ç”¨æ¡ˆä¾‹nodejs-mysql"><a href="#ä½¿ç”¨æ¡ˆä¾‹nodejs-mysql" class="headerlink" title="ä½¿ç”¨æ¡ˆä¾‹nodejs+mysql"></a>ä½¿ç”¨æ¡ˆä¾‹nodejs+mysql</h2><h3 id="åˆ›å»ºä¸€ä¸ªå®¹å™¨æµ‹è¯•ä¸‹"><a href="#åˆ›å»ºä¸€ä¸ªå®¹å™¨æµ‹è¯•ä¸‹" class="headerlink" title="åˆ›å»ºä¸€ä¸ªå®¹å™¨æµ‹è¯•ä¸‹"></a>åˆ›å»ºä¸€ä¸ªå®¹å™¨æµ‹è¯•ä¸‹</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ docker run -it ubuntu</div></pre></td></tr></table></figure>
<ul>
<li>runåˆ›å»ºå®¹å™¨</li>
<li>-itåˆ›å»ºåä¼šç›´æ¥ç»™ç”Ÿæˆçš„å®¹å™¨åˆ›å»ºä¸€ä¸ªç»ˆç«¯</li>
<li>ubuntuåˆ›å»ºå®¹å™¨æ‰€ä½¿ç”¨çš„é•œåƒ</li>
</ul>
<p>å¯ä»¥åœ¨å®¹å™¨çš„ç»ˆç«¯ä¸Šè¿è¡Œä¸€ä¸‹å‘½ä»¤ï¼ŒæŸ¥çœ‹å®¹å™¨çš„ä¿¡æ¯</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">root@719059da250d:/# lsb_release -a</div><div class="line">No LSB modules are available.</div><div class="line">Distributor ID:    Ubuntu</div><div class="line">Description:    Ubuntu 14.04.4 LTS</div><div class="line">Release:    14.04</div><div class="line">Codename:    trusty</div><div class="line">root@719059da250d:/# exit</div></pre></td></tr></table></figure>
<h3 id="å¼€å§‹æ¡ˆä¾‹å§ï¼Œåˆ›å»ºä¸€ä¸ªmysqlçš„å®¹å™¨"><a href="#å¼€å§‹æ¡ˆä¾‹å§ï¼Œåˆ›å»ºä¸€ä¸ªmysqlçš„å®¹å™¨" class="headerlink" title="å¼€å§‹æ¡ˆä¾‹å§ï¼Œåˆ›å»ºä¸€ä¸ªmysqlçš„å®¹å™¨"></a>å¼€å§‹æ¡ˆä¾‹å§ï¼Œåˆ›å»ºä¸€ä¸ªmysqlçš„å®¹å™¨</h3><p>åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹test_databaseï¼Œæ–‡ä»¶å¤¹ç»“æ„ä¸º</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">test_database\setup.sql</div><div class="line">test_database\start.sh</div><div class="line">test_database\stop.sh</div></pre></td></tr></table></figure>
<p>start.sh</p>
<figure class="highlight bash"><figcaption><span>start.sh</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#!/bin/sh</span></div><div class="line"></div><div class="line"><span class="comment"># Run the MySQL container, with a database named 'users' and credentials</span></div><div class="line"><span class="comment"># for a users-service user which can access it.</span></div><div class="line"><span class="built_in">echo</span> <span class="string">"Starting DB..."</span></div><div class="line">docker run --name db -d \</div><div class="line"> -e MYSQL_ROOT_PASSWORD=123 \</div><div class="line"> -e MYSQL_DATABASE=users -e MYSQL_USER=users_service -e MYSQL_PASSWORD=123 \</div><div class="line"> -p 3306:3306 mysql:latest</div><div class="line"></div><div class="line"><span class="comment"># Wait for the database service to start up.</span></div><div class="line"><span class="built_in">echo</span> <span class="string">"Waiting for DB to start up..."</span></div><div class="line">docker <span class="built_in">exec</span> db mysqladmin --silent --<span class="built_in">wait</span>=30 -uusers_service -p123 ping || <span class="built_in">exit</span> 1</div><div class="line"></div><div class="line"><span class="comment"># Run the setup script.</span></div><div class="line"><span class="built_in">echo</span> <span class="string">"Setting up initial data..."</span></div><div class="line">docker <span class="built_in">exec</span> -i db mysql -uusers_service -p123 users &lt; setup.sql</div></pre></td></tr></table></figure>
<ul>
<li>â€“name db ç»™å®¹å™¨å‘½å</li>
<li>-d åœ¨åå°è¿è¡Œ</li>
<li>-e ç¯å¢ƒå˜é‡</li>
<li>-p ç«¯å£æ˜ å°„ï¼Œå³å®¿ä¸»æœºä¸Šçš„3306ç«¯å£ä¼šæ˜ å°„åˆ°å®¹å™¨çš„3306ç«¯å£ä¸Š</li>
<li>mysql:latest æœ€æ–°ç‰ˆæœ¬çš„mysql</li>
</ul>
<p>stop.sh</p>
<figure class="highlight bash"><figcaption><span>stop.sh</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#!/bin/sh</span></div><div class="line"></div><div class="line"><span class="comment"># Stop the db and remove the container.</span></div><div class="line">docker stop db &amp;&amp; docker rm db</div></pre></td></tr></table></figure>
<ul>
<li>stop åœæ­¢å®¹å™¨</li>
<li>rm åˆ é™¤å®¹å™¨</li>
</ul>
<p>setup.sql</p>
<figure class="highlight sql"><figcaption><span>setup.sql</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">create</span> <span class="keyword">table</span> <span class="keyword">directory</span> (user_id <span class="built_in">INT</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT PRIMARY <span class="keyword">KEY</span>, email <span class="built_in">TEXT</span>, phone_number <span class="built_in">TEXT</span>);</div><div class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">directory</span> (email, phone_number) <span class="keyword">values</span> (<span class="string">'homer@thesimpsons.com'</span>, <span class="string">'+1 888 123 1111'</span>);</div><div class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">directory</span> (email, phone_number) <span class="keyword">values</span> (<span class="string">'marge@thesimpsons.com'</span>, <span class="string">'+1 888 123 1112'</span>);</div><div class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">directory</span> (email, phone_number) <span class="keyword">values</span> (<span class="string">'maggie@thesimpsons.com'</span>, <span class="string">'+1 888 123 1113'</span>);</div><div class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">directory</span> (email, phone_number) <span class="keyword">values</span> (<span class="string">'lisa@thesimpsons.com'</span>, <span class="string">'+1 888 123 1114'</span>);</div><div class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">directory</span> (email, phone_number) <span class="keyword">values</span> (<span class="string">'bart@thesimpsons.com'</span>, <span class="string">'+1 888 123 1115'</span>);</div></pre></td></tr></table></figure>
<p>ç„¶åç›´æ¥æ‰§è¡Œstart.shå³å¯ï¼Œä¸ç”¨çš„æ—¶å€™ç›´æ¥æ‰§è¡Œstop.shã€‚</p>
<h3 id="æ„å»ºnodejs-æœåŠ¡ç«¯ä»£ç "><a href="#æ„å»ºnodejs-æœåŠ¡ç«¯ä»£ç " class="headerlink" title="æ„å»ºnodejs æœåŠ¡ç«¯ä»£ç "></a>æ„å»ºnodejs æœåŠ¡ç«¯ä»£ç </h3><p>åˆ›å»ºæ–‡ä»¶å¤¹users-serviceï¼Œç„¶å <figure class="highlight plain"><figcaption><span>clone</span><a href="https://github.com/yuezaixz/nodejs-in-docker.git```" target="_blank" rel="external">link</a></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">å¯ä»¥å…ˆæ‰§è¡Œ```npm start```æ¥æµ‹è¯•æ˜¯å¦å¯ä»¥è¿è¡Œï¼Œå¦‚æœåœ¨æµè§ˆå™¨ä¸­å¯ä»¥æ­£å¸¸è®¿é—®```localhost:8123/users```ï¼Œé‚£ä¹ˆå°±è¯´æ˜ä»£ç æ²¡é—®é¢˜äº†ã€‚</div><div class="line"></div><div class="line">### é¡¹ç›®ä¸­çš„dockerå®¹å™¨é…ç½®æ–‡ä»¶</div><div class="line">åœ¨users-serviceç›®å½•ä¸­å·²ç»æœ‰äº†ä¸€ä¸ªæ–‡ä»¶Dockerfile,å†…å®¹ä¸º</div></pre></td></tr></table></figure></p>
<h1 id="Use-Node-v4-as-the-base-image"><a href="#Use-Node-v4-as-the-base-image" class="headerlink" title="Use Node v4 as the base image."></a>Use Node v4 as the base image.</h1><p>FROM node:4</p>
<h1 id="Add-everything-in-the-current-directory-to-our-image-in-the-â€˜appâ€™-folder"><a href="#Add-everything-in-the-current-directory-to-our-image-in-the-â€˜appâ€™-folder" class="headerlink" title="Add everything in the current directory to our image, in the â€˜appâ€™ folder."></a>Add everything in the current directory to our image, in the â€˜appâ€™ folder.</h1><p>ADD . /app</p>
<h1 id="Install-dependencies"><a href="#Install-dependencies" class="headerlink" title="Install dependencies"></a>Install dependencies</h1><p>RUN cd /app; \<br>    npm install â€“production</p>
<h1 id="Expose-our-server-port"><a href="#Expose-our-server-port" class="headerlink" title="Expose our server port."></a>Expose our server port.</h1><p>EXPOSE 8123</p>
<h1 id="Run-our-app"><a href="#Run-our-app" class="headerlink" title="Run our app."></a>Run our app.</h1><p>CMD [â€œnodeâ€, â€œ/app/index.jsâ€]<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">* FROM node:4 ç”¨node4ä½œä¸ºå®¹å™¨çš„æ™¯è±¡</div><div class="line">* ADD . /app æŠŠå½“å‰ç›®å½•çš„æ‰€æœ‰æ–‡ä»¶éƒ½æ˜ å°„ä¸ºå®¹å™¨ä¸­/appæ–‡ä»¶å¤¹ä¸‹çš„å†…å®¹</div><div class="line">* RUN cd /app; npm install --production è¿è¡Œå®¹å™¨æ—¶å€™ï¼Œæ‰§è¡Œå‘½ä»¤ï¼Œæ·»åŠ é¡¹ç›®æ‰€éœ€è¦çš„ä¾èµ–</div><div class="line">* EXPOSE 8123 è¾“å‡ºç«¯å£</div><div class="line">* CMD [&quot;node&quot;, &quot;/app/index.js&quot;] åº”ç”¨å¯åŠ¨å‘½ä»¤</div><div class="line"></div><div class="line">### è¿è¡Œnodejsçš„dockerå®¹å™¨</div><div class="line">åœ¨users-serviceè·¯å¾„ä¸‹è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥å¯åŠ¨å®¹å™¨</div><div class="line"></div><div class="line">```bash</div><div class="line">$ docker build -t users-service .</div><div class="line">$ docker run -it -p 8123:8123 users-service</div></pre></td></tr></table></figure></p>
<ul>
<li>docker build -t users-service .  æ ¹æ®å½“å‰ç›®å½•çš„Dockerfileæ–‡ä»¶åœ¨åˆ›å»ºå®¹å™¨users-service</li>
</ul>
<h3 id="å®¹å™¨ä¸å®¹å™¨çš„ä¾èµ–"><a href="#å®¹å™¨ä¸å®¹å™¨çš„ä¾èµ–" class="headerlink" title="å®¹å™¨ä¸å®¹å™¨çš„ä¾èµ–"></a>å®¹å™¨ä¸å®¹å™¨çš„ä¾èµ–</h3><p>è¿è¡Œä¸Šä¸€æ®µå‘½ä»¤åä¼šæŠ¥é”™ï¼Œå› ä¸ºå½“å‰å®¹å™¨ä¾èµ–äº†å®¿ä¸»æœºä¸Šå¦ä¸€ä¸ªmysqlå®¹å™¨ï¼Œnodejså®¹å™¨è®¿é—®å®¹å™¨ç§çš„3306ç«¯å£æ— æ³•è®¿é—®åˆ°å¦ä¸€å°å®¹å™¨çš„mysqlå®¹å™¨ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">--- Customer Service---</div><div class="line">Connecting to customer repository...</div><div class="line">Connected. Starting server...</div><div class="line">Server started successfully, running on port 8123.</div><div class="line">GET /users 500 23.958 ms - 582</div><div class="line">Error: An error occured getting the users: Error: connect ECONNREFUSED 127.0.0.1:3306</div><div class="line">    at Query._callback (/app/repository/repository.js:21:25)</div><div class="line">    at Query.Sequence.end (/app/node_modules/mysql/lib/protocol/sequences/Sequence.js:96:24)</div><div class="line">    at /app/node_modules/mysql/lib/protocol/Protocol.js:399:18</div><div class="line">    at Array.forEach (native)</div><div class="line">    at /app/node_modules/mysql/lib/protocol/Protocol.js:398:13</div><div class="line">    at nextTickCallbackWith0Args (node.js:420:9)</div><div class="line">    at process._tickCallback (node.js:349:13)</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                    NAMES</div><div class="line">ebcae11742af        users-service       &quot;node /app/index.js&quot;     2 days ago          Up 2 days           0.0.0.0:8123-&gt;8123/tcp   fervent_hopper</div><div class="line">0e6e2bacafa2        mysql:latest        &quot;docker-entrypoint.sh&quot;   2 days ago          Up 2 days           0.0.0.0:3306-&gt;3306/tcp   db</div></pre></td></tr></table></figure>
<p>é‚£ä¹ˆå°±éœ€è¦è®©nodejså®¹å™¨ä¾èµ–mysqlå®¹å™¨ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">docker run -it -p 8123:8123 --link db:db -e DATABASE_HOST=DB users-service</div></pre></td></tr></table></figure>
<ul>
<li>link db:db è¿æ¥åˆ°å®¹å™¨åä¸ºdbçš„å®¹å™¨ï¼ŒæŠŠä»–å¼•ç”¨ä¸ºdb</li>
<li>-e DATABASE_HOST=db è®¾ç½®ç¯å¢ƒå˜é‡</li>
</ul>
<p>æŸ¥çœ‹config.jsçš„ä»£ç å¯ä»¥å‘ç°ï¼ŒæœåŠ¡ç«¯ä»£ç é…ç½®æ•°æ®æºçš„æ–¹å¼æ˜¯ <figure class="highlight plain"><figcaption><span>|| '127.0.0.1'```å­˜åœ¨ç¯å¢ƒå˜é‡DATABASE_HOSTçš„æ—¶å€™ä½¿ç”¨è¯¥ç¯å¢ƒå˜é‡</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"></div></pre></td></tr></table></figure></p>
<p>//  config.js<br>//<br>//  Simple application configuration. Extend as needed.<br>module.exports = {<br>    port: process.env.PORT || 8123,<br>  db: {<br>    host: process.env.DATABASE_HOST || â€˜127.0.0.1â€™,<br>    database: â€˜usersâ€™,<br>    user: â€˜users_serviceâ€™,<br>    password: â€˜123â€™,<br>    port: 3306<br>  }<br>};</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">ä»ä¸‹é¢å¯ä»¥çœ‹å‡ºï¼Œå­˜åœ¨ä¸€ä¸ª172.17.0.2ï¼Œåä¸ºdbçš„ä¾èµ–ã€‚</div></pre></td></tr></table></figure>
<p>ubuntu@VM-79-113-ubuntu:~/users-service$ sudo docker exec fervent_hopper cat /etc/hosts<br>127.0.0.1    localhost<br>::1    localhost ip6-localhost ip6-loopback<br>fe00::0    ip6-localnet<br>ff00::0    ip6-mcastprefix<br>ff02::1    ip6-allnodes<br>ff02::2    ip6-allrouters<br>172.17.0.2    db 0e6e2bacafa2<br>172.17.0.3    ebcae11742af<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">å†ä»ä¸‹é¢å¯ä»¥çœ‹å‡ºï¼ŒDATABASE_HOSTæŒ‡å‘çš„å°±æ˜¯è¿™ä¸ªåä¸ºdbçš„ä¾èµ–</div></pre></td></tr></table></figure></p>
<p>ubuntu@VM-79-113-ubuntu:~/users-service$ sudo docker exec fervent_hopper printenv | grep DB<br>DB_PORT=tcp://172.17.0.2:3306<br>DB_PORT_3306_TCP=tcp://172.17.0.2:3306<br>DB_PORT_3306_TCP_ADDR=172.17.0.2<br>DB_PORT_3306_TCP_PORT=3306<br>DB_PORT_3306_TCP_PROTO=tcp<br>DB_NAME=/fervent_hopper/db<br>DB_ENV_MYSQL_ROOT_PASSWORD=123<br>DB_ENV_MYSQL_DATABASE=users<br>DB_ENV_MYSQL_USER=users_service<br>DB_ENV_MYSQL_PASSWORD=123<br>DB_ENV_GOSU_VERSION=1.7<br>DB_ENV_MYSQL_MAJOR=5.7<br>DB_ENV_MYSQL_VERSION=5.7.12-1debian8<br>DATABASE_HOST=DB<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">ç°åœ¨å¯ä»¥åœ¨æµè§ˆå™¨ä¸­è¯•è¯•å¯ä»¥ä¸å¯ä»¥æ­£å¸¸è®¿é—®```localhost:8123/users```ï¼Œå¯ä»¥çš„è¯è¯´æ˜é…ç½®æ²¡é—®é¢˜äº†ã€‚</div><div class="line"></div><div class="line">## python flaskæ¡†æ¶çš„æ¡ˆä¾‹</div><div class="line">ç”±äºä¾èµ–çš„æ˜¯å¤–éƒ¨æ•°æ®åº“ï¼Œæ‰€ä»¥å¾ˆç®€å•ï¼Œåªè¦å®šä¹‰å¥½Dockeræ–‡ä»¶å³å¯ã€‚</div></pre></td></tr></table></figure></p>
<p>FROM ubuntu:latest<br>MAINTAINER David Woo â€œxiao303178394@gmail.comâ€<br>RUN apt-get update -y<br>RUN apt-get install -y python-pip python-dev build-essential<br>COPY . /app<br>WORKDIR /app<br>RUN pip install -r etc/reqs-dev.txt<br>ENTRYPOINT [â€œpythonâ€]<br>CMD [â€œmanager.pyâ€,â€runserverâ€]</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">æ„å»ºé•œåƒ</div></pre></td></tr></table></figure>
<p>sudo docker build -t paodong-mng:latest .<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">è¿è¡Œå®¹å™¨</div></pre></td></tr></table></figure></p>
<p>sudo docker run -d -p 80:8558 paodong-mng<br>```</p>
<h2 id="å‘½ä»¤"><a href="#å‘½ä»¤" class="headerlink" title="å‘½ä»¤"></a>å‘½ä»¤</h2><ul>
<li>runåˆ›å»ºå®¹å™¨</li>
<li>-itåˆ›å»ºåä¼šç›´æ¥ç»™ç”Ÿæˆçš„å®¹å™¨åˆ›å»ºä¸€ä¸ªç»ˆç«¯</li>
<li>â€“name db ç»™å®¹å™¨å‘½å</li>
<li>-d åœ¨åå°è¿è¡Œ</li>
<li>-e ç¯å¢ƒå˜é‡</li>
<li>-t mysql åˆ›å»ºtagä¸ºmysqlçš„å®¹å™¨</li>
<li>-p ç«¯å£æ˜ å°„ï¼Œå³å®¿ä¸»æœºä¸Šçš„3306ç«¯å£ä¼šæ˜ å°„åˆ°å®¹å™¨çš„3306ç«¯å£ä¸Š</li>
<li>mysql:latest æœ€æ–°ç‰ˆæœ¬çš„mysql</li>
<li>ps æŸ¥çœ‹æ‰€æœ‰å®¹å™¨</li>
<li>docker exec -it db /bin/bash åœ¨å®¹å™¨dbä¸Šæ‰§è¡Œç»ˆç«¯ï¼Œç”¨bashæ‰§è¡Œ</li>
</ul>
<h2 id="å‚é˜…"><a href="#å‚é˜…" class="headerlink" title="å‚é˜…"></a>å‚é˜…</h2><ul>
<li><a href="http://www.dwmkerr.com/learn-docker-by-building-a-microservice/" target="_blank" rel="external">Learn Docker by building a Microservice</a></li>
<li><a href="https://docs.docker.com/engine/installation/linux/ubuntulinux/" target="_blank" rel="external">Installation on ubuntu</a></li>
<li><a href="http://containertutorials.com/docker-compose/flask-simple-app.html" target="_blank" rel="external">Dockerize Simple Flask App</a></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/07/13/2015-07-13-beginning-ios-pit-over-those-years-i/" itemprop="url">
                  åˆå­¦IOSé‚£äº›å¹´è¸©è¿‡çš„å‘ï¼ˆåï¼‰
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">VerÃ¶ffentlicht am</span>
            <time itemprop="dateCreated" datetime="2015-07-13T16:01:53+08:00" content="2015-07-13">
              2015-07-13
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="é¡µé¢é—´popå’Œpushå¯¼è‡´çš„é—®é¢˜"><a href="#é¡µé¢é—´popå’Œpushå¯¼è‡´çš„é—®é¢˜" class="headerlink" title="é¡µé¢é—´popå’Œpushå¯¼è‡´çš„é—®é¢˜"></a>é¡µé¢é—´popå’Œpushå¯¼è‡´çš„é—®é¢˜</h2><p>é—®é¢˜æè¿°ï¼šé—®é¢˜å¤§æ¦‚æ˜¯è¿™æ ·ï¼Œä¸€ä¸ªè¿åŠ¨ä¸­é¡µé¢RunningViewControllerï¼Œä¸€ä¸ªé¦–é¡µIndexViewControllerï¼Œä¸€ä¸ªç»“æœé¡µRunResultViewController<br>è¿åŠ¨ï¼šIndexViewControllerâ€“Pushâ€“&gt;RunningViewController<br>ç»“æŸï¼šRunningViewController â€“Popâ€“&gt;IndexViewControllerâ€“pushâ€“&gt;</p>
<p>ç»“æœIndexViewControllerçš„ViewWillAppearä¼šå¼¹å‡ºä¸ªUIAlertViewï¼Œå…¶é€»è¾‘ä¼šé€ æˆå½±å“ï¼Œåœ¨IOS8æƒ…å†µä¸‹UIAlertViewä¸ä¼šå¼¹å‡ºï¼ˆåº”è¯¥æ˜¯å¼¹å‡ºåç«‹é©¬è·³åˆ°äº†RunResultViewControllerï¼‰ï¼Œè€ŒIOS7æƒ…å†µä¸‹åˆ°RunResultViewControlleræ‰å¼¹å‡ºè¯¥UIAlertViewã€‚</p>
<p>è¯¥é—®é¢˜å¾ˆç®€å•ï¼Œè¯¥é€»è¾‘å…¶å®æ”¾é”™ä½ç½®äº†ï¼Œåº”è¯¥æ”¾åœ¨ViewDidLoadä¸­ï¼Œä½†æ˜¯ä»UIAlertViewé€ æˆçš„é”™è¯¯é€»è¾‘å»æ’æŸ¥åˆ°è¯¥é—®é¢˜æ¯”è¾ƒéº»çƒ¦ã€‚</p>
<h2 id="TableViewçš„loadæ—¶æœº"><a href="#TableViewçš„loadæ—¶æœº" class="headerlink" title="TableViewçš„loadæ—¶æœº"></a>TableViewçš„loadæ—¶æœº</h2><p>é—®é¢˜æè¿°ï¼šåœ¨ä½¿ç”¨FXFormåšè¡¨å•æ—¶å€™ï¼Œåœ¨viewDidLoadä¸­è¿›è¡Œäº†åˆå§‹åŒ–ï¼Œä½†æ˜¯åˆå§‹åŒ–å†…å®¹æ— æ•ˆï¼ˆåŒæ ·ä¹Ÿæ˜¯æ’æŸ¥æ¯”è¾ƒéº»çƒ¦ï¼Œå¼€å§‹æ²¡æ€€ç–‘è¿™ä¸ªé—®é¢˜ï¼‰ã€‚IOS8æ˜¯åœ¨ViewWillAppearä¹‹åï¼ˆé™¤éä½ è°ƒç”¨äº†tableView.tableFooterView = â€¦ ä¹‹ç±»æ–¹æ³•ï¼Œè°ƒç”¨åï¼‰å†è¿›è¡ŒloadViewçš„æ“ä½œï¼Œè€ŒIOS7åˆ™æ˜¯åœ¨[super viewDidLoad]ä¹‹åã€‚æœ€å®‰å…¨çš„åšæ³•å°±æ˜¯åœ¨ViewWillAppearä¹‹åé‡æ–°è°ƒç”¨ä¸€æ¬¡ [tableView reloadData];</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/06/29/2015-06-29-beginning-ios-pit-over-those-years-h/" itemprop="url">
                  åˆå­¦IOSé‚£äº›å¹´è¸©è¿‡çš„å‘ï¼ˆä¹ï¼‰
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">VerÃ¶ffentlicht am</span>
            <time itemprop="dateCreated" datetime="2015-06-29T11:25:10+08:00" content="2015-06-29">
              2015-06-29
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="å¦‚ä½•è®©å°å›¾ç‰‡æŒ‰é’®çš„ç‚¹å‡»åŒºåŸŸå˜å¤§"><a href="#å¦‚ä½•è®©å°å›¾ç‰‡æŒ‰é’®çš„ç‚¹å‡»åŒºåŸŸå˜å¤§" class="headerlink" title="å¦‚ä½•è®©å°å›¾ç‰‡æŒ‰é’®çš„ç‚¹å‡»åŒºåŸŸå˜å¤§"></a>å¦‚ä½•è®©å°å›¾ç‰‡æŒ‰é’®çš„ç‚¹å‡»åŒºåŸŸå˜å¤§</h2><p>ä¹‹å‰ç»å¸¸åšçš„äº‹æƒ…å°±æ˜¯ï¼Œç”¨ä¸ªimageViewæ¥æ”¾å›¾ç‰‡ï¼Œç„¶åç”¨ä¸€ä¸ªæ›´å¤§é€æ˜UIButtonç›–ä½ä»–ï¼Œè¿™æ ·æœ‰ä¸ªé—®é¢˜å°±æ˜¯ï¼Œä¸€æ—¦æŒ‰é’®éœ€è¦æœ‰ç‚¹å‡»é«˜äº®æ•ˆæœï¼Œå°±ä¼šå¾ˆéº»çƒ¦çš„ï¼ˆå„ç§ç‚¹å‡»å’Œé‡Šæ”¾çš„å›è°ƒï¼Œç„¶åå»ä¿®æ”¹imageViewçš„å›¾ç‰‡ï¼‰ã€‚</p>
<p>æœ€è¿‘å‘ç°äº†ä¸ªæ–¹æ³•ï¼Œå¯ä»¥ç”¨setContentEdgeInsetsæ¥è®¾ç½®Buttonå†…å®¹çš„åŒºåŸŸã€‚æ³¨æ„ï¼Œtopã€bottomç­‰ï¼Œéƒ½æ˜¯ä¸å…¶è·ç¦»ï¼Œæ¯”å¦‚bottomï¼Œå°±æ˜¯ä¸åº•éƒ¨è·ç¦»ã€‚å¼€å§‹æˆ‘ä»¥ä¸ºæ˜¯ä»(left,top)åˆ°(right,bottom)è¿™ä¸¤ä¸ªç‚¹çš„èŒƒå›´åšå›¾ç‰‡çš„ä½ç½®ï¼Œç„¶åå¯¼è‡´æ— æ³•å¾—åˆ°æƒ³è¦çš„æ•ˆæœã€‚</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//[self.runBtn setContentEdgeInsets:UIEdgeInsetsMake(&lt;#CGFloat top#&gt;, &lt;#CGFloat left#&gt;, &lt;#CGFloat bottom#&gt;, &lt;#CGFloat right#&gt;)];</span></div><div class="line">[<span class="keyword">self</span>.runBtn setContentEdgeInsets:<span class="built_in">UIEdgeInsetsMake</span>(<span class="number">8</span>, <span class="number">18</span>, <span class="number">8</span>, <span class="number">18</span>)];</div></pre></td></tr></table></figure>
<h2 id="viewæ²¡æœ‰è®¾ç½®backgroundColorï¼ŒsetNeedsDisplayåè§¦å‘drawRectï¼Œä¼šå¯¼è‡´é‡å¤ç»˜åˆ¶"><a href="#viewæ²¡æœ‰è®¾ç½®backgroundColorï¼ŒsetNeedsDisplayåè§¦å‘drawRectï¼Œä¼šå¯¼è‡´é‡å¤ç»˜åˆ¶" class="headerlink" title="viewæ²¡æœ‰è®¾ç½®backgroundColorï¼ŒsetNeedsDisplayåè§¦å‘drawRectï¼Œä¼šå¯¼è‡´é‡å¤ç»˜åˆ¶"></a>viewæ²¡æœ‰è®¾ç½®backgroundColorï¼ŒsetNeedsDisplayåè§¦å‘drawRectï¼Œä¼šå¯¼è‡´é‡å¤ç»˜åˆ¶</h2><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">-(<span class="keyword">void</span>)drawRect:(<span class="built_in">CGRect</span>)rect&#123;</div><div class="line"><span class="comment">//â€¦.</span></div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line">-(<span class="keyword">void</span>)touchesMoved:(<span class="built_in">NSSet</span> *)touches withEvent:(<span class="built_in">UIEvent</span> *)event&#123;</div><div class="line"><span class="comment">//â€¦.</span></div><div class="line">[<span class="keyword">self</span> setNeedsDisplay];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è¿™æ—¶å€™drawRectä¸­çš„å†…å®¹ä¼šé‡å¤ç»˜åˆ¶ï¼Œåªè¦è®¾ç½®backgroundColorå°±ä¸ä¼šé‡å¤ç»˜åˆ¶äº†ã€‚<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">lineChartView.backgroundColor = [<span class="built_in">UIColor</span> whiteColor];</div></pre></td></tr></table></figure></p>
<h2 id="ore-Dataå‡çº§åå¯¼è‡´æ•°æ®å‡çº§å¤±è´¥"><a href="#ore-Dataå‡çº§åå¯¼è‡´æ•°æ®å‡çº§å¤±è´¥" class="headerlink" title="ore-Dataå‡çº§åå¯¼è‡´æ•°æ®å‡çº§å¤±è´¥"></a>ore-Dataå‡çº§åå¯¼è‡´æ•°æ®å‡çº§å¤±è´¥</h2><p>ç”¨çš„æ˜¯MagicRecordï¼ŒAppDelegateä»£ç ä¸­æœ‰åˆå§‹åŒ–<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[MagicalRecord setupCoreDataStackWithAutoMigratingSqliteStoreNamed:SQLITE_NAME];</div><div class="line">[MagicalRecord shouldAutoCreateDefaultPersistentStoreCoordinator];</div><div class="line">[MagicalRecord setShouldDeleteStoreOnModelMismatch:<span class="literal">YES</span>];</div><div class="line">[MagicalRecord setupAutoMigratingCoreDataStack];<span class="comment">//è¿™é‡ŒæŠ¥é”™</span></div></pre></td></tr></table></figure></p>
<p>æŠ¥é”™å†…å®¹ä¸ºCanâ€™t find or automatically infer mapping model for migrationã€‚</p>
<p>åœ¨SOFä¸Šæ‰¾åˆ°äº†ä¸‹æ–‡ï¼Œå…·ä½“åŸå› ä¸æ˜ï¼Œå¯èƒ½æ˜¯æ·»åŠ ç‰ˆæœ¬æ—¶å€™æœ‰é”™è¯¯æ“ä½œï¼Œè¿™æ—¶å€™åªè¦æŠŠç‰ˆæœ¬å…ˆé€€å›åˆ°ä¸Šä¸€ä¸ªç‰ˆæœ¬ï¼Œç„¶ååˆ é™¤æ–°çš„ç‰ˆæœ¬ï¼Œæäº¤ä»£ç ï¼ˆä¸å…ˆæäº¤SVNå¯èƒ½ä¼šå‡ºé—®é¢˜å“¦ï¼‰ã€‚ç„¶åé‡æ–°æ·»åŠ ä¸€æ¬¡å†æäº¤å°±OKäº†ã€‚<br><a href="http://stackoverflow.com/questions/7708392/how-to-delete-an-old-unused-data-model-version-in-xcode-4" target="_blank" rel="external">å‚è€ƒ</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/11/">11</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="David Woo" />
          <p class="site-author-name" itemprop="name">David Woo</p>
          <p class="site-description motion-element" itemprop="description"></p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/">
              <span class="site-state-item-count">108</span>
              <span class="site-state-item-name">Artikel</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              
                <span class="site-state-item-count">195</span>
                <span class="site-state-item-name">Kategorien</span>
              
            </div>
          

          
            <div class="site-state-item site-state-tags">
              
                <span class="site-state-item-count">5</span>
                <span class="site-state-item-name">Tags</span>
              
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">David Woo</span>
</div>

<div class="powered-by">
  Erstellt mit  <a class="theme-link" href="https://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  



  




  
  

  

  

  

</body>
</html>
