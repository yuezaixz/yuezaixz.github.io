<!doctype html>



  


<html class="theme-next muse use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta property="og:type" content="website">
<meta property="og:title" content="大胃吴的闲话唠嗑">
<meta property="og:url" content="http://yoursite.com/page/5/index.html">
<meta property="og:site_name" content="大胃吴的闲话唠嗑">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="大胃吴的闲话唠嗑">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: 'Author'
    }
  };
</script>




  <link rel="canonical" href="http://yoursite.com/page/5/"/>

  <title> 大胃吴的闲话唠嗑 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">大胃吴的闲话唠嗑</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">扯扯技术，唠唠闲话</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-首页">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            menu.首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-文章">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            menu.文章
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2014/10/26/2014-10-26-july-september-output-of-06-version-summary/" itemprop="url">
                  7-9月产品0.6版本总结
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Veröffentlicht am</span>
            <time itemprop="dateCreated" datetime="2014-10-26T01:40:00+08:00" content="2014-10-26">
              2014-10-26
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>这上半年的总结，其实也就是这两个月的总结。3月后，项目组由于人员离职，也就剩下我一个人，那时候也处于部门合并和新顶头上司的变换中。4月5月也非常忙，一个人把V0.5BETA版本做了发布前的最后调整。这项目往返的比较严重，确实让人疲劳，也一个人做的事情太杂，其实工作状态并不好。<br>    接着4月发布后，做了一次小型的重构，重构后让原来的设计更加灵活了一些，加班加点完成了这部分重构后开始了一段轻松的旅途，10天时间，5个城市，有点赶，但是魔都的迷幻、西塘水乡的惬意、苏州园林的精致、南京古都的庄严、雨后西湖的美轮美奂、灵隐寺的大气磅礴，未尝想过，夏天，没有想象中江南的细雨，但有着这么多不同风格的美景，加上旁边的挚爱的伴侣，真是让人乐不思蜀。<br>    回来后瞎折腾一个月，主要还是产品的方向、需求的打磨、进度的计划等，这段时间总之效率不高，一是还沉浸在那段旅途回忆中，另是事情太杂方向比较迷茫，确实比较力不从心。<br>    7月后项目组又兵强马壮了，重装再发。开始了产品V0.6版本的开发，这段时间确实比较多总结的。资源竞争等外因确实影响着我们，但这总结主要从自身出发，以下是我总结的几个点：</p>
<ul>
<li>其实，界面设计、交互设计、架构设计、模块设计都很难在开始的时候就做的周全，在开始就去追求一份最适合的答案，那必然是花费非常多的人力物力，并且到最后会有角度的设计是冗余的。因此，我们应该多在开发的过程中去思考，随着Sprint的进展，所掌握的知识也越充分，把自己负责的模块仔细考虑。这阶段整个项目组对这点做的很不到位，原因大致一是业务不足，二是缺少思考，三是进度太紧。等到测试阶段才发现设计问题，那重构的代价就比开发阶段大大提升了；</li>
<li>功能耦合较严重，其实在后台已经在代码设计上做到解耦，但是功能要做的比较有引导性，就容易将业务上有关系的模块揉在一起，那就导致很多地方可能改了一个问题，又出现一个问题，或者是改了一个问题，漏了一个问题，也就是我说的拆了东墙补西墙，拆了东墙漏西墙；</li>
<li>项目周期拉的太长了，让人疲劳，最好是能把Sprint压缩在3个工作周内，又不会无法完成完整功能，又不会时间太长；</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2014/09/03/2014-09-03-explore-the-browser-side-events-a-an-event-event-flow-profile-add-events/" itemprop="url">
                  浏览器端的事件探秘（一）---事件事件流简介、事件添加方式
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Veröffentlicht am</span>
            <time itemprop="dateCreated" datetime="2014-09-03T13:17:00+08:00" content="2014-09-03">
              2014-09-03
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">in</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/javascript/" itemprop="url" rel="index">
                    <span itemprop="name">javascript</span>
                  </a>
                </span>

                
                
                  . 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/javascript/事件流/" itemprop="url" rel="index">
                    <span itemprop="name">事件流</span>
                  </a>
                </span>

                
                
                  . 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/javascript/事件流/事件/" itemprop="url" rel="index">
                    <span itemprop="name">事件</span>
                  </a>
                </span>

                
                
                  . 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/javascript/事件流/事件/事件冒泡/" itemprop="url" rel="index">
                    <span itemprop="name">事件冒泡</span>
                  </a>
                </span>

                
                
                  . 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/javascript/事件流/事件/事件冒泡/添加事件方式/" itemprop="url" rel="index">
                    <span itemprop="name">添加事件方式</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Javascript的事件"><a href="#Javascript的事件" class="headerlink" title="Javascript的事件"></a>Javascript的事件</h2><p>#1 事件冒泡</p>
<h2 id="1-1-事件"><a href="#1-1-事件" class="headerlink" title="1.1 事件"></a>1.1 事件</h2><p>在IE4以后，浏览器的开发团队就开始给页面的每个部分都设定了特定的事件。多到鼠标点击，简单到鼠标滑过，甚至敲击键盘都会有特定的事件。</p>
<h2 id="1-2-事件流"><a href="#1-2-事件流" class="headerlink" title="1.2 事件流"></a>1.2 事件流</h2><p>如下图，点击页面的一部分DIV3的时候，那么浏览器就认为你点击这按钮的同时，也点击了这个按钮所在的容器。这个过程就是一个事件流。<br><img src="http://chuantu.biz/t/50/1409750064x1822611033.jpg" alt=""><br>事件描述的是从页面接受事件的顺序。IE的事件流方式是事件冒泡流，网景公司用的是事件捕获流。</p>
<h2 id="1-2-1-事件冒泡"><a href="#1-2-1-事件冒泡" class="headerlink" title="# 1.2.1 事件冒泡"></a># 1.2.1 事件冒泡</h2><p>即事件最开始有最具体的元素（文档中的嵌套层次最深的元素）接收，然后逐级上传到最不具体的元素（文档）。<br>比如下面这个程序，当你点按钮的时候，也会认为你点了div，然后在认为你点了body，然后又认为你点了html，然后在认为你点了document。<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"Content-Type"</span> <span class="attr">content</span>=<span class="string">"text/html;charset=utf-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>事件流<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="undefined"></span></div><div class="line"><span class="javascript">        <span class="function"><span class="keyword">function</span> <span class="title">showMsg</span>(<span class="params">txt</span>)</span>&#123;</span></div><div class="line"><span class="undefined">            alert(txt)</span></div><div class="line"><span class="undefined">        &#125;</span></div><div class="line"><span class="undefined"></span></div><div class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"box"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"按钮"</span> <span class="attr">id</span>=<span class="string">"btn"</span> <span class="attr">onclick</span>=<span class="string">"showMsg('按钮')"</span> /&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span></span></div></pre></td></tr></table></figure></p>
<h2 id="1-2-2-事件捕获"><a href="#1-2-2-事件捕获" class="headerlink" title="# 1.2.2 事件捕获"></a># 1.2.2 事件捕获</h2><p>不太具体的应该更早的接受到事件，具体的应该是最后接受到的。上面例子，document就是最先接收，最后是按钮。</p>
<h2 id="1-3-事件添加方法"><a href="#1-3-事件添加方法" class="headerlink" title="1.3 事件添加方法"></a>1.3 事件添加方法</h2><h2 id="1-3-1-html事件"><a href="#1-3-1-html事件" class="headerlink" title="# 1.3.1 html事件"></a># 1.3.1 html事件</h2><p>上述代码就是一个html事件，html事件会导致html代码和javascript代码连接过紧，如果修改javascript代码的函数名，那么也要同学修改html。</p>
<h2 id="1-3-2-DOM0级事件处理程序"><a href="#1-3-2-DOM0级事件处理程序" class="headerlink" title="# 1.3.2 DOM0级事件处理程序"></a># 1.3.2 DOM0级事件处理程序</h2><p>好处：简单，跨浏览器。<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"Content-Type"</span> <span class="attr">content</span>=<span class="string">"text/html;charset=utf-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>事件流<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="undefined"></span></div><div class="line"><span class="javascript">        <span class="function"><span class="keyword">function</span> <span class="title">init</span>(<span class="params"></span>)</span>&#123;</span></div><div class="line"><span class="javascript">            <span class="keyword">var</span> btn1 = <span class="built_in">document</span>.getElementById(<span class="string">"btn"</span>)</span></div><div class="line"><span class="javascript">            btn1.onclick=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></div><div class="line"><span class="javascript">                showMsg(<span class="keyword">this</span>.getAttribute(<span class="string">"value"</span>))</span></div><div class="line"><span class="undefined">            &#125;</span></div><div class="line"><span class="javascript">            <span class="keyword">var</span> btn2 = <span class="built_in">document</span>.getElementById(<span class="string">"btn2"</span>)</span></div><div class="line"><span class="javascript">            btn2.onclick=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></div><div class="line"><span class="javascript">                showMsg(<span class="keyword">this</span>.getAttribute(<span class="string">"value"</span>))</span></div><div class="line"><span class="javascript">                btn2.onclick = <span class="literal">null</span></span></div><div class="line"><span class="undefined">            &#125;</span></div><div class="line"><span class="undefined">        &#125;</span></div><div class="line"><span class="javascript">        <span class="function"><span class="keyword">function</span> <span class="title">showMsg</span>(<span class="params">txt</span>)</span>&#123;</span></div><div class="line"><span class="undefined">            alert(txt)</span></div><div class="line"><span class="undefined">        &#125;</span></div><div class="line"><span class="undefined"></span></div><div class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">onload</span>=<span class="string">"init()"</span> &gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"box"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"按钮"</span> <span class="attr">id</span>=<span class="string">"btn"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"按钮2"</span> <span class="attr">id</span>=<span class="string">"btn2"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure></p>
<h2 id="1-3-3-DOM2级事件处理"><a href="#1-3-3-DOM2级事件处理" class="headerlink" title="# 1.3.3 DOM2级事件处理"></a># 1.3.3 DOM2级事件处理</h2><p>定义了2个方法，用于处理指定和删除事件处理程序的操作。分别为addEventListener()和removeEventListener()。接受3个参数：要处理的事件名、作为事件处理程序的函数和布尔值（true是事件捕获，false是事件冒泡）。<br>addEventListener添加的事件只能通过removeEventListener来删除，且参数一致。<br>详细参考如下代码：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">&lt;html&gt;</div><div class="line">&lt;head&gt;</div><div class="line">    &lt;meta http-equiv=<span class="string">"Content-Type"</span> content=<span class="string">"text/html;charset=utf-8"</span>&gt;</div><div class="line">    &lt;title&gt;事件流&lt;<span class="regexp">/title&gt;</span></div><div class="line"><span class="regexp">    &lt;script type="text/</span>javascript<span class="string">"&gt;</span></div><div class="line"><span class="string">        function init()&#123;</span></div><div class="line"><span class="string">            var btn1 = document.getElementById("</span>btn<span class="string">")</span></div><div class="line"><span class="string">            btn1.addEventListener('click',clickBtn,false)</span></div><div class="line"><span class="string">            var btn2 = document.getElementById("</span>btn2<span class="string">")</span></div><div class="line"><span class="string">            btn2.addEventListener('click',clickBtn,false)</span></div><div class="line"><span class="string">            btn2.addEventListener('click',function()&#123;</span></div><div class="line"><span class="string">                btn2.removeEventListener('click',clickBtn,false)</span></div><div class="line"><span class="string">            &#125;,false)</span></div><div class="line"><span class="string">        &#125;</span></div><div class="line"><span class="string">        function clickBtn()&#123;</span></div><div class="line"><span class="string">            showMsg(this.getAttribute("</span>value<span class="string">"))</span></div><div class="line"><span class="string">        &#125;</span></div><div class="line"><span class="string">        function showMsg(txt)&#123;</span></div><div class="line"><span class="string">            alert(txt)</span></div><div class="line"><span class="string">        &#125;</span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string">    &lt;/script&gt;</span></div><div class="line"><span class="string">&lt;/head&gt;</span></div><div class="line"><span class="string">&lt;body onload="</span>init()<span class="string">" &gt;</span></div><div class="line"><span class="string">    &lt;div id="</span>box<span class="string">"&gt;</span></div><div class="line"><span class="string">        &lt;input type="</span>button<span class="string">" value="</span>按钮<span class="string">" id="</span>btn<span class="string">"/&gt;</span></div><div class="line"><span class="string">        &lt;input type="</span>button<span class="string">" value="</span>按钮<span class="number">2</span><span class="string">" id="</span>btn2<span class="string">"/&gt;</span></div><div class="line"><span class="string">    &lt;/div&gt;</span></div><div class="line"><span class="string">&lt;/body&gt;</span></div><div class="line"><span class="string">&lt;/html&gt;</span></div></pre></td></tr></table></figure></p>
<p>DOM2级还有一个好处就是可以给模块增加多个点击事件。如上btn2，就添加了多个click事件。</p>
<h2 id="1-3-4-IE事件处理程序"><a href="#1-3-4-IE事件处理程序" class="headerlink" title="# 1.3.4 IE事件处理程序"></a># 1.3.4 IE事件处理程序</h2><p>定义了2个方法，用于处理指定和删除事件处理程序的操作。分别为attachEvent ()和detachEvent ()。接受2个参数：要处理的事件名、作为事件处理程序的函数，事件处理方式就是冒泡。<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"Content-Type"</span> <span class="attr">content</span>=<span class="string">"text/html;charset=utf-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>事件流<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="undefined"></span></div><div class="line"><span class="javascript">        <span class="function"><span class="keyword">function</span> <span class="title">init</span>(<span class="params"></span>)</span>&#123;</span></div><div class="line"><span class="javascript">            <span class="keyword">var</span> btn1 = <span class="built_in">document</span>.getElementById(<span class="string">"btn"</span>)</span></div><div class="line"><span class="javascript">            btn1.attachEvent(<span class="string">'onclick'</span>,clickBtn)</span></div><div class="line"><span class="javascript">            <span class="keyword">var</span> btn2 = <span class="built_in">document</span>.getElementById(<span class="string">"btn2"</span>)</span></div><div class="line"><span class="javascript">            btn2.attachEvent(<span class="string">'onclick'</span>,clickBtn)</span></div><div class="line"><span class="javascript">            btn2.attachEvent(<span class="string">'onclick'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></div><div class="line"><span class="javascript">                btn2.detachEvent(<span class="string">'onclick'</span>,clickBtn)</span></div><div class="line"><span class="undefined">            &#125;)</span></div><div class="line"><span class="undefined">        &#125;</span></div><div class="line"><span class="javascript">        <span class="function"><span class="keyword">function</span> <span class="title">clickBtn</span>(<span class="params"></span>)</span>&#123;</span></div><div class="line"><span class="javascript">            showMsg(<span class="keyword">this</span>.value)</span></div><div class="line"><span class="javascript">            <span class="comment">//this.getAttribute("value")</span></span></div><div class="line"><span class="undefined">        &#125;</span></div><div class="line"><span class="javascript">        <span class="function"><span class="keyword">function</span> <span class="title">showMsg</span>(<span class="params">txt</span>)</span>&#123;</span></div><div class="line"><span class="undefined">            alert(txt)</span></div><div class="line"><span class="undefined">        &#125;</span></div><div class="line"><span class="undefined"></span></div><div class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">onload</span>=<span class="string">"init()"</span> &gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"box"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"按钮"</span> <span class="attr">id</span>=<span class="string">"btn"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"按钮2"</span> <span class="attr">id</span>=<span class="string">"btn2"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure></p>
<h2 id="1-3-5-跨浏览器事件处理"><a href="#1-3-5-跨浏览器事件处理" class="headerlink" title="# 1.3.5 跨浏览器事件处理"></a># 1.3.5 跨浏览器事件处理</h2><p>那就要做能力处理判断，那最好把这种处理放在一个对象中。<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"Content-Type"</span> <span class="attr">content</span>=<span class="string">"text/html;charset=utf-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>事件流<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="undefined"></span></div><div class="line"><span class="javascript">        <span class="function"><span class="keyword">function</span> <span class="title">EventUtil</span>(<span class="params"></span>)</span>&#123;</span></div><div class="line"><span class="undefined">        &#125;</span></div><div class="line"><span class="javascript">        EventUtil.prototype.addHandler = <span class="function"><span class="keyword">function</span>(<span class="params">element,type,handler</span>)</span>&#123;</span></div><div class="line"><span class="javascript">            <span class="keyword">if</span>(element.addEventListener)&#123;</span></div><div class="line"><span class="javascript">                element.addEventListener(type,handler,<span class="literal">false</span>);</span></div><div class="line"><span class="javascript">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(element.attachEvent)&#123;</span></div><div class="line"><span class="javascript">                element.attachEvent(<span class="string">'on'</span>+type,handler);</span></div><div class="line"><span class="javascript">            &#125;<span class="keyword">else</span>&#123;</span></div><div class="line"><span class="javascript">                <span class="comment">//在javascript中，所有用点的地方都能用中刮号</span></span></div><div class="line"><span class="javascript">                element[<span class="string">'on'</span>+type] = handler;</span></div><div class="line"><span class="undefined">            &#125;</span></div><div class="line"><span class="undefined">        &#125;</span></div><div class="line"><span class="javascript">        EventUtil.prototype.removeHandler = <span class="function"><span class="keyword">function</span>(<span class="params">element,type,handler</span>)</span>&#123;</span></div><div class="line"><span class="javascript">            <span class="keyword">if</span>(element.removeEventListener)&#123;</span></div><div class="line"><span class="javascript">                element.removeEventListener(type,handler,<span class="literal">false</span>);</span></div><div class="line"><span class="javascript">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(element.detachEvent)&#123;</span></div><div class="line"><span class="javascript">                element.detachEvent(<span class="string">'on'</span>+type,handler);</span></div><div class="line"><span class="javascript">            &#125;<span class="keyword">else</span>&#123;</span></div><div class="line"><span class="javascript">                <span class="comment">//在javascript中，所有用点的地方都能用中刮号</span></span></div><div class="line"><span class="javascript">                element[<span class="string">'on'</span>+type] = <span class="literal">null</span>;</span></div><div class="line"><span class="undefined">            &#125;</span></div><div class="line"><span class="undefined">        &#125;</span></div><div class="line"><span class="javascript">        <span class="function"><span class="keyword">function</span> <span class="title">init</span>(<span class="params"></span>)</span>&#123;</span></div><div class="line"><span class="javascript">            <span class="keyword">var</span> eventUtil = <span class="keyword">new</span> EventUtil();</span></div><div class="line"><span class="javascript">            <span class="keyword">var</span> btn1 = <span class="built_in">document</span>.getElementById(<span class="string">"btn"</span>)</span></div><div class="line"><span class="javascript">            eventUtil.addHandler(btn1,<span class="string">'click'</span>,clickBtn)</span></div><div class="line"><span class="javascript">            <span class="keyword">var</span> btn2 = <span class="built_in">document</span>.getElementById(<span class="string">"btn2"</span>)</span></div><div class="line"><span class="javascript">            eventUtil.addHandler(btn2,<span class="string">'click'</span>,clickBtn)</span></div><div class="line"><span class="javascript">            eventUtil.addHandler(btn2,<span class="string">'click'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></div><div class="line"><span class="javascript">                eventUtil.removeHandler(btn2,<span class="string">'click'</span>,clickBtn)</span></div><div class="line"><span class="undefined">            &#125;)</span></div><div class="line"><span class="undefined">        &#125;</span></div><div class="line"><span class="javascript">        <span class="function"><span class="keyword">function</span> <span class="title">clickBtn</span>(<span class="params"></span>)</span>&#123;</span></div><div class="line"><span class="javascript">            <span class="keyword">if</span>(<span class="keyword">this</span>.value)&#123;</span></div><div class="line"><span class="javascript">                showMsg(<span class="keyword">this</span>.value)</span></div><div class="line"><span class="javascript">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="keyword">this</span>.attributes)&#123;</span></div><div class="line"><span class="javascript">                showMsg(<span class="keyword">this</span>.attributes[<span class="string">"value"</span>])</span></div><div class="line"><span class="javascript">            &#125; <span class="keyword">else</span>&#123;</span></div><div class="line"><span class="javascript">                showMsg(<span class="string">"Hello World"</span>)</span></div><div class="line"><span class="undefined">            &#125;</span></div><div class="line"><span class="undefined"></span></div><div class="line"><span class="javascript">            <span class="comment">//this.getAttribute("value")</span></span></div><div class="line"><span class="undefined">        &#125;</span></div><div class="line"><span class="javascript">        <span class="function"><span class="keyword">function</span> <span class="title">showMsg</span>(<span class="params">txt</span>)</span>&#123;</span></div><div class="line"><span class="undefined">            alert(txt)</span></div><div class="line"><span class="undefined">        &#125;</span></div><div class="line"><span class="undefined"></span></div><div class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">onload</span>=<span class="string">"init()"</span> &gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"box"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"按钮"</span> <span class="attr">id</span>=<span class="string">"btn"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"按钮2"</span> <span class="attr">id</span>=<span class="string">"btn2"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2014/09/02/2014-09-02-refactoring-code-example/" itemprop="url">
                  重构-代码示例
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Veröffentlicht am</span>
            <time itemprop="dateCreated" datetime="2014-09-02T13:58:00+08:00" content="2014-09-02">
              2014-09-02
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">in</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/重构/" itemprop="url" rel="index">
                    <span itemprop="name">重构</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>#Round.1案例<br>这里的案例是从重构这本书上直接拿来的，但是我通过不同的理解，做了些不一样的重构，总在先上源码。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Movie</span> </span>&#123;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> CHILDRENS = <span class="number">2</span>;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> NEW_RELEASE = <span class="number">1</span>;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> REGULAR = <span class="number">0</span>;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> String _title;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> _priceCode;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Movie</span><span class="params">(String title, <span class="keyword">int</span> priceCode)</span> </span>&#123;</div><div class="line">        _title = title;</div><div class="line">        _priceCode = priceCode;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getPriceCode</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> _priceCode;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPriceCode</span><span class="params">(<span class="keyword">int</span> arg)</span> </span>&#123;</div><div class="line">        _priceCode = arg;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getTitle</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> _title;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Rental</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> Movie _movie;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> _daysRented;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Rental</span><span class="params">(Movie movie, <span class="keyword">int</span> daysRented)</span> </span>&#123;</div><div class="line">        _movie = movie;</div><div class="line">        _daysRented = daysRented;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getDaysRented</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> _daysRented;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> Movie <span class="title">getMovie</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> _movie;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Customer</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> String _name;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> List&lt;Rental_rentals = <span class="keyword">new</span> ArrayList&lt;Rental&gt;();</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Customer</span><span class="params">(String name)</span> </span>&#123;</div><div class="line">        _name = name;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addRental</span><span class="params">(Rental arg)</span> </span>&#123;</div><div class="line">        _rentals.add(arg);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> _name;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">statement</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">double</span> totalAmount = <span class="number">0</span>;</div><div class="line">        <span class="keyword">int</span> frequentRenterPoints = <span class="number">0</span>;</div><div class="line">        String result = <span class="string">"Rental record for "</span> + getName() + <span class="string">"\n"</span>;</div><div class="line"></div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> index = <span class="number">0</span>; index &lt; _rentals.size(); index++) &#123;</div><div class="line">            <span class="keyword">double</span> thisAmount = <span class="number">0</span>;</div><div class="line">            Rental each = (Rental) _rentals.get(index);</div><div class="line"></div><div class="line">            <span class="keyword">switch</span> (each.getMovie().getPriceCode()) &#123;</div><div class="line">            <span class="keyword">case</span> Movie.REGULAR:</div><div class="line">                thisAmount += <span class="number">2</span>;</div><div class="line">                <span class="keyword">if</span> (each.getDaysRented() <span class="number">2</span>)</div><div class="line">                    thisAmount += (each.getDaysRented() - <span class="number">2</span>) * <span class="number">1.5</span>;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> Movie.NEW_RELEASE:</div><div class="line">                thisAmount += each.getDaysRented() * <span class="number">3</span>;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> Movie.CHILDRENS:</div><div class="line">                thisAmount += <span class="number">1.5</span>;</div><div class="line">                <span class="keyword">if</span> (each.getDaysRented() <span class="number">3</span>)</div><div class="line">                    thisAmount += (each.getDaysRented() - <span class="number">3</span>) * <span class="number">1.5</span>;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            &#125;</div><div class="line">            frequentRenterPoints++;</div><div class="line">            <span class="keyword">if</span> (each.getMovie().getPriceCode() == Movie.NEW_RELEASE</div><div class="line">                    &amp;&amp; each.getDaysRented() <span class="number">1</span>)</div><div class="line">                frequentRenterPoints++;</div><div class="line"></div><div class="line">            result += <span class="string">"\t"</span> + each.getMovie().getTitle() + <span class="string">"\t"</span></div><div class="line">                    + String.valueOf(thisAmount) + <span class="string">"\n"</span>;</div><div class="line">            totalAmount += thisAmount;</div><div class="line">        &#125;</div><div class="line">        result += <span class="string">"Amount owed is "</span> + String.valueOf(totalAmount) + <span class="string">"\n"</span>;</div><div class="line">        result += <span class="string">"You earned "</span> + String.valueOf(frequentRenterPoints)</div><div class="line">                + <span class="string">"frequent renter points"</span>;</div><div class="line">        <span class="keyword">return</span> result;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Cp1Demo1</span></span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        Customer cuntomer = <span class="keyword">new</span> Customer(<span class="string">"David"</span>);</div><div class="line">        cuntomer.addRental(<span class="keyword">new</span> Rental(<span class="keyword">new</span> Movie(<span class="string">"Lost Template"</span>, Movie.NEW_RELEASE), <span class="number">5</span>));</div><div class="line">        cuntomer.addRental(<span class="keyword">new</span> Rental(<span class="keyword">new</span> Movie(<span class="string">"The Great Gatsby"</span>, Movie.REGULAR), <span class="number">4</span>));</div><div class="line">        cuntomer.addRental(<span class="keyword">new</span> Rental(<span class="keyword">new</span> Movie(<span class="string">"Wolf and Sheep"</span>, Movie.CHILDRENS), <span class="number">2</span>));</div><div class="line">        cuntomer.addRental(<span class="keyword">new</span> Rental(<span class="keyword">new</span> Movie(<span class="string">"Star Trek"</span>, Movie.REGULAR), <span class="number">2</span>));</div><div class="line">        System.out.println(cuntomer.statement());</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>#Round.2 让代码变得可测试（增加单元测试）<br>首先，先改造Customer类，让statement中的核心计算方法（算价格和算积分的方法）抽出。<br><figure class="highlight java"><figcaption><span>Customer.java</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Customer</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> String name;</div><div class="line"></div><div class="line">    <span class="comment">//......省略部分代码</span></div><div class="line"></div><div class="line">    <span class="comment">//去除statement和main部分</span></div><div class="line"></div><div class="line">    <span class="comment">//对于statement中的方法，抽出两个关键的核心方法</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">amountTotalConsume</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">double</span> totalAmount = <span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> index = <span class="number">0</span>; index &lt; getRentals().size(); index++) &#123;</div><div class="line">            <span class="keyword">double</span> thisAmount = <span class="number">0</span>;</div><div class="line">            Rental each = (Rental) getRentals().get(index);</div><div class="line"></div><div class="line">            <span class="keyword">switch</span> (each.getMovie().getPriceCode()) &#123;</div><div class="line">            <span class="keyword">case</span> Movie.REGULAR:</div><div class="line">                thisAmount += <span class="number">2</span>;</div><div class="line">                <span class="keyword">if</span> (each.getDaysRented() <span class="number">2</span>)</div><div class="line">                    thisAmount += (each.getDaysRented() - <span class="number">2</span>) * <span class="number">1.5</span>;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> Movie.NEW_RELEASE:</div><div class="line">                thisAmount += each.getDaysRented() * <span class="number">3</span>;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> Movie.CHILDRENS:</div><div class="line">                thisAmount += <span class="number">1.5</span>;</div><div class="line">                <span class="keyword">if</span> (each.getDaysRented() <span class="number">3</span>)</div><div class="line">                    thisAmount += (each.getDaysRented() - <span class="number">3</span>) * <span class="number">1.5</span>;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            &#125;</div><div class="line">            <span class="comment">// 日志</span></div><div class="line">            System.out.println(<span class="string">"\t"</span> + each.getMovie().getTitle() + <span class="string">"\t"</span></div><div class="line">                    + String.valueOf(thisAmount));</div><div class="line">            totalAmount += thisAmount;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> totalAmount;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">countFrequentRenterPoints</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> frequentRenterPoints = <span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> index = <span class="number">0</span>; index &lt; getRentals().size(); index++) &#123;</div><div class="line">            Rental each = (Rental) getRentals().get(index);</div><div class="line"></div><div class="line">            frequentRenterPoints++;</div><div class="line">            <span class="keyword">if</span> (each.getMovie().getPriceCode() == Movie.NEW_RELEASE</div><div class="line">                    &amp;&amp; each.getDaysRented() <span class="number">1</span>)</div><div class="line">                frequentRenterPoints++;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> frequentRenterPoints;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>抽出后，也留有打印信息的事务入口，将入口创建一个新的类CustomerConsumeClinent<br><figure class="highlight java"><figcaption><span>CustomerConsumeClinent.java</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomerConsumeClinent</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">statement</span><span class="params">(Customer customer)</span> </span>&#123;</div><div class="line">        System.out.println(<span class="string">"Rental record for "</span> + customer.getName());</div><div class="line">        StringBuilder resultSb = <span class="keyword">new</span> StringBuilder();</div><div class="line">        resultSb.append(<span class="string">"Amount owed is "</span>)</div><div class="line">                .append(String.valueOf(customer.amountTotalConsume()))</div><div class="line">                .append(<span class="string">"\n"</span>).append(<span class="string">"You earned "</span>)</div><div class="line">                .append(String.valueOf(customer.countFrequentRenterPoints()))</div><div class="line">                .append(<span class="string">" frequent renter points"</span>);</div><div class="line">        <span class="keyword">return</span> resultSb.toString();</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        Customer customer = <span class="keyword">new</span> Customer(<span class="string">"David"</span>);</div><div class="line">        customer.addRental(<span class="keyword">new</span> Rental(<span class="keyword">new</span> Movie(<span class="string">"Lost Template"</span>,</div><div class="line">                Movie.NEW_RELEASE), <span class="number">2</span>));</div><div class="line">        customer.addRental(<span class="keyword">new</span> Rental(<span class="keyword">new</span> Movie(<span class="string">"Lost Template2"</span>,</div><div class="line">                Movie.NEW_RELEASE), <span class="number">2</span>));</div><div class="line">        customer.addRental(<span class="keyword">new</span> Rental(<span class="keyword">new</span> Movie(<span class="string">"The Great Gatsby"</span>,</div><div class="line">                Movie.REGULAR), <span class="number">2</span>));</div><div class="line">        customer.addRental(<span class="keyword">new</span> Rental(<span class="keyword">new</span> Movie(<span class="string">"Wolf and Sheep"</span>,</div><div class="line">                Movie.CHILDRENS), <span class="number">2</span>));</div><div class="line">        customer.addRental(<span class="keyword">new</span> Rental(<span class="keyword">new</span> Movie(<span class="string">"Star Trek"</span>, Movie.REGULAR), <span class="number">2</span>));</div><div class="line">        System.out.println(<span class="keyword">new</span> CustomerConsumeClinent().statement(customer));</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>然后添加单元测试，这里使用的是Junit4加上cucumber-java（Ruby中cucumber的java版本）进行BDD。<br>先修改maven的配置文件。<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></div><div class="line"><span class="tag">	<span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd"</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.david.codejourney<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>refactoring-book<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line"></div><div class="line">	<span class="tag">&lt;<span class="name">build</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">plugins</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">plugin</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">version</span>&gt;</span>2.5.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">configuration</span>&gt;</span></div><div class="line">					<span class="tag">&lt;<span class="name">encoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">encoding</span>&gt;</span></div><div class="line">					<span class="tag">&lt;<span class="name">source</span>&gt;</span>1.6<span class="tag">&lt;/<span class="name">source</span>&gt;</span></div><div class="line">					<span class="tag">&lt;<span class="name">target</span>&gt;</span>1.6<span class="tag">&lt;/<span class="name">target</span>&gt;</span></div><div class="line">				<span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></div><div class="line">			<span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></div><div class="line"></div><div class="line">			<span class="tag">&lt;<span class="name">plugin</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-surefire-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">version</span>&gt;</span>2.12.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">configuration</span>&gt;</span></div><div class="line">					<span class="tag">&lt;<span class="name">useFile</span>&gt;</span>false<span class="tag">&lt;/<span class="name">useFile</span>&gt;</span></div><div class="line">				<span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></div><div class="line">			<span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">build</span>&gt;</span></div><div class="line"></div><div class="line">	<span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>info.cukes<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cucumber-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>info.cukes<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cucumber-junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.rubiconproject.oss<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jchronic<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">version</span>&gt;</span>0.2.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">version</span>&gt;</span>4.11<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">properties</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">file.encoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">file.encoding</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">properties</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>然后写功能描述文件，也就是单元测试的依据。这里不详细说明cucumber如何使用，有兴趣的自己去搜索相关知识再来看这部分代码，没兴趣的就跳过，知道他是在单元测试就好。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">Feature: Refactoring Book</div><div class="line">  In order to study.</div><div class="line"></div><div class="line">  Scenario Outline: potter tests</div><div class="line">    Given Init the customer</div><div class="line">    And customer rental &lt;number of 1st moviedays of REGULAR movie</div><div class="line">    And customer rental &lt;number of 2nd moviedays of REGULAR movie</div><div class="line">    And customer rental &lt;number of 3rd moviedays of NEW_RELEASE movie</div><div class="line">    And customer rental &lt;number of 4th moviedays of NEW_RELEASE movie</div><div class="line">    And customer rental &lt;number of 5th moviedays of REGULAR movie</div><div class="line">    When I calculate the price and point</div><div class="line">    Then I should get the lowest price &lt;total amountand frequent points &lt;frequent renter points&gt;</div><div class="line"></div><div class="line">  Examples: test basics</div><div class="line">    | number of 1st movie| number of 2nd movie| number of 3rd movie| number of 4th movie| number of 5th movie| total amount | frequent renter points |</div><div class="line">    |         5          |           3        |           4        |         2          |          2         |       32.5   |           7            |</div><div class="line">    |         2          |           2        |           2        |         2          |          2         |       17.5   |           7            |</div><div class="line"></div><div class="line">  Examples: test simple discounts</div><div class="line">    | number of 1st movie| number of 2nd movie| number of 3rd movie| number of 4th movie| number of 5th movie| total amount | frequent renter points |</div><div class="line">    |         1          |           1        |           1        |         1          |          1         |       11.5   |           5            |</div></pre></td></tr></table></figure></p>
<p>然后写单元测试类，该类需要和前面的功能文件对应。<br><figure class="highlight java"><figcaption><span>RefactoringStepdefs.java</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RefactoringStepdefs</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> Customer customer;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> bookCount;</div><div class="line"></div><div class="line">    <span class="meta">@Given</span>(<span class="string">"^Init the customer$"</span>)</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> <span class="keyword">throws</span> Throwable </span>&#123;</div><div class="line">        customer = <span class="keyword">new</span> Customer(<span class="string">"David"</span>);</div><div class="line">        bookCount = <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Given</span>(<span class="string">"^customer rental (\\d+) days of (\\w+) movie$"</span>)</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">customerRentalMovieSimpleTest</span><span class="params">(<span class="keyword">int</span> days, String movieType)</span></span></div><div class="line"><span class="function">            <span class="keyword">throws</span> Throwable </span>&#123;</div><div class="line">        bookCount++;</div><div class="line">        customer.addRental(<span class="keyword">new</span> Rental(<span class="keyword">new</span> Movie(<span class="string">"Movie "</span> + bookCount, movieType</div><div class="line">                .equals(<span class="string">"REGULAR"</span>) ? <span class="number">0</span> : movieType.equals(<span class="string">"NEW_RELEASE"</span>) ? <span class="number">1</span></div><div class="line">                : <span class="number">2</span>), days));</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@When</span>(<span class="string">"^I calculate the price and point$"</span>)</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">calcAndCount</span><span class="params">()</span> <span class="keyword">throws</span> Throwable </span>&#123;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Then</span>(<span class="string">"I should get the lowest price (\\S+) and frequent points (\\d+)$"</span>)</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">I_should_get_the_lowest_price</span><span class="params">(<span class="keyword">double</span> totalAmout,</span></span></div><div class="line"><span class="function"><span class="params">            <span class="keyword">int</span> frequentRenterPoints)</span> <span class="keyword">throws</span> Throwable </span>&#123;</div><div class="line"></div><div class="line">        assertEquals(<span class="string">"failure - not the same with expected amout"</span>,</div><div class="line">                totalAmout, customer.amountTotalConsume(),<span class="number">5</span>);</div><div class="line">        assertEquals(<span class="string">"failure - not the same with expected point"</span>,</div><div class="line">                frequentRenterPoints, customer.countFrequentRenterPoints());</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>#Round.3 大胆的进行重构<br>现在已经有了单元测试的保证了，可以大胆进行重构了，按前篇博文中说到的进行。</p>
<h2 id="用简洁易懂的句法，控制一个函数类代码的数量，让一个函数只做一件事情"><a href="#用简洁易懂的句法，控制一个函数类代码的数量，让一个函数只做一件事情" class="headerlink" title="用简洁易懂的句法，控制一个函数类代码的数量，让一个函数只做一件事情"></a>用简洁易懂的句法，控制一个函数类代码的数量，让一个函数只做一件事情</h2><p>这个round2已经做了，不在让一个打印输出的方法，又同时做计算价格、统计积分等事情。</p>
<h2 id="修改变量名"><a href="#修改变量名" class="headerlink" title="修改变量名"></a>修改变量名</h2><p>这个较多地方都有问题，比如round1中的成员变量命名不是java的规范，全部重新写过。还比如遍历中用each作为变量名，很难表达变量的意思。</p>
<h2 id="相同的逻辑出现3次，抽方法"><a href="#相同的逻辑出现3次，抽方法" class="headerlink" title="相同的逻辑出现3次，抽方法"></a>相同的逻辑出现3次，抽方法</h2><p>这里功能比较简单，会重复出现的方法已经抽出来了，所以这里用不到该方法。</p>
<h2 id="一个类中的一个方法出现与另一个类进行更多的交流时，考虑搬移函数到该类中，然后该方法中直接调用该类的新方法"><a href="#一个类中的一个方法出现与另一个类进行更多的交流时，考虑搬移函数到该类中，然后该方法中直接调用该类的新方法" class="headerlink" title="一个类中的一个方法出现与另一个类进行更多的交流时，考虑搬移函数到该类中，然后该方法中直接调用该类的新方法"></a>一个类中的一个方法出现与另一个类进行更多的交流时，考虑搬移函数到该类中，然后该方法中直接调用该类的新方法</h2><p>这里对于每个Rental的计算积分和计算价格方法，都更应该移动到Rental中，因为看代码可以看到，他调用了很多次Rental的方法。<br>重构后的代码<br><figure class="highlight java"><figcaption><span>Customer.java</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Customer</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> String name;</div><div class="line">    <span class="keyword">private</span> List&lt;Rentalrentals = <span class="keyword">new</span> ArrayList&lt;Rental&gt;();</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Customer</span><span class="params">(String name)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.name = name;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addRental</span><span class="params">(Rental arg)</span> </span>&#123;</div><div class="line">        rentals.add(arg);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.name;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">public</span> List&lt;RentalgetRentals() &#123;</div><div class="line">        <span class="keyword">return</span> rentals;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">amountTotalConsume</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">double</span> result = <span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span> (Rental aRental : getRentals()) &#123;</div><div class="line">            result += aRental.getCharge();</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> result;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">countFrequentRenterPoints</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> frequentRenterPoints = <span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span> (Rental aRental : getRentals()) &#123;</div><div class="line">            frequentRenterPoints += aRental.getFrquentRenterPoints();</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> frequentRenterPoints;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight java"><figcaption><span>Rental.java</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Rental</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> Movie movie;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> daysRented;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Rental</span><span class="params">(Movie movie, <span class="keyword">int</span> daysRented)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.movie = movie;</div><div class="line">        <span class="keyword">this</span>.daysRented = daysRented;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getDaysRented</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.daysRented;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> Movie <span class="title">getMovie</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.movie;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getFrquentRenterPoints</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> frequentRenterPoints = <span class="number">0</span>;</div><div class="line">        frequentRenterPoints++;</div><div class="line">        <span class="keyword">if</span> (getMovie().getPriceCode() == Movie.NEW_RELEASE</div><div class="line">                &amp;&amp; getDaysRented() <span class="number">1</span>) &#123;</div><div class="line">            frequentRenterPoints++;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> frequentRenterPoints;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">getCharge</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">double</span> thisAmount = <span class="number">0</span>;</div><div class="line">        <span class="keyword">switch</span> (getMovie().getPriceCode()) &#123;</div><div class="line">        <span class="comment">// 这里的数量和定价策略可以先不改变，当增加新功能需要的时候</span></div><div class="line">        <span class="keyword">case</span> Movie.REGULAR:</div><div class="line">            thisAmount += <span class="number">2</span>;</div><div class="line">            <span class="keyword">if</span> (getDaysRented() <span class="number">2</span>)</div><div class="line">                thisAmount += (getDaysRented() - <span class="number">2</span>) * <span class="number">1.5</span>;</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        <span class="keyword">case</span> Movie.NEW_RELEASE:</div><div class="line">            thisAmount += getDaysRented() * <span class="number">3</span>;</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        <span class="keyword">case</span> Movie.CHILDRENS:</div><div class="line">            thisAmount += <span class="number">1.5</span>;</div><div class="line">            <span class="keyword">if</span> (getDaysRented() <span class="number">3</span>)</div><div class="line">                thisAmount += (getDaysRented() - <span class="number">3</span>) * <span class="number">1.5</span>;</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// 日志</span></div><div class="line">        System.out.println(<span class="string">"\t"</span> + getMovie().getTitle() + <span class="string">"\t"</span></div><div class="line">                + String.valueOf(thisAmount));</div><div class="line">        <span class="keyword">return</span> thisAmount;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight java"><figcaption><span>Movie.java</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Movie</span> </span>&#123;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> CHILDRENS = <span class="number">2</span>;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> NEW_RELEASE = <span class="number">1</span>;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> REGULAR = <span class="number">0</span>;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> String title;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> priceCode;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Movie</span><span class="params">(String title, <span class="keyword">int</span> priceCode)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.title = title;</div><div class="line">        <span class="keyword">this</span>.priceCode = priceCode;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getPriceCode</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.priceCode;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPriceCode</span><span class="params">(<span class="keyword">int</span> arg)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.priceCode = arg;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getTitle</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.title;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>重构完后，运行下单元测试，没问题，那么很好，完美收工。</p>
<p>#Round.4 如果发现增加一个功能很差，那么继续重构吧<br>一般情况下，做到第3步已经够了，第四部主要是说明，当你遇到新的需求，增加这个需求需要改动过大时候，那么说明代码的设计不够可维护可扩展可复用。<br>如下重构则为当需要增加一个类型，或者更改价格、积分计算策略时候的调整。</p>
<h2 id="开始重构，用多态替换逻辑判断"><a href="#开始重构，用多态替换逻辑判断" class="headerlink" title="开始重构，用多态替换逻辑判断"></a>开始重构，用多态替换逻辑判断</h2><p>首先，把getCharge与getFrquentRenterPoints方法移动到Movie中，因为我们需要用多态来代替逻辑状态判断。<br><figure class="highlight java"><figcaption><span>Rental.java</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Rental</span> </span>&#123;</div><div class="line">		<span class="comment">//...省略</span></div><div class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getFrquentRenterPoints</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> getMovie().getFrquentRenterPoints(daysRented);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">getCharge</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> getMovie().getCharge(daysRented);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight java"><figcaption><span>Movie.java</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Movie</span> </span>&#123;</div><div class="line">		<span class="comment">//...省略部分代码，然后把priceType变量替换成一个枚举类型的变量</span></div><div class="line">    <span class="keyword">private</span> MovieTypeEnum movieType;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Movie</span><span class="params">(String title, <span class="keyword">int</span> movieTypeCode)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.title = title;</div><div class="line">        movieType = MovieTypeEnum.convertByCode(String.valueOf(movieTypeCode));</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Movie</span><span class="params">(String title, String movieTypeName)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.title = title;</div><div class="line">        movieType = MovieTypeEnum.convertByName(movieTypeName);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getFrquentRenterPoints</span><span class="params">(<span class="keyword">int</span> daysRented)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> movieType.getFrquentRenterPoints(daysRented);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">getCharge</span><span class="params">(<span class="keyword">int</span> daysRented)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> movieType.getCharge(daysRented);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getPriceCode</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> Integer.valueOf(<span class="keyword">this</span>.movieType.getCode());</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPriceCode</span><span class="params">(<span class="keyword">int</span> movieTypeCode)</span> </span>&#123;</div><div class="line">        movieType = MovieTypeEnum.convertByCode(String.valueOf(movieTypeCode));</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> MovieTypeEnum <span class="title">getMovieType</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> movieType;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMovieType</span><span class="params">(MovieTypeEnum movieType)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.movieType = movieType;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getTitle</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.title;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="创建枚举"><a href="#创建枚举" class="headerlink" title="创建枚举"></a>创建枚举</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">enum</span> MovieTypeEnum &#123;</div><div class="line"><span class="comment">//这部分代码是我重构过程中犯下的低级错误，但是只要有单元测试，就能保证错误一旦出现，很快就能发现</span></div><div class="line"><span class="comment">//    CHILDRENS("2","CHILDRENS",new ChildrensPriceHandler(),new DefaultPointHandler()),</span></div><div class="line"><span class="comment">//    NEW_RELEASE("1","NEW_RELEASE",new ChildrensPriceHandler(),new DefaultPointHandler()),</span></div><div class="line"><span class="comment">//    REGULAR("0","REGULAR",new ChildrensPriceHandler(),new DefaultPointHandler());</span></div><div class="line"></div><div class="line">    CHILDRENS(<span class="string">"2"</span>,<span class="string">"CHILDRENS"</span>,<span class="keyword">new</span> ChildrensPriceHandler(),<span class="keyword">new</span> DefaultPointHandler()),</div><div class="line">    NEW_RELEASE(<span class="string">"1"</span>,<span class="string">"NEW_RELEASE"</span>,<span class="keyword">new</span> NewReleasePriceHandler(),<span class="keyword">new</span> NewReleasePointHandler()),</div><div class="line">    REGULAR(<span class="string">"0"</span>,<span class="string">"REGULAR"</span>,<span class="keyword">new</span> RegularPriceHandler(),<span class="keyword">new</span> DefaultPointHandler());</div><div class="line">    <span class="keyword">public</span> <span class="keyword">final</span> String code;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">final</span> String name;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">final</span> IPriceHandler priceHandler;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">final</span> IPointHandler pointHandler;</div><div class="line">    MovieTypeEnum(String code,String name,IPriceHandler priceHandler , IPointHandler pointHandler)&#123;</div><div class="line">        <span class="keyword">this</span>.code = code;</div><div class="line">        <span class="keyword">this</span>.name = name;</div><div class="line">        <span class="keyword">this</span>.priceHandler = priceHandler;</div><div class="line">        <span class="keyword">this</span>.pointHandler = pointHandler;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getCode</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> code;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> name;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> IPriceHandler <span class="title">getPriceHandler</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> priceHandler;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> IPointHandler <span class="title">getPointHandler</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> pointHandler;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getFrquentRenterPoints</span><span class="params">(<span class="keyword">int</span> daysRented)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> pointHandler.getFrquentRenterPoints(daysRented);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">getCharge</span><span class="params">(<span class="keyword">int</span> daysRented)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> priceHandler.getCharge(daysRented);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> MovieTypeEnum <span class="title">convertByCode</span><span class="params">(String code)</span></span>&#123;</div><div class="line">        <span class="keyword">if</span>(MovieTypeEnum.CHILDRENS.getCode().equals(code))&#123;</div><div class="line">            <span class="keyword">return</span> MovieTypeEnum.CHILDRENS;</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(MovieTypeEnum.NEW_RELEASE.getCode().equals(code))&#123;</div><div class="line">            <span class="keyword">return</span> MovieTypeEnum.NEW_RELEASE;</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(MovieTypeEnum.REGULAR.getCode().equals(code))&#123;</div><div class="line">            <span class="keyword">return</span> MovieTypeEnum.REGULAR;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> MovieTypeEnum <span class="title">convertByName</span><span class="params">(String name)</span></span>&#123;</div><div class="line">        <span class="keyword">if</span>(MovieTypeEnum.CHILDRENS.getName().equals(name))&#123;</div><div class="line">            <span class="keyword">return</span> MovieTypeEnum.CHILDRENS;</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(MovieTypeEnum.NEW_RELEASE.getName().equals(name))&#123;</div><div class="line">            <span class="keyword">return</span> MovieTypeEnum.NEW_RELEASE;</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(MovieTypeEnum.REGULAR.getName().equals(name))&#123;</div><div class="line">            <span class="keyword">return</span> MovieTypeEnum.REGULAR;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="处理器"><a href="#处理器" class="headerlink" title="处理器"></a>处理器</h2><p>这里分别实现了价格处理器和积分处理器，接口如下：<br><figure class="highlight java"><figcaption><span>IPointHandler.java</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IPointHandler</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getFrquentRenterPoints</span><span class="params">(<span class="keyword">int</span> daysRented)</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight java"><figcaption><span>IPriceHandler.java</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IPriceHandler</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">getCharge</span><span class="params">(<span class="keyword">int</span> daysRented)</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>具体处理器的实现这里就举一个例子，顺便看看同个处理逻辑两段代码的实现有多大差别。下面两段代码功能一样，代码前者多了那么多代码和临时变量。可以看出，写的优美的代码，不但易懂，而且优美。</p>
<figure class="highlight java"><figcaption><span>旧NewReleasePointHandler.java</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NewReleasePointHandler</span> <span class="keyword">extends</span> <span class="title">DefaultPointHandler</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getFrquentRenterPoints</span><span class="params">(<span class="keyword">int</span> daysRented)</span> </span>&#123;</div><div class="line">				<span class="keyword">int</span> frequentRenterPoints = <span class="number">1</span>;</div><div class="line">        <span class="keyword">if</span> (daysRented <span class="number">1</span>) &#123;</div><div class="line">            frequentRenterPoints++;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> frequentRenterPoints;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight java"><figcaption><span>新NewReleasePointHandler.java</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NewReleasePointHandler</span> <span class="keyword">extends</span> <span class="title">DefaultPointHandler</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getFrquentRenterPoints</span><span class="params">(<span class="keyword">int</span> daysRented)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> (daysRented <span class="number">1</span>) ? <span class="number">2</span> : <span class="number">1</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>运行单元而是，没问题，很好，又可以收工了（当然中间有出现错误，还有很多的调试）。</p>
<p>#Round.5 to be continue<br>重构不是一种状态，他是不断根据环境、需求、设计的变化去变化的。俗话说，只有变化是不变的，因此，重构一定会陪伴着整个软件过程，有了重构，也不用再怕这些变化了。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2014/08/26/2014-08-26-reconstruction-of-chatter/" itemprop="url">
                  闲扯重构
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Veröffentlicht am</span>
            <time itemprop="dateCreated" datetime="2014-08-26T09:26:00+08:00" content="2014-08-26">
              2014-08-26
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">in</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/设计/" itemprop="url" rel="index">
                    <span itemprop="name">设计</span>
                  </a>
                </span>

                
                
                  . 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/设计/重构/" itemprop="url" rel="index">
                    <span itemprop="name">重构</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>#为何要重构<br>最近，我经常思考一个问题，这个问题源自我一个做会计的朋友给我说“程序员有什么了不起的，写程序这种事情他们也会，他们经常也写一些程序、脚本来帮助他们工作。”<br>乔布斯就说过，每个人都应该学编程，他不仅能改变你的思维方式，还能帮助你的生活和工作。比如，我也帮女朋友写一些爬虫程序，帮他在互联网上抓一些数据。<br>这个问题思考后我觉得是这样的，程序员不仅仅是用编程语言来实现一个工具，而且这个工具是可维护、可移植、可复用、可维护、可扩展、可读的，就如最近公司的架构师交流会上讲师所说，编程就应该是一门艺术，你可以在别人的作品（代码、算法、设计）上微创新，做一些精进，还可以自己完成一幅大作。<br>因此，要让代码可维护、可移植、可复用、可维护、可扩展、可读的光是最好设计是不够的，还要不断的重构。</p>
<p>#代码的演进<br>（演进的方向一直是让代码可读、可维护、灵活等）</p>
<p>#从自身谈重构<br>重构并不是按照一个重构清单，一点一点的照做，而是一种感觉，比如，你感觉这段代码写了超过3次了，那你必须抽个方法出来；比如，你觉得在现有代码上增加一个功能不是那么容易了，那么，你也应该重新设计，让代码又可扩展性；比如，你在单元测试时候，觉得输入和输出不好写断言了，那么，你的代码相互直接的逻辑依赖就太深了，要做重构，最好让代码在语义上是可读的、函数式的（相同输入可以得到相同的输出，函数内部不改变全局环境）。</p>
<p>重构也不是一件一开始就要做的事情。初学编程时，总是浑浑噩噩的写代码，由于大学并不是很认真学习加上专业方向上是嵌入式，接触的大多数也是过程式的编程，写代码总是写写一些想一些。大四上的最后几个月才真正开始学Java，也慢慢会预先设计，这确实让我在开始时候节省返工的高昂成本，然后在大四下的实习时，我加强了这种预先设计的风格，而且滥用设计模式，很简单的一个模块一定要套上好几个设计模式。业内也有许多人把设计看做软件开发的关键环节，而编程只是搬砖，只是苦力活。<br>但是，慢慢的我又发现，有了设计我可以思考的很快，但是其中也充满了漏洞，在开发过程中和测试过程中还是要做很多设计上的返工，这意味着，在开始时候我要花更多的时间和经理在预先设计上，以避免日后的修改。我们总是在力求找到准确无误的解决方案，任何一个需求都让我们提心吊胆得猜疑。<br>这时候由于开始工作的公司是用敏捷开发的，我开始接触了很多敏捷思想，参加各种敏捷大会和沙龙，重构这想法也就在我耳边经常出现了。特别是XP的支持者们认为，可以完全由重构代替预先设计。<br>但是我觉得这太绝对了。如果你选择重构，你仍然要做预先设计，单不一定必须找到正确的解决方案，刺客你只需要得到一个足够合理的解决方案就够了。你肯定地知道，在实现这个初始解决方案的时候，你对问题的理解也会逐渐加深（项目管理课程中也提到，随着项目的实施，对项目的理解也会逐渐加深），你就会察觉到最佳解决方案和你当初想的有些不同，只要有重构在手，那这些也就不成问题，重构让日后的修改成本不再高昂。<br>这也是软件设计向简化前进了一大步。有一次敏捷大会上，一位讲师提到了极简（也就是乔布斯一直追求的，多一分太多，少一分太少），我觉得，通过重构也能让软件的设计达到极简的状态。<br>从此，我认为重构可以带来更简单的设计，同时又不损失灵活性，这也降低了设计过程的难度，减轻了设计压力。</p>
<p>但是，重构不是万能的银弹，如上面所说，只有当你嗅到了代码中的坏味道时候才会进行重构，这种坏味道，也就是上面说的一种感觉，只有轻松经历这种重构带来的美妙后，你就可以在感觉到这种不好的味道时候立马察觉。</p>
<p>#重构要注意什么，如何重构<br>个人觉得重构还有几个注意点：</p>
<ul>
<li>如果代码在绝大部分情况下都无法正常运行了，那就别重构了，重写吧；</li>
<li>在项目结尾阶段不要进行重构，特别是在单元测试不足的情况下；</li>
<li>对于重构后接口的调整，一般是保留原接口的基础上开放新接口，然后在原先接口上注释上不推荐时候。还有就是尽可能的推迟接口的发布，因为一旦发布，你就要考虑兼容旧的接口；</li>
<li>对于数据库，只能说架构设计阶段，就应该设计数据库持久化层和service层，让数据库和业务逻辑松耦合，然后通过mock的方式就做单元测试，保证相关代码重构后依然正常，也让数据库相关代码不在是侵入式的。</li>
</ul>
<p>对于初级的重构，个人认为注意以下几个点就好了：</p>
<ul>
<li>修改变量名，更改变量名称是值得的行为吗？绝对值得，好的代码应该清楚表达出自己的功能，变量名是代码清晰地关键。任何一个傻瓜都能写出计算机可以理解的代码，惟有写出人类容易理解的代码才是优秀的程序员 </li>
<li>用简洁易懂的句法，控制一个函数类代码的数量，让一个函数只做一件事情</li>
<li>相同逻辑代码出现3次，抽方法</li>
<li>一个类中的一个方法出现与另一个类进行更多的交流时，考虑搬移函数到该类中，然后该方法中直接调用该类的新方法</li>
<li>用多态代替过多的条件判断</li>
<li>将固定的逻辑封装在父类中，把不确定的逻辑用钩子方法（回调函数）描述，通过子类（调用者）实现</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2014/07/30/2014-07-30-some-javascript-features/" itemprop="url">
                  Javascript的一些特性
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Veröffentlicht am</span>
            <time itemprop="dateCreated" datetime="2014-07-30T01:57:00+08:00" content="2014-07-30">
              2014-07-30
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">in</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/javascript/" itemprop="url" rel="index">
                    <span itemprop="name">javascript</span>
                  </a>
                </span>

                
                
                  . 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/javascript/javascript/" itemprop="url" rel="index">
                    <span itemprop="name">javascript</span>
                  </a>
                </span>

                
                
                  . 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/javascript/javascript/prototype/" itemprop="url" rel="index">
                    <span itemprop="name">prototype</span>
                  </a>
                </span>

                
                
                  . 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/javascript/javascript/prototype/读书笔记/" itemprop="url" rel="index">
                    <span itemprop="name">读书笔记</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><strong>参考资料《node.js开发指南》，作者:Byoid</strong></p>
<h2 id="Javascript的一些特性"><a href="#Javascript的一些特性" class="headerlink" title="Javascript的一些特性"></a>Javascript的一些特性</h2><p>#1 作用域<br>如果习惯Java、C的编程语言，很容易对Javascript的作用域无法理解，比如下面代码，就会输出Hello David，因为JavaScript 的作用域完全是由函数来决定的，if、for 语句中的花括号不是独立的作用域。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> (<span class="literal">true</span>) &#123;</div><div class="line"><span class="keyword">var</span> name = <span class="string">'David'</span></div><div class="line">&#125;</div><div class="line"><span class="built_in">console</span>.log(<span class="string">'Hello '</span>+name) <span class="comment">// 输出 Hello David</span></div></pre></td></tr></table></figure></p>
<h2 id="1-1-函数作用域"><a href="#1-1-函数作用域" class="headerlink" title="1.1 函数作用域"></a>1.1 函数作用域</h2><p>Javascript的函数作用域，又是局部作用域。其他变成语言基本是通过花刮号或者缩进代码块来划定作用域，而Javascript的作用域通过函数来定义。当在一个函数中用到了某个变量的引用，那么会现在当前函数作用域中找，然后再去全局作用域中找。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">var name = &apos;David&apos;;</div><div class="line">var f1 = function() &#123;</div><div class="line">	console.log(name); // 输出 David</div><div class="line">&#125;;</div><div class="line">f1();</div><div class="line">var f2 = function() &#123;</div><div class="line">	var name = &apos;TangY&apos;;</div><div class="line">	console.log(name); // 输出 Tangy</div><div class="line">&#125;;</div><div class="line">f2();</div></pre></td></tr></table></figure></p>
<h2 id="1-1-1-嵌套函数作用域"><a href="#1-1-1-嵌套函数作用域" class="headerlink" title="# 1.1.1 嵌套函数作用域"></a># 1.1.1 嵌套函数作用域</h2><p>函数作用域可是可以嵌套的，和Java的局部作用域不一样，Java中不允许局部与父局部作用域有相同的变量(可以同对象作用域重复，对象作用域用this.var来调用)。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">(<span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>)</span>&#123;</div><div class="line">	<span class="keyword">var</span> name = <span class="string">"David"</span></div><div class="line">	<span class="built_in">console</span>.log(<span class="string">"Function 1:"</span>+name);<span class="comment">//Function 1:David</span></div><div class="line">	(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">		<span class="keyword">var</span> name = <span class="string">"TangY"</span></div><div class="line">		<span class="built_in">console</span>.log(<span class="string">"Function 2:"</span>+name);<span class="comment">//Function 2:TangY</span></div><div class="line">	&#125;)();</div><div class="line">&#125;)();</div></pre></td></tr></table></figure></p>
<h2 id="1-1-2-作用域的搜索方式"><a href="#1-1-2-作用域的搜索方式" class="headerlink" title="# 1.1.2 作用域的搜索方式"></a># 1.1.2 作用域的搜索方式</h2><h2 id="1-1-2-1-屏蔽作用域"><a href="#1-1-2-1-屏蔽作用域" class="headerlink" title="# # 1.1.2.1 屏蔽作用域"></a># # 1.1.2.1 屏蔽作用域</h2><p>函数的作用域会先从最近的函数作用域开始，搜索的具体逻辑可以参考如下代码。执行到变量引用的地方，变量还未定义，那变量是取局部，还是取上一次函数的作用域中的变量呢？执行代码后可发现，输出undefined，这是因为，JavaScript 会先搜索里层函数的作用域，恰巧在里层的作用域里面搜索到 scope 变量，所以上层作用域中定义的 scope 就被屏蔽了，但执行到 console.log 语句时，scope 还没被定义，或者说初始化，所以得到的就是 undefined 值了。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">(<span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>)</span>&#123;</div><div class="line">	<span class="keyword">var</span> name = <span class="string">"David"</span></div><div class="line">	<span class="built_in">console</span>.log(<span class="string">"Function 1:"</span>+name);<span class="comment">//Function 1:David</span></div><div class="line">	(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">		<span class="built_in">console</span>.log(<span class="string">"Function 3:"</span>+name);<span class="comment">//Function 3:undefined</span></div><div class="line">		<span class="keyword">var</span> name = <span class="string">"Haha"</span></div><div class="line">	&#125;)();</div><div class="line">&#125;)();</div></pre></td></tr></table></figure></p>
<h2 id="1-1-2-2-定义生效还是调用生效？"><a href="#1-1-2-2-定义生效还是调用生效？" class="headerlink" title="# # 1.1.2.2 定义生效还是调用生效？"></a># # 1.1.2.2 定义生效还是调用生效？</h2><p>如下代码，为什么最后那个也是打印globalScope呢？因为函数的作用域是取定义时候的，而不是调用时候的。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> scope = <span class="string">'globalScope'</span>;</div><div class="line"><span class="keyword">var</span> f1 = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">	<span class="built_in">console</span>.log(scope);</div><div class="line">&#125;;</div><div class="line">f1(); <span class="comment">// 输出 'globalScope'</span></div><div class="line"><span class="keyword">var</span> f2 = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">	<span class="keyword">var</span> scope = <span class="string">'f2Scope'</span>;</div><div class="line">	f1();</div><div class="line">&#125;;</div><div class="line">f2(); <span class="comment">// 输出 'globalScope'</span></div></pre></td></tr></table></figure></p>
<h2 id="1-2-全局作用域"><a href="#1-2-全局作用域" class="headerlink" title="1.2 全局作用域"></a>1.2 全局作用域</h2><p>在 JavaScript 中有一种特殊的对象称为 全局对象。这个对象在Node.js 对应的是 global对象，在浏览器中对应的是 window 对象。<br>满足以下条件的变量属于全局作用域：</p>
<ul>
<li>在最外层定义的变量；</li>
<li>全局对象的属性；</li>
<li>任何地方隐式定义的变量（未定义直接赋值的变量，就是没通过var定义，尽可能避免这种情况）。</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>)</span>&#123;</div><div class="line">	name = <span class="string">'David'</span></div><div class="line">&#125;</div><div class="line">test()<span class="comment">//这里如果不执行，就会保存因为隐式定义的代码未运行</span></div><div class="line"><span class="built_in">console</span>.log(name);<span class="comment">//David</span></div></pre></td></tr></table></figure>
<p>#2 闭包<br>对未接触过函数编程的人，闭包一直都是一个很神秘的东西，但是接触以后你会发现，其实闭包也很容易，但是也会发现，闭包是如此的神奇好用。<br>闭包的严格定义是“由函数（环境）及其封闭的自由变量组成的集合体。”这个定义对于大家来说有些晦涩难懂，所以让我们先通过例子和不那么严格的解释来说明什么是闭包。</p>
<h2 id="2-1-What"><a href="#2-1-What" class="headerlink" title="2.1 What"></a>2.1 What</h2><p>在javascript中，每个其实都是一个闭包，只是嵌套的函数比较容易体现闭包的特性。按照前面讲解的作用域，函数中的变量引用，应该取的是其定义时候作用域的值，那么， Counter返回的函数在外部调用的时候，count变量应该已经失效了，按Java的理解来说，这里应该会报错（就算Java中用匿名内部类，也需要定义成final）。这里非但没有出错，反而每次调用 counter() 时还修改并返回了 count。这是怎么回事呢？<br>这正是所谓闭包的特性。当一个函数返回它内部定义的一个函数时，就产生了一个闭包，闭包不但包括被返回的函数，还包括这个函数的定义环境。上面例子中，当函数Counter () 的内部函数被一个外部变量 counter 引用时，counter 和Counter () 的局部变量就是一个闭包。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">Counter</span>(<span class="params"></span>)</span>&#123;</div><div class="line">	<span class="keyword">var</span> count = <span class="number">1</span>;</div><div class="line">	<span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">		<span class="keyword">return</span> count++;</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"><span class="keyword">var</span> counter = Counter();</div><div class="line"><span class="built_in">console</span>.log(counter());<span class="comment">//1</span></div><div class="line"><span class="built_in">console</span>.log(counter());<span class="comment">//2</span></div><div class="line"><span class="built_in">console</span>.log(counter());<span class="comment">//3</span></div><div class="line"><span class="built_in">console</span>.log(counter());<span class="comment">//4</span></div><div class="line"><span class="built_in">console</span>.log(counter());<span class="comment">//5</span></div></pre></td></tr></table></figure></p>
<h2 id="2-2-Usage"><a href="#2-2-Usage" class="headerlink" title="2.2 Usage"></a>2.2 Usage</h2><h2 id="2-2-1-回调函数嵌套"><a href="#2-2-1-回调函数嵌套" class="headerlink" title="# 2.2.1 回调函数嵌套"></a># 2.2.1 回调函数嵌套</h2><p>这里举前端使用jQuery开发最常用的方法举例。这里定义的时候，不会立即执行，只是传入了一个回调函数（闭包），当点击事件发生的时候，才会去调用该回调函数。因为前端嵌套的层度不够，在node.js的mongoDb中，会嵌套N层的回调。<br>这样做还有一个好处就是隐藏内部逻辑，使用方根部不需要知道onclick这个事件怎么去监听。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$(<span class="string">'#div_id'</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line"><span class="comment">//点击操作</span></div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<h2 id="2-2-2-访问器"><a href="#2-2-2-访问器" class="headerlink" title="# 2.2.2 访问器"></a># 2.2.2 访问器</h2><p>闭包还可以作为一个访问器，比如前面的Counter的例子，只有调用 counter() 才能访问到闭包内的 count 变量，并按照规则对其增加1，除此之外决无可能用其他方式找到 count 变量。<br>在javascript中是没有私有变量这概念的，不像java中有private，在javascript中只有个约定“_”开始的为私有变量，比如_name，这样很容易被修改了属性，比较不安全。</p>
<p>#3 对象<br>Java里的对象全是基于类的，而javascript不同，他都是基于原型的。如下代码可以简单的创建一个对象。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">var man = &#123;&#125;</div><div class="line">man.name = &quot;David&quot;</div><div class="line">man.test = function()&#123;</div><div class="line">	console.log(this.name);//David</div><div class="line">&#125;</div><div class="line"></div><div class="line">man.test.testFun = function()&#123;</div><div class="line">	console.log(this.name);//无输出</div><div class="line">&#125;</div><div class="line">man.test();</div><div class="line">man.test.testFun();</div></pre></td></tr></table></figure></p>
<h2 id="3-1-构造函数"><a href="#3-1-构造函数" class="headerlink" title="3.1 构造函数"></a>3.1 构造函数</h2><p>以上代码构造对象都是一次性的，如何像Java那样用固定的构造方法和参数去构造呢？以下代码为创建复杂对象的实例。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">function User(name, age) &#123;</div><div class="line">	this.name = name;</div><div class="line">	this.age = age;</div><div class="line">	this.sayHi = function() &#123;</div><div class="line">		console.log(&quot;Hello World,My Name is &quot;+this.name+&quot;,I&apos;m &quot;+age+&quot; years old!&quot;)</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line">var somebody = new User(&apos;david&apos;,&apos;25&apos;)</div><div class="line">somebody.sayHi()//Hello World,My Name is david,I&apos;m 25 years old!</div></pre></td></tr></table></figure></p>
<h2 id="3-2-上下文对象"><a href="#3-2-上下文对象" class="headerlink" title="3.2 上下文对象"></a>3.2 上下文对象</h2><p>这个和Java中类似，this就是在对象内部调用他本身的指针。<br>把上面的例子改造了下，因为User中定义的sayHi方法的name是调用对象内部的上下文，而age则是调用原型内部的局部变量。因此，在somebody中的this指针指向的是somebody对象，而tangy对象中指向的是tangy对象。而age则是闭包原理，变量的引用的作用域为定义时候的作用域，因为构造的时候才真正定义，所以age就是new User()时候的变量了。<br>最后一个函数，由于函数是全局的，所以this指向的是全局变量。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">User</span>(<span class="params">name, age</span>) </span>&#123;</div><div class="line">	<span class="keyword">this</span>.name = name;</div><div class="line">	<span class="keyword">this</span>.age = age;</div><div class="line">	<span class="keyword">this</span>.sayHi = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">		<span class="built_in">console</span>.log(<span class="string">"Hello World,My Name is "</span>+<span class="keyword">this</span>.name+<span class="string">",I'm "</span>+age+<span class="string">" years old!"</span>)</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"><span class="keyword">var</span> somebody = <span class="keyword">new</span> User(<span class="string">'david'</span>,<span class="string">'25'</span>)</div><div class="line">somebody.sayHi()<span class="comment">//Hello World,My Name is david,I'm 25 years old!</span></div><div class="line"><span class="keyword">var</span> tangy = &#123;</div><div class="line">	sayHi:somebody.sayHi,</div><div class="line">	name:<span class="string">'tangy'</span>,</div><div class="line">	age:<span class="number">23</span></div><div class="line">&#125;</div><div class="line">tangy.sayHi()<span class="comment">//Hello World,My Name is tangy,I'm 25 years old!</span></div><div class="line"></div><div class="line">name = <span class="string">"global"</span></div><div class="line">sayHi = tangy.sayHi<span class="comment">//Hello World,My Name is global,I'm 25 years old!</span></div><div class="line">sayHi()</div></pre></td></tr></table></figure></p>
<h2 id="3-3-call与apply"><a href="#3-3-call与apply" class="headerlink" title="3.3 call与apply"></a>3.3 call与apply</h2><p>这两个函数挺神奇的，其作用有点像Java中的反射（其实是Java通过反射来模仿call与apply的操作），call 和 apply 的功能是一致的，两者细微的差别在于 call 以参数表来接受被调用函数的参数，而 apply 以数组来接受被调用函数的参数。call 和 apply 的语法分别是：<br>func.call(thisArg[, arg1[, arg2[, …]]])<br>func.apply(thisArg[, argsArray])<br>用Java来帮助理解的话，第一个参数就是Java的Method对象的invoke方法的第一个参数，也就是代理对象。<br>如果不用Java描述，那理解就是func 是函数的引用（javascript中函数是第一等公民），thisArg 是 func 被调用时的上下文对象，arg1、arg2 或argsArray 是传入 func 的参数，看一下例子，可以看出这两个函数的作用。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">User</span>(<span class="params">name</span>) </span>&#123;</div><div class="line">	<span class="keyword">this</span>.name = name;</div><div class="line">	<span class="keyword">this</span>.sayHi = <span class="function"><span class="keyword">function</span>(<span class="params">age,favorite</span>) </span>&#123;</div><div class="line">		<span class="built_in">console</span>.log(<span class="string">"Hello World,My Name is "</span>+<span class="keyword">this</span>.name+<span class="string">",I'm "</span>+age+<span class="string">" years old! I like "</span>+favorite+<span class="string">"!"</span>)</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line">name = <span class="string">'global'</span></div><div class="line"><span class="keyword">var</span> david = <span class="keyword">new</span> User(<span class="string">'David'</span>)</div><div class="line">david.sayHi(<span class="number">25</span>,<span class="string">'basketball and football'</span>)</div><div class="line"><span class="comment">//Hello World,My Name is David,I'm 25 years old! I like basketball and football!</span></div><div class="line"><span class="keyword">var</span> tangy = &#123;</div><div class="line">	name:<span class="string">'tangy'</span></div><div class="line">&#125;</div><div class="line">david.sayHi.call(tangy,<span class="number">23</span>,<span class="string">'shopping and movie'</span>)<span class="comment">//Hello World,My Name is tangy,I'm 23 years old! I like shopping and movie!</span></div><div class="line"><span class="keyword">var</span> lily = &#123;</div><div class="line">	name:<span class="string">'lily'</span></div><div class="line">&#125;</div><div class="line">david.sayHi.apply(lily,[<span class="number">46</span>,<span class="string">'travel'</span>])<span class="comment">//Hello World,My Name is lily,I'm 46 years old! I like travel!</span></div></pre></td></tr></table></figure></p>
<h2 id="3-4-bind函数"><a href="#3-4-bind函数" class="headerlink" title="3.4 bind函数"></a>3.4 bind函数</h2><p>但是，如果重复使用，每次都要传递对象作为函数的上下文，那么多不方便。这时候就可以使用bind函数。语法为：<br>func.bind(thisArg[, arg1[, arg2[, …]]])<br>参数与call一致。实例代码如下，最后一个输出，出现了重复绑定，这时候，bind已经无效了。如果要解释，就是第一次bind的时候，对象内部还是有this这个指针的，第二次bind，那么这个函数已经类似function(){func.call(david,25)},这时候已经不存在this，所以bind是无效的。这里可能有点难理解，无法理解的话就记住，bind不能重新绑定。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">function User(name) &#123;</div><div class="line">	this.name = name;</div><div class="line">	this.sayHi = function(age,favorite) &#123;</div><div class="line">		console.log(&quot;Hello World,My Name is &quot;+this.name+&quot;,I&apos;m &quot;+age+&quot; years old! I like &quot;+favorite+&quot;!&quot;)</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line">var david = new User(&apos;David&apos;)</div><div class="line">name = &apos;global&apos;</div><div class="line">david.sayHi(25,&apos;basketball and football&apos;)</div><div class="line">//Hello World,My Name is David,I&apos;m 25 years old! I like basketball and football!</div><div class="line">var tangy = &#123;</div><div class="line">	name:&apos;tangy&apos;</div><div class="line">&#125;</div><div class="line">tangy.sayHi = david.sayHi</div><div class="line">tangy.sayHi(23,&apos;shopping and movie&apos;)//Hello World,My Name is tangy,I&apos;m 23 years old! I like shopping and movie!</div><div class="line">tangy.sayHi2 = david.sayHi.bind(david,25,&apos;make a joke&apos;)</div><div class="line">tangy.sayHi2()//Hello World,My Name is David,I&apos;m 25 years old! I like make a joke!</div><div class="line">tangy.sayHi3 = david.sayHi.bind(david,25)</div><div class="line">tangy.sayHi3(&apos;reading&apos;)//Hello World,My Name is David,I&apos;m 25 years old! I like reading!</div><div class="line">var lily = &#123;</div><div class="line">	name:&apos;lily&apos;</div><div class="line">&#125;</div><div class="line">lily.sayHi = tangy.sayHi3.bind(lily)</div><div class="line">lily.sayHi(46,&apos;travel&apos;)//Hello World,My Name is David,I&apos;m 25 years old! I like 46!</div></pre></td></tr></table></figure></p>
<h2 id="3-5-原型"><a href="#3-5-原型" class="headerlink" title="3.5 原型"></a>3.5 原型</h2><p>这是javascript面向对象的核心，javascript的对象都是基于原型的。这就相当于一件艺术品，一件蒙娜丽莎的微笑，javascript就是匠心独运的画匠，他100%的复制了蒙娜丽莎，并且可以通过自己的创意和灵感，赋予她新的东西。下面是一个简单的例子：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params"></span>) </span>&#123;</div><div class="line">	<span class="keyword">this</span>.func = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">		<span class="built_in">console</span>.log(<span class="number">1</span>);</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line">Person.prototype.name = <span class="string">'David'</span>;</div><div class="line">Person.prototype.showName = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">	<span class="built_in">console</span>.log(<span class="string">'My name is '</span>+<span class="keyword">this</span>.name)</div><div class="line">&#125;</div><div class="line"><span class="keyword">var</span> person = <span class="keyword">new</span> Person()</div><div class="line">person.showName()<span class="comment">//My name is David</span></div><div class="line">person.name = <span class="string">'tangy'</span></div><div class="line">person.showName()</div><div class="line"><span class="keyword">var</span> person2 = <span class="keyword">new</span> Person()</div><div class="line"><span class="built_in">console</span>.log(person.func == person2.func);<span class="comment">//false</span></div><div class="line"><span class="built_in">console</span>.log(person.showName == person2.showName);<span class="comment">//true</span></div></pre></td></tr></table></figure></p>
<p>上面这段代码使用了原型而不是构造函数初始化对象。这样做与直接在构造函数内定义属性有什么不同呢？可以从最后看出，原型中的函数是同一个应用，而构造函数每次都会重复创建，由于闭包的局部变量上下文，所以有额外开销，因此可以得出下面结论：</p>
<ul>
<li>构造函数内定义的属性继承方式与原型不同，子对象需要显式调用父对象才能继承构造函数内定义的属性；</li>
<li>构造函数内定义的任何属性，包括函数在内都会被重复创建，同一个构造函数产生的两个对象不共享实例；</li>
<li>构造函数内定义的函数有运行时闭包的开销，因为构造函数内的局部变量对其中定义的函数来说也是可见的。</li>
</ul>
<p>尽管如此，并不是说在构造函数内创建属性不好，而是两者各有适合的范围。那么我们什么时候使用原型，什么时候使用构造函数内定义来创建属性呢？</p>
<ul>
<li>除非必须用构造函数闭包，否则尽量用原型定义成员函数，因为这样可以减少开销；</li>
<li>尽量在构造函数内定义一般成员，尤其是对象或数组，因为用原型定义的成员是多个实例共享的。</li>
</ul>
<h2 id="3-6-原型链"><a href="#3-6-原型链" class="headerlink" title="3.6 原型链"></a>3.6 原型链</h2><p>Object 与 Function是两个特殊对象，它们都是构造函数，用于生成对象，参加如下代码。Object.prototype 是所有对象的祖先，Function.prototype 是所有函数的原型，包括构造函数。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">Function</span>.prototype.testfunc = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">	<span class="built_in">console</span>.log(<span class="string">'this is a test func!'</span>);</div><div class="line">&#125;</div><div class="line"><span class="keyword">var</span> o = <span class="keyword">new</span> <span class="built_in">Object</span>();</div><div class="line"><span class="keyword">var</span> f = <span class="keyword">new</span> <span class="built_in">Function</span>();</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">func</span>(<span class="params"></span>)</span>&#123;</div><div class="line"></div><div class="line">&#125;</div><div class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> o)</div><div class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> f)</div><div class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> func)</div><div class="line"><span class="built_in">console</span>.log(f.testFunc == func.testFunc)</div></pre></td></tr></table></figure></p>
<h2 id="3-6-1-对象分类"><a href="#3-6-1-对象分类" class="headerlink" title="# 3.6.1 对象分类"></a># 3.6.1 对象分类</h2><p>javascript中的对象有三类，一类是用户创建的对象，一类是构造函数对象，一类是原型对象。用户创建的对象，即一般意义上用 new 语句显式构造的对象。构造函数对象指的是普通的构造函数（第一类是该函数构造的对象，这里就是这构造函数），即通过 new 调用生成普通对象的函数。原型对象特指构造函数 prototype 属性指向的对象。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">constructor</span>(<span class="params"></span>)</span>&#123;</div><div class="line"></div><div class="line">&#125;</div><div class="line"><span class="keyword">var</span> object = <span class="keyword">new</span> <span class="keyword">constructor</span>()</div><div class="line">console.log(typeof <span class="keyword">constructor</span>);//function</div><div class="line">console.log(typeof object);//object</div><div class="line">console.log(<span class="keyword">constructor</span>.prototype);//&#123;&#125;</div><div class="line"><span class="built_in">console</span>.log(object.prototype);<span class="comment">//undefined</span></div><div class="line"><span class="built_in">console</span>.log(object.__proto__);<span class="comment">//&#123;&#125;</span></div><div class="line"><span class="built_in">console</span>.log(object.__proto__ === <span class="keyword">constructor</span>.prototype);//true</div></pre></td></tr></table></figure></p>
<h2 id="3-6-2-proto属性"><a href="#3-6-2-proto属性" class="headerlink" title="# 3.6.2 proto属性"></a># 3.6.2 <strong>proto</strong>属性</h2><p>上面的例子也稍微提到了<strong>proto</strong>属性，可以看出，他指向该对象的原型，从任何对象沿着它开始遍历都可以追溯到 Object.prototype。<br>构造函数对象有 prototype 属性，指向一个原型对象，通过该构造函数创建对象时，被创建对象的 <strong>proto</strong> 属性将会指向构造函数的 prototype 属性。原型对象有 constructor属性，指向它对应的构造函数。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">function Constructor()&#123;</div><div class="line"></div><div class="line">&#125;</div><div class="line">Object.prototype.name = &quot;ObjectPrototypeAttr&quot;</div><div class="line">Constructor.prototype.name = &quot;ConstructorPrototypeAttr&quot;</div><div class="line">var constructor = new Constructor()</div><div class="line">var object = new Object()</div><div class="line">console.log(constructor.name);//ConstructorPrototypeAttr</div><div class="line">console.log(object.name);//ObjectPrototypeAttr</div><div class="line">console.log(constructor.__proto__.name);//ConstructorPrototypeAttr</div><div class="line">console.log(constructor.__proto__.__proto__.name);//ObjectPrototypeAttr</div><div class="line">console.log(constructor.__proto__.constructor.prototype.name);//ConstructorPrototypeAttr</div></pre></td></tr></table></figure></p>
<h2 id="3-7-对象复制"><a href="#3-7-对象复制" class="headerlink" title="3.7 对象复制"></a>3.7 对象复制</h2><h2 id="3-7-1-浅复制"><a href="#3-7-1-浅复制" class="headerlink" title="# 3.7.1 浅复制"></a># 3.7.1 浅复制</h2><p>浅复制只是重新创建了一个指针（同类型变量的引用），实际上引用还是相同的对象。浅复制实现如下代码。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">Object</span>.prototype.clone = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line"><span class="keyword">var</span> newObj = &#123;&#125;;</div><div class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i <span class="keyword">in</span> <span class="keyword">this</span>) &#123;</div><div class="line">newObj[i] = <span class="keyword">this</span>[i];</div><div class="line">&#125;</div><div class="line"><span class="keyword">return</span> newObj;</div><div class="line">&#125;</div><div class="line"><span class="keyword">var</span> obj = &#123;</div><div class="line">name: <span class="string">'David'</span>,</div><div class="line">likes: [<span class="string">'basketball'</span>]</div><div class="line">&#125;;</div><div class="line"><span class="keyword">var</span> newObj = obj.clone();</div><div class="line">obj.likes.push(<span class="string">'football'</span>);</div><div class="line"><span class="built_in">console</span>.log(obj.likes); <span class="comment">//[ 'basketball', 'football' ]</span></div><div class="line"><span class="built_in">console</span>.log(newObj.likes); <span class="comment">// [ 'basketball', 'football' ]</span></div></pre></td></tr></table></figure></p>
<h2 id="3-7-2-深复制"><a href="#3-7-2-深复制" class="headerlink" title="# 3.7.2 深复制"></a># 3.7.2 深复制</h2><p>深复制比较复杂，因为每个对象的内部逻辑都不一样，需要循环递归，而且对于函数和数组需要做特殊处理。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line">Object.prototype.clone = function() &#123;</div><div class="line">	var newObj = &#123;&#125;;</div><div class="line">	for (var i in this) &#123;</div><div class="line">		if (typeof(this[i]) == &apos;object&apos; || typeof(this[i]) == &apos;function&apos;) &#123;</div><div class="line">			newObj[i] = this[i].clone();</div><div class="line">		&#125; else &#123;</div><div class="line">			newObj[i] = this[i];</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	return newObj;</div><div class="line">&#125;;</div><div class="line">Array.prototype.clone = function() &#123;</div><div class="line">	var newArray = [];</div><div class="line">	for (var i = 0; i &lt; this.length; i++) &#123;</div><div class="line">		if (typeof(this[i]) == &apos;object&apos; || typeof(this[i]) == &apos;function&apos;) &#123;</div><div class="line">			newArray[i] = this[i].clone();</div><div class="line">		&#125; else &#123;</div><div class="line">			newArray[i] = this[i];</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	return newArray;</div><div class="line">&#125;;</div><div class="line">Function.prototype.clone = function() &#123;</div><div class="line">	var that = this;</div><div class="line">	var newFunc = function() &#123;</div><div class="line">		return that.apply(this, arguments);</div><div class="line">	&#125;;</div><div class="line">	for (var i in this) &#123;</div><div class="line">		newFunc[i] = this[i];</div><div class="line">	&#125;</div><div class="line">	return newFunc;</div><div class="line">&#125;;</div><div class="line">var obj = &#123;</div><div class="line">	name: &apos;david&apos;,</div><div class="line">	likes: [&apos;basketball&apos;],</div><div class="line">	display: function() &#123;</div><div class="line">	console.log(this.name);</div><div class="line">&#125;,</div><div class="line">&#125;;</div><div class="line">var newObj = obj.clone();</div><div class="line">newObj.likes.push(&apos;football&apos;);</div><div class="line">console.log(obj.likes); // [ &apos;basketball&apos; ]</div><div class="line">console.log(newObj.likes); // [ &apos;basketball&apos;, &apos;football&apos; ]</div><div class="line">console.log(newObj.display == obj.display); //false</div></pre></td></tr></table></figure></p>
<h2 id="3-7-3-深复制的问题"><a href="#3-7-3-深复制的问题" class="headerlink" title="# 3.7.3 深复制的问题"></a># 3.7.3 深复制的问题</h2><p>如上代码其实存在一个问题，如果存在循环引用就会报错（如下代码加到上面那个代码）。要实现真正的深复制，那么就需要分析对象的依赖关系，像Java中的Spring初始化那样。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> obj1 = &#123;</div><div class="line">ref: <span class="literal">null</span></div><div class="line">&#125;;</div><div class="line"><span class="keyword">var</span> obj2 = &#123;</div><div class="line">ref: obj1</div><div class="line">&#125;;</div><div class="line">obj1.ref = obj2;</div><div class="line">obj1.clone();<span class="comment">//RangeError: Maximum call stack size exceeded</span></div></pre></td></tr></table></figure></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2014/07/23/2014-07-23-architecture-design-sharing-records-of-the-company/" itemprop="url">
                  公司架构设计交流分享记录
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Veröffentlicht am</span>
            <time itemprop="dateCreated" datetime="2014-07-23T14:54:00+08:00" content="2014-07-23">
              2014-07-23
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">in</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/架构设计/" itemprop="url" rel="index">
                    <span itemprop="name">架构设计</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>架构交流-李炜</p>
<p>#1 什么是架构设计<br>主讲人分三点阐述：</p>
<ul>
<li>架构是阐述结构与结构之间的关系与通信</li>
<li>还是一个过程，关注过程中人的重要性</li>
<li>关注风险，把实施过程中的风险提前暴露出来，并通过架构设计规避</li>
</ul>
<p>#2 架构设计的过程</p>
<h2 id="2-1-瀑布"><a href="#2-1-瀑布" class="headerlink" title="2.1 瀑布"></a>2.1 瀑布</h2><p>在小型且需求明确的项目中，可以使用简单的瀑布模型，也就是系统概念化、系统需求分析、概要设计、详细设计、实施与测试、验收与结项。</p>
<h2 id="2-2-增量式"><a href="#2-2-增量式" class="headerlink" title="2.2 增量式"></a>2.2 增量式</h2><p>增量式为先完成整个系统中的某个模块，慢慢的在架构上增量的增加内容。</p>
<h2 id="2-3-迭代式"><a href="#2-3-迭代式" class="headerlink" title="2.3 迭代式"></a>2.3 迭代式</h2><p>开始先简单设计，完成一个比较粗糙的原型，再在这个基础上做迭代的扩展。</p>
<p>#3 如何驱动架构设计<br>这个在不同的软件开发过程，不同的架构师，就有不同的理解。主讲人的团队是采用RUP的开发模式，所以他们基本以用例和质量为驱动，以过程为导向。<br>而Scrum敏捷开发中大多数情况是以测试为驱动，以用户故事为导向，而在我当前项目中，软件过程虽然为敏捷，但是执行的比较不彻底，也额米有具体的驱动方式，大多数情况还是跟着业务需要走，所以为业务导向，因此也处于比较被动的驱动状况。</p>
<p>#4 如何验证架构设计</p>
<h2 id="4-1-技术预研"><a href="#4-1-技术预研" class="headerlink" title="4.1 技术预研"></a>4.1 技术预研</h2><p>如果各个模块用到的技术存在外部的技术框架，那么需要做前期的技术预研，通过技术、特征二维表的方式，列举出各个技术的优劣，然后通过评审的方式决定。</p>
<h2 id="4-2-测试"><a href="#4-2-测试" class="headerlink" title="4.2 测试"></a>4.2 测试</h2><p>通过测试，在特定的测试环境中，用测试DEMO运行的方式，发现架构的问题所在，比如性能的瓶颈是在磁盘吞吐还是并发上。</p>
<p>#5 架构设计关注什么</p>
<h2 id="5-1-功能需求"><a href="#5-1-功能需求" class="headerlink" title="5.1 功能需求"></a>5.1 功能需求</h2><p>主讲人拿了调度引擎模块的需求来做案例，主要是需要关注功能需求中哪些因素是变化的，哪些因素是不变的，比如调度引擎的作业和作业之间的逻辑关系，就是变化的因素。<br>还要关注需求的关键点，比如调度引擎的作业可以并发，也可以同步执行。</p>
<h2 id="5-2-非功能性需求"><a href="#5-2-非功能性需求" class="headerlink" title="5.2 非功能性需求"></a>5.2 非功能性需求</h2><p>比如，需要关注系统的质量，包括稳定性、安全性、鲁棒性、可扩展性、可维护性、易用性等。</p>
<h2 id="5-3-约束"><a href="#5-3-约束" class="headerlink" title="5.3 约束"></a>5.3 约束</h2><p>约束的因素角度，作者大概阐述几点，这些约束就是一个框框，架构师必须在这个框框内衡量，在各种约束中做取舍，做平衡。</p>
<h2 id="5-3-1-技术环境"><a href="#5-3-1-技术环境" class="headerlink" title="# 5.3.1 技术环境"></a># 5.3.1 技术环境</h2><p>比如，用户提出必须用JAVA开发。</p>
<h2 id="5-3-2-业务环境"><a href="#5-3-2-业务环境" class="headerlink" title="# 5.3.2 业务环境"></a># 5.3.2 业务环境</h2><p>比如，使用的技术或者成果是受保护的专业知识产权。</p>
<h2 id="5-3-3-构建环境"><a href="#5-3-3-构建环境" class="headerlink" title="# 5.3.3 构建环境"></a># 5.3.3 构建环境</h2><p>比如，需要根据研发团队和现场交互团队的能力衡量架构实施的难易度。</p>
<h2 id="5-3-4-使用环境"><a href="#5-3-4-使用环境" class="headerlink" title="# 5.3.4 使用环境"></a># 5.3.4 使用环境</h2><p>比如用户提出，需要兼容IE6，或者需要在平板上也能正常浏览。</p>
<h2 id="5-3-5-易用性问题"><a href="#5-3-5-易用性问题" class="headerlink" title="# 5.3.5 易用性问题"></a># 5.3.5 易用性问题</h2><p>这里的易用性不是指产品经理关注的易用性问题，而是构建、部署的易用性问题。</p>
<p>#6 什么时候开始做架构设计<br>主讲人阐述，在项目启动过程中就需要介入。</p>
<p>#7 怎么表达我们的架构</p>
<h2 id="7-1-分层"><a href="#7-1-分层" class="headerlink" title="7.1 分层"></a>7.1 分层</h2><p>大多数情况看到的架构就是系统各个模块之间的分层，通过分层展现他们之前的依赖关系。</p>
<h2 id="7-2-4-1视图"><a href="#7-2-4-1视图" class="headerlink" title="7.2 4+1视图"></a>7.2 4+1视图</h2><p>该方法为RUP开发中的工具，个人RUP就是以用例、质量为驱动，基于构件，注意UML等工具建模，以架构为中心、迭代增量。</p>
<h2 id="7-2-1-逻辑视图"><a href="#7-2-1-逻辑视图" class="headerlink" title="# 7.2.1 逻辑视图"></a># 7.2.1 逻辑视图</h2><p>如何根据功能需求、非功能需求划分你的模块，梳理各个模块之间的关系与通信机制。</p>
<h2 id="7-2-2-开发视图"><a href="#7-2-2-开发视图" class="headerlink" title="# 7.2.2 开发视图"></a># 7.2.2 开发视图</h2><p>关注质量，包括扩展性、重用性、移植性、易用性、易测试性等。</p>
<h2 id="7-2-3-处理视图"><a href="#7-2-3-处理视图" class="headerlink" title="# 7.2.3 处理视图"></a># 7.2.3 处理视图</h2><p>处理视图关注进程、线程、对象等运行时概念，以及相关的并发、同步、通信等问题，经常通过时序图方式来做。</p>
<h2 id="7-2-4-物理视图"><a href="#7-2-4-物理视图" class="headerlink" title="# 7.2.4 物理视图"></a># 7.2.4 物理视图</h2><p>如何部署，部署到哪些机器上。</p>
<h2 id="7-2-5-场景视图"><a href="#7-2-5-场景视图" class="headerlink" title="# 7.2.5 场景视图"></a># 7.2.5 场景视图</h2><p>主讲人未讲，或者我漏了这块。</p>
<p>#8 架构师分类</p>
<h2 id="8-1-PPT架构师"><a href="#8-1-PPT架构师" class="headerlink" title="8.1 PPT架构师"></a>8.1 PPT架构师</h2><p>只通过PPT，对系统模块进行简单的分层。</p>
<h2 id="8-2-集成架构师"><a href="#8-2-集成架构师" class="headerlink" title="8.2 集成架构师"></a>8.2 集成架构师</h2><p>只是简单的把市面上出现的技术方案集成到一起。</p>
<h2 id="8-3-创作型架构师"><a href="#8-3-创作型架构师" class="headerlink" title="8.3 创作型架构师"></a>8.3 创作型架构师</h2><p>真正的架构师应该是才华横溢，像一个作家一样。这点我非常赞同，格雷厄姆的《黑客与画家》也阐述了软件设计是多么具有创造性的一个职业。</p>
<p>#9 如何实现设计<br>主讲人分三点阐述：</p>
<ul>
<li>先做接口，再做抽象类，可以避免包与包的依赖关系</li>
<li>包从下往上设计，接口从上往下设计</li>
<li>包的接口放包外，消除包与包的依赖关系</li>
</ul>
<p>#10 案例<br>模块的类型无非三种，高并发、高吞吐以及高并发高吞吐。<br>在高并发高吞吐的情况下就可以做一种架构，就是把高并发转换成高吞吐，采用反应堆设计模式和广告过滤器模式通过异步的方式做。</p>
<h2 id="10-1-反应堆设计模式"><a href="#10-1-反应堆设计模式" class="headerlink" title="10.1 反应堆设计模式"></a>10.1 反应堆设计模式</h2><p>按作者的阐述，我理解就相当于去饭店吃饭，里面已经满客了，外面就有一个服务员（线程）专门负责给来到的客人（请求）排号，排号后安排相应的接待员（处理器）去负责给予点菜。</p>
<h2 id="10-2-广告过滤器模式"><a href="#10-2-广告过滤器模式" class="headerlink" title="10.2 广告过滤器模式"></a>10.2 广告过滤器模式</h2><p>这个中间离开了一会，不是很理解，百度也没找到相应的问题，我理解就是通过一层一层的过滤，将信息拦截后再通过一定规则转发到下一层。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2014/06/30/2014-06-30-chinese-style-project-management-reading-record/" itemprop="url">
                  《中国式项目管理》读记
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Veröffentlicht am</span>
            <time itemprop="dateCreated" datetime="2014-06-30T00:02:00+08:00" content="2014-06-30">
              2014-06-30
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">in</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/项目管理/" itemprop="url" rel="index">
                    <span itemprop="name">项目管理</span>
                  </a>
                </span>

                
                
                  . 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/项目管理/读记/" itemprop="url" rel="index">
                    <span itemprop="name">读记</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="《中国式项目管理》读记"><a href="#《中国式项目管理》读记" class="headerlink" title="#《中国式项目管理》读记"></a>#《中国式项目管理》读记</h2><p>#1 概述</p>
<h2 id="1-1-什么样的项目是成功的"><a href="#1-1-什么样的项目是成功的" class="headerlink" title="1.1 什么样的项目是成功的"></a>1.1 什么样的项目是成功的</h2><p>该问题的关键不在于费用是否超支，是否超出进度，而在于， <strong>老板（客户）为什么要花钱做这件事 </strong> ，必须从业务角度去思考，而不是从技术实现上思考。 <strong>理解业务动机是项目成功的关键</strong> 。</p>
<h2 id="1-2-什么有PMP这么复杂的一整套管理理论"><a href="#1-2-什么有PMP这么复杂的一整套管理理论" class="headerlink" title="1.2 什么有PMP这么复杂的一整套管理理论"></a>1.2 什么有PMP这么复杂的一整套管理理论</h2><p>之前我也一直思考这个问题，项目管理的理论相对于敏捷来说，他过于复杂了，为什么还有人照搬这一套。这本书里很好的解释了这个道理，因为这样的项目成功是可以复制的。<br>也许靠一些牛人，他们用自己独特的管理方式可以实现敏捷，但是这种靠人的工作存在很大的风险。而且一个公司一般不只有一个项目再跑，如果只有一个，完全不需要所谓的流程，但大量的项目，很难保证对每个人的能力和每一个细节都有所把握，那一整套成熟的机制和理论就显得安全可靠。<br><strong>把牛人们的经验转化成流程，这才最有价值</strong> 。敏捷极限编程中的Scrum就是一种比较容易复制、成熟可靠的流程。</p>
<h2 id="1-3-面对严重技术问题时候怎么办？"><a href="#1-3-面对严重技术问题时候怎么办？" class="headerlink" title="1.3 面对严重技术问题时候怎么办？"></a>1.3 面对严重技术问题时候怎么办？</h2><p>组织技术人员进行讨论？需找可能的解决方案？找更有经验的专家寻求帮助？这些当然都需要，当然作为一个项目经理，你还必须 <strong>专业地评估、有效的沟通、有力的执行</strong> 。<br>先评估该问题可能造成的影响，成本超支？进度延误？重要的里程碑受到影响？对于客户、下包方、合作伙伴的影响？<br>然后是沟通，这也是评估的目的，比如你可以把你评估的结果和老板沟通，出了什么事，为什么会出，有什么影响，打算怎么做，计划是什么，当前情况什么样，需求什么资源，最重要的是你需要老板出面帮你做什么。<br>最后是执行，执行过程中切记每个事情都必须有人做，但一定不都是你在做，作为项目经理更应该做的是从业务、管理、团队、项目计划、资源协调等层面对项目进行控制。</p>
<p>#2 项目需求</p>
<h2 id="2-1-需求必须是业务导向的"><a href="#2-1-需求必须是业务导向的" class="headerlink" title="2.1 需求必须是业务导向的"></a>2.1 需求必须是业务导向的</h2><p>认真思考你的项目目标到底解决了用户哪方面的问题，然后再选择技术方案、指定项目规划、确定验收标准。</p>
<h2 id="2-2-老板不一定正确"><a href="#2-2-老板不一定正确" class="headerlink" title="2.2 老板不一定正确"></a>2.2 老板不一定正确</h2><p>老板告诉你的只是一个思路，他所说的想法不一定正确，如果一成不变的按着老板说的走，那么必将走很多弯路。而你需要帮老板去验证他的想法是否正确，然后把自己的想法委婉的说出来，最后一定要说，请问我的想法是否正确。</p>
<h2 id="2-3-需求是需要确认的"><a href="#2-3-需求是需要确认的" class="headerlink" title="2.3 需求是需要确认的"></a>2.3 需求是需要确认的</h2><p>虽然没有不变的需求，但是至少在项目启动阶段之前，就必须把需求确认好。如果老板把这事情拖着，那么你要主动推进。</p>
<h2 id="2-4-弄清楚谁是项目干系人"><a href="#2-4-弄清楚谁是项目干系人" class="headerlink" title="2.4 弄清楚谁是项目干系人"></a>2.4 弄清楚谁是项目干系人</h2><p>弄清楚谁是项目干系人，需求到底要找谁谈。你必须保证项目干系人在需求上达成一致，而且别弄错了项目干系人。</p>
<h2 id="2-5-争吵"><a href="#2-5-争吵" class="headerlink" title="2.5 争吵"></a>2.5 争吵</h2><p>在需求阶段有争吵是难免的，别把事情藏着掖着，有问题就必须提出来，毕竟在需求阶段更改的成本还是最低的。</p>
<h2 id="2-6-必须需求中有模糊的概念"><a href="#2-6-必须需求中有模糊的概念" class="headerlink" title="2.6 必须需求中有模糊的概念"></a>2.6 必须需求中有模糊的概念</h2><p>比如，系统很大很安全，那什么程度能达到“很”呢，需要斟酌。</p>
<h2 id="2-7-引导和聆听"><a href="#2-7-引导和聆听" class="headerlink" title="2.7 引导和聆听"></a>2.7 引导和聆听</h2><p>在需求讨论中，引导和聆听是必须的沟通技巧，阐述自己的观点只是辅助性的。</p>
<p>#3 项目计划</p>
<h2 id="3-1-开始阶段必须做好论证和规划"><a href="#3-1-开始阶段必须做好论证和规划" class="headerlink" title="3.1 开始阶段必须做好论证和规划"></a>3.1 开始阶段必须做好论证和规划</h2><p>在开始阶段，舍得花时间进行论证和规划，不厌其烦的把项目干系人抓来沟通，要顶得住压力把模糊的问题谈清楚。在这个阶段修改方案和项目计划还是来得急的。</p>
<h2 id="3-2-里程碑节点比验收节点更重要"><a href="#3-2-里程碑节点比验收节点更重要" class="headerlink" title="3.2 里程碑节点比验收节点更重要"></a>3.2 里程碑节点比验收节点更重要</h2><p>里程碑节点是一个一个的检查点，他并不像验收节点那样是硬性的，但是必须更看重，做好进度上的控制。</p>
<h2 id="3-3-项目计划必须是现实的"><a href="#3-3-项目计划必须是现实的" class="headerlink" title="3.3 项目计划必须是现实的"></a>3.3 项目计划必须是现实的</h2><p>必须站在现实的角度上去做计划，不要用太多的假设，什么如果资源满足的情况下，如果客户不变更需求，这些都必须考虑在内，做好风险清单。</p>
<h2 id="3-4-资源的争取"><a href="#3-4-资源的争取" class="headerlink" title="3.4 资源的争取"></a>3.4 资源的争取</h2><p>资源冲突在职能型组织是常见的，把资源落实到人头上，要到具体的人，而不是虚席以待，而且需要做好沟通，争取更优更多的资源。</p>
<h2 id="3-5-达成共识"><a href="#3-5-达成共识" class="headerlink" title="3.5 达成共识"></a>3.5 达成共识</h2><p>项目计划不能是你认为正确的，还必须和项目干系人、协作部门打成一致，你认为正确的并不是他们认为正确的，站在他们的角度可能有更重要的事情要处理。</p>
<h2 id="3-6-计划要简洁"><a href="#3-6-计划要简洁" class="headerlink" title="3.6 计划要简洁"></a>3.6 计划要简洁</h2><p>视图用最小的篇幅、最短的额时间让客户（老板）理解你的意图。</p>
<h2 id="3-7-风险一定要落实到计划"><a href="#3-7-风险一定要落实到计划" class="headerlink" title="3.7 风险一定要落实到计划"></a>3.7 风险一定要落实到计划</h2><p>形成风险清单，落实到计划，每周例会检查，确保风险都在控制当中，并且做好风险应对措施。</p>
<p>#4 项目控制</p>
<h2 id="4-1-风险控制必须是持续的过程"><a href="#4-1-风险控制必须是持续的过程" class="headerlink" title="4.1 风险控制必须是持续的过程"></a>4.1 风险控制必须是持续的过程</h2><p>当识别到一个风险的时候，把他列入项目风险清单中，每周周会都拿出来讨论，这是安全而有效的方法。<br>当你的老板每周都询问你这个事情的时候，你想忘记他都会很难，你都会去确定该风险<br>当前是否在控制当中。</p>
<h2 id="4-2-项目启动阶段项目经理的工作"><a href="#4-2-项目启动阶段项目经理的工作" class="headerlink" title="4.2 项目启动阶段项目经理的工作"></a>4.2 项目启动阶段项目经理的工作</h2><p>在这个阶段，项目经理必须确认的三个事情是需求、方案与工作模式。<br>首先，把需求搞清楚，做什么，为什么做，如何验收，验收的标准是什么？<br>然后，要拿到授权，确认工作团队，把资源落实到位；<br>最后，理清内部分工、工作机制与流程。</p>
<h2 id="4-3-项目整体计划阶段项目经理的工作"><a href="#4-3-项目整体计划阶段项目经理的工作" class="headerlink" title="4.3 项目整体计划阶段项目经理的工作"></a>4.3 项目整体计划阶段项目经理的工作</h2><p>在这个阶段。要做的不仅仅是开会和写文档，而是要协调沟通与妥协。例如客户方要求采用新的开发平台，那么这个决定将导致进度延期，那么你必须去了解他有这个想法的初衷、根本想法是什么，是否可以协调沟通呢？<br>还有，你预估的一个里程碑点被领导残忍的压缩了，你也必须去沟通了解这个里程碑点有这个要求的原因是什么？市场需要还是什么？这时候你就可以计划在指定时间内完成需要的交付物，剩下一些东西可以在里程碑后去完善。</p>
<h2 id="4-4-项目执行阶段项目经理的工作"><a href="#4-4-项目执行阶段项目经理的工作" class="headerlink" title="4.4 项目执行阶段项目经理的工作"></a>4.4 项目执行阶段项目经理的工作</h2><p>在执行阶段，会有诸多问题，但是切记不要被事情推着走，要主动推进事情。</p>
<ul>
<li>要在过程中寻找节奏感，这节奏感长期考里程碑，短期靠例会。</li>
<li>后看一，前看三，每次例会了解上周做了什么以及之后三周要做什么。</li>
<li><p><strong>周会必须有两周表要讨论，风险清单和问题清单</strong> 。确保问题都在风险表上而不是问题表上。</p>
<h2 id="4-5-关于项目文档"><a href="#4-5-关于项目文档" class="headerlink" title="4.5 关于项目文档"></a>4.5 关于项目文档</h2><p>很多项目文档在工人层面确实是没有用的东西，但是对于组织来说就是宝贵的过程资产。<br>写文档必须搞清楚写给谁看，目的是什么，管理层最希望看到的文档是什么样的。<br>善于使用一些图标，更易于理解。</p>
<h2 id="4-6-关于协作沟通"><a href="#4-6-关于协作沟通" class="headerlink" title="4.6 关于协作沟通"></a>4.6 关于协作沟通</h2><p>在中国这个讲人情的地方，并不是你得到了授权，你把老板搬出来就能让别人就范。很多时候还是需要一些应酬，人际沟通是一种润滑剂，缺少了这，你就会被流程卡住的。</p>
<h2 id="4-7-项目成员的跨部门管理"><a href="#4-7-项目成员的跨部门管理" class="headerlink" title="4.7 项目成员的跨部门管理"></a>4.7 项目成员的跨部门管理</h2><p>项目经理在人的晋升、涨薪方面是很弱势的，所以要让别人听你的，必须有一些手段：</p>
</li>
<li><p>理清楚这个项目能带给他们什么，有时候一个人的意愿比经验更重要；</p>
</li>
<li>要让大家信服你，包括你的技能、处事态度和人品；</li>
<li>和管理层保持沟通（不要直接用老板压别人，要先从道理上让别人知道这是你应该做的事，再用柔性的办法去沟通）</li>
</ul>
<p>项目经理不一定是资源的管理者，但一定是业务的推动者，你的价值，需要靠你自己去证明，不要总抱怨没有资源，必须证明自己的价值。</p>
<h2 id="4-8-对于项目变更"><a href="#4-8-对于项目变更" class="headerlink" title="4.8 对于项目变更"></a>4.8 对于项目变更</h2><p>完全没有变更的项目是不存在的，能做的是：</p>
<ul>
<li>在项目需求阶段，尽可能的把需求理清楚；</li>
<li>在项目执行阶段，对一切需求变更做变更流程，如把变更造成的进度影响告知领导，在这种影响的前提下，变更是否审核；</li>
<li>变更后要相应的调整计划与文档。</li>
</ul>
<p>#5 项目团队与沟通</p>
<h2 id="5-1-项目经理的一天"><a href="#5-1-项目经理的一天" class="headerlink" title="5.1 项目经理的一天"></a>5.1 项目经理的一天</h2><p>项目经理应该面向全局但同时也要关注细节，一定要找对感觉，闷头做事一定会出问题的。到晚上想及同年做了什么，发现想不起来，那真是“忙晕了”。那什么最重要呢？</p>
<ul>
<li>首先，如果流程除了问题，必须首先解决；</li>
<li>与重要的干系人沟通、协调、妥协……向管理层争取资源</li>
<li>写文档（这同样是非常重要的，必须保证文档与项目现状保持一致）</li>
</ul>
<h2 id="5-2-工作热情比工作经验更重要"><a href="#5-2-工作热情比工作经验更重要" class="headerlink" title="5.2 工作热情比工作经验更重要"></a>5.2 工作热情比工作经验更重要</h2><p>调动每一个成员的工作热情，是项目经理必须做的工作，但是这很难。作为一个弱势的管理者，有意愿往往比有经验更重要。<br>有经验的人可以降低项目的技术风险，但是成本高且不容易管理。</p>
<h2 id="5-3-项目经理在沟通中的作用"><a href="#5-3-项目经理在沟通中的作用" class="headerlink" title="5.3 项目经理在沟通中的作用"></a>5.3 项目经理在沟通中的作用</h2><p>明确目标、理清模式，是项目经理在沟通中的主要工作。<br>项目团队是临时的，是一个多样性的团队，文化、技能、性格、地域可能都不同，你不可能改变别人，更不可能改变环境，你能做的只是适应环境。</p>
<h2 id="5-4-沟通中要因人而异"><a href="#5-4-沟通中要因人而异" class="headerlink" title="5.4 沟通中要因人而异"></a>5.4 沟通中要因人而异</h2><p>当要说服一个技术骨干接手一个项目，但是非常抵触。你应该做什么？画饼？给实际利益？晓之以理（这个项目就你最合适了）？动之以情（兄弟，你一定要帮我一把啊）？都不是，最重要的是你要知道他觉得什么是最重要的，比如原因是他刚结婚，想和媳妇在一起，那么，能不能说服他，让他觉得去的地方也不错，带上媳妇一起去呢？</p>
<h2 id="5-5-MBTI理论"><a href="#5-5-MBTI理论" class="headerlink" title="5.5 MBTI理论"></a>5.5 MBTI理论</h2><p>迈尔斯-布里格斯类型指标。</p>
<h2 id="5-5-1-认知与判断"><a href="#5-5-1-认知与判断" class="headerlink" title="# 5.5.1 认知与判断"></a># 5.5.1 认知与判断</h2><p>判断型（J）    知觉型（P）<br>做了决定后最为高兴    当各种选择都存在时，感到高兴<br>有“工作原则”：工作第一，玩其次（如果有时间的话）    “玩的原则”：现在享受，然后再完成工作（如果有时间的话）<br>建立目标，准时地完成    随着新信息的获取，不断改变目标<br>愿意知道它们将面对的情况    喜欢适应新情况<br>着重结果（重点在于完成任务）    着重过程（重点在于如何完成工作）<br>满足感来源于完成计划    满足感来源于计划的开始<br>把时间看作有限的资源，认真地对待最后期限    认为时间是可更新的资源，而且最后期限也是有收缩的<br>理论上讲，判断是项目控制的基础，J类型的人在项目管理上有很大的又是，而且大多数人也都会喜欢判断性的人，但是，这样的人在中国的商业环境中却很痛苦，很难将事情处于绝对控制中，应该不变是相对的，变化是绝对的。P型的人才往往有更大的灵活性，能在突发情况的时候能力越强。</p>
<h2 id="5-5-2-感觉与直觉"><a href="#5-5-2-感觉与直觉" class="headerlink" title="# 5.5.2 感觉与直觉"></a># 5.5.2 感觉与直觉</h2><p>感觉型（S）    直觉型（N）<br>相信确定和有形的东西    相信灵感或推理<br>对概念和理论兴趣不大，除非它们有着实际的效用    对概念和理论感兴趣<br>重视现实性和常情    重视可能性和独创性<br>喜欢使用和琢磨已知的技能    喜欢学习新技能，但掌握之后很容易就厌倦了<br>留意具体的、特定的事物；进行细节描述    留意事物的整体概况、普遍规律及象征含义；用概括、隐喻等方式进行表述<br>循序渐进地讲述有关情况    跳跃性地展现事实<br>着眼于现实    着眼于未来，留意事物的变化趋势，惯于从长远角度看待事物<br>直觉型的人，相信直觉、关注大局、更加在意时期你发招的趋势和各种可能性。S型的人，相信经验、关注细节、更加在意眼前发生的具体的事情。<br>当你说服一个感觉型人的时候，不能画饼，要讲实际的效益，比如这个项目存在补助，而对于直觉型的人，画饼往往更好。他们看重未来。<br>当你和一个直觉型的老板汇报项目，那么，你把要点说清楚就够了，而和一个感觉型的老板汇报，那么你最好把细节都想清楚了，时刻防止被刨根问底。</p>
<h2 id="5-5-3-内向与外向"><a href="#5-5-3-内向与外向" class="headerlink" title="# 5.5.3 内向与外向"></a># 5.5.3 内向与外向</h2><p>外倾型（E）    内倾型(I)<br>与他人相处时精力充沛    独处时精力充沛<br>行动先于思考    思考先于行动<br>喜欢边想边说出声    在心中思考问题<br>易于“读”和了解；随意地分享个人情况    更封闭，更愿意在经挑选的小群体中分享个人的情况<br>说的多于听的    听的比说的多<br>高度热情地社交    不把兴奋说出来<br>反应快，喜欢快节奏    仔细考虑后，才有所反应<br>重于广度而不是深度    喜欢深度而不是广度<br>内向的人，往往需要在心里把事情想清楚，才愿意和别人进行沟通，对于不是很清晰的事情，他未必会和你深入地交流。而对于外向型的人，讨论有时只是进行思考的一种方式，没有充分的讨论，他们很难理清自己的思路。<br>所以当你和一个内向型的人打交道时，最好就是提前把所有资料发给他，总之，你要为对方留出思考的时间，而不要在开会时强求对方表态。</p>
<h2 id="5-5-4-思维与情感"><a href="#5-5-4-思维与情感" class="headerlink" title="# 5.5.4 思维与情感"></a># 5.5.4 思维与情感</h2><p>思维型（T）    情感型（F）<br>退后一步思考，对问题进行客观的、非个人立场的分析    超前思考，考虑行为对他人的影响<br>重视符合逻辑、公正、公平的价值；一视同仁    重视同情与和睦：重视准则的例外性<br>被认为冷酷、麻木、漠不关心    被认为感情过多，缺少逻辑性，软弱<br>认为坦率比圆通更重要    认为圆通比坦率更重要<br>只有当情感符合逻辑时，才认为它可取    无论是否有意义，认为任何感情都可取<br>被“获取成就”所激励    被“获得欣赏”所激励<br>很自然地看到缺点，倾向于批评    惯于迎合他人，着重维护人脉资源<br>这是从作决策的方式来看。仅看这个维度的名称，也许你会觉得，思维型的人是理性的，而情感性的人是非理性的，事实上并非如此。两类人都有理性思考的成分，但作决定或下结论的主要依据不一样。情感型的人常从自我的价值观念出发，变通地贯彻规章制度，做出一些自己认定是对的决策，比较关注决策可能给他人带来的情绪体验，人情味较浓。思维型的人则比较注重依据客观事实的分析，一以贯之、一视同仁地贯彻规章制度，不太习惯根据人情因素变通，哪怕做出的决定并不令人舒服。<br>思维型的人说话有时候不会顾及别人的感受，只说在说一个正确的事情，就像贝索斯小时候计算他外婆因为抽烟减寿多少，这是一个可以说是正确的结论，但是，他没有顾及外婆外公的感受，他外公和他说，天赋是天生的，而善良更为重要。<br>思维型的人考虑问题道理很重要，他们关注正确性而不是对方的感受。而情感型的人关注人，他们关注情感，有时候甚至可以在原则上做出让步。</p>
<h2 id="5-6-问题解决了吗？"><a href="#5-6-问题解决了吗？" class="headerlink" title="5.6 问题解决了吗？"></a>5.6 问题解决了吗？</h2><p>有时候，让步这个解决问题的方式并不有效。虽然在结果上出于各方压力做出了让步，但是情绪上的问题并没有解决，同样会在情绪上反击你。所以，解决问题的关键在于 <strong>先情绪，后问题</strong> 。</p>
<h2 id="5-7-学会说No，但必须有技巧"><a href="#5-7-学会说No，但必须有技巧" class="headerlink" title="5.7 学会说No，但必须有技巧"></a>5.7 学会说No，但必须有技巧</h2><p>刚从事项目经理，为了让干系人都满意，基本上对于别人提出的事情都不会说No，但是，这样往往把自己搞的很累，也把小组的人也都搞的很累。要适当的学会说No，而且还要有技巧，有时候坚持自己的原则，做正确的事，更容易赢得别人的信任。</p>
<p>#6 后记<br>项目经理是一个权力小，责任大的职位，他作为一个职业转型期，是自我价值的重新定位。并从专家转变为业务导向的推进者，他对人在计划、沟通、控制、处理冲突等技能有很好的锻炼。并且能锻炼一个很好的心态和心里素质。<br>一定不要抱怨，你要有强健的内心，为团队传递正能量，你必须让自己有价值。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2014/06/15/2014-06-15-monday-morning-leadership/" itemprop="url">
                  Monday Morning Leadership 
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Veröffentlicht am</span>
            <time itemprop="dateCreated" datetime="2014-06-15T08:50:00+08:00" content="2014-06-15">
              2014-06-15
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">in</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/总结/" itemprop="url" rel="index">
                    <span itemprop="name">总结</span>
                  </a>
                </span>

                
                
                  . 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/总结/读后感/" itemprop="url" rel="index">
                    <span itemprop="name">读后感</span>
                  </a>
                </span>

                
                
                  . 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/总结/读后感/管理学/" itemprop="url" rel="index">
                    <span itemprop="name">管理学</span>
                  </a>
                </span>

                
                
                  . 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/总结/读后感/管理学/领导课/" itemprop="url" rel="index">
                    <span itemprop="name">领导课</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>最近看了一本领导推荐给我的书，还挺不错的，本文为该书的读后感，结合了我的个人想法。</p>
<h2 id="周一清晨的领导课"><a href="#周一清晨的领导课" class="headerlink" title="周一清晨的领导课"></a>周一清晨的领导课</h2><p>#1 改变<br>从一个普通员工转变为团队领导，首先需要转变以往的做事习惯，做一个领导该做的事情。<br>打个比方，当你作为乘客坐在车上，你可以做你想做的事情，比如听歌、看书，但是，如果有一天你成为了司机，你就不能在做这些了，你需要对自己负责，更要对你车上的每个人的生命负责。<br>当我还是一名普通的开发人员的时候，我可以把我的精力都专注在开发上，当我成为团队开发管理者时候，我没有及时的改变这个身份，仍然把很多时间花在了开发、设计工作上。作为一个司机，首先我没看路，对整个项目组应该做什么、做到什么程度把控不足，就算有时候我自己清晰的知道目标，但是我没有把目标很好的传递给我的乘客，他们坐在我的车上很茫然，不知道下一站是何处。<br>这时候，他们完成的东西也就很茫然，这样团队陷入，甚至他们也不知道自己做的是否符合要求，是否正确。导致我这个司机觉得车内一切正常，而不知道其实车内都已经要着火了，陷入了管理黑洞。<br>因此，在试错失败后，我首先应当做一个改变， <strong>我应当花更多的时间解决问题，而不是责备别人，如果出了问题都应当是我的责任，我应当把眼光投向未来，而不是专注的眼前开发设计上的细节，我要为他人的时间负责</strong> 。</p>
<p>#2 弄清目标<br>首先，应当找出当前的首要问题，知道当前最需要紧急完成的事情是什么，如果有疑问，应当和我的领导和团队成员们一起讨论这个问题。了解领导和团队成员他们所认为的最首要的问题是什么，他们对我的期望是什么？<br>你认为的首要问题必须要和你的领导一致，在很多情况下，这是会有偏差的。就像你的团队成员所认为的很可能也与你认为的有偏差。<br><strong>认清团队的首要问题，如果有人让你的团队做首要问题以外的事情，告诉你的团队成员，他们有权拒绝，不管是谁的要求。</strong></p>
<h2 id="2-1-从离职中找原因"><a href="#2-1-从离职中找原因" class="headerlink" title="2.1 从离职中找原因"></a>2.1 从离职中找原因</h2><p><strong>团队成员的离职，大多数情况都是出于对现在领导的不满，请搞清楚他们对你不满的地方</strong>。大多数情况下原因都是：他们的领导目标不清晰；并且缺少对他们进行反馈；让他们的工作变得不可度量。领导最重要的三件事情就是：消除团队成员的迷惑；告诉团队成员获取成功的方法和手段；为顾客提供出色的服务，并盈利。</p>
<h2 id="2-2-把目标写下来"><a href="#2-2-把目标写下来" class="headerlink" title="2.2 把目标写下来"></a>2.2 把目标写下来</h2><p>当你把这些都写下来时，你便做出了实施的承诺。如果你只是口头上说你想做什么，就不会对你构成约束。 <strong>把目标写下来，这样你才能记得更清楚</strong> 。</p>
<h2 id="2-3-很少人指定目标的原因"><a href="#2-3-很少人指定目标的原因" class="headerlink" title="2.3 很少人指定目标的原因"></a>2.3 很少人指定目标的原因</h2><p><strong>对活到老学到老认同很容易，但除非你订立具体的目标</strong> ，否则将一无所获。很少人制定目标的原因：</p>
<ul>
<li>不知道制定目标的重要性</li>
<li>不知道该如何制定目标</li>
<li>有时候人们因为害怕失败不敢订目标</li>
<li>定目标代表者要离开舒适地带</li>
</ul>
<p>#3 如何对员工负责<br>作为一个管理新手，很容易陷入管理黑洞。7个月的管理工作中，我经常处于不知道团队成员工作状态的情况下，一部分原因是他们有选择的汇报，更重要的一方面是因为，我并没有去关注他们的进度以及没有对他们进行反馈。<br>要改变，首先，对团队成员的 <strong>工作要是可度量的，不要让优秀的员工一直忙碌，而欺上瞒下的人反而游手好闲，解雇那些在其位不谋其职的人</strong> ；<br>然后，要 <strong>指导每个员工，给予足够的反馈和指导</strong> ；<br>再次，要意识到， <strong>自己的受挫、团队成员的失望是因为自己没做好分内的事情，如果团队成员不把自己的迷惑告诉领导，而总是说经理爱听的话，那么我就陷入了管理黑洞</strong> 。</p>
<h2 id="3-1-对团队成员进行分类"><a href="#3-1-对团队成员进行分类" class="headerlink" title="3.1 对团队成员进行分类"></a>3.1 对团队成员进行分类</h2><p>大多数团队分三类雇员：</p>
<ul>
<li>超级明星-富有经验和学识，现在岗位上发挥最佳作用的人</li>
<li>中层星-他们也许还不具备超级明星所拥有的经验或者以前是现在由于某些原因失去了争第一的动力</li>
<li>流星-尽量逃避责任，希望担子越轻越好</li>
</ul>
<p>典型团队中各类成员的比例为3：5：2。<br>团队中，有些人不管肩上担子多重，也是超级明星，但也有些人会因为压力被压成中层明星，如果你答谢流星并且少派些工作给他们，那么更多人会沦落到这一组中。<br>因此， <strong>你的职责并不是通过关照业绩最差的雇员，来降低最低限。你应当通过承认并嘉奖超级明显来提高上限</strong> 。<br>可以做一个统计，把你的团队的每个人的名字写下来，给他们划分层次，然后打个分数，最后把他们最近六个月中受到嘉奖都记录下来。看看是否奖符其实。</p>
<h2 id="3-2-团队成员对领导的期望"><a href="#3-2-团队成员对领导的期望" class="headerlink" title="3.2 团队成员对领导的期望"></a>3.2 团队成员对领导的期望</h2><p>员工对领导的期望：</p>
<ul>
<li>雇佣优秀的员工并指导每个员工，让他们变得更优秀</li>
<li>解雇那些在其位不谋其职的员工</li>
</ul>
<h2 id="3-3-总结"><a href="#3-3-总结" class="headerlink" title="3.3 总结"></a>3.3 总结</h2><p>逃离管理黑洞的方法：</p>
<ul>
<li>与下属保持联系</li>
<li>你的职责并不是通过关照流星来降低最低线</li>
<li>你应当通过承认并嘉奖超级明星来提高最上限</li>
</ul>
<p>#4 坚持正确的行为准则<br>在我做管理的七个月中，很多时候犯了这个错误。因为进度压力，因为资源能力问题，因为现有系统设计束缚。很多问题都存在问题，有的采用临时性的解决办法，很多甚至都忽视过去了。<br>一个团队应当有一套正确的行为准则，如果没有一套行为准则，很难知道什么是对的，就像飞行员使用的意外事故手册，当遇到危机，立马就能知道应该如何应对。如果让飞行员在发生事故时候在想如何应对，这很难。<br>做正确的事并非轻而易举，事实上有时真的很难，但要记住，做正确的事始终都是正确的。当你的团队成员做了不正确的事情，请不要忽视问题，不要因为怕别人认为你没有同情心、死板、教条主义就忽视这个问题，因为，通常来说，经理是团队最后一个知悉问题的人，而且经理所看到的一般只是一小部分而已。像冰山的一角，在睡的上面，你看到的是冰尖，而藏在水下的要大得多，通常都更具有破坏性。因此 <strong>员工往往看到的问题更多，经理忽视问题，那就是拿自己正直的口碑冒险</strong> 。<br><strong>你应该为长期的、持久的成功，而不是为短期的方便来提高最高标准</strong> 。短期内见效很容易。你可以威胁下属、支付更高的心说，或者只是满足他们的需要，就可以赢得短期目标了。长期想见效比较难，需要建立一套大家都必须遵守的行为准则；需要有准确的反馈意见；需要根据下属所做的决策（积极或消极）实施相应的办法。你一切都需要你鼓起勇气，坚持正确的做法。<br>做正确的事并非轻而易举，事实上有时真的很难，但要记住，做正确的事始终都是正确的。忽视问题而不采取正确的行动，问题实际上不会自动消失。 <strong>你必须有所行动，你必须用正确的方式来解决问题</strong> 。<br>所以，之后的管理中，应当花更多的时间在代码、设计、需求的检查上，减少因为忽视问题导致的返工。</p>
<p>#5 需找合适的团队成员<br><strong>一个好的团队成员，他能减少你很多的管理工作</strong> 。因此，需找合适的团队成员，解雇那些不合适的团队成员。并为解雇某个犯错的员工释然，他们的反应一般是：这是别人的错、管理者没有同情心、过失是可以被原谅的，牢记这是他们自己选择了解雇自己，我们只是在执行他的决策而已。<br><strong>公司最重要的财富的合适的员工（right people）</strong> 。招聘应当精挑细选，管理起来就会容易得多，并且让加入你的团队成为一种特权。空缺的职位让你费时费力，你想快点填补。带着这种感情，你会速战速决的选择并非很合适的人。为填补一个职位空缺而降低标准，以后你会为此付出代价的。<br>现在在进度的压力下，往往经常是不得不降低标准来寻找可以干活的人。我认为，可以暂时放低业务和技术上的标准，但是对于行为上的标准不能降低，不能让任何人破坏团队的标准。</p>
<p>#6 管理好时间，提高效率<br>很多部门的同事会说，没有时间学习，一直都处在很忙的状态下。我自己虽然在学习上不会觉得缺少时间，但是，在于一堆各式各样错综复杂的工作上，我总是让自己显得很忙。其实，很多时候是自己没有管理好自己的时间，这些不可控的事情，让自己又觉得焦虑。<br><strong>压力、焦虑和苦恼的主要原因在于，你觉得生活失控了</strong> 。那是因为你好像在把管理时间的问题归咎于不可控制的事务。那么，除了你之外，谁还能花你的时间呢？你要想办法统筹自己的时间，这样就可以控制自己的生活。<br>充分分析，你把时间都花在了什么地方（可以考虑用番茄钟），回顾上两周时间的安排，这样对如何改进，你可以做出有根有据的决策。<br>思考下这两个问题：我们花在主要的事物和错事上的额时间各有多少。可以从做的事情和方式两个角度来分析安排时间，在上两周，我们做了主要的事务吗？做对了吗？</p>
<h2 id="6-1-更好安排时间"><a href="#6-1-更好安排时间" class="headerlink" title="6.1 更好安排时间"></a>6.1 更好安排时间</h2><p>可以通过三方面的改进来更好安排时间：</p>
<ul>
<li>理清事务的轻重缓急并进行合理统筹</li>
<li>减少干扰</li>
<li>有效地管理会议</li>
</ul>
<h2 id="6-2-二八定律"><a href="#6-2-二八定律" class="headerlink" title="6.2 二八定律"></a>6.2 二八定律</h2><p>大多数情况下，可以用80%的时间做20%重要的事情。</p>
<h2 id="6-3-做计划"><a href="#6-3-做计划" class="headerlink" title="6.3 做计划"></a>6.3 做计划</h2><p>每天都留一段不受干扰的时间来做计划，让自己的工作更有条理。像番茄钟工作法中，每天清晨第一件事情就是用一个短番茄钟对今天一天的工作做一个计划。这样能让自己的工作更有条理，还可以减少干扰。事实证明，在没有干扰的情况下工作效率是干扰情况下的2倍还多。<br>让自己更有条理，可以从办公桌开始，混乱的办公桌很容易让人觉得你做事没有条理。</p>
<h2 id="6-4-集中处理"><a href="#6-4-集中处理" class="headerlink" title="6.4 集中处理"></a>6.4 集中处理</h2><p>把一些繁杂的事情进行集中处理，比如回复电子邮件、回答测试人员的疑问，可以在每天选择几个固定的时段来完成这种干扰性较严重的工作，把事情放在一起做，不要整天都忙于开始和结束。比如把所有的邮件一次做完，减少从一件事转到做另一件事情的次数。不要让这种上下文切换来影响你的效率，浪费你的脑力。</p>
<p>#7 如何做好领导者<br>作为领导，一定要牢记以下两点：</p>
<ul>
<li>作为领导者，你的业绩是团队共同努力的结果</li>
<li>你对团队的需要甚于团队对你的需要</li>
</ul>
<p><strong>你是主要的装桶人，装桶的最佳方法是良好的沟通</strong></p>
<h2 id="7-1-对于反馈"><a href="#7-1-对于反馈" class="headerlink" title="7.1 对于反馈"></a>7.1 对于反馈</h2><p>对于反馈</p>
<ul>
<li>要真诚，如果不诚挚的提出反馈意见，员工会把你当不存在</li>
<li>要把桶装满，反馈意见必须明确。如果不说明赞扬的是谁，桶也不会满，因为他们猜测你的意图是，桶也银耳倾斜</li>
<li>要及时反馈</li>
<li>反馈意见一定要与接受者的价值体系相一致。不要试图以对你很重要、对别人不重要的东西来装满他们的桶</li>
</ul>
<h2 id="7-2-关心团队成员的工作"><a href="#7-2-关心团队成员的工作" class="headerlink" title="7.2 关心团队成员的工作"></a>7.2 关心团队成员的工作</h2><p>让下属知道你很在意他们，也很关心他们的工作，一下是12种方法：</p>
<ul>
<li>让员工参与重大决策</li>
<li>记住提桶者及其家人的情况</li>
<li>为员工倒咖啡</li>
<li>将感谢信送到员工家中</li>
<li>送提桶者一张感恩卡片</li>
<li>要超级明星做中层星和流星的良师益友（这个一个双赢策略）</li>
<li>要贴近员工，记录下每次重大的装桶事宜</li>
<li>在公司种一棵树，以示对团队的敬意</li>
<li>建一个存有书籍、录像带和杂志的图书馆</li>
<li>用员工及其家人的照片做一面‘荣誉墙’</li>
<li>遵守装桶的黄金定律：用员工期望的方式来对待他们</li>
<li>与所有员工攻读时光，有时候，只是站在员工身旁，向他们表示你的关心，就会自动地把他们的桶装满</li>
</ul>
<h2 id="7-3-装桶的方法"><a href="#7-3-装桶的方法" class="headerlink" title="7.3 装桶的方法"></a>7.3 装桶的方法</h2><p>装桶四中方法：</p>
<ul>
<li>知道首要的事务是什么</li>
<li>提出对业绩的反馈意见</li>
<li>表扬员工</li>
<li>交流对团队的评价</li>
</ul>
<h2 id="7-4-其他"><a href="#7-4-其他" class="headerlink" title="7.4 其他"></a>7.4 其他</h2><ul>
<li>让团队知道他们凝聚在一体有多好</li>
<li>让员工时刻保持清醒，知道他们是否正在赢得目标</li>
</ul>
<p>#8 离开舒适地带<br>当你觉得目前的工作很舒适，那么就要立马逃离这种状态。 <strong>阻止你发挥潜力的劲敌是舒适地带，你想出人头地，就不能放任自己躺在舒适地带上自鸣得意。你要追求进步</strong> 。<br>学习地带有三个房间：阅览室、倾听室和给予室。</p>
<h2 id="8-1-阅览室"><a href="#8-1-阅览室" class="headerlink" title="8.1 阅览室"></a>8.1 阅览室</h2><p><strong>读书越多，知识越丰富</strong> 。问题不在于你有没有时间和金钱，在于你能不能每天抽出固定时间来看书。</p>
<h2 id="8-2-倾听室"><a href="#8-2-倾听室" class="headerlink" title="8.2 倾听室"></a>8.2 倾听室</h2><p>很多人失败的原因在于他们骄傲自大、过于自负、麻木不仁，他们忘记花时间倾听员工的意见，很快他们就对团队中的每个人的需要和渴望麻木不仁。</p>
<h2 id="8-3-给予室"><a href="#8-3-给予室" class="headerlink" title="8.3 给予室"></a>8.3 给予室</h2><p>如果不付出，就不会成功。你教的越多，就会对所教事务更加负责，自己也能对教的东西理解的更深甚至有新的理解。</p>
<p>#9 保持乐观<br><strong>在困惑的时候也要保持乐观，生活中有很多事情都与生活态度、如何面对生活带来的苦恼有关。生活是美好的，即使境况恶化时也依然如此。</strong></p>
<p>#10 一些原则</p>
<h2 id="10-1-领导学原则"><a href="#10-1-领导学原则" class="headerlink" title="10.1 领导学原则"></a>10.1 领导学原则</h2><ul>
<li>正直原则：绩效与领导者获得的信任程度成正比</li>
<li>责任原则：如果领导和下属都为自己的行为负责，绩效便会提高</li>
<li>委托原则：领导者雇佣并提拔有才能的员工，绩效会随之提高</li>
<li>构想原则：如果领导者将自己的构想解释得一清二楚，而且抱有这种构想的原因也令人心悦诚服，绩效便会提高</li>
</ul>
<h2 id="10-2-同心协力原则"><a href="#10-2-同心协力原则" class="headerlink" title="10.2 同心协力原则"></a>10.2 同心协力原则</h2><ul>
<li>交流原则：员工了解自己的职责，并因为取得的成就而获得奖励，他们的绩效便会提高</li>
<li>矛盾解决的原则：领导者排除了压抑下属的障碍后，绩效会提高</li>
<li>乐观原则：绩效与领导的自尊心和态度成正比</li>
<li>改变管理方式的原则：领导崇尚改革，而且积极地致力于改革事务，绩效会随之提高</li>
</ul>
<h2 id="10-3-投资原则"><a href="#10-3-投资原则" class="headerlink" title="10.3 投资原则"></a>10.3 投资原则</h2><ul>
<li>授权原则：当员工要为自己的行为负责时，他们的绩效便会提高</li>
<li>勇气原则：领导直面影响员工的问题的能力越强，业绩越会同比上升</li>
<li>榜样原则：领导成为正面的榜样时，业绩会提升</li>
<li>准备原则：领导越促进自身及员工的成长，绩效水平越高</li>
</ul>
<p>#11 后记<br>《周一清晨的领导课》这本书对我的帮助是挺大的。这9个月的管理工作，我没有少做总结，但是，个人经验的总结往往是片面的、抽象的。这本书中将我自己总结出来的全部都覆盖到了，并且将我的问题解释的更全面、更具体，而且，还提出了很多改进的意见。<br>读万卷书不如行万里路，希望看完这本书后，我能把目前的管理工作做好。<br>对于这本书中托尼的话，首先，我把这本书中学到的东西记录了下来，并且结合了我个人的看法做了写成了该文，也算把学到的东西分享了出去，另外，我也打算做写一份我立马需要做的事情。<br>还有，看完这本书其实有些问题还是有些疑问的，比如正确做事这个章节，有时候，死板的按照行为准则做事，会给团队成员以教条主义的眼光看待。这些疑问，我打算在适当的时候，找有经验的前辈指教。</p>
<p>#12 我当前要做的事情</p>
<ul>
<li>做出改变，不在埋头做事，理清头绪，整理好当前项目开发中的计划，找出近期迭代中的首要问题；</li>
<li>对团队成员负责，让整个团队都有认识一致的首要问题，并且更好的给他们反馈，关心他们的工作，填充他们的不足，和他们共同进步；</li>
<li>将后续总结会中的问题整理成一份行为准则，并且坚持做这些正确的事情；</li>
<li>做好自己的时间管理，做好每天的计划，更好的管理自己的时间，并且用80%的时间做我最应该做的事情；</li>
<li>不要放低标准，招聘适合的团队成员，加强团队；</li>
<li>加强学习，多看书、多倾听、多分享。不要给别人灌输别人不愿意听的想法和知识；</li>
<li>保持乐观，不管境况多糟糕，都要乐观的寻找方法去改变现状。</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2014/05/21/2014-05-21-jobs-and-bezos-product-monitoring-subsystem-module-refactoring/" itemprop="url">
                  乔布斯与贝索斯-------公司产品监控子系统监控模块重构
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Veröffentlicht am</span>
            <time itemprop="dateCreated" datetime="2014-05-21T14:12:00+08:00" content="2014-05-21">
              2014-05-21
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">in</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/bezos/" itemprop="url" rel="index">
                    <span itemprop="name">bezos</span>
                  </a>
                </span>

                
                
                  . 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/bezos/jobs/" itemprop="url" rel="index">
                    <span itemprop="name">jobs</span>
                  </a>
                </span>

                
                
                  . 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/bezos/jobs/设计/" itemprop="url" rel="index">
                    <span itemprop="name">设计</span>
                  </a>
                </span>

                
                
                  . 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/bezos/jobs/设计/乔布斯/" itemprop="url" rel="index">
                    <span itemprop="name">乔布斯</span>
                  </a>
                </span>

                
                
                  . 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/bezos/jobs/设计/乔布斯/贝索斯/" itemprop="url" rel="index">
                    <span itemprop="name">贝索斯</span>
                  </a>
                </span>

                
                
                  . 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/bezos/jobs/设计/乔布斯/贝索斯/干货/" itemprop="url" rel="index">
                    <span itemprop="name">干货</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="旅游"><a href="#旅游" class="headerlink" title="#旅游"></a>#旅游</h2><p>终于差不多可以休息个半个月去旅游下了。作为旅游前的最后一遍博文，就把这周的工作作为主体阐述下，也把最近看的书的一点感悟阐述下。</p>
<h2 id="乔布斯与贝索斯"><a href="#乔布斯与贝索斯" class="headerlink" title="#乔布斯与贝索斯"></a>#乔布斯与贝索斯</h2><p>最近看一网打尽，发现乔布斯和贝索斯还真是很像。虽然，他们人性中都有很多让正常人不好沟通交流的地方，让他们的员工都很怕和他们一起坐电梯，但是，他们的感染力、创新力、决策力、行动力，还是让我们尊称他们为神。<br>首先，他们有产品经理应该有的嗅觉，可以说，乔布斯80年代就已经预测到了二十一世纪的电脑使用方式了，只是他太超前了，当时的主流用户根本没法接受；而贝索斯虽然也有很多失误，但是他大方向上都是没错的，一键下单、推荐引擎、Kindle阅读器等，都是划时代的产品。可以说，乔布斯重定义了电脑和手机，贝索斯重定义了书；<br>然后，他们都具有非常强的现实扭曲力，乔布斯可以告诉你，电脑就是应该这么操作的，手机就应该像我这么用。他觉得你不该有的东西，就不能有。不像安卓手机，尽可能的满足用户的各种需求，最后导致定制化太多，整个安卓平台都是碎片化的。一个好的产品，只需要满足80%主流用户的80%主要需求即可。而贝索斯，他改变了人们不止实现了世界上最大的书店，慢慢的发展成最大的电商平台，最大的综合服务公司，他不断的创新，不断的让你接受他的创新；<br>还有，他们都有很强的决策力和行动力，他们不但能清晰的看到机会，还能将想法很快的付出于行动。他们都崇尚于行动；<br>另外，他们都被董事会提议解雇，最后乔布斯确实被一个来自可口可乐的卖糖水的人赶走了，而贝索斯也差点被一个来自百事可乐卖糖水的赶走，还好贝索斯的感染力比乔布斯好，很多手下还是被他感（xi）染（nao）了，成为了Jeff Reboot；<br>最后，他们都对自己的技术合伙人很冷酷。乔布斯又沃兹，贝索斯有卡芬，这两个奇才除了技术都很牛意外，他们还有个同样的特点，内向，木讷。卡芬至少还争取了，沃兹就显得无所谓了，任由乔布斯一点一点的把他边缘化，最后他也就去做遥控器开发了，不过，挺成功的。<strong>对于乔布斯和贝索斯，在他们的字典里面，没有合作这个词，只有为他们所用</strong>。</p>
<p>他们的名言：</p>
<ol>
<li>Stay hungry stay foolish.</li>
<li>We are our choice.</li>
</ol>
<h2 id="监控模块重构"><a href="#监控模块重构" class="headerlink" title="#监控模块重构"></a>#监控模块重构</h2><h2 id="原问题"><a href="#原问题" class="headerlink" title="原问题"></a>原问题</h2><p>原来监控模块的逻辑有两个问题</p>
<ol>
<li>原来的TMtObjItem与TMtObj的对应关系是固定的，比如原有4个监控项，那么就是4：1，就是说，比如一个监控对象是服务器，那么就有4个监测项（连通性、CPU、内存、磁盘）。那么就存在一个问题，如果有两个监控方案对应同一个监控对象，那么他们就存在同步的问题。比如监控方案A修改了CPU使用率的监测阀值，那么监控方案B就必须和A一样，如果B再设置了，就又会把A覆盖了；</li>
<li>按原有的设计，注册监控对象的时候，就一定要创建监控项，因为他与方案是无关的，且还要建立与现有的类型监控方案的关系；</li>
<li>按原有设计，监控项日志记录与监控项绑定，那么，就无法判断每次监测对象的时候是监测了几个对象。</li>
</ol>
<h2 id="重构设计UML"><a href="#重构设计UML" class="headerlink" title="重构设计UML"></a>重构设计UML</h2><p><img src="http://i1.tietuku.com/86a31da4f94810e3s.jpg" alt=""></p>
<h2 id="依赖关系调整"><a href="#依赖关系调整" class="headerlink" title="依赖关系调整"></a>依赖关系调整</h2><h2 id="监控数据结构关系调整"><a href="#监控数据结构关系调整" class="headerlink" title="# 监控数据结构关系调整"></a># 监控数据结构关系调整</h2><p>去除了原数据结构TMtObjItem，TMTObjNorm，TMtObjThreadhol等对象，取而代之的是TMTSchemeItem、TMtShcemeObj，并且与方案1对n关联，TMtObj对象并不直接持有，但是TMtSchemeObj持有TMtObj作为MetaObj。</p>
<h2 id="监控日志关系调整"><a href="#监控日志关系调整" class="headerlink" title="# 监控日志关系调整"></a># 监控日志关系调整</h2><p>让监测对象日志与调度方案日志绑定，这样做数据分析统计的时候，就可以根据查找相应对象最近调度方案来找到最近一次监控的结果，就算只监控了其中几个监测项，也可以发现。</p>
<h2 id="溯源方式调整"><a href="#溯源方式调整" class="headerlink" title="溯源方式调整"></a>溯源方式调整</h2><p>在SerialMonitor中，会通过判断方案的类型，如果是类型监测方案就会向上追溯，比如监控数据库，有异常就会去监测是否是服务器存在异常。如果是组合监控方案，就会根据组合监控对象的组合结构，去往下追溯异常源头。</p>
<h2 id="构造方式"><a href="#构造方式" class="headerlink" title="构造方式"></a>构造方式</h2><p>原类型监测方案创建时候会去创建TMtObjItem，当创建监控对象的时候还要将新创建的监控对象添加到相应的类型监测方案下。现在只是运行监测方案的时候，会去构造TMtSchemeObj和TMtSchemeItem。</p>
<h2 id="监控结果记录方式"><a href="#监控结果记录方式" class="headerlink" title="监控结果记录方式"></a>监控结果记录方式</h2><p>原来的监控结果基本记录在TMtLogObjItem中。现在另外还记在TMtSchemeItem中，方便追溯。</p>
<h2 id="调用方式"><a href="#调用方式" class="headerlink" title="调用方式"></a>调用方式</h2><p>SerialMonitor的monitor方法为入口方法，可以争对不同的实现子类实现多态。而其基类的monitorOneItem方法为抽象的逻辑，对溯源、监控、记录日志、监控监控项状态等行为进行了调用。这些行为依赖于相应的接口，这些接口可以有不同的子类实现，通过策略模式与模板模式实现了具体监控的多态。</p>
<h2 id="重构中发现的问题"><a href="#重构中发现的问题" class="headerlink" title="重构中发现的问题"></a>重构中发现的问题</h2><p>代码的重构可以用单元测试来防止错误，那么，现有很多数据都是通过存储过程来分析统计的。对于存储过程这块没有相应的单元测试方法，为了验证重构有没有带来影响，我只能辛苦的造数据，而且测试完以后觉得还是存在隐患，因为覆盖度根本不够。<br>或许有人会说，那么就不用存储过程，吧分析统计写到java里面，将控制权把握在手上呗。但是，这要看场景。因为我们的业务线比较长，甚至到了新疆内蒙等地方，如果把分析统计这种会根据实际需要变的业务逻辑写到程序中，那么必定导致开发人员的维护工作大大增加，有的时候不得不出差到现场去解决问题。那么，如果用存储过程，我只要定义好需要的数据，存储过程怎么去统计和分析，都是现场的运维人员可控的。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2014/05/20/2014-05-20-everythis-is-in-our-store-2/" itemprop="url">
                  Everythis is store书载(2)
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Veröffentlicht am</span>
            <time itemprop="dateCreated" datetime="2014-05-20T14:32:00+08:00" content="2014-05-20">
              2014-05-20
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">in</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Amazon/" itemprop="url" rel="index">
                    <span itemprop="name">Amazon</span>
                  </a>
                </span>

                
                
                  . 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Amazon/bezos/" itemprop="url" rel="index">
                    <span itemprop="name">bezos</span>
                  </a>
                </span>

                
                
                  . 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Amazon/bezos/一网打尽/" itemprop="url" rel="index">
                    <span itemprop="name">一网打尽</span>
                  </a>
                </span>

                
                
                  . 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Amazon/bezos/一网打尽/EverythisIsStore/" itemprop="url" rel="index">
                    <span itemprop="name">EverythisIsStore</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>有一次散步时，卡芬问贝佐斯，既然他们现在已经实现了一些早期目标，为何还极力向外扩张。贝佐斯回答：“当公司规模还非常弱小时，其他大公司会随时出现，并且极力抢夺你的果实。因此我们必须平衡竞争力量，来和那些老牌图书销售商抗衡。”</p>
<p>每天一睁眼就要有忧患意识，但不用关注我们的对手，因为他们不会给我们送钱。让我们更关注顾客吧，各位一定要脚踏实地。</p>
<p>首次公开募股前，贝佐斯和他的这位老搭档一同散步，告诉他公司需要更强的技术管理人员，然后想任命他为亚马逊的首席技术官。这听起来像是升职了，但实际上，卡芬将变成一个顾问的角色，既不需要做预算，也不需要负直接责任。卡芬想了几天，没答应，但贝佐斯知道卡芬的性格，然后说“让它过去吧”,就再也没提这事了。</p>
<p>这时，两个承诺发生了冲突。贝佐斯曾向卡芬承诺，可以永久保留他的工作。但亚马逊的创始人还向公司和投资人承诺，他将会提高应聘标准，亚马逊的命运与招募的技术人员的能力息息相关。瑞克·达尔泽尔和乔尔·施皮格尔两人擅长于公司政治；而卡芬是一位性格内向的电脑奇才，有些过于理想化，缺乏领导才能事实上，他已经不再插手员工招聘和壮大自己部门的工作了。但他却默默地为亚马逊奉献了自己，并且帮助亚马逊确立了世界地位。回首当年，贝佐斯的电子表格上就是一串虚无缥缈的数字而已。</p>
<p>年来的历程却感到有些酸楚。他把贝佐斯不让他参与亚马逊决策一事称为“是对信任的一种背叛”，忘了当初两人共同创业时的艰辛。卡芬说，他得到的是“一生中最令他失望的一次遭遇”。</p>
<p>这些不满是许多亚马逊老员工相同境遇的浓缩版。由于贝佐斯令人信服的信条，使得所有员工都怀有一种信念，他们确实也得到了丰厚的回报。但这位眼神坚定的创始人最终还是把他们解雇了，取而代之的是拥有新观念和更多经验的人。公司前进中，再也看不到这些老员工的身影了，这实在让人心酸，好像是他的孩子离开了家，又搬到了另一个家。最终，Bezos向卡芬坦言，亚马逊只有一个真正的父亲。</p>
<p>当我们看到获得市场领先地位的可能性很大时，做投资决定就要大胆，而不要畏首畏尾。这些投资有些会获得回报，有些则不能，但我们从二者中都会吸取宝贵的经验。</p>
<p>贝佐斯强调亚马逊日常运行中的节俭习惯。他让员工付停车费，并要求所有高管出差坐经济舱。</p>
<p>贝佐斯吸取了沃尔顿自传中的精华，而且沿用沃尔玛创始人的节俭作风以及“崇尚行动”的做法，并使其融入了亚马逊的文化中。</p>
<p><strong>沃尔玛式的传奇在今天这个时代还能重现吗？我的答案是，当然还会。或许现在就有人正在跃跃欲试——或许有成千上万的人在做——他们有足够多的创意支持其一路走下去。假如有人非常热切地追求自己心中的梦想，虽然期间会经历很多的失败，但也要锲而不舍地坚持下去。这全仰仗一个人的态度和能力，要不断研究和探寻商业管理的秘诀。</strong></p>
<p>杰夫·贝佐斯就具备了山姆·沃尔顿所描绘的那些品质。他一直不愿意让亚马逊屈从于任何官僚的慵懒作风，希望不断有新的想法涌现，想方设法改进网站的过去做法，以吸引更多的顾客，始终走在对手的前头。</p>
<p>谁也不能跟杰夫·贝佐斯合作，而只能替他卖命。</p>
<p>Bezos把亚马逊定义为一家以顾客为中心的公司，而并非以竞争者为核心的公司。</p>
</blockquote>
<p><em>但后来事实证明，Bezos在易趣的竞争下，单纯为了竞争，下了很多昏招。</em></p>
<blockquote>
<p><strong>五项狠心价值：顾客至上（ customer   obsession）、 勤俭节约（ frugality）、 崇尚行动（ bias   for   action）、 主人翁精神（ ownership） 和人才招聘的高标准（ high   bar   talent）。 后来又加上一条：创新（ innovation ）</strong></p>
</blockquote>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/4/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><span class="page-number current">5</span><a class="page-number" href="/page/6/">6</a><span class="space">&hellip;</span><a class="page-number" href="/page/10/">10</a><a class="extend next" rel="next" href="/page/6/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="David Woo" />
          <p class="site-author-name" itemprop="name">David Woo</p>
          <p class="site-description motion-element" itemprop="description"></p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/">
              <span class="site-state-item-count">96</span>
              <span class="site-state-item-name">Artikel</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              
                <span class="site-state-item-count">195</span>
                <span class="site-state-item-name">Kategorien</span>
              
            </div>
          

          
            <div class="site-state-item site-state-tags">
              
                <span class="site-state-item-count">4</span>
                <span class="site-state-item-name">Tags</span>
              
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">David Woo</span>
</div>

<div class="powered-by">
  Erstellt mit  <a class="theme-link" href="https://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  



  




  
  

  

  

  

</body>
</html>
