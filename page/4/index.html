<!doctype html>



  


<html class="theme-next muse use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta property="og:type" content="website">
<meta property="og:title" content="大胃吴的闲话唠嗑">
<meta property="og:url" content="http://yoursite.com/page/4/index.html">
<meta property="og:site_name" content="大胃吴的闲话唠嗑">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="大胃吴的闲话唠嗑">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: 'Author'
    }
  };
</script>




  <link rel="canonical" href="http://yoursite.com/page/4/"/>

  <title> 大胃吴的闲话唠嗑 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">大胃吴的闲话唠嗑</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">扯扯技术，唠唠闲话 交流email-xiao303178394@gmail.com</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-首页">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            menu.首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-文章">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            menu.文章
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/02/28/2015-02-28-beginning-ios-pit-over-those-years-d/" itemprop="url">
                  初学IOS那些年踩过的坑(四)
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Veröffentlicht am</span>
            <time itemprop="dateCreated" datetime="2015-02-28T02:47:00+08:00" content="2015-02-28">
              2015-02-28
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>#集成友盟后报错<br>错误日志如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">15-02-12 09:26:47.206 Runmove[2532:13249] NSScanner: nil string argument</div><div class="line">2015-02-12 09:26:47.206 Runmove[2532:13249] Umeng: Read binary image info failed!</div></pre></td></tr></table></figure></p>
<p>分析：其实不是友盟问题，是自己程序中有了个错误，只是打开了友盟的调试开关，所以报了友盟错误。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">//    [MobClick setLogEnabled:YES];</div></pre></td></tr></table></figure></p>
<p>解决：注释该行代码后可以正常报告出程序中的异常</p>
<p>#tableview下方空白处的seprator line去除<br>tableview的黑魔法<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">self</span>.tableView.tableFooterView = [<span class="built_in">UIView</span> new];</div></pre></td></tr></table></figure></p>
<p>#navigationbar的左滑返回<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">    <span class="keyword">self</span>.navigationItem.leftBarButtonItem = [[<span class="built_in">UIBarButtonItem</span> alloc]</div><div class="line">                                         initWithImage:img</div><div class="line">                                         style:<span class="built_in">UIBarButtonItemStylePlain</span></div><div class="line">                                         target:<span class="keyword">self</span></div><div class="line">                                         action:<span class="keyword">@selector</span>(onBack:)];</div><div class="line"><span class="keyword">self</span>.navigationController.interactivePopGestureRecognizer.delegate = (<span class="keyword">id</span>)<span class="keyword">self</span>;</div></pre></td></tr></table></figure></p>
<p>#autolayout的nib和手写并用的实践<br>使用nib做界面，但是layoutAttribute有些又需要根据适配来适配，nib+手写混写好烦恼啊，感觉睡不着觉了<br>其实错了，混写其实很简单的，可以像拉button一样的拉你的约束.nslayoutattribute也是可以拉线的，这样一切都太平了</p>
<p>#画面不流畅<br>画面不流畅可能是因为一些透明视图影响了fps，可以去掉这些透明视图<br>方法：Product-&gt;Profile-&gt;Core Animation-&gt;右下第二个选项卡中勾上Color Blended Layers<br>然后看到红色的就都是透明的视图，不需要透明效果的可以去掉透明</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/02/05/2015-02-05-sql-table-from-the-record-by-the-time-to-calculate-the-continuous-days/" itemprop="url">
                  用SQL从记录表中根据时间算出连击天数
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Veröffentlicht am</span>
            <time itemprop="dateCreated" datetime="2015-02-05T05:05:00+08:00" content="2015-02-05">
              2015-02-05
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">in</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/蛋疼/" itemprop="url" rel="index">
                    <span itemprop="name">蛋疼</span>
                  </a>
                </span>

                
                
                  . 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/蛋疼/折腾/" itemprop="url" rel="index">
                    <span itemprop="name">折腾</span>
                  </a>
                </span>

                
                
                  . 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/蛋疼/折腾/作死/" itemprop="url" rel="index">
                    <span itemprop="name">作死</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>#概述<br>这是一个蛋疼的折腾，just for fun。<br>问题是这样的，有一张表A，有user_id,create_time这两个属性，要用sql查询，查询的结果是user_id,continue_days。</p>
<p>#首先<br>数据库是mysql，没有oracle那么强大的函数集，连row_num都是要自己实现的，也没有什么好用的聚合函数，逻辑控制函数，用sql做这个操作是很蛋疼，不如用代码去查询，但是，俺本着just for fun的精神折腾了下。<br>然后想了下要怎么操作，就想到了一个法子。<br>我的思路是这样的：先根据时间去group by，把同一天内相同的数据合并，然后排序并编号，那么这张表自身内联下，t1.create_date - t2.create_date = t1.row_num - t2.row_num 的记录，取他的t1.create_date - t2.create_date结果，那就是连续的天数。</p>
<p>#问题<br>实现过程碰到两个问题，一个是t1.create_date - t2.create_date的结果要加上1，这才是正确的结果，否则就忽略了起始日。<br>另一个问题是开始直接用yyyymmdd形式，忽略了跨月，所以后来改成了TO_DAYS函数做转化。</p>
<p>#实现<br>实现就看几个sql把。<br><figure class="highlight sql"><figcaption><span>view_route</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">CREATE</span></div><div class="line">    ALGORITHM = UNDEFINED</div><div class="line">    DEFINER = <span class="string">`team_xm`</span>@<span class="string">`%`</span></div><div class="line">    <span class="keyword">SQL</span> <span class="keyword">SECURITY</span> DEFINER</div><div class="line"><span class="keyword">VIEW</span> <span class="string">`view_route`</span> <span class="keyword">AS</span></div><div class="line">    <span class="keyword">SELECT</span></div><div class="line">        (<span class="keyword">TO_DAYS</span>(<span class="string">`t`</span>.<span class="string">`create_date`</span>) - <span class="keyword">TO_DAYS</span>(<span class="string">'2000-01-01'</span>)) <span class="keyword">AS</span> <span class="string">`r_timestamp`</span>,</div><div class="line">        <span class="string">`t`</span>.<span class="string">`user_id`</span> <span class="keyword">AS</span> <span class="string">`user_id`</span></div><div class="line">    <span class="keyword">FROM</span></div><div class="line">        <span class="string">`route`</span> <span class="string">`t`</span></div><div class="line">    <span class="keyword">WHERE</span></div><div class="line">        (<span class="string">`t`</span>.<span class="string">`user_id`</span> <span class="keyword">IN</span> (<span class="string">'3'</span> , <span class="string">'7'</span>, <span class="string">'17'</span>, <span class="string">'1'</span>))</div></pre></td></tr></table></figure></p>
<p><img src="http://chuantu.biz/t/65/1423113571x1822611171.jpg" alt=""><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">CREATE</span></div><div class="line">    ALGORITHM = UNDEFINED</div><div class="line">    DEFINER = <span class="string">`team_xm`</span>@<span class="string">`%`</span></div><div class="line">    <span class="keyword">SQL</span> <span class="keyword">SECURITY</span> DEFINER</div><div class="line"><span class="keyword">VIEW</span> <span class="string">`view_route_bydate`</span> <span class="keyword">AS</span></div><div class="line">    <span class="keyword">SELECT</span></div><div class="line">        <span class="string">`t`</span>.<span class="string">`r_timestamp`</span> <span class="keyword">AS</span> <span class="string">`r_timestamp`</span>,</div><div class="line">        <span class="string">`t`</span>.<span class="string">`user_id`</span> <span class="keyword">AS</span> <span class="string">`user_id`</span></div><div class="line">    <span class="keyword">FROM</span></div><div class="line">        <span class="string">`view_route`</span> <span class="string">`t`</span></div><div class="line">    <span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="string">`t`</span>.<span class="string">`r_timestamp`</span> , <span class="string">`t`</span>.<span class="string">`user_id`</span></div><div class="line">    <span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="string">`t`</span>.<span class="string">`r_timestamp`</span></div></pre></td></tr></table></figure></p>
<p><img src="http://chuantu.biz/t/65/1423113597x1822611171.jpg" alt=""><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">CREATE</span></div><div class="line">    ALGORITHM = UNDEFINED</div><div class="line">    DEFINER = <span class="string">`team_xm`</span>@<span class="string">`%`</span></div><div class="line">    <span class="keyword">SQL</span> <span class="keyword">SECURITY</span> DEFINER</div><div class="line"><span class="keyword">VIEW</span> <span class="string">`view_route_bydate_withnum`</span> <span class="keyword">AS</span></div><div class="line">    <span class="keyword">SELECT</span></div><div class="line">        <span class="string">`t`</span>.<span class="string">`r_timestamp`</span> <span class="keyword">AS</span> <span class="string">`r_timestamp`</span>,</div><div class="line">        <span class="string">`t`</span>.<span class="string">`user_id`</span> <span class="keyword">AS</span> <span class="string">`user_id`</span>,</div><div class="line">        (<span class="keyword">SELECT</span></div><div class="line">                (<span class="keyword">COUNT</span>(<span class="number">0</span>) + <span class="number">1</span>) <span class="keyword">AS</span> <span class="string">`row_num`</span></div><div class="line">            <span class="keyword">FROM</span></div><div class="line">                <span class="string">`view_route_bydate`</span> <span class="string">`t2`</span></div><div class="line">            <span class="keyword">WHERE</span></div><div class="line">                ((<span class="string">`t2`</span>.<span class="string">`r_timestamp`</span> &lt; <span class="string">`t`</span>.<span class="string">`r_timestamp`</span>)</div><div class="line">                    <span class="keyword">AND</span> (<span class="string">`t2`</span>.<span class="string">`user_id`</span> = <span class="string">`t`</span>.<span class="string">`user_id`</span>))) <span class="keyword">AS</span> <span class="string">`row_num`</span></div><div class="line">    <span class="keyword">FROM</span></div><div class="line">        <span class="string">`view_route_bydate`</span> <span class="string">`t`</span></div></pre></td></tr></table></figure></p>
<p><img src="http://chuantu.biz/t/65/1423113616x1822611171.jpg" alt=""><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">CREATE</span></div><div class="line">    ALGORITHM = UNDEFINED</div><div class="line">    DEFINER = <span class="string">`team_xm`</span>@<span class="string">`%`</span></div><div class="line">    <span class="keyword">SQL</span> <span class="keyword">SECURITY</span> DEFINER</div><div class="line"><span class="keyword">VIEW</span> <span class="string">`view_user_riding_day_count`</span> <span class="keyword">AS</span></div><div class="line">    <span class="keyword">SELECT</span></div><div class="line">        <span class="string">`t1`</span>.<span class="string">`user_id`</span> <span class="keyword">AS</span> <span class="string">`user_id`</span>,</div><div class="line">        (<span class="keyword">MAX</span>((<span class="string">`t1`</span>.<span class="string">`row_num`</span> - <span class="string">`t2`</span>.<span class="string">`row_num`</span>)) + <span class="number">1</span>) <span class="keyword">AS</span> <span class="string">`count`</span></div><div class="line">    <span class="keyword">FROM</span></div><div class="line">        (<span class="string">`view_route_bydate_withnum`</span> <span class="string">`t1`</span></div><div class="line">        <span class="keyword">JOIN</span> <span class="string">`view_route_bydate_withnum`</span> <span class="string">`t2`</span>)</div><div class="line">    <span class="keyword">WHERE</span></div><div class="line">        (((<span class="string">`t1`</span>.<span class="string">`r_timestamp`</span> - <span class="string">`t2`</span>.<span class="string">`r_timestamp`</span>) = (<span class="string">`t1`</span>.<span class="string">`row_num`</span> - <span class="string">`t2`</span>.<span class="string">`row_num`</span>))</div><div class="line">            <span class="keyword">AND</span> (<span class="string">`t1`</span>.<span class="string">`user_id`</span> = <span class="string">`t2`</span>.<span class="string">`user_id`</span>))</div><div class="line">    <span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="string">`t1`</span>.<span class="string">`user_id`</span></div></pre></td></tr></table></figure></p>
<p><img src="http://chuantu.biz/t/65/1423113634x1822611171.jpg" alt=""></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/02/05/2015-02-05-beginning-ios-pit-over-those-years-c/" itemprop="url">
                  初学IOS那些年踩过的坑(三)
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Veröffentlicht am</span>
            <time itemprop="dateCreated" datetime="2015-02-05T04:55:00+08:00" content="2015-02-05">
              2015-02-05
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>#我是主题<br>今天这章就是一些小问题的汇总，木有主题</p>
<p>#我是内容</p>
<h2 id="无符号整形的负溢出负溢出"><a href="#无符号整形的负溢出负溢出" class="headerlink" title="无符号整形的负溢出负溢出"></a>无符号整形的负溢出负溢出</h2><p>要小心无符号整形的负溢出负溢出，比如下面代码，当photos数组的数量为1时，第三行就负溢出了。要使用 [array count]的时候要注意。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">NSString *leftPhotoName = [_photos count] &gt; indexPath.row ?[_photos objectAtIndex:indexPath.row]:nil;</div><div class="line">NSString *middlePhotoName = [_photos count]-1) &gt; indexPath.row ?[_photos objectAtIndex:(indexPath.row+1)]:nil;</div><div class="line">NSString *rightPhotoName = ([_photos count]-2) &gt; indexPath.row ?[_photos objectAtIndex:(indexPath.row+2)]:nil;</div></pre></td></tr></table></figure></p>
<h2 id="NIB与手写代码不一致的一些坑"><a href="#NIB与手写代码不一致的一些坑" class="headerlink" title="NIB与手写代码不一致的一些坑"></a>NIB与手写代码不一致的一些坑</h2><h2 id="UIView的交互开关"><a href="#UIView的交互开关" class="headerlink" title="# UIView的交互开关"></a># UIView的交互开关</h2><p>用Nib创建的View默认是不进行交互的，所以要勾上User Interaction Enabled。<br>否则将不能接受如下代码的手势的事件<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)initPhotoImageViewAction:(<span class="built_in">UIImageView</span> \*) imageView</div><div class="line">&#123;</div><div class="line">    <span class="built_in">UITapGestureRecognizer</span> \*tapRecognizer = [[<span class="built_in">UITapGestureRecognizer</span> alloc] initWithTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(scrollerTapped:)];</div><div class="line"></div><div class="line">    [imageView addGestureRecognizer:tapRecognizer];</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)scrollerTapped:(<span class="built_in">UITapGestureRecognizer</span>*)gesture</div><div class="line">&#123;</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>,gesture.view);</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"11"</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="UIActivityIndicator的动画"><a href="#UIActivityIndicator的动画" class="headerlink" title="# UIActivityIndicator的动画"></a># UIActivityIndicator的动画</h2><p>nib中创建的会自动旋转，而手写代码要记得[indicator startAnimation]，否则不显示。</p>
<h2 id="UIViewController的绘制"><a href="#UIViewController的绘制" class="headerlink" title="UIViewController的绘制"></a>UIViewController的绘制</h2><p>问题是这样的，UIViewController的self.view只有一个subview，而subview为UIImageView，开始在initWithNibName中初始化UIImageView的image，UIImageView的初始化不成功，第一次进入时候图片无法展现。<br>之后迁移到viewDidLoad中，进行初始化，就没问题了，所以要注意，UIVIewCOntroller的生命周期，initWithNibName并未完成初始化。</p>
<h2 id="UIImageVIew的autolayout和Aspect-Fit"><a href="#UIImageVIew的autolayout和Aspect-Fit" class="headerlink" title="UIImageVIew的autolayout和Aspect Fit"></a>UIImageVIew的autolayout和Aspect Fit</h2><p>autolayout和Aspect Fit不冲突，因此，UIImageVIew需要增加完全的约束，而Aspect Fit会根据计算的大小进行Aspect Fit。</p>
<h2 id="用-class避免循环引用"><a href="#用-class避免循环引用" class="headerlink" title="用@class避免循环引用"></a>用@class避免循环引用</h2><p>A引用B，B引用A则为造成引用循环，这时候可以用@class来解决。此外，还可以提高效率，比如引用链为A-&gt;B,B-&gt;C,C-&gt;D如果都用#import，则中间有一个修改都会造成全部的编译，效率较低</p>
<h2 id="UIVIewController对于布局的生命周期"><a href="#UIVIewController对于布局的生命周期" class="headerlink" title="UIVIewController对于布局的生命周期"></a>UIVIewController对于布局的生命周期</h2><p>[[UIVIewController alloc] init]时候，不会UpdateContrainers，不会进行AutoLayout，不会触发viewDidAppear等方法，所以在[[UIVIewController alloc] init]后就对视图进行和布局有关的操作都是无效的，在viewDidLoad中、[[UIVIewController alloc] init]后只能进行数据的初始化操作。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[runPhotoViewController index:gesture.view.tag];</div><div class="line">[self presentViewController:runPhotoViewController animated:YES completion:^&#123;&#125;];</div></pre></td></tr></table></figure>
<p>要改为<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[self presentViewController:runPhotoViewController animated:YES completion:^&#123;</div><div class="line">    [runPhotoViewController index:gesture.view.tag];</div><div class="line">&#125;];</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">- (void)viewDidLoad &#123;</div><div class="line">    //去掉</div><div class="line">    //[self setScrollViewContentSize];</div><div class="line">&#125;</div><div class="line">-(void)viewDidAppear:(BOOL)animated</div><div class="line">&#123;</div><div class="line">    if(!isInitScale)//防止多次调用</div><div class="line">    &#123;</div><div class="line">        [self setScrollViewContentSize];</div><div class="line">        isInitScale = YES;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="真机调试证书问题"><a href="#真机调试证书问题" class="headerlink" title="真机调试证书问题"></a>真机调试证书问题</h2><p>coding signing indntity问题，需要更新证书<br><img src="http://chuantu.biz/t/65/1423112120x1822611171.png" alt=""><br><img src="http://chuantu.biz/t/65/1423112614x1822611171.png" alt=""><br><img src="http://chuantu.biz/t/65/1423112647x-954497605.png" alt=""></p>
<h2 id="building时候报错"><a href="#building时候报错" class="headerlink" title="building时候报错"></a>building时候报错</h2><p>报错说XXX文件找不到，考虑可能是更新代码后遗留库影响，product中的clean执行一下<br><img src="http://chuantu.biz/t/65/1423112680x-954497605.png" alt=""></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/02/01/2015-02-01-ios-beginner-pit-over-those-years-b/" itemprop="url">
                  初学IOS那些年踩过的坑(二)
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Veröffentlicht am</span>
            <time itemprop="dateCreated" datetime="2015-02-01T10:02:00+08:00" content="2015-02-01">
              2015-02-01
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>#结论：<br>在ViewController的自定义viewDidLayoutSubviews方法中，调用viewDidLayoutSubviews方法后进行了addSubview操作后，需要调用[self.view layoutSubviews]来触发子视图布局，否则否导致子视图不知道如何布局而应用崩溃。</p>
<p>#坑描述：<br>为了给IPHONE做适配，实现了ViewController的 viewDidLayoutSubviews方法，该方法是在试图控制器对试图进行auto layout的时候调用其来触发子视图的auto layout的。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">- (void)viewDidLayoutSubviews &#123;</div><div class="line">    [super viewDidLayoutSubviews];</div><div class="line">    NSString *deviceInfo = [CommonUtils getDeviceInfo];</div><div class="line">    int mapHeight = ROUTE_MAP_SCREEN_MAP_HEIGHT_5;</div><div class="line">    if ([deviceInfo isEqualToString:@&quot;iPhone 4S&quot;] || [deviceInfo isEqualToString:@&quot;iPhone 4&quot;]) &#123;</div><div class="line">        mapHeight = ROUTE_MAP_SCREEN_MAP_HEIGHT_4S;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    self.downNavBar.frame = CGRectMake(0, mapHeight, self.view.bounds.size.width, 95);</div><div class="line">    [self.view addSubview:self.downNavBar];</div><div class="line"></div><div class="line">    [self.menuView setHidden:YES];</div><div class="line">    [self.view addSubview:self.menuView];</div><div class="line">    [self.view bringSubviewToFront:self.menuView];</div><div class="line"></div><div class="line">    self.menuView.frame = CGRectMake(38, mapHeight - 110, 80, 110);</div><div class="line">    [self.mapBed setFrame:CGRectMake(0, 0, self.view.bounds.size.width, mapHeight)];</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>但是，调用该视图的时候应用崩溃了，后台报错<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&apos;NSInternalInconsistencyException&apos;, reason: &apos;Auto Layout still required after sending -viewDidLayoutSubviews to the view controller. RouteMapViewController&apos;s implementation needs to send -layoutSubviews to the view to invoke auto layout.&apos;</div></pre></td></tr></table></figure></p>
<p>#坑解释<br>自动布局的方式为自上而下，也就是从父视图向子视图，调用了[super viewDidLayoutSubviews]就是为了触发子视图的布局，但是之后又增加了2个子视图，那么这两个子视图的布局就没有触发。所以，需要在该方法最后增加一行代码来触发子视图的布局。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">- (void)viewDidLayoutSubviews &#123;</div><div class="line">    ...</div><div class="line">    [self.mapBed setFrame:CGRectMake(0, 0, self.view.bounds.size.width, mapHeight)];</div><div class="line">    [self.view layoutSubviews];</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/01/30/2015-01-30-beginning-ios-stepped-on-the-pits-for-years-a/" itemprop="url">
                  初学IOS那些年踩过的坑(一)
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Veröffentlicht am</span>
            <time itemprop="dateCreated" datetime="2015-01-30T02:36:00+08:00" content="2015-01-30">
              2015-01-30
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>#Indicator的隐藏显示</p>
<h2 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h2><p>ActivityIndicator的隐藏用stopAnimating，不要用hidden = YES。</p>
<h2 id="坑描述："><a href="#坑描述：" class="headerlink" title="坑描述："></a>坑描述：</h2><p><img src="http://chuantu.biz/t/63/1422585664x1822611446.jpg" alt=""><br>代码的停止方式使用这种方式去停止<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">self</span>.heartIndicator.hidden = <span class="literal">YES</span>;</div></pre></td></tr></table></figure></p>
<p>带来的问题是push到别的页面pop回来后，又开始旋转了。<br><img src="http://chuantu.biz/t/63/1422585698x-954497586.jpg" alt=""><br>创建了个Indicator子类，用KVO可以发现页面PUSH走和POP回来都会change hidden的值</p>
<h2 id="坑解释"><a href="#坑解释" class="headerlink" title="坑解释"></a>坑解释</h2><p>所以可以看出，IOS对于显示隐藏都会对View属性进行重构，而Indicator的Hidden值在重构时候是根据animate的值来判断的，如果值为YES，那hidden的属性则为NO。<br>所以，千万别用hidden属性来隐藏Indicator（其他地方都操作View都如此），要用[self.heartIndicator stopAnimating];</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/01/28/2015-01-28-django-nginx-uswgi-mysql-production-environment-server-migration/" itemprop="url">
                  Django、nginx、uswgi、mysql生产环境的服务器迁移
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Veröffentlicht am</span>
            <time itemprop="dateCreated" datetime="2015-01-28T08:28:00+08:00" content="2015-01-28">
              2015-01-28
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>#迁移环境</p>
<h2 id="source"><a href="#source" class="headerlink" title="source"></a>source</h2><ul>
<li>(此处修改，不公开服务器)</li>
<li>ubuntu 12.04</li>
</ul>
<h2 id="target"><a href="#target" class="headerlink" title="target"></a>target</h2><ul>
<li>此处修改，不公开服务器</li>
<li>ubuntu 14.04.1</li>
</ul>
<p>#旧服务器备份</p>
<h2 id="数据备份"><a href="#数据备份" class="headerlink" title="数据备份"></a>数据备份</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#先连接source</span></div><div class="line">ssh 此处修改，不公开服务器 -l unbx</div><div class="line"><span class="comment">#使用mysqldump命令，用unbxprod用户登录，备份unbxprod库到用户根目录backUp文件夹中的unitybox_mysql_dump.txt文件</span></div><div class="line">mkdir ~/backUp</div><div class="line">mysqldump -u此处修改，不公开服务器 -p 此处修改，不公开服务器 &gt; ~/backUp/unitybox_mysql_dump.txt</div></pre></td></tr></table></figure>
<h2 id="Python运行环境备份"><a href="#Python运行环境备份" class="headerlink" title="Python运行环境备份"></a>Python运行环境备份</h2><p>使用pip命令备份，如果source环境为安装pip。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pip freeze &gt; ~/backUp/requirements.txt</div></pre></td></tr></table></figure></p>
<h2 id="ssl文件备份"><a href="#ssl文件备份" class="headerlink" title="ssl文件备份"></a>ssl文件备份</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cp -r nginx-conf/ backUp/</div></pre></td></tr></table></figure>
<h2 id="脚本-amp-nginx-amp-uwsgi配置文件备份"><a href="#脚本-amp-nginx-amp-uwsgi配置文件备份" class="headerlink" title="脚本&amp;nginx &amp; uwsgi配置文件备份"></a>脚本&amp;nginx &amp; uwsgi配置文件备份</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">mkdir ~/backUp/sript</div><div class="line">mkdir ~/backUp/ng_conf</div><div class="line">mkdir ~/backUp/wsgi_conf</div><div class="line">find ~/ -name *.sh -<span class="built_in">exec</span> cp &#123;&#125; ~/backUp/sript  \</div><div class="line">find ~/ -name *.conf -<span class="built_in">exec</span> cp &#123;&#125; ~/backUp/ng_conf  \</div><div class="line">find ~/ -name *.ini -<span class="built_in">exec</span> cp &#123;&#125; ~/backUp/wsgi_conf  \</div></pre></td></tr></table></figure>
<h2 id="备份文件传送"><a href="#备份文件传送" class="headerlink" title="备份文件传送"></a>备份文件传送</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">scp -r /home/unbx/backUp unbx@此处修改，不公开服务器:/home/unbx/</div></pre></td></tr></table></figure>
<p>#新环境部署<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#先用root连接新服务器，如果unbx用户已创建，请直接用unbx登录</span></div><div class="line">ssh 此处修改，不公开服务器 -l root</div></pre></td></tr></table></figure></p>
<h2 id="系统用户初始"><a href="#系统用户初始" class="headerlink" title="系统用户初始"></a>系统用户初始</h2><h2 id="用户及用户组创建"><a href="#用户及用户组创建" class="headerlink" title="# 用户及用户组创建"></a># 用户及用户组创建</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#记住这里要adduser，否则unbuntu将不会帮你创建用户主目录</span></div><div class="line">adduser unbx</div><div class="line">passwd unbx</div><div class="line">vim /etc/group</div><div class="line"><span class="comment">#配置unbx 组到www-data ，www-data到unbx</span></div></pre></td></tr></table></figure>
<h2 id="设置sudoer"><a href="#设置sudoer" class="headerlink" title="# 设置sudoer"></a># 设置sudoer</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">chmod u+w /etc/sudoers</div><div class="line">vim /etc/sudoers</div><div class="line">chmod u-w /etc/sudoers</div><div class="line"><span class="comment">#这时候用户已经创建完成，切换unbx开始工作</span></div><div class="line">su unbx</div><div class="line"><span class="built_in">cd</span> ~/</div></pre></td></tr></table></figure>
<h2 id="数据清理"><a href="#数据清理" class="headerlink" title="数据清理"></a>数据清理</h2><p>如果mysql在旧机器上未安装，请跳过该章节<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">sudo apt-get autoremove --purge mysql-server-5.0</div><div class="line">sudo apt-get remove mysql-server</div><div class="line">sudo apt-get autoremove mysql-server</div><div class="line">sudo apt-get remove mysql-common</div><div class="line">dpkg -l |grep ^rc|awk <span class="string">'&#123;print $2&#125;'</span> |sudo xargs dpkg -P</div></pre></td></tr></table></figure></p>
<h2 id="安装环境"><a href="#安装环境" class="headerlink" title="安装环境"></a>安装环境</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">sudo apt-get install git mysql-server python-mysqldb python2.7 python2.7-dev</div><div class="line"><span class="comment">#安装pip</span></div><div class="line">wget https://bootstrap.pypa.io/get-pip.py</div><div class="line">python get-pip.py</div><div class="line">sudo python get-pip.py</div><div class="line"><span class="comment">#安装django</span></div><div class="line">sudo pip install https://www.djangoproject.com/download/1.7c1/tarball/</div><div class="line"><span class="comment">#安装pillow的jpg和png依赖</span></div><div class="line">sudo apt-get install libjpeg-dev zlib1g*</div><div class="line">sudo aptitude install libfreetype6-dev</div><div class="line"><span class="comment">#安装OpenSSL的依赖</span></div><div class="line">sudo apt-get install libssl-dev</div></pre></td></tr></table></figure>
<h2 id="配置MySql字符集"><a href="#配置MySql字符集" class="headerlink" title="配置MySql字符集"></a>配置MySql字符集</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo vim /etc/mysql/my.cnf</div></pre></td></tr></table></figure>
<p>在my.cnf中添加相应内容，如下所示</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">……</div><div class="line">    [client]</div><div class="line">    default-character-set=utf8</div><div class="line">……</div><div class="line">    [mysql]</div><div class="line">    default-character-set=utf8</div><div class="line">……</div><div class="line">    [mysqld]</div><div class="line">    collation-server=utf8_unicode_ci</div><div class="line">    init-connect=&apos;SET NAMES utf8&apos;</div><div class="line">    character-set-server=utf8</div><div class="line">    default-storage-engine=InnoDB</div><div class="line">……</div></pre></td></tr></table></figure>
<p>然后重启mysql服务</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo service mysql restart</div></pre></td></tr></table></figure>
<h2 id="设置git的ssh"><a href="#设置git的ssh" class="headerlink" title="设置git的ssh"></a>设置git的ssh</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#https://confluence.atlassian.com/pages/viewpage.action?pageId=270827678</span></div><div class="line">ssh-v    <span class="comment">#看ssh版本</span></div><div class="line">ls<span class="_">-a</span>~/.ssh <span class="comment">#看是否存在.ssh目录，有的话备份后删除</span></div><div class="line">ssh-keygen <span class="comment">#生成ssh秘钥</span></div><div class="line">ls<span class="_">-a</span>~/.ssh <span class="comment">#查看是否生成</span></div><div class="line">ps<span class="_">-e</span>|grep[s]sh-agent  <span class="comment">#查看是否有ssh-agent进程，我的做法是由的话杀了</span></div><div class="line">ssh-agent/bin/bash <span class="comment">#启动ssh-agent</span></div><div class="line">ps<span class="_">-e</span>|grep[s]sh-agent <span class="comment">#查看是否生成</span></div><div class="line">ssh-add~/.ssh/id_rsa <span class="comment">#添加信息到秘钥</span></div><div class="line">ssh-add<span class="_">-l</span></div><div class="line">cat~/.ssh/id_rsa.pub <span class="comment">#查看公钥，添加到git服务器端的个人配置中</span></div></pre></td></tr></table></figure>
<p>把公钥添加到git服务器端的个人ssh配置后，就可以用git下载工程了。注意：【此处修改，不公开服务器】的秘钥时候我设置了密码，密码请参考<a href="https://bitbucket.org/unitybox/pyunitybox/wiki/passwords" target="_blank" rel="external">Account and Passwords</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">gitclonegit@此处不公开</div></pre></td></tr></table></figure>
<h2 id="安装Python运行环境"><a href="#安装Python运行环境" class="headerlink" title="安装Python运行环境"></a>安装Python运行环境</h2><p>前面的步骤中我们已经安装了pip了，现在可以让他排上用场了。先修改requirenment.txt，首先Django刚刚我们已经安装了1.7c1，所以Django那行可以删除。另外，有一些依赖在pip环境上已经变更，所以也需要相应的调整，否则会受影响，这里我根据执行中的环境差异做的调整如下，x为已经不存在的。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pip install -r requirenment.txt</div></pre></td></tr></table></figure></p>
<p>有些环境不一致，可能会报错，很多依赖找不到或者版本不正确，如果遇到可以进行调整，参考如下：</p>
<blockquote>
<p>Twisted-Core==11.1.0 13.2.0</p>
<p>Twisted-Names==11.1.0 x</p>
<p>Twisted-Web==11.1.0 x</p>
<p>apt-xapian-index==0.44 0.45</p>
<p>cloud-init==0.6.3 0.7.5</p>
<p>command-not-found==0.2.44 x</p>
<p>euca2ools==2.0.0 x</p>
<p>language-selector==0.1 xx</p>
<p>launchpadlib==1.9.12  1.6.0</p>
<p>lazr.restfulclient==0.12.0  0.12.2</p>
<p>pycurl==7.19.0  安装报错</p>
<p>python-apt==0.8.3ubuntu7.2   0.9.3.5</p>
<p>unattended-upgrades==0.1 x</p>
<p>wadllib==1.3.0 1.3.2</p>
<p>ufw x</p>
</blockquote>
<p>调整完就可以进行安装了<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pip install -r requirenment.txt</div></pre></td></tr></table></figure></p>
<h2 id="初始化数据库"><a href="#初始化数据库" class="headerlink" title="初始化数据库"></a>初始化数据库</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mysql -uroot -p</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">---初始化数据库用户和数据库</div><div class="line">此处不公开</div><div class="line">---初始化数据</div><div class="line">此处不公开</div><div class="line">source /home/unbx/backUp/unitybox_mysql_dump.txt</div></pre></td></tr></table></figure>
<h2 id="配置uwsgi和nginx"><a href="#配置uwsgi和nginx" class="headerlink" title="配置uwsgi和nginx"></a>配置uwsgi和nginx</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">sudo ln -s ~/PyUnitybox/Web/src/adm_nginx.conf /etc/nginx/sites-enabled/</div><div class="line">sudo ln -s ~/PyUnitybox/Web/src/api_nginx.conf /etc/nginx/sites-enabled/</div><div class="line">sudo ln -s ~/PyUnitybox/Web/src/biz_nginx.conf /etc/nginx/sites-enabled/</div><div class="line">sudo mkdir /etc/uwsgi</div><div class="line">sudo mkdir /etc/uwsgi/vassals</div><div class="line">sudo ln -s ~/PyUnitybox/Web/src/adm_uwsgi.ini /etc/uwsgi/vassals</div><div class="line">sudo ln -s ~/PyUnitybox/Web/src/api_uwsgi.ini /etc/uwsgi/vassals</div><div class="line">sudo ln -s ~/PyUnitybox/Web/src/biz_uwsgi.ini /etc/uwsgi/vassals</div><div class="line"><span class="comment">#创建nginx的log目录</span></div><div class="line">mkdir <span class="built_in">log</span></div></pre></td></tr></table></figure>
<h2 id="考核ssl文件"><a href="#考核ssl文件" class="headerlink" title="考核ssl文件"></a>考核ssl文件</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cp -r ~/backUp/nginx-conf ~/</div></pre></td></tr></table></figure>
<h2 id="修改Django的setting配置文件"><a href="#修改Django的setting配置文件" class="headerlink" title="修改Django的setting配置文件"></a>修改Django的setting配置文件</h2><p>然后要根据所部署的服务器server name的不同，修改biz/settings.py和adm/settings.py中的相应部分。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">此处不公开</div></pre></td></tr></table></figure></p>
<h2 id="启动uwsgi"><a href="#启动uwsgi" class="headerlink" title="启动uwsgi"></a>启动uwsgi</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">sudo vim /etc/rc.local</div><div class="line"><span class="comment">#增加内容：/usr/local/bin/uwsgi --emperor /etc/uwsgi/vassals --uid www-data --gid www-data</span></div></pre></td></tr></table></figure>
<p>#collectstatic<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">cd</span> PyUnitybox/Web/src/</div><div class="line">python manage_biz.py collectstatic</div><div class="line">python manage_adm.py collectstatic</div></pre></td></tr></table></figure></p>
<h2 id="重启测试是否能自动启动uwsgi"><a href="#重启测试是否能自动启动uwsgi" class="headerlink" title="重启测试是否能自动启动uwsgi"></a>重启测试是否能自动启动uwsgi</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">reboot</div></pre></td></tr></table></figure>
<h2 id="创建启动脚本"><a href="#创建启动脚本" class="headerlink" title="创建启动脚本"></a>创建启动脚本</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">vim restart_pyunitybox.sh</div><div class="line">sudo <span class="built_in">kill</span> -9 `cat ~/<span class="built_in">log</span>/unitybox-biz.pid`</div><div class="line">sudo <span class="built_in">kill</span> -9 `cat ~/<span class="built_in">log</span>/unitybox-adm.pid`</div><div class="line">sudo <span class="built_in">kill</span> -9 `cat ~/<span class="built_in">log</span>/unitybox-api.pid`</div><div class="line"></div><div class="line">chmod +x restart_pyunitybox.sh</div><div class="line">./restart_pyunitybox.sh</div></pre></td></tr></table></figure>
<p>#FAQ</p>
<h2 id="uwsgi无法启动，报错mysqld-sock"><a href="#uwsgi无法启动，报错mysqld-sock" class="headerlink" title="uwsgi无法启动，报错mysqld.sock"></a>uwsgi无法启动，报错mysqld.sock</h2><h2 id="可能是mysql服务down了"><a href="#可能是mysql服务down了" class="headerlink" title="# 可能是mysql服务down了"></a># 可能是mysql服务down了</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">sudo /etc/init.d/mysql restart</div><div class="line"><span class="comment">#如果启动不要，请先kill wsgi相关的pid，否则被占用服务重启</span></div></pre></td></tr></table></figure>
<h2 id="可能是服务器内存不足造成"><a href="#可能是服务器内存不足造成" class="headerlink" title="# 可能是服务器内存不足造成"></a># 可能是服务器内存不足造成</h2><p>该情况可以在wsgi运行的内存中发现提示</p>
<blockquote>
<p>spawned uWSGI master process (pid: 12149) fork(): Cannot allocate memory [core/master_utils.c line 726]</p>
</blockquote>
<p>这情况就只能将云服务resize了。</p>
<h2 id="部署后二维码打印图片无法显示问题"><a href="#部署后二维码打印图片无法显示问题" class="headerlink" title="# 部署后二维码打印图片无法显示问题"></a># 部署后二维码打印图片无法显示问题</h2><p>问题可能为pillow的依赖lib不存在，具体可以看日志，如果为该情况，可以执行以下脚本去安装依赖，安装后记得重装pillow<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">sudo aptitude install libfreetype6-devpip</div><div class="line">uninstall Pillowpip</div><div class="line">install Pillow==2.5.1</div></pre></td></tr></table></figure></p>
<h2 id="部署后，登录应用无法登录，后台报各种表找不到"><a href="#部署后，登录应用无法登录，后台报各种表找不到" class="headerlink" title="# 部署后，登录应用无法登录，后台报各种表找不到"></a># 部署后，登录应用无法登录，后台报各种表找不到</h2><p>按该章节操作<a href="#django_setting">Django的setting配置</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/01/08/2015-01-08-afnetworking-transmission-objects-to-convert-a-parameter-of-type-str/" itemprop="url">
                  AFNetworking传输对象时，将参数的类型转换成str的坑
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Veröffentlicht am</span>
            <time itemprop="dateCreated" datetime="2015-01-08T02:47:00+08:00" content="2015-01-08">
              2015-01-08
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">in</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/iOS/" itemprop="url" rel="index">
                    <span itemprop="name">iOS</span>
                  </a>
                </span>

                
                
                  . 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/iOS/AFNetworking/" itemprop="url" rel="index">
                    <span itemprop="name">AFNetworking</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>#背景<br>先描述下背景，现在要增加一个功能，用户在地图上触摸操作，移动或放大缩小了地图，这时候要根据新的region去服务器端拿范围的数据。</p>
<p>#问题<br>之前是用IOS自带的网络传输，数据的序列化方式是 ‘’’NSData* data = [NSJSONSerialization dataWithJSONObject:[location toDictionary] options:0 error:NULL];’’’ 后直接塞进去作为参数。<br>但是，后面把相应的网络功能全部替换，改成了AFNetWorking进行传输，他的POST函数接受的params为dictionary或者字符串。所以就直接把[location toDictionary]传了进去。<br>这之后就导致mongo查询db.locations.find({“location”:{“$geoWithin”:{“$box”:[[0,0],[150,100]]}}}) 再查不到数据了，因为数据变了,下面第一条是正常数据，第二条是异常数据，coordinates里的值编程了字符串。<br><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&#123; <span class="attr">"_id"</span> : ObjectId(<span class="string">"54acfef52390d9a68247df6b"</span>), <span class="attr">"details"</span> : <span class="string">"amoy"</span>, <span class="attr">"location"</span> : &#123; <span class="attr">"type"</span> : <span class="string">"Point"</span>, <span class="attr">"coordinates"</span> : [ <span class="number">118.1189864873886</span>, <span class="number">24.48821130558777</span> ] &#125;, <span class="attr">"categories"</span> : [ ], <span class="attr">"placename"</span> : <span class="string">"福建省厦门市思明区嘉莲街道怡祥大厦"</span>, <span class="attr">"name"</span> : <span class="string">"福建省厦门市思明区嘉莲街道怡祥大厦"</span>, <span class="attr">"imageId"</span> : <span class="string">"54abdd38f648dbff427cbf0b"</span> &#125;</div><div class="line">&#123; <span class="attr">"_id"</span> : ObjectId(<span class="string">"54acff2b4a07474a1d8467d4"</span>), <span class="attr">"categories"</span> : [ <span class="string">"03"</span> ], <span class="attr">"details"</span> : <span class="string">"fdfdfdfdfdf"</span>, <span class="attr">"location"</span> : &#123; <span class="attr">"coordinates"</span> : [ <span class="string">"118.1164839863777"</span>, <span class="string">"24.48796232996047"</span> ], <span class="attr">"type"</span> : <span class="string">"Point"</span> &#125;, <span class="attr">"name"</span> : <span class="string">"福建省厦门市思明区筼筜街道莲岳路173之10号"</span>, <span class="attr">"placename"</span> : <span class="string">"福建省厦门市思明区筼筜街道莲岳路173之10号"</span>, <span class="attr">"created_at"</span> : ISODate(<span class="string">"2015-01-07T09:40:59.815Z"</span>) &#125;</div></pre></td></tr></table></figure></p>
<p>发现是字符串引擎的问题就找了很久。之后开始尝试解决。</p>
<p>#在APP端直接给AFNetworking传字符串。<br>如下代码，但是新问题就来了，服务器端接收的数据格式为{“(null)”:”{\”details\”:\”fffdfd\”,\”categories\”:[],\”name\”:\”福建省厦门市思明区开元街道厦门歌仔戏研习中心\”,\”location\”:{\”type\”:\”Point\”,\”coordinates\”:[118.0860650539398,24.45868229051323]},\”placename\”:\”福建省厦门市思明区开元街道厦门歌仔戏研习中心\”}”}，多了一层。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">//IOS自己的JSON转换方式</div><div class="line">NSData* data = [NSJSONSerialization dataWithJSONObject:[location toDictionary] options:0 error:NULL];</div><div class="line">NSString *jsonString = [NSString stringWithUTF8String:[data bytes]];</div><div class="line"></div><div class="line">NSString* urlStr = isExistingLocation ?[locations stringByAppendingPathComponent:location._id]:locations;</div><div class="line">AFHTTPRequestOperationManager *manager = [AFHTTPRequestOperationManager manager];</div><div class="line">[manager.requestSerializer setValue:@&quot;application/json&quot; forHTTPHeaderField:@&quot;Accept&quot;];</div><div class="line">[manager  POST:urlStr parameters:jsonString success:successCallback failure:^(AFHTTPRequestOperation *operation, NSError *error) &#123;</div><div class="line">        NSLog(@&quot;%@&quot;,error);</div><div class="line"> &#125;];</div></pre></td></tr></table></figure></p>
<p>#在服务器端操作<br>APP端不变，在服务器端接收时候做转换，int(inputStr)。好，问题就这么简单解决了。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/01/06/2015-01-06-just-to-summarize-discuss-changes-in-2014-individual-plans/" itemprop="url">
                  随便总结，谈谈2014年个人规划上的转变
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Veröffentlicht am</span>
            <time itemprop="dateCreated" datetime="2015-01-06T06:19:00+08:00" content="2015-01-06">
              2015-01-06
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">in</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/总结/" itemprop="url" rel="index">
                    <span itemprop="name">总结</span>
                  </a>
                </span>

                
                
                  . 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/总结/转变/" itemprop="url" rel="index">
                    <span itemprop="name">转变</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>#Change<br>2014年的总结最大转变是两个，一个就是放弃Java开始转函数式的元编程语言，第二个就是放弃项目管理发展的规划转往产品发展。</p>
<p>#One<br>其实早在一年多前就放弃Java语言方面的提升了，放弃Java的主要原因是因为他太严谨了，当然，Java从过去到未来都是一种设计保守的语言，这也是Java的一大优势。（学习曲线低易上手，易读，容错让编译器帮你解决大多数问题，对于大型系统来说严谨是有好处的）。当我没有找到完成一件事情正确方法的时候，那么用Java我就什么都不能做。个人是不大喜欢束缚，就像现在公司的管理方式太严谨了，个人偏向于那种扁平式的管理风格。<br>James Gosling所说的一句话比较有感触，<em>很多人觉得Java老了，编程语言需要改变，但是他们没有搞清楚的是，真正变化的是他们自己。他们在能力上有了发展，他们想看得更远更深，而语言反映出了这一点。并不是语言需要改变，而是提出这个观点的程序员自身发生了变化。</em> ，所以Java的地位不会变，所以很多公司把Java换成了Scala和Node.js。</p>
<p>#Transition<br>那么说到技术，其实把玩的技术多了，也真觉得技术就是个工具。拿锤子举例，我要敲钉子，那我就必须学会使用锤子。而钉子的大小、形状不同，使用的锤子也不一样，用一个20斤的锤子敲一个小钉子就牛刀杀鸡了，而当钉子变成了螺丝，你又需要学会使用螺丝刀了，螺丝的型号就多了，但是使用方法基本是想通的，但是用螺丝等零件做出来的机器确实千变万化的，这就看使用工具的人了。</p>
<p>#Two<br>那么这么也就说到产品吧，最近有人问我，你觉得做产品最重要的是什么呢？当时我第一反应的回答是用户分析、业务场景分析、产品精简、产品动态发布等。但是我回去后思考后觉得这些东西都太具体化了，产品经理首先最应该关注的是解决了什么问题，然后分析这个问题的潜在用户有哪些，是否为刚性需求，然后是解决这个问题有什么关键特性。<br>腾讯产品经理第一课的例子，以一台ATM机为例。<br>ATM机提供什么服务（腾讯不讲解决什么问题，讲服务）？ATM机的核心服务：取现金。<br>那么一台ATM机的设计，有哪些特性？<br>在这个问题上，不懂产品的人就会说ATM机的前端界面，是公司形象，还是操作提醒；从第一次操作，到拿到钞票，需要几步达成；提醒放在哪个环节出现，声音提醒还是字幕提醒；先取卡，还是先取钞。但 <strong>这些特性，叫显性特性</strong> 。</p>
<p>ATM机，还有关键特性。是隐形特性。<br>比如，一台ATM机里要放20万现金。也就是说，如果一个银行提供100台ATM机，那么他要把2000万现金放在外面。所以，看似ATM机分流了银行的营业压力，提升了品牌曝光，同时也分流了公司的核心资源。<br>因此，如何统计数据同步数据，支持决策，让ATM机发挥战略价值，同时不让资金过多闲置，是一台ATM机设计的隐形特性。也是核心服务。<br>说关键特性潜，就要先分析一台ATM机，服务的全流程是什么？<br>作为一个用户体会到的一台ATM机的服务是，查卡，输密码，输金额，取钞，打印凭条，退卡。如果有问题，拨打服务热线。</p>
<p>那么作为一个ATM机的服务提供者，为了让用户持续稳定的获得上述简单的服务，日常操作性的服务流程包括：<br>现金管理：保证ATM机里随时有钱。包括了数据、现金出库、运送等复杂流程。<br>硬件管理：电源工作正常，打印机工作正常，打印机的纸、油墨耗材正常…<br>客服管理：遇到客户问题或者投诉的处理全流程。</p>
<p>这时，再分析战略问题，银行为什么要提供ATM机的服务？<br><strong>第一是为了分流营业网点的取现压力。第二是更多的品牌曝光机会。</strong></p>
<p>因此关键特性就是如何让管理运营的人知道，某台机器没钱了，再不补现金进去，客户要投诉了；哪个服务点的设置没有足够的客流，是否裁撤这个网点。<br>所以，以下特征的菜鸟，就别认为自己可以创业，然后陷入无限妄境了，让信任你的人，跟随你的人受苦了。<br>过分强调显性特性的，菜鸟之中的最初级。过去，我最怕的就是听谁说，我们要改版了，新版哪天……显性特性很重要，但是显性特性救不了你。把核心资源与时间，放在一次次优化显性特性上，基本上是互联网初级从业者的狂热症。<br>那些只是搭个网站界面的创业团队，是就做了个ATM机的空壳子，就认为自己提供ATM机服务了。<br>如何持续稳定地，不断优化地，符合用户预期地，让用户从这里获得他要的服务？他说这是第二步。<br>他说，我先融资，拿到钱，再考虑后面的问题。<br>这里是互联网的成熟时代，已经不是那片蓝海了，是成熟的猎人的厮杀，只看显性特性的产品经理就是出来坑人。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2014/12/22/2014-12-22-obj-c-deficiency/" itemprop="url">
                  OBJ-C的不足
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Veröffentlicht am</span>
            <time itemprop="dateCreated" datetime="2014-12-22T05:03:00+08:00" content="2014-12-22">
              2014-12-22
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">in</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/总结/" itemprop="url" rel="index">
                    <span itemprop="name">总结</span>
                  </a>
                </span>

                
                
                  . 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/总结/obj-c/" itemprop="url" rel="index">
                    <span itemprop="name">obj-c</span>
                  </a>
                </span>

                
                
                  . 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/总结/obj-c/不足/" itemprop="url" rel="index">
                    <span itemprop="name">不足</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>#概述<br>用Obj-c编程一周了，很 <strong>不（昨天打错了，忘了写不）</strong> 负责任的总结一下自己对于Obj-c不足的看法。</p>
<p>#吐槽</p>
<ul>
<li>无GC，程序员的一大部分精力在内存管理上。但是有了ARC，这一劣势反而变成了优势，编译时自动加上retain和release，运行时函数变量栈的自动释放，让应用丝毫不减速情况下又让程序员的精力在业务逻辑上；</li>
<li>无命名空间问题，和javascript一样的问题，所以最好都给类加上前缀来规避这问题；</li>
<li>无法多继承问题，和Java一样的问题，java主要通过接口和组合来规避。而Obj-c也差不多，通过类别和协议，在加上组合来规避该问题。程序中比较多的例子就是代理模式，比如ViewController还会是很多View的delegate，他实现了各种委托的协议来实现委托。除了上面说的这几个还有就是id这个类型（鸭子类型），通过该类型来完成多态；</li>
<li>语义不怎么够简洁，这只能依靠XCODE的强大功能来弥补了。</li>
</ul>
<p>#总结<br>总之，每种编程语言都会有许多不足，如Java就非常不足，设计模式就是一种比较通用的实践方式来解决这些不足，套用设计模式后让程序员的经历不被这些不足束缚，可以痛快的变成，just for fun , no fun no zuo !</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2014/12/15/2014-12-15-ios-gcd-method-from-scratch-introduction/" itemprop="url">
                  IOS从头开始之GCD基本方法介绍
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Veröffentlicht am</span>
            <time itemprop="dateCreated" datetime="2014-12-15T09:04:00+08:00" content="2014-12-15">
              2014-12-15
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">in</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/iOS/" itemprop="url" rel="index">
                    <span itemprop="name">iOS</span>
                  </a>
                </span>

                
                
                  . 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/iOS/GCD/" itemprop="url" rel="index">
                    <span itemprop="name">GCD</span>
                  </a>
                </span>

                
                
                  . 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/iOS/GCD/obj-c/" itemprop="url" rel="index">
                    <span itemprop="name">obj-c</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>#概述<br>任务支持函数和块，GCD比NSOperation更底层，可以是并发的或串行的。他是纯C语言编写，性能很好，而是是对象化的，内存也是通过计数管理。</p>
<p>#队列类型</p>
<ul>
<li>主线程队列：提交到该队列的任务会在主线程中执行。可以调用dispatch_get_main_queue()来获得。因为main queue是与主线程相关的，所以这是一个串行队列</li>
<li><p>全局队列：是并发队列，并由整个进程共享。存在4个全局队列：高（DISPATCH_QUEUE_PRIORITY_HIGH ）、中（默认，DISPATCH_QUEUE_PRIORITY_DEFAULT ）、低（DISPATCH_QUEUE_PRIORITY_LOW ）、后台（DISPATCH_QUEUE_PRIORITY_BACKGROUND ）四个优先级队列。可以调用dispatch_get_global_queue函数传入优先级来访问队列。</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">dispatch_queue_t</span> concurrentQueue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span class="number">0</span>);</div></pre></td></tr></table></figure>
</li>
<li><p>自创建队列：该队列是用函数 dispatch_queue_create 创建的队列，提交到队列中的任务是串行的，各个队列间是串行的。dispatch_queue_create 函数的第一个参数是一个标签，是提供唯一标示方便调试。官方建议我倒置包名来命名队列，比如“com.dragonsoft.subsystem.task”。这些名字会在崩溃日志中被显示出来，也可以被调试器调用，这在调试中会很有用。第二个参数是queue的类型，设为NULL时默认是DISPATCH_QUEUE_SERIAL，将创建串行队列，在必要情况下，你可以将其设置为DISPATCH_QUEUE_CONCURRENT来创建自定义并行队列。</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">dispatch_queue_t</span> firstSerialQueue = dispatch_queue_create(<span class="string">"com.pixolity.GCD.serialQueue1"</span>, <span class="number">0</span>);</div></pre></td></tr></table></figure>
</li>
</ul>
<p>注意：全局的队列，不用retain或release，自创建通过ARC进行，也不需要，如果想保留，就需要。</p>
<p>#dispatch_async<br>将任务推到子线程中异步执行，注册的任务完成时间是随机不确定的。该函数会立即返回，任务会在后台异步执行。<br>该方法使用场景按我理解类似做Web前端开发时候，可能会有一个操作需要去后台请求数据，然后再对主页面进行局部刷新。在Web开发可以利用Ajax和Javascript的事件循环异步机制来轻松实现回调而在IOS程序中，这就意味着需要将数据的获取交给子线程去做，数据返回后再把任务推回到主线程来执行一些代码。使用GCD的dispatch_async可以简单地完成这个任务。使用嵌套的dispatch，在外层中执行后台任务，在内层中将任务dispatch到main queue，以下代码为网上拔来的示例。<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">dispatch_async</span>(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span class="number">0</span>), ^&#123;</div><div class="line">    <span class="built_in">NSURL</span> * url = [<span class="built_in">NSURL</span> URLWithString:<span class="string">@"http://avatar.csdn.net/2/C/D/1_totogo2010.jpg"</span>];</div><div class="line">    <span class="built_in">NSData</span> * data = [[<span class="built_in">NSData</span> alloc]initWithContentsOfURL:url];</div><div class="line">    <span class="built_in">UIImage</span> *image = [[<span class="built_in">UIImage</span> alloc]initWithData:data];</div><div class="line">    <span class="keyword">if</span> (data != <span class="literal">nil</span>) &#123;</div><div class="line">        <span class="built_in">dispatch_async</span>(dispatch_get_main_queue(), ^&#123;</div><div class="line">            <span class="keyword">self</span>.imageView.image = image;</div><div class="line">         &#125;);</div><div class="line">    &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>还有一个场景他的应用会比较有效，比如要计算1000以内的素数，那就要循环1000次，每次都是同步执行的，性能很差。可以应用如下代码，doSomethingIntensiveWith:obj改为判断当前循环到的数字是否为素数，是就添加到一个集合中。<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">dispatch_queue_t</span> queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span class="number">0</span>);</div><div class="line"><span class="keyword">for</span>(<span class="keyword">id</span> obj <span class="keyword">in</span> array)</div><div class="line">    <span class="built_in">dispatch_async</span>(queue,^&#123;[<span class="keyword">self</span> doSomethingIntensiveWith:obj];&#125;);</div></pre></td></tr></table></figure></p>
<p>#dispatch_sync<br>该函数干的事和dispatch<em>async相同，差异就是它不会立即返回，它会等待传入的block中的代码执行完成并返回。结合\</em>_block类型修饰符，可以用来从执行中的block获取一个值。例如，你可能有一段代码在后台执行，而它需要从界面控制层获取一个值。那么你可以使用dispatch_sync简单办到。<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">__block <span class="built_in">NSString</span> *stringValue;</div><div class="line"><span class="built_in">dispatch_sync</span>(dispatch_get_main_queue(), ^&#123;</div><div class="line">        stringValue = [[textField stringValue] <span class="keyword">copy</span>];</div><div class="line">&#125;);</div><div class="line">[stringValue autorelease];</div><div class="line"><span class="comment">// 操作stringValue</span></div></pre></td></tr></table></figure></p>
<p>有一个使用的例子就是替换锁。以下代码为something属性的getter&amp;setter，具体可以看程序中的注释。<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">id</span>)something</div><div class="line">&#123;</div><div class="line">    __block <span class="keyword">id</span> localSomething;</div><div class="line">    <span class="comment">//会等待传入的block执行完后才返回，但是由于自定义队列是FIFO执行的，所以如果前面有多个setter操作，那么现在就在等待中。</span></div><div class="line">    <span class="built_in">dispatch_sync</span>(queue, ^&#123;</div><div class="line">        localSomething = [something <span class="keyword">retain</span>];</div><div class="line">    &#125;);</div><div class="line">    <span class="keyword">return</span> [localSomething autorelease];</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)setSomething:(<span class="keyword">id</span>)newSomething</div><div class="line">&#123;</div><div class="line">      <span class="comment">//直接返回，把任务添加到队列中执行。</span></div><div class="line">    <span class="built_in">dispatch_async</span>(queue, ^&#123;</div><div class="line">        <span class="keyword">if</span>(newSomething != something)</div><div class="line">        &#123;</div><div class="line">            [something release];</div><div class="line">            something = [newSomething <span class="keyword">retain</span>];</div><div class="line">           <span class="comment">//修改缓存可能非常耗时间，所以立即返回完全不影响性能</span></div><div class="line">            [<span class="keyword">self</span> updateSomethingCaches];</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>不过这里要注意，小心有代码会造成互斥锁，导致getter中的dispatch_sync一直无法返回。</p>
<p>#dispatch_group_async<br>它可以实现监听一组任务是否完成，完成后得到通知执行其他的操作。<br>可以想象这么一个场景，比如你执行10下载任务，然后程序将每个下载任务又分成了2步操作，第二步合并必须在第一步完成后才能进行，那么前面dispatch_async的那个循环的例子就不管用了。看以下代码<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">dispatch_queue_t</span> queue = dispatch_get_global_qeueue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span class="number">0</span>);</div><div class="line">dispatch_group_t group = dispatch_group_create();</div><div class="line"><span class="keyword">for</span>(<span class="keyword">id</span> obj <span class="keyword">in</span> array)&#123;</div><div class="line">  dispatch_group_async(group,queue, ^&#123;</div><div class="line">    [<span class="keyword">self</span> doDownloadIntensiveWith:obj];</div><div class="line">  &#125;);</div><div class="line">   <span class="comment">//group中的任务都结束了，就会去通知该block中的任务去执行</span></div><div class="line">  dispatch_group_notify(group,queue, ^&#123;</div><div class="line">    [<span class="keyword">self</span> doDownloadCombaineWith:obj];</div><div class="line">  &#125;);</div><div class="line">  <span class="comment">//IOS 6.0后不需要自己去释放，函数的变量栈在函数退出时候会自己释放。这个释放不同于ARC，他是在运行时</span></div><div class="line">  dispatch_release(group);</div><div class="line"> &#125;</div></pre></td></tr></table></figure></p>
<p>#dispatch_barrier_async<br>在前面的任务执行结束后它才执行，而且它后面的任务等它执行完成之后才会执行<br>还是前面那个场景，比如下载必须等前面的任务完成后才进行合并操作，合并结束后才进行提示操作，那么dispatch_group_async又不是很好用了，看以下代码</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">dispatch_queue_t</span> queue = dispatch_queue_create(<span class="string">"com.dragonsoft.queue1"</span>, DISPATCH_QUEUE_CONCURRENT);</div><div class="line"><span class="keyword">for</span>(<span class="keyword">id</span> obj <span class="keyword">in</span> array)&#123;</div><div class="line"><span class="built_in">dispatch_async</span>(queue, ^&#123;</div><div class="line">    [<span class="keyword">self</span> doDownloadIntensiveWith:obj];</div><div class="line">&#125;);</div><div class="line"><span class="built_in">dispatch_async</span>(queue, ^&#123;</div><div class="line">    [<span class="keyword">self</span> doDownload2IntensiveWith:obj];</div><div class="line">&#125;);</div><div class="line">dispatch_barrier_async(queue, ^&#123;</div><div class="line">    [<span class="keyword">self</span> doDownloadCombaineWith:obj];</div><div class="line">&#125;);</div><div class="line"><span class="built_in">dispatch_async</span>(queue, ^&#123;</div><div class="line">    [<span class="keyword">self</span> doNoticeWith:obj];</div><div class="line">&#125;);</div><div class="line"> &#125;</div></pre></td></tr></table></figure>
<p>#dispatch_apply<br>执行某个代码片段N<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">dispatch_apply(<span class="number">5</span>, globalQ, ^(size_t index) &#123;</div><div class="line">    <span class="comment">// 执行5次</span></div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>使用场景还是刚刚那个下载，这下连循环都省了<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">dispatch_queue_t</span> queue = dispatch_get_global_qeueue(DISPATCH_QUEUE_PRIORITY_DEFAULT,  <span class="number">0</span>);</div><div class="line"><span class="comment">//推到后台去</span></div><div class="line"><span class="built_in">dispatch_async</span>(queue,^&#123;</div><div class="line">  dispatch_apply([array count], queue, ^(size_t index)&#123;</div><div class="line">    [<span class="keyword">self</span> doDownloadIntensiveWith:obj];</div><div class="line">  &#125;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/3/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><span class="space">&hellip;</span><a class="page-number" href="/page/11/">11</a><a class="extend next" rel="next" href="/page/5/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="David Woo" />
          <p class="site-author-name" itemprop="name">David Woo</p>
          <p class="site-description motion-element" itemprop="description"></p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/">
              <span class="site-state-item-count">110</span>
              <span class="site-state-item-name">Artikel</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              
                <span class="site-state-item-count">195</span>
                <span class="site-state-item-name">Kategorien</span>
              
            </div>
          

          
            <div class="site-state-item site-state-tags">
              
                <span class="site-state-item-count">5</span>
                <span class="site-state-item-name">Tags</span>
              
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">David Woo</span>
</div>

<div class="powered-by">
  Erstellt mit  <a class="theme-link" href="https://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  



  




  
  

  

  

  

</body>
</html>
