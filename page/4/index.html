<!doctype html>



  


<html class="theme-next muse use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta property="og:type" content="website">
<meta property="og:title" content="大胃吴的闲话唠嗑">
<meta property="og:url" content="http://yoursite.com/page/4/index.html">
<meta property="og:site_name" content="大胃吴的闲话唠嗑">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="大胃吴的闲话唠嗑">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: 'Author'
    }
  };
</script>




  <link rel="canonical" href="http://yoursite.com/page/4/"/>

  <title> 大胃吴的闲话唠嗑 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">大胃吴的闲话唠嗑</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">扯扯技术，唠唠闲话</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2014/11/17/2014-11-17-my-resume/" itemprop="url">
                  我的简历
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2014-11-17T14:49:00+08:00" content="2014-11-17">
              2014-11-17
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/个人简历/" itemprop="url" rel="index">
                    <span itemprop="name">个人简历</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="基础资料"><a href="#基础资料" class="headerlink" title="#基础资料"></a>#基础资料</h2><p>##吴迪玮<br>男 | 本科 | 厦门理工学院 07~11 | 计算机科学与技术 | 三年工作经验<br>13599915039 | xiao303178394@gmail.com<br>Blog: <a href="http://yuezaixz.logdown.com/" target="_blank" rel="external">http://yuezaixz.logdown.com/</a><br>Github:<a href="https://github.com/yuezaixz" target="_blank" rel="external">https://github.com/yuezaixz</a></p>
<h2 id="工作经历"><a href="#工作经历" class="headerlink" title="#工作经历"></a>#工作经历</h2><p>##厦门巨龙信息科技有限公司 | 运维平台研发组组长 | 2012-11 - 现在</p>
<p>##厦门海迈科技股份有限公司 | V3产品JAVA工程师 | 2011-02 - 2012-07</p>
<h2 id="技术技能"><a href="#技术技能" class="headerlink" title="#技术技能"></a>#技术技能</h2><ul>
<li>在当前项目中负责架构设计、产品设计等工作，有一定相关经验；</li>
<li>熟练Java，3年的生产开发经验，由于所在团队一直采用敏捷开发，所以对设计接触的也较早较多，对于面对对象开发及设计模式、主流框架使用设计都有较深入掌握；</li>
<li>熟练Javascript，有一定基于jQuery、原型的组件开发经验，也熟悉Javascript的服务器端开发，如Node.js；</li>
<li>对Python及其Django框架通过自学有一定了解；</li>
<li>熟悉Sublime、Eclipse等开发，对IntelliJ、Vim使用也有过一些尝试；</li>
<li>熟悉敏捷Scrum开发，并有过组织敏捷转型经验，也有一年的敏捷项目管理经验；</li>
</ul>
<h2 id="主要项目经历"><a href="#主要项目经历" class="headerlink" title="#主要项目经历"></a>#主要项目经历</h2><p>#巨龙综合运维平台<br>2013年9月，由于该产品原定研发经理临时被调剂去协助另一个项目，所以在部门资源比较紧缺的情况下我申请负责该项目。接手之前由于原项目经理主要为兼职，推动的速度较慢，当时只完成了前期策划评估调研阶段。之后我推动了研发团队组建、需求分析、原型设计、架构框架设计、规范过程设计等。<br>该产品解决的主要问题为传统运维存在技术门槛高、无标准化、效率低、不及时性、无规范流程、成果不容易体现、无法考核等问题，该产品提供自动化的设备（如服务器、数据库）、应用、业务监控报警，产生运维工作并通过流程流转处置，处置的情况及运维情况都会是考核依据，处置的内容会归纳入知识库，最后通过报表、档案和图表的方式进行展现。</p>
<p>##用到的技术</p>
<ul>
<li>基于JAVA的S1SH，在S1基础上封装了一层，在实现Struts2基本功能同时又保持着比较好的轻量级、可裁剪、可扩展等功能；</li>
<li>基于Oracle数据库，由于一些业务数据的监控，数据库压力较大，因此使用Oracle比较合适；</li>
<li>基于Websphere6.1，这点取决于公司运维团队在该技术上有较好的基础，方便现场部署实施；</li>
<li>自己设计开发了一些JS组件，功能包括页面加载、弹窗、表单校验、Ajax方法封装、分页组件、模板引擎、自定义标签、气泡提示信息、所见即所得的调试、可视化关系图、可视化流程配置等；</li>
</ul>
<p>##技术细节<br>该产品我参与了大多数核心模块的设计及开发，比如Struts1封装改造、JS组件开发、监控引擎、两级平台业务数据比对、设备关系预览页面、可视化流程页面、数据分析展现等。<br>项目迭代中也不断重构，比如监控模块的重构，当时写了一篇博文来总结，<a href="http://yuezaixz.logdown.com/posts/200757-jobs-and-bezos-product-monitoring-subsystem-module-refactoring" target="_blank" rel="external">地址</a>。<br>也做了一些组件开发，比如分页组件，在后端是定义了一个PageInfo的类，该类中有单页展现数量、当前页、最大页、排序字段、排序方式、数据列表等字段。封装的BaseDao采用策略模式，根据配置不同的数据库类型会组装不同的分页查询方法来修改PageInfo的值。页面上记录PageInfo中的相关属性，比如修改了单页跳数就会发起一个请求，根据当前页面的数据服务url，带上PageInfo中的相关参数发起刷新页面的请求。</p>
<p>#海迈清单造价平台V3</p>
<p>##简介<br>2011年我作为实习生参与了海迈清单造价系列产品的开发，该项目为C/S架构，该产品采用敏捷Scrum开发，把持动态经营、有损服务的策略，加入开发组时该产品差不多已经发布了10来个版本了，每个迭代版本都是在完善旧功能和实现新需求。<br>该产品的主要功能为根据手动填入清单定额或者导入海迈算量文件来生成工程造价，解决了以往造价工程投标中计算复杂、门槛高、效率低、成果无法复用、结果不准确等问题。</p>
<p>##用到的技术</p>
<ul>
<li>基于JAVA的Spring框架，自己通过DB-Util封装了持久化层；</li>
<li>基于RCP插件式开发，前端为SWT技术，数据库为DB2；</li>
<li>报表是使用IReport，在之上自己封装了数据字典等功能；</li>
</ul>
<p>##技术细节<br>比如在该项目中做过的一个比较大的模块为撤销重做，主要用了命令模式，首先要把所有需要撤销重做的功能都重构成Command的实现类，Command接口有do、redo、undo函数，do和redo都会记录执行前需要记录的状态，undo则是将数据返回到那个记录的状态。另外用了一个堆栈CommandHistory去记录操作，do或redo后Command入栈，撤销则将顶层的command出栈执行undo操作。另外通过一个CommandManger类作为控制器，做一些命令的管理操作。比如根据配置的最大可撤销重做步数来限制堆栈的长度（不限制长度可能会内存溢出，因为有的command记录的数据量较多）。</p>
<h2 id="自我评价"><a href="#自我评价" class="headerlink" title="#自我评价"></a>#自我评价</h2><ul>
<li>善于思考总结，但在落地上执行力度不足，努力在试错中成长，不让错误重现；</li>
<li>乐爱编程，对于新技术保持好奇心，也不断巩固已掌握的知识；</li>
<li>崇尚工具，乐于学习新工具来提高效率，也相信方法论，特别是在时间管理上；</li>
<li>乐于分享，也乐于把学习、总结、工作中的经验写成博客；</li>
<li>擅长沟通，也通过项目组管理的经验对解决项目组成员沟通问题有一定经验；</li>
<li>乐爱运动，有时间都会去进行篮球、足球、羽毛球运动，没时间时候也会抽空跑跑步；</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2014/11/14/2014-11-14-yield-function-to-resolve-function-returns-a-list-of-all-the-questions/" itemprop="url">
                  yield函数，解决函数返回列表时的种种问题
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2014-11-14T07:37:00+08:00" content="2014-11-14">
              2014-11-14
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>在开发中可能经常碰到这样的问题，举个比较简单的场景描述，比如我要获取1-100的整数集合，那么我第一反应会这样想这个函数。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getNumList</span><span class="params">(<span class="keyword">int</span> max)</span></span>&#123;</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; max; i++) &#123;</div><div class="line">		System.out.println(i);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>那么这么写的缺点有哪些呢？就是我无法获得这个集合，那么好吧，我就修改下这个函数。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> List&lt;IntegergetNumList(<span class="keyword">int</span> max)&#123;</div><div class="line">	List&lt;IntegernumList = <span class="keyword">new</span> ArrayList&lt;Integer&gt;();</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; max; i++) &#123;</div><div class="line">		numList.add(i);</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> numList;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>好了，这样是不是问题解决了，这篇博文就到这了呢？不是，这样还有个问题，就是当列表元素占用内存过大，并且列表元素过多时，这样操作是非常占用内存的。<br>好吧，有人说，他知道这么解决这个问题，多简单，看如下代码。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">NumList</span> <span class="keyword">implements</span> <span class="title">Iterable</span>&lt;<span class="title">Integer</span>&gt;</span>&#123;</div><div class="line">	<span class="keyword">private</span> <span class="keyword">int</span> index;</div><div class="line">	<span class="keyword">private</span> <span class="keyword">int</span> max;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="title">NumList</span><span class="params">(<span class="keyword">int</span> max)</span></span>&#123;</div><div class="line">		index = <span class="number">1</span>;</div><div class="line">		<span class="keyword">this</span>.max = max;</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="keyword">public</span> Iterator&lt;Integeriterator() &#123;</div><div class="line">		<span class="keyword">return</span> <span class="keyword">new</span> NumIterator();</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="class"><span class="keyword">class</span> <span class="title">NumIterator</span> <span class="keyword">implements</span> <span class="title">Iterator</span>&lt;<span class="title">Integer</span></span>&#123;</div><div class="line">		</div><div class="line">		</div><div class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasNext</span><span class="params">()</span> </span>&#123;</div><div class="line">			<span class="keyword">return</span> index != max;</div><div class="line">		&#125;</div><div class="line">		</div><div class="line">		<span class="function"><span class="keyword">public</span> Integer <span class="title">next</span><span class="params">()</span> </span>&#123;</div><div class="line">			<span class="keyword">return</span> ++index;</div><div class="line">		&#125;</div><div class="line">		</div><div class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">()</span> </span>&#123;</div><div class="line">			index++;</div><div class="line">		&#125;</div><div class="line">		</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>没错，用迭代器这问题是解决了，但是，这样的设计有点过于复杂。感觉小题大做了。在JAVA中有没有方法可以快速解决这个问题呢？我感觉是没有啦，那就让我们看看今天的主角，yield在python中是如何使用的。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">def numList(max): </div><div class="line">    n = 1</div><div class="line">    while n &lt;= max: </div><div class="line">    		# print n</div><div class="line">        yield n </div><div class="line">        n = n + 1</div><div class="line">def read_file(fpath): </div><div class="line">    BLOCK_SIZE = 1024 </div><div class="line">    with open(fpath, &apos;rb&apos;) as f: </div><div class="line">        while True: </div><div class="line">            block = f.read(BLOCK_SIZE) </div><div class="line">            if block: </div><div class="line">                yield block </div><div class="line">            else: </div><div class="line">                return</div><div class="line">def main():</div><div class="line">    for num in numList(10):</div><div class="line">        print num</div><div class="line"></div><div class="line">    for content in read_file(&apos;../README.md&apos;):</div><div class="line">        print content</div></pre></td></tr></table></figure></p>
<p>两个函数，第一个函数就是返回数列，是不是很神奇。简单地讲，yield 的作用就是把一个函数变成一个 generator，带有 yield 的函数不再是一个普通函数，Python 解释器会将其视为一个 generator，调用 fab(5) 不会执行 fab 函数，而是返回一个 iterable 对象！在 for 循环执行时，每次循环都会执行 fab 函数内部的代码，执行到 yield b 时，fab 函数就返回一个迭代值，下次迭代时，代码从 yield b 的下一条语句继续执行，而函数的本地变量看起来和上次中断执行前是完全一样的，于是函数继续执行，直到再次遇到 yield。也可以手动调用 fab(5) 的 next() 方法（因为 fab(5) 是一个 generator 对象，该对象具有 next() 方法），这样我们就可以更清楚地看到 fab 的执行流程：<br>在一个 generator function 中，如果没有 return，则默认执行至函数完毕，如果在执行过程中 return，则直接抛出 StopIteration 终止迭代。<br>一个带有 yield 的函数就是一个 generator，它和普通函数不同，生成一个 generator 看起来像函数调用，但不会执行任何函数代码，直到对其调用 next()（在 for 循环中会自动调用 next()）才开始执行。虽然执行流程仍按函数的流程执行，但每执行到一个 yield 语句就会中断，并返回一个迭代值，下次执行时从 yield 的下一个语句继续执行。看起来就好像一个函数在正常执行的过程中被 yield 中断了数次，每次中断都会通过 yield 返回当前的迭代值。</p>
<p>yield 的好处是显而易见的，把一个函数改写为一个 generator 就获得了迭代能力，比起用类的实例保存状态来计算下一个 next() 的值，不仅代码简洁，而且执行流程异常清晰。</p>
<p>如何判断一个函数是否是一个特殊的 generator 函数？可以利用 isgeneratorfunction 判断：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> inspect <span class="keyword">import</span> isgeneratorfunction </div><div class="line"><span class="keyword">print</span> isgeneratorfunction(numList)</div></pre></td></tr></table></figure></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2014/11/13/2014-11-13-problems-in-learning-django-framework-ii/" itemprop="url">
                  Django框架学习中的问题（二）
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2014-11-13T15:19:00+08:00" content="2014-11-13">
              2014-11-13
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>#Django的工作原理<br>感觉大多数框架形形色色的思路基本都是一致的，就是哪些框架更灵活，哪些框架的去侵入性做的更好，哪些框架的中间件的拔插方式更方便，哪些框架的语法糖更易用，哪些框架带来了更大的生产力。<br>像Java中的SSH，基本都是带侵入式的，比如你要把Hibernate换成Mybatis基本上会头疼致死，而Django只需要修改下settings.py文件。<br>像Java中你需要添加很多拦截器来起到中间件效果，通过拦截器也使这些拦截器不再耦合，不过这些中间件基本上要针对你MVC各层框架，及持久化层框架，及业务来编写。而Django中这些基本的中间件基本上都有成熟的库，只需要针对业务做一些自己实现的中间件，这点很类似于node.js的express框架。<br>像Java中的路由控制，你需要通过struts或者SpringMVC，都需要编写Action（或者controller），经常会把业务集成在Action中，Django就更简单了点，urls.py只负责正则映射，调用指定的方法去做处理。职责更分明，做的事情也自然单一了。<br>而数据库的访问Django已经封装好了，只需要调用Model的相应方法即可，而业务逻辑也应当封装在Model中，Views中的函数只负责完成程序逻辑。<br>而视图层其实在各种框架中都差不多，基本都是模板加程序语言去实现。比如Django中有Django的模板方法，而ejs、jade、velocity、freemaker、jsp都有相应的方法。<br>Django的大致工作原理如下图：<br><img src="http://chuantu.biz/t/17/1415892562x-1376440137.jpg" alt=""></p>
<p>#几个命令<br>创建Django工程：django-admin.py startproject projectname<br>工程中创建新的APP：mange.py startapp appname<br>运行工程：mange.py runserver (None port or 0.0.0.0:prot)<br>在工程中同步数据库：mange.py syncdb</p>
<p>#python对应的数据库模块未安装<br><figure class="highlight python"><figcaption><span>settings.py</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">DATABASES = &#123;</div><div class="line">    <span class="string">'default'</span>: &#123;</div><div class="line">        <span class="string">'ENGINE'</span>: <span class="string">'django.db.backends.mysql'</span>,</div><div class="line">        <span class="string">'NAME'</span>: <span class="string">'TestDjango'</span>,</div><div class="line">        <span class="string">'PASSWORD'</span>: <span class="string">'123'</span>,</div><div class="line">        <span class="string">'HOST'</span>:<span class="string">''</span>,</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>运行命令后报错为： windows Error loading MySQLdb module: No module named MySQLdb<br>原因：python2.7不会自动安装对应的MySQLdb<br><a href="http://www.codegood.com/download/11/" target="_blank" rel="external">下载地址</a><br>安装到python的site-package目录下就OK了。</p>
<p>#用户漏了配置<br>配置后Access denied for user ‘ODBC’@’localhost’ (using password: YES)”)<br>原因：漏了配置用户名<br>改成如下代码就能正常了。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">DATABASES = &#123;</div><div class="line">    &apos;default&apos;: &#123;</div><div class="line">        &apos;ENGINE&apos;: &apos;django.db.backends.mysql&apos;,</div><div class="line">        &apos;USER&apos;: &apos;root&apos;,</div><div class="line">        &apos;NAME&apos;: &apos;TestDjango&apos;,</div><div class="line">        &apos;PASSWORD&apos;: &apos;123&apos;,</div><div class="line">        &apos;HOST&apos;:&apos;&apos;,</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>#POST提交表单，action需要/结尾<br>报错：You called this URL via POST, but the URL doesn’t end in a slash and you have APPEND_SLASH set<br>原因：action属性没有结尾，如下，/login/，最后的斜杠不能漏</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">class</span>=<span class="string">"navbar-form navbar-right"</span> <span class="attr">action</span>=<span class="string">"/login/"</span> <span class="attr">method</span>=<span class="string">"post"</span> <span class="attr">role</span>=<span class="string">"form"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">placeholder</span>=<span class="string">"用户名"</span> <span class="attr">class</span>=<span class="string">"form-control"</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">placeholder</span>=<span class="string">"密码"</span> <span class="attr">class</span>=<span class="string">"form-control"</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">class</span>=<span class="string">"btn btn-success"</span>&gt;</span>登 录<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></div></pre></td></tr></table></figure>
<p>#还是提交表单，又报错了<br>报错：CSRF verification failed. Request aborted.<br>原因：这是一个跨单访问的错误，去掉相应的中间件即可,看下列代码注释<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">MIDDLEWARE_CLASSES = (</div><div class="line">    &apos;django.contrib.sessions.middleware.SessionMiddleware&apos;,</div><div class="line">    &apos;django.middleware.common.CommonMiddleware&apos;,</div><div class="line">    #&apos;django.middleware.csrf.CsrfViewMiddleware&apos;,</div><div class="line">    &apos;django.contrib.auth.middleware.AuthenticationMiddleware&apos;,</div><div class="line">    &apos;django.contrib.auth.middleware.SessionAuthenticationMiddleware&apos;,</div><div class="line">    &apos;django.contrib.messages.middleware.MessageMiddleware&apos;,</div><div class="line">    &apos;django.middleware.clickjacking.XFrameOptionsMiddleware&apos;,</div><div class="line">    &apos;django.middleware.security.SecurityMiddleware&apos;,</div><div class="line">)</div></pre></td></tr></table></figure></p>
<p>如果需要使用跨单访问保护，又不想报错，那就需要在表单中加{\% csrf_token \%}，我没试过，先记下来需要时方便查询。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2014/11/11/2014-11-11-installation-and-initialization-of-the-django-framework-in-windows-projects/" itemprop="url">
                  Django框架在Windows的安装及初始化项目
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2014-11-11T15:14:00+08:00" content="2014-11-11">
              2014-11-11
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>这里就是笔者自己记录过程中犯的错误，并没有详细阐述过程及原理。</p>
<p>#Django安装时出现No module named setuptools的问题<br>在windows在安装Python时（笔者安装为2.7），是不会将setuptools外部包安装工具一起安装的，因此在Django目录执行python setup.py install会出现 <figure class="highlight plain"><figcaption><span>No module named setuptools） ``` 的异常。</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div></pre></td><td class="code"><pre><div class="line">当然去安装setuptools也行，当然也有个快速便捷的方法。复制以下代码保存后在文件所在目录执行 ```python ez_setup.py``` 。</div><div class="line">```python ez_setup.py</div><div class="line">#!python</div><div class="line">&quot;&quot;&quot;Bootstrap setuptools installation</div><div class="line"></div><div class="line">If you want to use setuptools in your package&apos;s setup.py, just include this</div><div class="line">file in the same directory with it, and add this to the top of your setup.py::</div><div class="line"></div><div class="line">    from ez_setup import use_setuptools</div><div class="line">    use_setuptools()</div><div class="line"></div><div class="line">If you want to require a specific version of setuptools, set a download</div><div class="line">mirror, or use an alternate download directory, you can do so by supplying</div><div class="line">the appropriate options to ``use_setuptools()``.</div><div class="line"></div><div class="line">This file can also be run as a script to install or upgrade setuptools.</div><div class="line">&quot;&quot;&quot;</div><div class="line">import sys</div><div class="line">DEFAULT_VERSION = &quot;0.6c11&quot;</div><div class="line">DEFAULT_URL     = &quot;http://pypi.python.org/packages/%s/s/setuptools/&quot; % sys.version[:3]</div><div class="line"></div><div class="line">md5_data = &#123;</div><div class="line">    &apos;setuptools-0.6b1-py2.3.egg&apos;: &apos;8822caf901250d848b996b7f25c6e6ca&apos;,</div><div class="line">    &apos;setuptools-0.6b1-py2.4.egg&apos;: &apos;b79a8a403e4502fbb85ee3f1941735cb&apos;,</div><div class="line">    &apos;setuptools-0.6b2-py2.3.egg&apos;: &apos;5657759d8a6d8fc44070a9d07272d99b&apos;,</div><div class="line">    &apos;setuptools-0.6b2-py2.4.egg&apos;: &apos;4996a8d169d2be661fa32a6e52e4f82a&apos;,</div><div class="line">    &apos;setuptools-0.6b3-py2.3.egg&apos;: &apos;bb31c0fc7399a63579975cad9f5a0618&apos;,</div><div class="line">    &apos;setuptools-0.6b3-py2.4.egg&apos;: &apos;38a8c6b3d6ecd22247f179f7da669fac&apos;,</div><div class="line">    &apos;setuptools-0.6b4-py2.3.egg&apos;: &apos;62045a24ed4e1ebc77fe039aa4e6f7e5&apos;,</div><div class="line">    &apos;setuptools-0.6b4-py2.4.egg&apos;: &apos;4cb2a185d228dacffb2d17f103b3b1c4&apos;,</div><div class="line">    &apos;setuptools-0.6c1-py2.3.egg&apos;: &apos;b3f2b5539d65cb7f74ad79127f1a908c&apos;,</div><div class="line">    &apos;setuptools-0.6c1-py2.4.egg&apos;: &apos;b45adeda0667d2d2ffe14009364f2a4b&apos;,</div><div class="line">    &apos;setuptools-0.6c10-py2.3.egg&apos;: &apos;ce1e2ab5d3a0256456d9fc13800a7090&apos;,</div><div class="line">    &apos;setuptools-0.6c10-py2.4.egg&apos;: &apos;57d6d9d6e9b80772c59a53a8433a5dd4&apos;,</div><div class="line">    &apos;setuptools-0.6c10-py2.5.egg&apos;: &apos;de46ac8b1c97c895572e5e8596aeb8c7&apos;,</div><div class="line">    &apos;setuptools-0.6c10-py2.6.egg&apos;: &apos;58ea40aef06da02ce641495523a0b7f5&apos;,</div><div class="line">    &apos;setuptools-0.6c11-py2.3.egg&apos;: &apos;2baeac6e13d414a9d28e7ba5b5a596de&apos;,</div><div class="line">    &apos;setuptools-0.6c11-py2.4.egg&apos;: &apos;bd639f9b0eac4c42497034dec2ec0c2b&apos;,</div><div class="line">    &apos;setuptools-0.6c11-py2.5.egg&apos;: &apos;64c94f3bf7a72a13ec83e0b24f2749b2&apos;,</div><div class="line">    &apos;setuptools-0.6c11-py2.6.egg&apos;: &apos;bfa92100bd772d5a213eedd356d64086&apos;,</div><div class="line">    &apos;setuptools-0.6c2-py2.3.egg&apos;: &apos;f0064bf6aa2b7d0f3ba0b43f20817c27&apos;,</div><div class="line">    &apos;setuptools-0.6c2-py2.4.egg&apos;: &apos;616192eec35f47e8ea16cd6a122b7277&apos;,</div><div class="line">    &apos;setuptools-0.6c3-py2.3.egg&apos;: &apos;f181fa125dfe85a259c9cd6f1d7b78fa&apos;,</div><div class="line">    &apos;setuptools-0.6c3-py2.4.egg&apos;: &apos;e0ed74682c998bfb73bf803a50e7b71e&apos;,</div><div class="line">    &apos;setuptools-0.6c3-py2.5.egg&apos;: &apos;abef16fdd61955514841c7c6bd98965e&apos;,</div><div class="line">    &apos;setuptools-0.6c4-py2.3.egg&apos;: &apos;b0b9131acab32022bfac7f44c5d7971f&apos;,</div><div class="line">    &apos;setuptools-0.6c4-py2.4.egg&apos;: &apos;2a1f9656d4fbf3c97bf946c0a124e6e2&apos;,</div><div class="line">    &apos;setuptools-0.6c4-py2.5.egg&apos;: &apos;8f5a052e32cdb9c72bcf4b5526f28afc&apos;,</div><div class="line">    &apos;setuptools-0.6c5-py2.3.egg&apos;: &apos;ee9fd80965da04f2f3e6b3576e9d8167&apos;,</div><div class="line">    &apos;setuptools-0.6c5-py2.4.egg&apos;: &apos;afe2adf1c01701ee841761f5bcd8aa64&apos;,</div><div class="line">    &apos;setuptools-0.6c5-py2.5.egg&apos;: &apos;a8d3f61494ccaa8714dfed37bccd3d5d&apos;,</div><div class="line">    &apos;setuptools-0.6c6-py2.3.egg&apos;: &apos;35686b78116a668847237b69d549ec20&apos;,</div><div class="line">    &apos;setuptools-0.6c6-py2.4.egg&apos;: &apos;3c56af57be3225019260a644430065ab&apos;,</div><div class="line">    &apos;setuptools-0.6c6-py2.5.egg&apos;: &apos;b2f8a7520709a5b34f80946de5f02f53&apos;,</div><div class="line">    &apos;setuptools-0.6c7-py2.3.egg&apos;: &apos;209fdf9adc3a615e5115b725658e13e2&apos;,</div><div class="line">    &apos;setuptools-0.6c7-py2.4.egg&apos;: &apos;5a8f954807d46a0fb67cf1f26c55a82e&apos;,</div><div class="line">    &apos;setuptools-0.6c7-py2.5.egg&apos;: &apos;45d2ad28f9750e7434111fde831e8372&apos;,</div><div class="line">    &apos;setuptools-0.6c8-py2.3.egg&apos;: &apos;50759d29b349db8cfd807ba8303f1902&apos;,</div><div class="line">    &apos;setuptools-0.6c8-py2.4.egg&apos;: &apos;cba38d74f7d483c06e9daa6070cce6de&apos;,</div><div class="line">    &apos;setuptools-0.6c8-py2.5.egg&apos;: &apos;1721747ee329dc150590a58b3e1ac95b&apos;,</div><div class="line">    &apos;setuptools-0.6c9-py2.3.egg&apos;: &apos;a83c4020414807b496e4cfbe08507c03&apos;,</div><div class="line">    &apos;setuptools-0.6c9-py2.4.egg&apos;: &apos;260a2be2e5388d66bdaee06abec6342a&apos;,</div><div class="line">    &apos;setuptools-0.6c9-py2.5.egg&apos;: &apos;fe67c3e5a17b12c0e7c541b7ea43a8e6&apos;,</div><div class="line">    &apos;setuptools-0.6c9-py2.6.egg&apos;: &apos;ca37b1ff16fa2ede6e19383e7b59245a&apos;,</div><div class="line">&#125;</div><div class="line"></div><div class="line">import sys, os</div><div class="line">try: from hashlib import md5</div><div class="line">except ImportError: from md5 import md5</div><div class="line"></div><div class="line">def _validate_md5(egg_name, data):</div><div class="line">    if egg_name in md5_data:</div><div class="line">        digest = md5(data).hexdigest()</div><div class="line">        if digest != md5_data[egg_name]:</div><div class="line">            print &gt;&gt;sys.stderr, (</div><div class="line">                &quot;md5 validation of %s failed!  (Possible download problem?)&quot;</div><div class="line">                % egg_name</div><div class="line">            )</div><div class="line">            sys.exit(2)</div><div class="line">    return data</div><div class="line"></div><div class="line">def use_setuptools(</div><div class="line">    version=DEFAULT_VERSION, download_base=DEFAULT_URL, to_dir=os.curdir,</div><div class="line">    download_delay=15</div><div class="line">):</div><div class="line">    &quot;&quot;&quot;Automatically find/download setuptools and make it available on sys.path</div><div class="line"></div><div class="line">    `version` should be a valid setuptools version number that is available</div><div class="line">    as an egg for download under the `download_base` URL (which should end with</div><div class="line">    a &apos;/&apos;).  `to_dir` is the directory where setuptools will be downloaded, if</div><div class="line">    it is not already available.  If `download_delay` is specified, it should</div><div class="line">    be the number of seconds that will be paused before initiating a download,</div><div class="line">    should one be required.  If an older version of setuptools is installed,</div><div class="line">    this routine will print a message to ``sys.stderr`` and raise SystemExit in</div><div class="line">    an attempt to abort the calling script.</div><div class="line">    &quot;&quot;&quot;</div><div class="line">    was_imported = &apos;pkg_resources&apos; in sys.modules or &apos;setuptools&apos; in sys.modules</div><div class="line">    def do_download():</div><div class="line">        egg = download_setuptools(version, download_base, to_dir, download_delay)</div><div class="line">        sys.path.insert(0, egg)</div><div class="line">        import setuptools; setuptools.bootstrap_install_from = egg</div><div class="line">    try:</div><div class="line">        import pkg_resources</div><div class="line">    except ImportError:</div><div class="line">        return do_download()       </div><div class="line">    try:</div><div class="line">        pkg_resources.require(&quot;setuptools&gt;=&quot;+version); return</div><div class="line">    except pkg_resources.VersionConflict, e:</div><div class="line">        if was_imported:</div><div class="line">            print &gt;&gt;sys.stderr, (</div><div class="line">            &quot;The required version of setuptools (&gt;=%s) is not available, and\n&quot;</div><div class="line">            &quot;can&apos;t be installed while this script is running. Please install\n&quot;</div><div class="line">            &quot; a more recent version first, using &apos;easy_install -U setuptools&apos;.&quot;</div><div class="line">            &quot;\n\n(Currently using %r)&quot;</div><div class="line">            ) % (version, e.args[0])</div><div class="line">            sys.exit(2)</div><div class="line">    except pkg_resources.DistributionNotFound:</div><div class="line">        pass</div><div class="line"></div><div class="line">    del pkg_resources, sys.modules[&apos;pkg_resources&apos;]    # reload ok</div><div class="line">    return do_download()</div><div class="line"></div><div class="line">def download_setuptools(</div><div class="line">    version=DEFAULT_VERSION, download_base=DEFAULT_URL, to_dir=os.curdir,</div><div class="line">    delay = 15</div><div class="line">):</div><div class="line">    &quot;&quot;&quot;Download setuptools from a specified location and return its filename</div><div class="line"></div><div class="line">    `version` should be a valid setuptools version number that is available</div><div class="line">    as an egg for download under the `download_base` URL (which should end</div><div class="line">    with a &apos;/&apos;). `to_dir` is the directory where the egg will be downloaded.</div><div class="line">    `delay` is the number of seconds to pause before an actual download attempt.</div><div class="line">    &quot;&quot;&quot;</div><div class="line">    import urllib2, shutil</div><div class="line">    egg_name = &quot;setuptools-%s-py%s.egg&quot; % (version,sys.version[:3])</div><div class="line">    url = download_base + egg_name</div><div class="line">    saveto = os.path.join(to_dir, egg_name)</div><div class="line">    src = dst = None</div><div class="line">    if not os.path.exists(saveto):  # Avoid repeated downloads</div><div class="line">        try:</div><div class="line">            from distutils import log</div><div class="line">            if delay:</div><div class="line">                log.warn(&quot;&quot;&quot;</div><div class="line">---------------------------------------------------------------------------</div><div class="line">This script requires setuptools version %s to run (even to display</div><div class="line">help).  I will attempt to download it for you (from</div><div class="line">%s), but</div><div class="line">you may need to enable firewall access for this script first.</div><div class="line">I will start the download in %d seconds.</div><div class="line"></div><div class="line">(Note: if this machine does not have network access, please obtain the file</div><div class="line"></div><div class="line">   %s</div><div class="line"></div><div class="line">and place it in this directory before rerunning this script.)</div><div class="line">---------------------------------------------------------------------------&quot;&quot;&quot;,</div><div class="line">                    version, download_base, delay, url</div><div class="line">                ); from time import sleep; sleep(delay)</div><div class="line">            log.warn(&quot;Downloading %s&quot;, url)</div><div class="line">            src = urllib2.urlopen(url)</div><div class="line">            # Read/write all in one block, so we don&apos;t create a corrupt file</div><div class="line">            # if the download is interrupted.</div><div class="line">            data = _validate_md5(egg_name, src.read())</div><div class="line">            dst = open(saveto,&quot;wb&quot;); dst.write(data)</div><div class="line">        finally:</div><div class="line">            if src: src.close()</div><div class="line">            if dst: dst.close()</div><div class="line">    return os.path.realpath(saveto)</div><div class="line"></div><div class="line">def main(argv, version=DEFAULT_VERSION):</div><div class="line">    &quot;&quot;&quot;Install or upgrade setuptools and EasyInstall&quot;&quot;&quot;</div><div class="line">    try:</div><div class="line">        import setuptools</div><div class="line">    except ImportError:</div><div class="line">        egg = None</div><div class="line">        try:</div><div class="line">            egg = download_setuptools(version, delay=0)</div><div class="line">            sys.path.insert(0,egg)</div><div class="line">            from setuptools.command.easy_install import main</div><div class="line">            return main(list(argv)+[egg])   # we&apos;re done here</div><div class="line">        finally:</div><div class="line">            if egg and os.path.exists(egg):</div><div class="line">                os.unlink(egg)</div><div class="line">    else:</div><div class="line">        if setuptools.__version__ == &apos;0.0.1&apos;:</div><div class="line">            print &gt;&gt;sys.stderr, (</div><div class="line">            &quot;You have an obsolete version of setuptools installed.  Please\n&quot;</div><div class="line">            &quot;remove it from your system entirely before rerunning this script.&quot;</div><div class="line">            )</div><div class="line">            sys.exit(2)</div><div class="line"></div><div class="line">    req = &quot;setuptools&gt;=&quot;+version</div><div class="line">    import pkg_resources</div><div class="line">    try:</div><div class="line">        pkg_resources.require(req)</div><div class="line">    except pkg_resources.VersionConflict:</div><div class="line">        try:</div><div class="line">            from setuptools.command.easy_install import main</div><div class="line">        except ImportError:</div><div class="line">            from easy_install import main</div><div class="line">        main(list(argv)+[download_setuptools(delay=0)])</div><div class="line">        sys.exit(0) # try to force an exit</div><div class="line">    else:</div><div class="line">        if argv:</div><div class="line">            from setuptools.command.easy_install import main</div><div class="line">            main(argv)</div><div class="line">        else:</div><div class="line">            print &quot;Setuptools version&quot;,version,&quot;or greater has been installed.&quot;</div><div class="line">            print &apos;(Run &quot;ez_setup.py -U setuptools&quot; to reinstall or upgrade.)&apos;</div><div class="line"></div><div class="line">def update_md5(filenames):</div><div class="line">    &quot;&quot;&quot;Update our built-in md5 registry&quot;&quot;&quot;</div><div class="line"></div><div class="line">    import re</div><div class="line"></div><div class="line">    for name in filenames:</div><div class="line">        base = os.path.basename(name)</div><div class="line">        f = open(name,&apos;rb&apos;)</div><div class="line">        md5_data[base] = md5(f.read()).hexdigest()</div><div class="line">        f.close()</div><div class="line"></div><div class="line">    data = [&quot;    %r: %r,\n&quot; % it for it in md5_data.items()]</div><div class="line">    data.sort()</div><div class="line">    repl = &quot;&quot;.join(data)</div><div class="line"></div><div class="line">    import inspect</div><div class="line">    srcfile = inspect.getsourcefile(sys.modules[__name__])</div><div class="line">    f = open(srcfile, &apos;rb&apos;); src = f.read(); f.close()</div><div class="line"></div><div class="line">    match = re.search(&quot;\nmd5_data = &#123;\n([^&#125;]+)&#125;&quot;, src)</div><div class="line">    if not match:</div><div class="line">        print &gt;&gt;sys.stderr, &quot;Internal error!&quot;</div><div class="line">        sys.exit(2)</div><div class="line"></div><div class="line">    src = src[:match.start(1)] + repl + src[match.end(1):]</div><div class="line">    f = open(srcfile,&apos;w&apos;)</div><div class="line">    f.write(src)</div><div class="line">    f.close()</div><div class="line"></div><div class="line"></div><div class="line">if __name__==&apos;__main__&apos;:</div><div class="line">    if len(sys.argv)&gt;2 and sys.argv[1]==&apos;--md5update&apos;:</div><div class="line">        update_md5(sys.argv[2:])</div><div class="line">    else:</div><div class="line">        main(sys.argv[1:])</div></pre></td></tr></table></figure></p>
<p>然后再去安装Django就没问题了。</p>
<p>#创建Django项目<br>输入命令django-admin.py startproject mysite 用来创建一个网站项目mysite。<br>当然，执行该命令你需要先将Django的Bin添加到path中去。再进入目录输入manage.py runserver 开启网站。可以指定端口，默认为8000，如果想使用90端口，就写成 manage.py runserver 90。最后我们打开浏览器在地址栏里输入地址 <a href="http://localhost:8000" target="_blank" rel="external">http://localhost:8000</a> 就可以看到初始化项目自动生成好了。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2014/10/26/2014-10-26-use-one-month-after-sublime-skill-of-using-some-of-the-summary/" itemprop="url">
                  使用Sublime一个月后的一些使用技巧总结
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2014-10-26T01:45:00+08:00" content="2014-10-26">
              2014-10-26
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Sublime/" itemprop="url" rel="index">
                    <span itemprop="name">Sublime</span>
                  </a>
                </span>

                
                
                  , 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Sublime/工具/" itemprop="url" rel="index">
                    <span itemprop="name">工具</span>
                  </a>
                </span>

                
                
                  , 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Sublime/工具/编辑器/" itemprop="url" rel="index">
                    <span itemprop="name">编辑器</span>
                  </a>
                </span>

                
                
                  , 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Sublime/工具/编辑器/提升工作效率/" itemprop="url" rel="index">
                    <span itemprop="name">提升工作效率</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>#废话<br>这个月开始从VIM转向使用Sublime，可能很多Sublime脑残粉会说，这工具你现在才开始用啊，也可能很多Vim脑残粉会说，Vim是最高级的编辑器，你竟然自我退化。确实Vim太高级了，我用不好，Sublime至少一个月内让我把IntelliJ的前端功能都摒弃了（以前html、css、JavaScript基本用他操作）。</p>
<p>#Feature<br>那就来说说我感受到的他的优点</p>
<p>##强大的命令模式<br>在编辑窗口按ctrl+shift+p就可以进入命令模式，命令模式即为在编辑窗口上方弹出了一个输入框，可以输入Sublime内置和插件所扩展的命令功能，而且支持模糊匹配。比如：</p>
<ul>
<li>set synax javascript 命令可以设置当前语法为javascript</li>
<li>安装Package Control后可以用Package Install命令来安装插件</li>
<li>minimap 可以关闭打开编辑器迷你图</li>
<li>等等等等</li>
</ul>
<p>##强大的Goto功能<br>在编辑窗口输入ctrl+p就可以进入goto命令，与命令模式一样，在编辑窗口上方会弹出了一个输入框，可以输入goto的命令，可以是文件跳转，也可以是文件跳转行，也可以跳转到某个元素（函数、选择器等），也可以在页面中查找。</p>
<ul>
<li>@可以快速定位元素，比如js的函数，CSS文件的选择器，支持模糊匹配</li>
<li>#可以定位到页面内的内容，支持模糊匹配</li>
<li>：+行数 跳转到行</li>
</ul>
<p>##模糊匹配功能<br>我认为的模糊分两种，一种是模糊缩写自动补全，一种是搜索的时候的模糊匹配，如下：</p>
<ul>
<li>模糊补全：在CSS文件中输入bgc按tab键就是自动键入background-color</li>
<li>模糊匹配：比如在命令模式输入ssjs，就会模糊匹配上 <strong>s</strong>et <strong>s</strong>ynax <strong>j</strong>ava <strong>s</strong>cript，粗体的字符为模糊匹配的字段；</li>
</ul>
<p>##强大的插件功能<br>基本上所有的语法都能找到很好的插件，比如对于Html就有Emmet，他极大的提升了前端开发的工作效率，这里就不一一细说该插件，有兴趣的可以Google下，这里稍微举个例子来看看。<br>ctrl+n创建个页面后，输入 !+[tab]，就可以自动生成html5的标准文档，如果需要HTML4的标准，就输入html:4s+[tab]。之后会自动生成如下代码。<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">	</div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>然后在任意位置输入元素名字后按tab都能生成相应名字的元素，比如输入script+[tab]，就会生成script标签。如果输入div.className就会生成<figure class="highlight plain"><figcaption><span>class="className">``` ，是不是很神奇。更神奇的是，输入ul>.item$*5+[tab]（ *这里注意，>代表子元素，+代表并列。子元素的情况下默认子元素为div，但是ul的默认为li，tr的默认为td等* ），会自动生成以下代码：</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">```html</div><div class="line">&lt;ul&gt;</div><div class="line">        &lt;li class=&quot;item1&quot;&gt;&lt;/li&gt;</div><div class="line">        &lt;li class=&quot;item2&quot;&gt;&lt;/li&gt;</div><div class="line">        &lt;li class=&quot;item3&quot;&gt;&lt;/li&gt;</div><div class="line">        &lt;li class=&quot;item4&quot;&gt;&lt;/li&gt;</div><div class="line">        &lt;li class=&quot;item5&quot;&gt;&lt;/li&gt;</div><div class="line">&lt;/ul&gt;</div></pre></td></tr></table></figure></p>
<p>##多行编辑功能<br>就在上列html代码中，如果要同时编辑li元素中的内容，那么正常情况需要先编辑完一个后复制粘贴4次。Subilme的多行编辑功能很好的帮我们简化了这个操作（编码+鼠标+键盘+再鼠标+再键盘……），提升了我们的编码速率。<br>进入多行编辑模式有几种方式，如下：</p>
<ul>
<li>选中&gt;&lt;按alt+f3可以多行光标模式（这里输入的内容为需要匹配的共同点），这样做的坏处是共同点与其他页面元素相同时候不方便匹配，比较不灵活</li>
<li>争对上面的问题就有另一个办法，可以把鼠标放在&gt;&lt;之间按住shift用右键往下拖来就可以进行多行编辑，这样做的坏处是，如果需要多行编辑的元素不在一个垂直线并且不是末尾元素，将无法进行</li>
<li>再争对以上问题就又有一个办法，可以选中&gt;&lt;后用ctrl+d 和ctrl+k来选择跳过选中，这样的缺点就是太慢，尽可能还是在相同点按alt+f3吧</li>
</ul>
<p>多行选择后可以p{This is content}+[tab]来生成以下代码<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item1 "</span>&gt;</span><span class="tag">&lt;<span class="name">p</span>&gt;</span>This is content<span class="tag">&lt;/<span class="name">p</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item2 "</span>&gt;</span><span class="tag">&lt;<span class="name">p</span>&gt;</span>This is content<span class="tag">&lt;/<span class="name">p</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item3 "</span>&gt;</span><span class="tag">&lt;<span class="name">p</span>&gt;</span>This is content<span class="tag">&lt;/<span class="name">p</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item4 "</span>&gt;</span><span class="tag">&lt;<span class="name">p</span>&gt;</span>This is content<span class="tag">&lt;/<span class="name">p</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item5 "</span>&gt;</span><span class="tag">&lt;<span class="name">p</span>&gt;</span>This is content<span class="tag">&lt;/<span class="name">p</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>##其他快捷键<br>其中粗体的内容为我认为可以大幅度增加工作效率的功能，而且其他浏览器可能没有的（不是绝对没有，请勿喷）。<br>ctrl+tab切换正在编辑的文件（ctrl+shift+tab可以相反方向）<br>ctrl+H当前文件查找替换模式（类型其他编辑器的替换查找）<br>ctrl+f所有文件查找内容(使用完后按esc退出，之前一直不知道这个。。。)<br>ctrl+shift+f所有文件替换内容<br>ctrl+shift+d 复制当前或者复制选中内容<br>ctrl+shift+k 删除当前行<br>alt+. 闭合标签<br><strong>shift+f11</strong> 进入无干扰模式<br><strong>ctrl+enter</strong> 在下一行插入并移动光标到那<br><strong>ctrl+shift+enter</strong> 在上一行插入并移动光标到那<br><strong>ctrl+shift+v</strong> 带自动缩进的粘贴（正常复制后格式会乱，这种方式粘贴后省略了人工排版的问题）</p>
<p>#总结<br>好用，谁用谁知道！</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2014/10/26/2014-10-26-july-september-output-of-06-version-summary/" itemprop="url">
                  7-9月产品0.6版本总结
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2014-10-26T01:40:00+08:00" content="2014-10-26">
              2014-10-26
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>这上半年的总结，其实也就是这两个月的总结。3月后，项目组由于人员离职，也就剩下我一个人，那时候也处于部门合并和新顶头上司的变换中。4月5月也非常忙，一个人把V0.5BETA版本做了发布前的最后调整。这项目往返的比较严重，确实让人疲劳，也一个人做的事情太杂，其实工作状态并不好。<br>    接着4月发布后，做了一次小型的重构，重构后让原来的设计更加灵活了一些，加班加点完成了这部分重构后开始了一段轻松的旅途，10天时间，5个城市，有点赶，但是魔都的迷幻、西塘水乡的惬意、苏州园林的精致、南京古都的庄严、雨后西湖的美轮美奂、灵隐寺的大气磅礴，未尝想过，夏天，没有想象中江南的细雨，但有着这么多不同风格的美景，加上旁边的挚爱的伴侣，真是让人乐不思蜀。<br>    回来后瞎折腾一个月，主要还是产品的方向、需求的打磨、进度的计划等，这段时间总之效率不高，一是还沉浸在那段旅途回忆中，另是事情太杂方向比较迷茫，确实比较力不从心。<br>    7月后项目组又兵强马壮了，重装再发。开始了产品V0.6版本的开发，这段时间确实比较多总结的。资源竞争等外因确实影响着我们，但这总结主要从自身出发，以下是我总结的几个点：</p>
<ul>
<li>其实，界面设计、交互设计、架构设计、模块设计都很难在开始的时候就做的周全，在开始就去追求一份最适合的答案，那必然是花费非常多的人力物力，并且到最后会有角度的设计是冗余的。因此，我们应该多在开发的过程中去思考，随着Sprint的进展，所掌握的知识也越充分，把自己负责的模块仔细考虑。这阶段整个项目组对这点做的很不到位，原因大致一是业务不足，二是缺少思考，三是进度太紧。等到测试阶段才发现设计问题，那重构的代价就比开发阶段大大提升了；</li>
<li>功能耦合较严重，其实在后台已经在代码设计上做到解耦，但是功能要做的比较有引导性，就容易将业务上有关系的模块揉在一起，那就导致很多地方可能改了一个问题，又出现一个问题，或者是改了一个问题，漏了一个问题，也就是我说的拆了东墙补西墙，拆了东墙漏西墙；</li>
<li>项目周期拉的太长了，让人疲劳，最好是能把Sprint压缩在3个工作周内，又不会无法完成完整功能，又不会时间太长；</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2014/09/03/2014-09-03-explore-the-browser-side-events-a-an-event-event-flow-profile-add-events/" itemprop="url">
                  浏览器端的事件探秘（一）---事件事件流简介、事件添加方式
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2014-09-03T13:17:00+08:00" content="2014-09-03">
              2014-09-03
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/javascript/" itemprop="url" rel="index">
                    <span itemprop="name">javascript</span>
                  </a>
                </span>

                
                
                  , 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/javascript/事件流/" itemprop="url" rel="index">
                    <span itemprop="name">事件流</span>
                  </a>
                </span>

                
                
                  , 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/javascript/事件流/事件/" itemprop="url" rel="index">
                    <span itemprop="name">事件</span>
                  </a>
                </span>

                
                
                  , 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/javascript/事件流/事件/事件冒泡/" itemprop="url" rel="index">
                    <span itemprop="name">事件冒泡</span>
                  </a>
                </span>

                
                
                  , 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/javascript/事件流/事件/事件冒泡/添加事件方式/" itemprop="url" rel="index">
                    <span itemprop="name">添加事件方式</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Javascript的事件"><a href="#Javascript的事件" class="headerlink" title="Javascript的事件"></a>Javascript的事件</h2><p>#1 事件冒泡</p>
<p>##1.1 事件<br>在IE4以后，浏览器的开发团队就开始给页面的每个部分都设定了特定的事件。多到鼠标点击，简单到鼠标滑过，甚至敲击键盘都会有特定的事件。</p>
<p>##1.2 事件流<br>如下图，点击页面的一部分DIV3的时候，那么浏览器就认为你点击这按钮的同时，也点击了这个按钮所在的容器。这个过程就是一个事件流。<br><img src="http://chuantu.biz/t/50/1409750064x1822611033.jpg" alt=""><br>事件描述的是从页面接受事件的顺序。IE的事件流方式是事件冒泡流，网景公司用的是事件捕获流。</p>
<p>###1.2.1 事件冒泡<br>即事件最开始有最具体的元素（文档中的嵌套层次最深的元素）接收，然后逐级上传到最不具体的元素（文档）。<br>比如下面这个程序，当你点按钮的时候，也会认为你点了div，然后在认为你点了body，然后又认为你点了html，然后在认为你点了document。<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"Content-Type"</span> <span class="attr">content</span>=<span class="string">"text/html;charset=utf-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>事件流<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">        <span class="function"><span class="keyword">function</span> <span class="title">showMsg</span>(<span class="params">txt</span>)</span>&#123;</div><div class="line">            alert(txt)</div><div class="line">        &#125;</div><div class="line"></div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"box"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"按钮"</span> <span class="attr">id</span>=<span class="string">"btn"</span> <span class="attr">onclick</span>=<span class="string">"showMsg('按钮')"</span> /&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span></span></div></pre></td></tr></table></figure></p>
<p>###1.2.2 事件捕获<br>不太具体的应该更早的接受到事件，具体的应该是最后接受到的。上面例子，document就是最先接收，最后是按钮。</p>
<p>##1.3 事件添加方法</p>
<p>###1.3.1 html事件<br>上述代码就是一个html事件，html事件会导致html代码和javascript代码连接过紧，如果修改javascript代码的函数名，那么也要同学修改html。</p>
<p>###1.3.2 DOM0级事件处理程序<br>好处：简单，跨浏览器。<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"Content-Type"</span> <span class="attr">content</span>=<span class="string">"text/html;charset=utf-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>事件流<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">        <span class="function"><span class="keyword">function</span> <span class="title">init</span>(<span class="params"></span>)</span>&#123;</div><div class="line">            <span class="keyword">var</span> btn1 = <span class="built_in">document</span>.getElementById(<span class="string">"btn"</span>)</div><div class="line">            btn1.onclick=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">                showMsg(<span class="keyword">this</span>.getAttribute(<span class="string">"value"</span>))</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">var</span> btn2 = <span class="built_in">document</span>.getElementById(<span class="string">"btn2"</span>)</div><div class="line">            btn2.onclick=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">                showMsg(<span class="keyword">this</span>.getAttribute(<span class="string">"value"</span>))</div><div class="line">                btn2.onclick = <span class="literal">null</span></div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="function"><span class="keyword">function</span> <span class="title">showMsg</span>(<span class="params">txt</span>)</span>&#123;</div><div class="line">            alert(txt)</div><div class="line">        &#125;</div><div class="line"></div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">onload</span>=<span class="string">"init()"</span> &gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"box"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"按钮"</span> <span class="attr">id</span>=<span class="string">"btn"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"按钮2"</span> <span class="attr">id</span>=<span class="string">"btn2"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>###1.3.3 DOM2级事件处理<br>定义了2个方法，用于处理指定和删除事件处理程序的操作。分别为addEventListener()和removeEventListener()。接受3个参数：要处理的事件名、作为事件处理程序的函数和布尔值（true是事件捕获，false是事件冒泡）。<br>addEventListener添加的事件只能通过removeEventListener来删除，且参数一致。<br>详细参考如下代码：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">&lt;html&gt;</div><div class="line">&lt;head&gt;</div><div class="line">    &lt;meta http-equiv="Content-Type" content="text/html;charset=utf-8"&gt;</div><div class="line">    &lt;title&gt;事件流&lt;/title&gt;</div><div class="line">    &lt;script type="text/javascript"&gt;</div><div class="line">        function init()&#123;</div><div class="line">            var btn1 = document.getElementById("btn")</div><div class="line">            btn1.addEventListener('click',clickBtn,false)</div><div class="line">            var btn2 = document.getElementById("btn2")</div><div class="line">            btn2.addEventListener('click',clickBtn,false)</div><div class="line">            btn2.addEventListener('click',function()&#123;</div><div class="line">                btn2.removeEventListener('click',clickBtn,false)</div><div class="line">            &#125;,false)</div><div class="line">        &#125;</div><div class="line">        function clickBtn()&#123;</div><div class="line">            showMsg(this.getAttribute("value"))</div><div class="line">        &#125;</div><div class="line">        function showMsg(txt)&#123;</div><div class="line">            alert(txt)</div><div class="line">        &#125;</div><div class="line"></div><div class="line">    &lt;/script&gt;</div><div class="line">&lt;/head&gt;</div><div class="line">&lt;body onload="init()" &gt;</div><div class="line">    &lt;div id="box"&gt;</div><div class="line">        &lt;input type="button" value="按钮" id="btn"/&gt;</div><div class="line">        &lt;input type="button" value="按钮2" id="btn2"/&gt;</div><div class="line">    &lt;/div&gt;</div><div class="line">&lt;/body&gt;</div><div class="line">&lt;/html&gt;</div></pre></td></tr></table></figure></p>
<p>DOM2级还有一个好处就是可以给模块增加多个点击事件。如上btn2，就添加了多个click事件。</p>
<p>###1.3.4 IE事件处理程序<br>定义了2个方法，用于处理指定和删除事件处理程序的操作。分别为attachEvent ()和detachEvent ()。接受2个参数：要处理的事件名、作为事件处理程序的函数，事件处理方式就是冒泡。<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"Content-Type"</span> <span class="attr">content</span>=<span class="string">"text/html;charset=utf-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>事件流<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">        <span class="function"><span class="keyword">function</span> <span class="title">init</span>(<span class="params"></span>)</span>&#123;</div><div class="line">            <span class="keyword">var</span> btn1 = <span class="built_in">document</span>.getElementById(<span class="string">"btn"</span>)</div><div class="line">            btn1.attachEvent(<span class="string">'onclick'</span>,clickBtn)</div><div class="line">            <span class="keyword">var</span> btn2 = <span class="built_in">document</span>.getElementById(<span class="string">"btn2"</span>)</div><div class="line">            btn2.attachEvent(<span class="string">'onclick'</span>,clickBtn)</div><div class="line">            btn2.attachEvent(<span class="string">'onclick'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">                btn2.detachEvent(<span class="string">'onclick'</span>,clickBtn)</div><div class="line">            &#125;)</div><div class="line">        &#125;</div><div class="line">        <span class="function"><span class="keyword">function</span> <span class="title">clickBtn</span>(<span class="params"></span>)</span>&#123;</div><div class="line">            showMsg(<span class="keyword">this</span>.value)</div><div class="line">            <span class="comment">//this.getAttribute("value")</span></div><div class="line">        &#125;</div><div class="line">        <span class="function"><span class="keyword">function</span> <span class="title">showMsg</span>(<span class="params">txt</span>)</span>&#123;</div><div class="line">            alert(txt)</div><div class="line">        &#125;</div><div class="line"></div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">onload</span>=<span class="string">"init()"</span> &gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"box"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"按钮"</span> <span class="attr">id</span>=<span class="string">"btn"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"按钮2"</span> <span class="attr">id</span>=<span class="string">"btn2"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>###1.3.5 跨浏览器事件处理<br>那就要做能力处理判断，那最好把这种处理放在一个对象中。<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"Content-Type"</span> <span class="attr">content</span>=<span class="string">"text/html;charset=utf-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>事件流<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">        <span class="function"><span class="keyword">function</span> <span class="title">EventUtil</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        &#125;</div><div class="line">        EventUtil.prototype.addHandler = <span class="function"><span class="keyword">function</span>(<span class="params">element,type,handler</span>)</span>&#123;</div><div class="line">            <span class="keyword">if</span>(element.addEventListener)&#123;</div><div class="line">                element.addEventListener(type,handler,<span class="literal">false</span>);</div><div class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(element.attachEvent)&#123;</div><div class="line">                element.attachEvent(<span class="string">'on'</span>+type,handler);</div><div class="line">            &#125;<span class="keyword">else</span>&#123;</div><div class="line">                <span class="comment">//在javascript中，所有用点的地方都能用中刮号</span></div><div class="line">                element[<span class="string">'on'</span>+type] = handler;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        EventUtil.prototype.removeHandler = <span class="function"><span class="keyword">function</span>(<span class="params">element,type,handler</span>)</span>&#123;</div><div class="line">            <span class="keyword">if</span>(element.removeEventListener)&#123;</div><div class="line">                element.removeEventListener(type,handler,<span class="literal">false</span>);</div><div class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(element.detachEvent)&#123;</div><div class="line">                element.detachEvent(<span class="string">'on'</span>+type,handler);</div><div class="line">            &#125;<span class="keyword">else</span>&#123;</div><div class="line">                <span class="comment">//在javascript中，所有用点的地方都能用中刮号</span></div><div class="line">                element[<span class="string">'on'</span>+type] = <span class="literal">null</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="function"><span class="keyword">function</span> <span class="title">init</span>(<span class="params"></span>)</span>&#123;</div><div class="line">            <span class="keyword">var</span> eventUtil = <span class="keyword">new</span> EventUtil();</div><div class="line">            <span class="keyword">var</span> btn1 = <span class="built_in">document</span>.getElementById(<span class="string">"btn"</span>)</div><div class="line">            eventUtil.addHandler(btn1,<span class="string">'click'</span>,clickBtn)</div><div class="line">            <span class="keyword">var</span> btn2 = <span class="built_in">document</span>.getElementById(<span class="string">"btn2"</span>)</div><div class="line">            eventUtil.addHandler(btn2,<span class="string">'click'</span>,clickBtn)</div><div class="line">            eventUtil.addHandler(btn2,<span class="string">'click'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">                eventUtil.removeHandler(btn2,<span class="string">'click'</span>,clickBtn)</div><div class="line">            &#125;)</div><div class="line">        &#125;</div><div class="line">        <span class="function"><span class="keyword">function</span> <span class="title">clickBtn</span>(<span class="params"></span>)</span>&#123;</div><div class="line">            <span class="keyword">if</span>(<span class="keyword">this</span>.value)&#123;</div><div class="line">                showMsg(<span class="keyword">this</span>.value)</div><div class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="keyword">this</span>.attributes)&#123;</div><div class="line">                showMsg(<span class="keyword">this</span>.attributes[<span class="string">"value"</span>])</div><div class="line">            &#125; <span class="keyword">else</span>&#123;</div><div class="line">                showMsg(<span class="string">"Hello World"</span>)</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            <span class="comment">//this.getAttribute("value")</span></div><div class="line">        &#125;</div><div class="line">        <span class="function"><span class="keyword">function</span> <span class="title">showMsg</span>(<span class="params">txt</span>)</span>&#123;</div><div class="line">            alert(txt)</div><div class="line">        &#125;</div><div class="line"></div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">onload</span>=<span class="string">"init()"</span> &gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"box"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"按钮"</span> <span class="attr">id</span>=<span class="string">"btn"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"按钮2"</span> <span class="attr">id</span>=<span class="string">"btn2"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2014/09/02/2014-09-02-refactoring-code-example/" itemprop="url">
                  重构-代码示例
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2014-09-02T13:58:00+08:00" content="2014-09-02">
              2014-09-02
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/重构/" itemprop="url" rel="index">
                    <span itemprop="name">重构</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>#Round.1案例<br>这里的案例是从重构这本书上直接拿来的，但是我通过不同的理解，做了些不一样的重构，总在先上源码。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Movie</span> </span>&#123;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> CHILDRENS = <span class="number">2</span>;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> NEW_RELEASE = <span class="number">1</span>;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> REGULAR = <span class="number">0</span>;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> String _title;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> _priceCode;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Movie</span><span class="params">(String title, <span class="keyword">int</span> priceCode)</span> </span>&#123;</div><div class="line">        _title = title;</div><div class="line">        _priceCode = priceCode;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getPriceCode</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> _priceCode;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPriceCode</span><span class="params">(<span class="keyword">int</span> arg)</span> </span>&#123;</div><div class="line">        _priceCode = arg;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getTitle</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> _title;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Rental</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> Movie _movie;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> _daysRented;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Rental</span><span class="params">(Movie movie, <span class="keyword">int</span> daysRented)</span> </span>&#123;</div><div class="line">        _movie = movie;</div><div class="line">        _daysRented = daysRented;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getDaysRented</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> _daysRented;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> Movie <span class="title">getMovie</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> _movie;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Customer</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> String _name;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> List&lt;Rental_rentals = <span class="keyword">new</span> ArrayList&lt;Rental&gt;();</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Customer</span><span class="params">(String name)</span> </span>&#123;</div><div class="line">        _name = name;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addRental</span><span class="params">(Rental arg)</span> </span>&#123;</div><div class="line">        _rentals.add(arg);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> _name;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">statement</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">double</span> totalAmount = <span class="number">0</span>;</div><div class="line">        <span class="keyword">int</span> frequentRenterPoints = <span class="number">0</span>;</div><div class="line">        String result = <span class="string">"Rental record for "</span> + getName() + <span class="string">"\n"</span>;</div><div class="line"></div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> index = <span class="number">0</span>; index &lt; _rentals.size(); index++) &#123;</div><div class="line">            <span class="keyword">double</span> thisAmount = <span class="number">0</span>;</div><div class="line">            Rental each = (Rental) _rentals.get(index);</div><div class="line"></div><div class="line">            <span class="keyword">switch</span> (each.getMovie().getPriceCode()) &#123;</div><div class="line">            <span class="keyword">case</span> Movie.REGULAR:</div><div class="line">                thisAmount += <span class="number">2</span>;</div><div class="line">                <span class="keyword">if</span> (each.getDaysRented() <span class="number">2</span>)</div><div class="line">                    thisAmount += (each.getDaysRented() - <span class="number">2</span>) * <span class="number">1.5</span>;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> Movie.NEW_RELEASE:</div><div class="line">                thisAmount += each.getDaysRented() * <span class="number">3</span>;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> Movie.CHILDRENS:</div><div class="line">                thisAmount += <span class="number">1.5</span>;</div><div class="line">                <span class="keyword">if</span> (each.getDaysRented() <span class="number">3</span>)</div><div class="line">                    thisAmount += (each.getDaysRented() - <span class="number">3</span>) * <span class="number">1.5</span>;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            &#125;</div><div class="line">            frequentRenterPoints++;</div><div class="line">            <span class="keyword">if</span> (each.getMovie().getPriceCode() == Movie.NEW_RELEASE</div><div class="line">                    &amp;&amp; each.getDaysRented() <span class="number">1</span>)</div><div class="line">                frequentRenterPoints++;</div><div class="line"></div><div class="line">            result += <span class="string">"\t"</span> + each.getMovie().getTitle() + <span class="string">"\t"</span></div><div class="line">                    + String.valueOf(thisAmount) + <span class="string">"\n"</span>;</div><div class="line">            totalAmount += thisAmount;</div><div class="line">        &#125;</div><div class="line">        result += <span class="string">"Amount owed is "</span> + String.valueOf(totalAmount) + <span class="string">"\n"</span>;</div><div class="line">        result += <span class="string">"You earned "</span> + String.valueOf(frequentRenterPoints)</div><div class="line">                + <span class="string">"frequent renter points"</span>;</div><div class="line">        <span class="keyword">return</span> result;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Cp1Demo1</span></span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        Customer cuntomer = <span class="keyword">new</span> Customer(<span class="string">"David"</span>);</div><div class="line">        cuntomer.addRental(<span class="keyword">new</span> Rental(<span class="keyword">new</span> Movie(<span class="string">"Lost Template"</span>, Movie.NEW_RELEASE), <span class="number">5</span>));</div><div class="line">        cuntomer.addRental(<span class="keyword">new</span> Rental(<span class="keyword">new</span> Movie(<span class="string">"The Great Gatsby"</span>, Movie.REGULAR), <span class="number">4</span>));</div><div class="line">        cuntomer.addRental(<span class="keyword">new</span> Rental(<span class="keyword">new</span> Movie(<span class="string">"Wolf and Sheep"</span>, Movie.CHILDRENS), <span class="number">2</span>));</div><div class="line">        cuntomer.addRental(<span class="keyword">new</span> Rental(<span class="keyword">new</span> Movie(<span class="string">"Star Trek"</span>, Movie.REGULAR), <span class="number">2</span>));</div><div class="line">        System.out.println(cuntomer.statement());</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>#Round.2 让代码变得可测试（增加单元测试）<br>首先，先改造Customer类，让statement中的核心计算方法（算价格和算积分的方法）抽出。<br><figure class="highlight java"><figcaption><span>Customer.java</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Customer</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> String name;</div><div class="line"></div><div class="line">    <span class="comment">//......省略部分代码</span></div><div class="line">    </div><div class="line">    <span class="comment">//去除statement和main部分</span></div><div class="line">    </div><div class="line">    <span class="comment">//对于statement中的方法，抽出两个关键的核心方法</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">amountTotalConsume</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">double</span> totalAmount = <span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> index = <span class="number">0</span>; index &lt; getRentals().size(); index++) &#123;</div><div class="line">            <span class="keyword">double</span> thisAmount = <span class="number">0</span>;</div><div class="line">            Rental each = (Rental) getRentals().get(index);</div><div class="line"></div><div class="line">            <span class="keyword">switch</span> (each.getMovie().getPriceCode()) &#123;</div><div class="line">            <span class="keyword">case</span> Movie.REGULAR:</div><div class="line">                thisAmount += <span class="number">2</span>;</div><div class="line">                <span class="keyword">if</span> (each.getDaysRented() <span class="number">2</span>)</div><div class="line">                    thisAmount += (each.getDaysRented() - <span class="number">2</span>) * <span class="number">1.5</span>;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> Movie.NEW_RELEASE:</div><div class="line">                thisAmount += each.getDaysRented() * <span class="number">3</span>;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> Movie.CHILDRENS:</div><div class="line">                thisAmount += <span class="number">1.5</span>;</div><div class="line">                <span class="keyword">if</span> (each.getDaysRented() <span class="number">3</span>)</div><div class="line">                    thisAmount += (each.getDaysRented() - <span class="number">3</span>) * <span class="number">1.5</span>;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            &#125;</div><div class="line">            <span class="comment">// 日志</span></div><div class="line">            System.out.println(<span class="string">"\t"</span> + each.getMovie().getTitle() + <span class="string">"\t"</span></div><div class="line">                    + String.valueOf(thisAmount));</div><div class="line">            totalAmount += thisAmount;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> totalAmount;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">countFrequentRenterPoints</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> frequentRenterPoints = <span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> index = <span class="number">0</span>; index &lt; getRentals().size(); index++) &#123;</div><div class="line">            Rental each = (Rental) getRentals().get(index);</div><div class="line"></div><div class="line">            frequentRenterPoints++;</div><div class="line">            <span class="keyword">if</span> (each.getMovie().getPriceCode() == Movie.NEW_RELEASE</div><div class="line">                    &amp;&amp; each.getDaysRented() <span class="number">1</span>)</div><div class="line">                frequentRenterPoints++;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> frequentRenterPoints;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>抽出后，也留有打印信息的事务入口，将入口创建一个新的类CustomerConsumeClinent<br><figure class="highlight java"><figcaption><span>CustomerConsumeClinent.java</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomerConsumeClinent</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">statement</span><span class="params">(Customer customer)</span> </span>&#123;</div><div class="line">        System.out.println(<span class="string">"Rental record for "</span> + customer.getName());</div><div class="line">        StringBuilder resultSb = <span class="keyword">new</span> StringBuilder();</div><div class="line">        resultSb.append(<span class="string">"Amount owed is "</span>)</div><div class="line">                .append(String.valueOf(customer.amountTotalConsume()))</div><div class="line">                .append(<span class="string">"\n"</span>).append(<span class="string">"You earned "</span>)</div><div class="line">                .append(String.valueOf(customer.countFrequentRenterPoints()))</div><div class="line">                .append(<span class="string">" frequent renter points"</span>);</div><div class="line">        <span class="keyword">return</span> resultSb.toString();</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        Customer customer = <span class="keyword">new</span> Customer(<span class="string">"David"</span>);</div><div class="line">        customer.addRental(<span class="keyword">new</span> Rental(<span class="keyword">new</span> Movie(<span class="string">"Lost Template"</span>,</div><div class="line">                Movie.NEW_RELEASE), <span class="number">2</span>));</div><div class="line">        customer.addRental(<span class="keyword">new</span> Rental(<span class="keyword">new</span> Movie(<span class="string">"Lost Template2"</span>,</div><div class="line">                Movie.NEW_RELEASE), <span class="number">2</span>));</div><div class="line">        customer.addRental(<span class="keyword">new</span> Rental(<span class="keyword">new</span> Movie(<span class="string">"The Great Gatsby"</span>,</div><div class="line">                Movie.REGULAR), <span class="number">2</span>));</div><div class="line">        customer.addRental(<span class="keyword">new</span> Rental(<span class="keyword">new</span> Movie(<span class="string">"Wolf and Sheep"</span>,</div><div class="line">                Movie.CHILDRENS), <span class="number">2</span>));</div><div class="line">        customer.addRental(<span class="keyword">new</span> Rental(<span class="keyword">new</span> Movie(<span class="string">"Star Trek"</span>, Movie.REGULAR), <span class="number">2</span>));</div><div class="line">        System.out.println(<span class="keyword">new</span> CustomerConsumeClinent().statement(customer));</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>然后添加单元测试，这里使用的是Junit4加上cucumber-java（Ruby中cucumber的java版本）进行BDD。<br>先修改maven的配置文件。<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></div><div class="line">	<span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd"</span>&gt;</div><div class="line">	<span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.david.codejourney<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>refactoring-book<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line"></div><div class="line">	<span class="tag">&lt;<span class="name">build</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">plugins</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">plugin</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">version</span>&gt;</span>2.5.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">configuration</span>&gt;</span></div><div class="line">					<span class="tag">&lt;<span class="name">encoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">encoding</span>&gt;</span></div><div class="line">					<span class="tag">&lt;<span class="name">source</span>&gt;</span>1.6<span class="tag">&lt;/<span class="name">source</span>&gt;</span></div><div class="line">					<span class="tag">&lt;<span class="name">target</span>&gt;</span>1.6<span class="tag">&lt;/<span class="name">target</span>&gt;</span></div><div class="line">				<span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></div><div class="line">			<span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></div><div class="line"></div><div class="line">			<span class="tag">&lt;<span class="name">plugin</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-surefire-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">version</span>&gt;</span>2.12.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">configuration</span>&gt;</span></div><div class="line">					<span class="tag">&lt;<span class="name">useFile</span>&gt;</span>false<span class="tag">&lt;/<span class="name">useFile</span>&gt;</span></div><div class="line">				<span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></div><div class="line">			<span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">build</span>&gt;</span></div><div class="line"></div><div class="line">	<span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>info.cukes<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cucumber-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>info.cukes<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cucumber-junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.rubiconproject.oss<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jchronic<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">version</span>&gt;</span>0.2.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">version</span>&gt;</span>4.11<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">properties</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">file.encoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">file.encoding</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">properties</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>然后写功能描述文件，也就是单元测试的依据。这里不详细说明cucumber如何使用，有兴趣的自己去搜索相关知识再来看这部分代码，没兴趣的就跳过，知道他是在单元测试就好。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">Feature: Refactoring Book</div><div class="line">  In order to study.</div><div class="line"></div><div class="line">  Scenario Outline: potter tests</div><div class="line">    Given Init the customer</div><div class="line">    And customer rental &lt;number of 1st moviedays of REGULAR movie</div><div class="line">    And customer rental &lt;number of 2nd moviedays of REGULAR movie</div><div class="line">    And customer rental &lt;number of 3rd moviedays of NEW_RELEASE movie</div><div class="line">    And customer rental &lt;number of 4th moviedays of NEW_RELEASE movie</div><div class="line">    And customer rental &lt;number of 5th moviedays of REGULAR movie</div><div class="line">    When I calculate the price and point</div><div class="line">    Then I should get the lowest price &lt;total amountand frequent points &lt;frequent renter points&gt;</div><div class="line"></div><div class="line">  Examples: test basics</div><div class="line">    | number of 1st movie| number of 2nd movie| number of 3rd movie| number of 4th movie| number of 5th movie| total amount | frequent renter points | </div><div class="line">    |         5          |           3        |           4        |         2          |          2         |       32.5   |           7            |</div><div class="line">    |         2          |           2        |           2        |         2          |          2         |       17.5   |           7            |</div><div class="line"></div><div class="line">  Examples: test simple discounts</div><div class="line">    | number of 1st movie| number of 2nd movie| number of 3rd movie| number of 4th movie| number of 5th movie| total amount | frequent renter points |</div><div class="line">    |         1          |           1        |           1        |         1          |          1         |       11.5   |           5            |</div></pre></td></tr></table></figure></p>
<p>然后写单元测试类，该类需要和前面的功能文件对应。<br><figure class="highlight java"><figcaption><span>RefactoringStepdefs.java</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RefactoringStepdefs</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> Customer customer;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> bookCount;</div><div class="line"></div><div class="line">    <span class="meta">@Given</span>(<span class="string">"^Init the customer$"</span>)</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> <span class="keyword">throws</span> Throwable </span>&#123;</div><div class="line">        customer = <span class="keyword">new</span> Customer(<span class="string">"David"</span>);</div><div class="line">        bookCount = <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Given</span>(<span class="string">"^customer rental (\\d+) days of (\\w+) movie$"</span>)</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">customerRentalMovieSimpleTest</span><span class="params">(<span class="keyword">int</span> days, String movieType)</span></span></div><div class="line">            <span class="keyword">throws</span> Throwable &#123;</div><div class="line">        bookCount++;</div><div class="line">        customer.addRental(<span class="keyword">new</span> Rental(<span class="keyword">new</span> Movie(<span class="string">"Movie "</span> + bookCount, movieType</div><div class="line">                .equals(<span class="string">"REGULAR"</span>) ? <span class="number">0</span> : movieType.equals(<span class="string">"NEW_RELEASE"</span>) ? <span class="number">1</span></div><div class="line">                : <span class="number">2</span>), days));</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@When</span>(<span class="string">"^I calculate the price and point$"</span>)</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">calcAndCount</span><span class="params">()</span> <span class="keyword">throws</span> Throwable </span>&#123;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Then</span>(<span class="string">"I should get the lowest price (\\S+) and frequent points (\\d+)$"</span>)</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">I_should_get_the_lowest_price</span><span class="params">(<span class="keyword">double</span> totalAmout,</span></span></div><div class="line">            <span class="keyword">int</span> frequentRenterPoints) <span class="keyword">throws</span> Throwable &#123;</div><div class="line"></div><div class="line">        assertEquals(<span class="string">"failure - not the same with expected amout"</span>,</div><div class="line">                totalAmout, customer.amountTotalConsume(),<span class="number">5</span>);</div><div class="line">        assertEquals(<span class="string">"failure - not the same with expected point"</span>,</div><div class="line">                frequentRenterPoints, customer.countFrequentRenterPoints());</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>#Round.3 大胆的进行重构<br>现在已经有了单元测试的保证了，可以大胆进行重构了，按前篇博文中说到的进行。</p>
<p>##用简洁易懂的句法，控制一个函数类代码的数量，让一个函数只做一件事情<br>这个round2已经做了，不在让一个打印输出的方法，又同时做计算价格、统计积分等事情。</p>
<p>##修改变量名<br>这个较多地方都有问题，比如round1中的成员变量命名不是java的规范，全部重新写过。还比如遍历中用each作为变量名，很难表达变量的意思。</p>
<p>##相同的逻辑出现3次，抽方法<br>这里功能比较简单，会重复出现的方法已经抽出来了，所以这里用不到该方法。</p>
<p>##一个类中的一个方法出现与另一个类进行更多的交流时，考虑搬移函数到该类中，然后该方法中直接调用该类的新方法<br>这里对于每个Rental的计算积分和计算价格方法，都更应该移动到Rental中，因为看代码可以看到，他调用了很多次Rental的方法。<br>重构后的代码<br><figure class="highlight java"><figcaption><span>Customer.java</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Customer</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> String name;</div><div class="line">    <span class="keyword">private</span> List&lt;Rentalrentals = <span class="keyword">new</span> ArrayList&lt;Rental&gt;();</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Customer</span><span class="params">(String name)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.name = name;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addRental</span><span class="params">(Rental arg)</span> </span>&#123;</div><div class="line">        rentals.add(arg);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.name;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">public</span> List&lt;RentalgetRentals() &#123;</div><div class="line">        <span class="keyword">return</span> rentals;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">amountTotalConsume</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">double</span> result = <span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span> (Rental aRental : getRentals()) &#123;</div><div class="line">            result += aRental.getCharge();</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> result;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">countFrequentRenterPoints</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> frequentRenterPoints = <span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span> (Rental aRental : getRentals()) &#123;</div><div class="line">            frequentRenterPoints += aRental.getFrquentRenterPoints();</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> frequentRenterPoints;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight java"><figcaption><span>Rental.java</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Rental</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> Movie movie;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> daysRented;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Rental</span><span class="params">(Movie movie, <span class="keyword">int</span> daysRented)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.movie = movie;</div><div class="line">        <span class="keyword">this</span>.daysRented = daysRented;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getDaysRented</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.daysRented;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> Movie <span class="title">getMovie</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.movie;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getFrquentRenterPoints</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> frequentRenterPoints = <span class="number">0</span>;</div><div class="line">        frequentRenterPoints++;</div><div class="line">        <span class="keyword">if</span> (getMovie().getPriceCode() == Movie.NEW_RELEASE</div><div class="line">                &amp;&amp; getDaysRented() <span class="number">1</span>) &#123;</div><div class="line">            frequentRenterPoints++;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> frequentRenterPoints;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">getCharge</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">double</span> thisAmount = <span class="number">0</span>;</div><div class="line">        <span class="keyword">switch</span> (getMovie().getPriceCode()) &#123;</div><div class="line">        <span class="comment">// 这里的数量和定价策略可以先不改变，当增加新功能需要的时候</span></div><div class="line">        <span class="keyword">case</span> Movie.REGULAR:</div><div class="line">            thisAmount += <span class="number">2</span>;</div><div class="line">            <span class="keyword">if</span> (getDaysRented() <span class="number">2</span>)</div><div class="line">                thisAmount += (getDaysRented() - <span class="number">2</span>) * <span class="number">1.5</span>;</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        <span class="keyword">case</span> Movie.NEW_RELEASE:</div><div class="line">            thisAmount += getDaysRented() * <span class="number">3</span>;</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        <span class="keyword">case</span> Movie.CHILDRENS:</div><div class="line">            thisAmount += <span class="number">1.5</span>;</div><div class="line">            <span class="keyword">if</span> (getDaysRented() <span class="number">3</span>)</div><div class="line">                thisAmount += (getDaysRented() - <span class="number">3</span>) * <span class="number">1.5</span>;</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// 日志</span></div><div class="line">        System.out.println(<span class="string">"\t"</span> + getMovie().getTitle() + <span class="string">"\t"</span></div><div class="line">                + String.valueOf(thisAmount));</div><div class="line">        <span class="keyword">return</span> thisAmount;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight java"><figcaption><span>Movie.java</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Movie</span> </span>&#123;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> CHILDRENS = <span class="number">2</span>;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> NEW_RELEASE = <span class="number">1</span>;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> REGULAR = <span class="number">0</span>;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> String title;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> priceCode;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Movie</span><span class="params">(String title, <span class="keyword">int</span> priceCode)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.title = title;</div><div class="line">        <span class="keyword">this</span>.priceCode = priceCode;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getPriceCode</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.priceCode;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPriceCode</span><span class="params">(<span class="keyword">int</span> arg)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.priceCode = arg;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getTitle</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.title;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>重构完后，运行下单元测试，没问题，那么很好，完美收工。</p>
<p>#Round.4 如果发现增加一个功能很差，那么继续重构吧<br>一般情况下，做到第3步已经够了，第四部主要是说明，当你遇到新的需求，增加这个需求需要改动过大时候，那么说明代码的设计不够可维护可扩展可复用。<br>如下重构则为当需要增加一个类型，或者更改价格、积分计算策略时候的调整。</p>
<p>##开始重构，用多态替换逻辑判断<br>首先，把getCharge与getFrquentRenterPoints方法移动到Movie中，因为我们需要用多态来代替逻辑状态判断。<br><figure class="highlight java"><figcaption><span>Rental.java</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Rental</span> </span>&#123;</div><div class="line">		<span class="comment">//...省略</span></div><div class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getFrquentRenterPoints</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> getMovie().getFrquentRenterPoints(daysRented);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">getCharge</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> getMovie().getCharge(daysRented);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight java"><figcaption><span>Movie.java</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Movie</span> </span>&#123;</div><div class="line">		<span class="comment">//...省略部分代码，然后把priceType变量替换成一个枚举类型的变量</span></div><div class="line">    <span class="keyword">private</span> MovieTypeEnum movieType;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Movie</span><span class="params">(String title, <span class="keyword">int</span> movieTypeCode)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.title = title;</div><div class="line">        movieType = MovieTypeEnum.convertByCode(String.valueOf(movieTypeCode));</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Movie</span><span class="params">(String title, String movieTypeName)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.title = title;</div><div class="line">        movieType = MovieTypeEnum.convertByName(movieTypeName);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getFrquentRenterPoints</span><span class="params">(<span class="keyword">int</span> daysRented)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> movieType.getFrquentRenterPoints(daysRented);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">getCharge</span><span class="params">(<span class="keyword">int</span> daysRented)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> movieType.getCharge(daysRented);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getPriceCode</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> Integer.valueOf(<span class="keyword">this</span>.movieType.getCode());</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPriceCode</span><span class="params">(<span class="keyword">int</span> movieTypeCode)</span> </span>&#123;</div><div class="line">        movieType = MovieTypeEnum.convertByCode(String.valueOf(movieTypeCode));</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> MovieTypeEnum <span class="title">getMovieType</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> movieType;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMovieType</span><span class="params">(MovieTypeEnum movieType)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.movieType = movieType;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getTitle</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.title;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>##创建枚举</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">enum</span> MovieTypeEnum &#123;</div><div class="line"><span class="comment">//这部分代码是我重构过程中犯下的低级错误，但是只要有单元测试，就能保证错误一旦出现，很快就能发现</span></div><div class="line"><span class="comment">//    CHILDRENS("2","CHILDRENS",new ChildrensPriceHandler(),new DefaultPointHandler()),</span></div><div class="line"><span class="comment">//    NEW_RELEASE("1","NEW_RELEASE",new ChildrensPriceHandler(),new DefaultPointHandler()),</span></div><div class="line"><span class="comment">//    REGULAR("0","REGULAR",new ChildrensPriceHandler(),new DefaultPointHandler());</span></div><div class="line">    </div><div class="line">    CHILDRENS(<span class="string">"2"</span>,<span class="string">"CHILDRENS"</span>,<span class="keyword">new</span> ChildrensPriceHandler(),<span class="keyword">new</span> DefaultPointHandler()),</div><div class="line">    NEW_RELEASE(<span class="string">"1"</span>,<span class="string">"NEW_RELEASE"</span>,<span class="keyword">new</span> NewReleasePriceHandler(),<span class="keyword">new</span> NewReleasePointHandler()),</div><div class="line">    REGULAR(<span class="string">"0"</span>,<span class="string">"REGULAR"</span>,<span class="keyword">new</span> RegularPriceHandler(),<span class="keyword">new</span> DefaultPointHandler());</div><div class="line">    <span class="keyword">public</span> <span class="keyword">final</span> String code;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">final</span> String name;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">final</span> IPriceHandler priceHandler;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">final</span> IPointHandler pointHandler;    </div><div class="line">    MovieTypeEnum(String code,String name,IPriceHandler priceHandler , IPointHandler pointHandler)&#123;</div><div class="line">        <span class="keyword">this</span>.code = code;</div><div class="line">        <span class="keyword">this</span>.name = name;</div><div class="line">        <span class="keyword">this</span>.priceHandler = priceHandler;</div><div class="line">        <span class="keyword">this</span>.pointHandler = pointHandler;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getCode</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> code;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> name;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> IPriceHandler <span class="title">getPriceHandler</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> priceHandler;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> IPointHandler <span class="title">getPointHandler</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> pointHandler;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getFrquentRenterPoints</span><span class="params">(<span class="keyword">int</span> daysRented)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> pointHandler.getFrquentRenterPoints(daysRented);</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">getCharge</span><span class="params">(<span class="keyword">int</span> daysRented)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> priceHandler.getCharge(daysRented);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> MovieTypeEnum <span class="title">convertByCode</span><span class="params">(String code)</span></span>&#123;</div><div class="line">        <span class="keyword">if</span>(MovieTypeEnum.CHILDRENS.getCode().equals(code))&#123;</div><div class="line">            <span class="keyword">return</span> MovieTypeEnum.CHILDRENS;</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(MovieTypeEnum.NEW_RELEASE.getCode().equals(code))&#123;</div><div class="line">            <span class="keyword">return</span> MovieTypeEnum.NEW_RELEASE;</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(MovieTypeEnum.REGULAR.getCode().equals(code))&#123;</div><div class="line">            <span class="keyword">return</span> MovieTypeEnum.REGULAR;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> MovieTypeEnum <span class="title">convertByName</span><span class="params">(String name)</span></span>&#123;</div><div class="line">        <span class="keyword">if</span>(MovieTypeEnum.CHILDRENS.getName().equals(name))&#123;</div><div class="line">            <span class="keyword">return</span> MovieTypeEnum.CHILDRENS;</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(MovieTypeEnum.NEW_RELEASE.getName().equals(name))&#123;</div><div class="line">            <span class="keyword">return</span> MovieTypeEnum.NEW_RELEASE;</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(MovieTypeEnum.REGULAR.getName().equals(name))&#123;</div><div class="line">            <span class="keyword">return</span> MovieTypeEnum.REGULAR;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>##处理器<br>这里分别实现了价格处理器和积分处理器，接口如下：<br><figure class="highlight java"><figcaption><span>IPointHandler.java</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IPointHandler</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getFrquentRenterPoints</span><span class="params">(<span class="keyword">int</span> daysRented)</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight java"><figcaption><span>IPriceHandler.java</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IPriceHandler</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">getCharge</span><span class="params">(<span class="keyword">int</span> daysRented)</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>具体处理器的实现这里就举一个例子，顺便看看同个处理逻辑两段代码的实现有多大差别。下面两段代码功能一样，代码前者多了那么多代码和临时变量。可以看出，写的优美的代码，不但易懂，而且优美。</p>
<figure class="highlight java"><figcaption><span>旧NewReleasePointHandler.java</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NewReleasePointHandler</span> <span class="keyword">extends</span> <span class="title">DefaultPointHandler</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getFrquentRenterPoints</span><span class="params">(<span class="keyword">int</span> daysRented)</span> </span>&#123;</div><div class="line">				<span class="keyword">int</span> frequentRenterPoints = <span class="number">1</span>;</div><div class="line">        <span class="keyword">if</span> (daysRented <span class="number">1</span>) &#123;</div><div class="line">            frequentRenterPoints++;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> frequentRenterPoints;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight java"><figcaption><span>新NewReleasePointHandler.java</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NewReleasePointHandler</span> <span class="keyword">extends</span> <span class="title">DefaultPointHandler</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getFrquentRenterPoints</span><span class="params">(<span class="keyword">int</span> daysRented)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> (daysRented <span class="number">1</span>) ? <span class="number">2</span> : <span class="number">1</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>运行单元而是，没问题，很好，又可以收工了（当然中间有出现错误，还有很多的调试）。</p>
<p>#Round.5 to be continue<br>重构不是一种状态，他是不断根据环境、需求、设计的变化去变化的。俗话说，只有变化是不变的，因此，重构一定会陪伴着整个软件过程，有了重构，也不用再怕这些变化了。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2014/08/26/2014-08-26-reconstruction-of-chatter/" itemprop="url">
                  闲扯重构
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2014-08-26T09:26:00+08:00" content="2014-08-26">
              2014-08-26
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/设计/" itemprop="url" rel="index">
                    <span itemprop="name">设计</span>
                  </a>
                </span>

                
                
                  , 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/设计/重构/" itemprop="url" rel="index">
                    <span itemprop="name">重构</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>#为何要重构<br>最近，我经常思考一个问题，这个问题源自我一个做会计的朋友给我说“程序员有什么了不起的，写程序这种事情他们也会，他们经常也写一些程序、脚本来帮助他们工作。”<br>乔布斯就说过，每个人都应该学编程，他不仅能改变你的思维方式，还能帮助你的生活和工作。比如，我也帮女朋友写一些爬虫程序，帮他在互联网上抓一些数据。<br>这个问题思考后我觉得是这样的，程序员不仅仅是用编程语言来实现一个工具，而且这个工具是可维护、可移植、可复用、可维护、可扩展、可读的，就如最近公司的架构师交流会上讲师所说，编程就应该是一门艺术，你可以在别人的作品（代码、算法、设计）上微创新，做一些精进，还可以自己完成一幅大作。<br>因此，要让代码可维护、可移植、可复用、可维护、可扩展、可读的光是最好设计是不够的，还要不断的重构。</p>
<p>#代码的演进<br>（演进的方向一直是让代码可读、可维护、灵活等）</p>
<p>#从自身谈重构<br>重构并不是按照一个重构清单，一点一点的照做，而是一种感觉，比如，你感觉这段代码写了超过3次了，那你必须抽个方法出来；比如，你觉得在现有代码上增加一个功能不是那么容易了，那么，你也应该重新设计，让代码又可扩展性；比如，你在单元测试时候，觉得输入和输出不好写断言了，那么，你的代码相互直接的逻辑依赖就太深了，要做重构，最好让代码在语义上是可读的、函数式的（相同输入可以得到相同的输出，函数内部不改变全局环境）。</p>
<p>重构也不是一件一开始就要做的事情。初学编程时，总是浑浑噩噩的写代码，由于大学并不是很认真学习加上专业方向上是嵌入式，接触的大多数也是过程式的编程，写代码总是写写一些想一些。大四上的最后几个月才真正开始学Java，也慢慢会预先设计，这确实让我在开始时候节省返工的高昂成本，然后在大四下的实习时，我加强了这种预先设计的风格，而且滥用设计模式，很简单的一个模块一定要套上好几个设计模式。业内也有许多人把设计看做软件开发的关键环节，而编程只是搬砖，只是苦力活。<br>但是，慢慢的我又发现，有了设计我可以思考的很快，但是其中也充满了漏洞，在开发过程中和测试过程中还是要做很多设计上的返工，这意味着，在开始时候我要花更多的时间和经理在预先设计上，以避免日后的修改。我们总是在力求找到准确无误的解决方案，任何一个需求都让我们提心吊胆得猜疑。<br>这时候由于开始工作的公司是用敏捷开发的，我开始接触了很多敏捷思想，参加各种敏捷大会和沙龙，重构这想法也就在我耳边经常出现了。特别是XP的支持者们认为，可以完全由重构代替预先设计。<br>但是我觉得这太绝对了。如果你选择重构，你仍然要做预先设计，单不一定必须找到正确的解决方案，刺客你只需要得到一个足够合理的解决方案就够了。你肯定地知道，在实现这个初始解决方案的时候，你对问题的理解也会逐渐加深（项目管理课程中也提到，随着项目的实施，对项目的理解也会逐渐加深），你就会察觉到最佳解决方案和你当初想的有些不同，只要有重构在手，那这些也就不成问题，重构让日后的修改成本不再高昂。<br>这也是软件设计向简化前进了一大步。有一次敏捷大会上，一位讲师提到了极简（也就是乔布斯一直追求的，多一分太多，少一分太少），我觉得，通过重构也能让软件的设计达到极简的状态。<br>从此，我认为重构可以带来更简单的设计，同时又不损失灵活性，这也降低了设计过程的难度，减轻了设计压力。</p>
<p>但是，重构不是万能的银弹，如上面所说，只有当你嗅到了代码中的坏味道时候才会进行重构，这种坏味道，也就是上面说的一种感觉，只有轻松经历这种重构带来的美妙后，你就可以在感觉到这种不好的味道时候立马察觉。</p>
<p>#重构要注意什么，如何重构<br>个人觉得重构还有几个注意点：</p>
<ul>
<li>如果代码在绝大部分情况下都无法正常运行了，那就别重构了，重写吧；</li>
<li>在项目结尾阶段不要进行重构，特别是在单元测试不足的情况下；</li>
<li>对于重构后接口的调整，一般是保留原接口的基础上开放新接口，然后在原先接口上注释上不推荐时候。还有就是尽可能的推迟接口的发布，因为一旦发布，你就要考虑兼容旧的接口；</li>
<li>对于数据库，只能说架构设计阶段，就应该设计数据库持久化层和service层，让数据库和业务逻辑松耦合，然后通过mock的方式就做单元测试，保证相关代码重构后依然正常，也让数据库相关代码不在是侵入式的。</li>
</ul>
<p>对于初级的重构，个人认为注意以下几个点就好了：</p>
<ul>
<li>修改变量名，更改变量名称是值得的行为吗？绝对值得，好的代码应该清楚表达出自己的功能，变量名是代码清晰地关键。任何一个傻瓜都能写出计算机可以理解的代码，惟有写出人类容易理解的代码才是优秀的程序员 </li>
<li>用简洁易懂的句法，控制一个函数类代码的数量，让一个函数只做一件事情</li>
<li>相同逻辑代码出现3次，抽方法</li>
<li>一个类中的一个方法出现与另一个类进行更多的交流时，考虑搬移函数到该类中，然后该方法中直接调用该类的新方法</li>
<li>用多态代替过多的条件判断</li>
<li>将固定的逻辑封装在父类中，把不确定的逻辑用钩子方法（回调函数）描述，通过子类（调用者）实现</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2014/07/30/2014-07-30-some-javascript-features/" itemprop="url">
                  Javascript的一些特性
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2014-07-30T01:57:00+08:00" content="2014-07-30">
              2014-07-30
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/javascript/" itemprop="url" rel="index">
                    <span itemprop="name">javascript</span>
                  </a>
                </span>

                
                
                  , 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/javascript/javascript/" itemprop="url" rel="index">
                    <span itemprop="name">javascript</span>
                  </a>
                </span>

                
                
                  , 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/javascript/javascript/prototype/" itemprop="url" rel="index">
                    <span itemprop="name">prototype</span>
                  </a>
                </span>

                
                
                  , 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/javascript/javascript/prototype/读书笔记/" itemprop="url" rel="index">
                    <span itemprop="name">读书笔记</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><strong>参考资料《node.js开发指南》，作者:Byoid</strong></p>
<h2 id="Javascript的一些特性"><a href="#Javascript的一些特性" class="headerlink" title="Javascript的一些特性"></a>Javascript的一些特性</h2><p>#1 作用域<br>如果习惯Java、C的编程语言，很容易对Javascript的作用域无法理解，比如下面代码，就会输出Hello David，因为JavaScript 的作用域完全是由函数来决定的，if、for 语句中的花括号不是独立的作用域。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> (<span class="literal">true</span>) &#123;</div><div class="line"><span class="keyword">var</span> name = <span class="string">'David'</span></div><div class="line">&#125;</div><div class="line"><span class="built_in">console</span>.log(<span class="string">'Hello '</span>+name) <span class="comment">// 输出 Hello David</span></div></pre></td></tr></table></figure></p>
<p>##1.1 函数作用域<br>Javascript的函数作用域，又是局部作用域。其他变成语言基本是通过花刮号或者缩进代码块来划定作用域，而Javascript的作用域通过函数来定义。当在一个函数中用到了某个变量的引用，那么会现在当前函数作用域中找，然后再去全局作用域中找。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">var name = &apos;David&apos;;</div><div class="line">var f1 = function() &#123;</div><div class="line">	console.log(name); // 输出 David</div><div class="line">&#125;;</div><div class="line">f1();</div><div class="line">var f2 = function() &#123;</div><div class="line">	var name = &apos;TangY&apos;;</div><div class="line">	console.log(name); // 输出 Tangy</div><div class="line">&#125;;</div><div class="line">f2();</div></pre></td></tr></table></figure></p>
<p>###1.1.1 嵌套函数作用域<br>函数作用域可是可以嵌套的，和Java的局部作用域不一样，Java中不允许局部与父局部作用域有相同的变量(可以同对象作用域重复，对象作用域用this.var来调用)。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">(<span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>)</span>&#123;</div><div class="line">	<span class="keyword">var</span> name = <span class="string">"David"</span></div><div class="line">	<span class="built_in">console</span>.log(<span class="string">"Function 1:"</span>+name);<span class="comment">//Function 1:David</span></div><div class="line">	(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">		<span class="keyword">var</span> name = <span class="string">"TangY"</span></div><div class="line">		<span class="built_in">console</span>.log(<span class="string">"Function 2:"</span>+name);<span class="comment">//Function 2:TangY</span></div><div class="line">	&#125;)();</div><div class="line">&#125;)();</div></pre></td></tr></table></figure></p>
<p>###1.1.2 作用域的搜索方式</p>
<p>####1.1.2.1 屏蔽作用域<br>函数的作用域会先从最近的函数作用域开始，搜索的具体逻辑可以参考如下代码。执行到变量引用的地方，变量还未定义，那变量是取局部，还是取上一次函数的作用域中的变量呢？执行代码后可发现，输出undefined，这是因为，JavaScript 会先搜索里层函数的作用域，恰巧在里层的作用域里面搜索到 scope 变量，所以上层作用域中定义的 scope 就被屏蔽了，但执行到 console.log 语句时，scope 还没被定义，或者说初始化，所以得到的就是 undefined 值了。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">(<span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>)</span>&#123;</div><div class="line">	<span class="keyword">var</span> name = <span class="string">"David"</span></div><div class="line">	<span class="built_in">console</span>.log(<span class="string">"Function 1:"</span>+name);<span class="comment">//Function 1:David</span></div><div class="line">	(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">		<span class="built_in">console</span>.log(<span class="string">"Function 3:"</span>+name);<span class="comment">//Function 3:undefined</span></div><div class="line">		<span class="keyword">var</span> name = <span class="string">"Haha"</span></div><div class="line">	&#125;)();</div><div class="line">&#125;)();</div></pre></td></tr></table></figure></p>
<p>####1.1.2.2 定义生效还是调用生效？<br>如下代码，为什么最后那个也是打印globalScope呢？因为函数的作用域是取定义时候的，而不是调用时候的。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> scope = <span class="string">'globalScope'</span>;</div><div class="line"><span class="keyword">var</span> f1 = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">	<span class="built_in">console</span>.log(scope);</div><div class="line">&#125;;</div><div class="line">f1(); <span class="comment">// 输出 'globalScope'</span></div><div class="line"><span class="keyword">var</span> f2 = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">	<span class="keyword">var</span> scope = <span class="string">'f2Scope'</span>;</div><div class="line">	f1();</div><div class="line">&#125;;</div><div class="line">f2(); <span class="comment">// 输出 'globalScope'</span></div></pre></td></tr></table></figure></p>
<p>##1.2 全局作用域<br>在 JavaScript 中有一种特殊的对象称为 全局对象。这个对象在Node.js 对应的是 global对象，在浏览器中对应的是 window 对象。<br>满足以下条件的变量属于全局作用域：</p>
<ul>
<li>在最外层定义的变量；</li>
<li>全局对象的属性；</li>
<li>任何地方隐式定义的变量（未定义直接赋值的变量，就是没通过var定义，尽可能避免这种情况）。</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>)</span>&#123;</div><div class="line">	name = <span class="string">'David'</span></div><div class="line">&#125;</div><div class="line">test()<span class="comment">//这里如果不执行，就会保存因为隐式定义的代码未运行</span></div><div class="line"><span class="built_in">console</span>.log(name);<span class="comment">//David</span></div></pre></td></tr></table></figure>
<p>#2 闭包<br>对未接触过函数编程的人，闭包一直都是一个很神秘的东西，但是接触以后你会发现，其实闭包也很容易，但是也会发现，闭包是如此的神奇好用。<br>闭包的严格定义是“由函数（环境）及其封闭的自由变量组成的集合体。”这个定义对于大家来说有些晦涩难懂，所以让我们先通过例子和不那么严格的解释来说明什么是闭包。</p>
<p>##2.1 What<br>在javascript中，每个其实都是一个闭包，只是嵌套的函数比较容易体现闭包的特性。按照前面讲解的作用域，函数中的变量引用，应该取的是其定义时候作用域的值，那么， Counter返回的函数在外部调用的时候，count变量应该已经失效了，按Java的理解来说，这里应该会报错（就算Java中用匿名内部类，也需要定义成final）。这里非但没有出错，反而每次调用 counter() 时还修改并返回了 count。这是怎么回事呢？<br>这正是所谓闭包的特性。当一个函数返回它内部定义的一个函数时，就产生了一个闭包，闭包不但包括被返回的函数，还包括这个函数的定义环境。上面例子中，当函数Counter () 的内部函数被一个外部变量 counter 引用时，counter 和Counter () 的局部变量就是一个闭包。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">Counter</span>(<span class="params"></span>)</span>&#123;</div><div class="line">	<span class="keyword">var</span> count = <span class="number">1</span>;</div><div class="line">	<span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">		<span class="keyword">return</span> count++;</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"><span class="keyword">var</span> counter = Counter();</div><div class="line"><span class="built_in">console</span>.log(counter());<span class="comment">//1</span></div><div class="line"><span class="built_in">console</span>.log(counter());<span class="comment">//2</span></div><div class="line"><span class="built_in">console</span>.log(counter());<span class="comment">//3</span></div><div class="line"><span class="built_in">console</span>.log(counter());<span class="comment">//4</span></div><div class="line"><span class="built_in">console</span>.log(counter());<span class="comment">//5</span></div></pre></td></tr></table></figure></p>
<p>##2.2 Usage</p>
<p>###2.2.1 回调函数嵌套<br>这里举前端使用jQuery开发最常用的方法举例。这里定义的时候，不会立即执行，只是传入了一个回调函数（闭包），当点击事件发生的时候，才会去调用该回调函数。因为前端嵌套的层度不够，在node.js的mongoDb中，会嵌套N层的回调。<br>这样做还有一个好处就是隐藏内部逻辑，使用方根部不需要知道onclick这个事件怎么去监听。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$(<span class="string">'#div_id'</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line"><span class="comment">//点击操作</span></div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>###2.2.2 访问器<br>闭包还可以作为一个访问器，比如前面的Counter的例子，只有调用 counter() 才能访问到闭包内的 count 变量，并按照规则对其增加1，除此之外决无可能用其他方式找到 count 变量。<br>在javascript中是没有私有变量这概念的，不像java中有private，在javascript中只有个约定“_”开始的为私有变量，比如_name，这样很容易被修改了属性，比较不安全。</p>
<p>#3 对象<br>Java里的对象全是基于类的，而javascript不同，他都是基于原型的。如下代码可以简单的创建一个对象。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">var man = &#123;&#125;</div><div class="line">man.name = &quot;David&quot;</div><div class="line">man.test = function()&#123;</div><div class="line">	console.log(this.name);//David</div><div class="line">&#125;</div><div class="line"></div><div class="line">man.test.testFun = function()&#123;</div><div class="line">	console.log(this.name);//无输出</div><div class="line">&#125;</div><div class="line">man.test();</div><div class="line">man.test.testFun();</div></pre></td></tr></table></figure></p>
<p>##3.1 构造函数<br>以上代码构造对象都是一次性的，如何像Java那样用固定的构造方法和参数去构造呢？以下代码为创建复杂对象的实例。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">function User(name, age) &#123;</div><div class="line">	this.name = name;</div><div class="line">	this.age = age;</div><div class="line">	this.sayHi = function() &#123;</div><div class="line">		console.log(&quot;Hello World,My Name is &quot;+this.name+&quot;,I&apos;m &quot;+age+&quot; years old!&quot;)</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line">var somebody = new User(&apos;david&apos;,&apos;25&apos;)</div><div class="line">somebody.sayHi()//Hello World,My Name is david,I&apos;m 25 years old!</div></pre></td></tr></table></figure></p>
<p>##3.2 上下文对象<br>这个和Java中类似，this就是在对象内部调用他本身的指针。<br>把上面的例子改造了下，因为User中定义的sayHi方法的name是调用对象内部的上下文，而age则是调用原型内部的局部变量。因此，在somebody中的this指针指向的是somebody对象，而tangy对象中指向的是tangy对象。而age则是闭包原理，变量的引用的作用域为定义时候的作用域，因为构造的时候才真正定义，所以age就是new User()时候的变量了。<br>最后一个函数，由于函数是全局的，所以this指向的是全局变量。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">User</span>(<span class="params">name, age</span>) </span>&#123;</div><div class="line">	<span class="keyword">this</span>.name = name;</div><div class="line">	<span class="keyword">this</span>.age = age;</div><div class="line">	<span class="keyword">this</span>.sayHi = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">		<span class="built_in">console</span>.log(<span class="string">"Hello World,My Name is "</span>+<span class="keyword">this</span>.name+<span class="string">",I'm "</span>+age+<span class="string">" years old!"</span>)</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"><span class="keyword">var</span> somebody = <span class="keyword">new</span> User(<span class="string">'david'</span>,<span class="string">'25'</span>)</div><div class="line">somebody.sayHi()<span class="comment">//Hello World,My Name is david,I'm 25 years old!</span></div><div class="line"><span class="keyword">var</span> tangy = &#123;</div><div class="line">	sayHi:somebody.sayHi,</div><div class="line">	name:<span class="string">'tangy'</span>,</div><div class="line">	age:<span class="number">23</span></div><div class="line">&#125;</div><div class="line">tangy.sayHi()<span class="comment">//Hello World,My Name is tangy,I'm 25 years old!</span></div><div class="line"></div><div class="line">name = <span class="string">"global"</span></div><div class="line">sayHi = tangy.sayHi<span class="comment">//Hello World,My Name is global,I'm 25 years old!</span></div><div class="line">sayHi()</div></pre></td></tr></table></figure></p>
<p>##3.3 call与apply<br>这两个函数挺神奇的，其作用有点像Java中的反射（其实是Java通过反射来模仿call与apply的操作），call 和 apply 的功能是一致的，两者细微的差别在于 call 以参数表来接受被调用函数的参数，而 apply 以数组来接受被调用函数的参数。call 和 apply 的语法分别是：<br>func.call(thisArg[, arg1[, arg2[, …]]])<br>func.apply(thisArg[, argsArray])<br>用Java来帮助理解的话，第一个参数就是Java的Method对象的invoke方法的第一个参数，也就是代理对象。<br>如果不用Java描述，那理解就是func 是函数的引用（javascript中函数是第一等公民），thisArg 是 func 被调用时的上下文对象，arg1、arg2 或argsArray 是传入 func 的参数，看一下例子，可以看出这两个函数的作用。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">User</span>(<span class="params">name</span>) </span>&#123;</div><div class="line">	<span class="keyword">this</span>.name = name;</div><div class="line">	<span class="keyword">this</span>.sayHi = <span class="function"><span class="keyword">function</span>(<span class="params">age,favorite</span>) </span>&#123;</div><div class="line">		<span class="built_in">console</span>.log(<span class="string">"Hello World,My Name is "</span>+<span class="keyword">this</span>.name+<span class="string">",I'm "</span>+age+<span class="string">" years old! I like "</span>+favorite+<span class="string">"!"</span>)</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line">name = <span class="string">'global'</span></div><div class="line"><span class="keyword">var</span> david = <span class="keyword">new</span> User(<span class="string">'David'</span>)</div><div class="line">david.sayHi(<span class="number">25</span>,<span class="string">'basketball and football'</span>)</div><div class="line"><span class="comment">//Hello World,My Name is David,I'm 25 years old! I like basketball and football!</span></div><div class="line"><span class="keyword">var</span> tangy = &#123;</div><div class="line">	name:<span class="string">'tangy'</span></div><div class="line">&#125;</div><div class="line">david.sayHi.call(tangy,<span class="number">23</span>,<span class="string">'shopping and movie'</span>)<span class="comment">//Hello World,My Name is tangy,I'm 23 years old! I like shopping and movie!</span></div><div class="line"><span class="keyword">var</span> lily = &#123;</div><div class="line">	name:<span class="string">'lily'</span></div><div class="line">&#125;</div><div class="line">david.sayHi.apply(lily,[<span class="number">46</span>,<span class="string">'travel'</span>])<span class="comment">//Hello World,My Name is lily,I'm 46 years old! I like travel!</span></div></pre></td></tr></table></figure></p>
<p>##3.4 bind函数<br>但是，如果重复使用，每次都要传递对象作为函数的上下文，那么多不方便。这时候就可以使用bind函数。语法为：<br>func.bind(thisArg[, arg1[, arg2[, …]]])<br>参数与call一致。实例代码如下，最后一个输出，出现了重复绑定，这时候，bind已经无效了。如果要解释，就是第一次bind的时候，对象内部还是有this这个指针的，第二次bind，那么这个函数已经类似function(){func.call(david,25)},这时候已经不存在this，所以bind是无效的。这里可能有点难理解，无法理解的话就记住，bind不能重新绑定。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">function User(name) &#123;</div><div class="line">	this.name = name;</div><div class="line">	this.sayHi = function(age,favorite) &#123;</div><div class="line">		console.log(&quot;Hello World,My Name is &quot;+this.name+&quot;,I&apos;m &quot;+age+&quot; years old! I like &quot;+favorite+&quot;!&quot;)</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line">var david = new User(&apos;David&apos;)</div><div class="line">name = &apos;global&apos;</div><div class="line">david.sayHi(25,&apos;basketball and football&apos;)</div><div class="line">//Hello World,My Name is David,I&apos;m 25 years old! I like basketball and football!</div><div class="line">var tangy = &#123;</div><div class="line">	name:&apos;tangy&apos;</div><div class="line">&#125;</div><div class="line">tangy.sayHi = david.sayHi</div><div class="line">tangy.sayHi(23,&apos;shopping and movie&apos;)//Hello World,My Name is tangy,I&apos;m 23 years old! I like shopping and movie!</div><div class="line">tangy.sayHi2 = david.sayHi.bind(david,25,&apos;make a joke&apos;)</div><div class="line">tangy.sayHi2()//Hello World,My Name is David,I&apos;m 25 years old! I like make a joke!</div><div class="line">tangy.sayHi3 = david.sayHi.bind(david,25)</div><div class="line">tangy.sayHi3(&apos;reading&apos;)//Hello World,My Name is David,I&apos;m 25 years old! I like reading!</div><div class="line">var lily = &#123;</div><div class="line">	name:&apos;lily&apos;</div><div class="line">&#125;</div><div class="line">lily.sayHi = tangy.sayHi3.bind(lily)</div><div class="line">lily.sayHi(46,&apos;travel&apos;)//Hello World,My Name is David,I&apos;m 25 years old! I like 46!</div></pre></td></tr></table></figure></p>
<p>##3.5 原型<br>这是javascript面向对象的核心，javascript的对象都是基于原型的。这就相当于一件艺术品，一件蒙娜丽莎的微笑，javascript就是匠心独运的画匠，他100%的复制了蒙娜丽莎，并且可以通过自己的创意和灵感，赋予她新的东西。下面是一个简单的例子：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params"></span>) </span>&#123;</div><div class="line">	<span class="keyword">this</span>.func = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">		<span class="built_in">console</span>.log(<span class="number">1</span>);</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line">Person.prototype.name = <span class="string">'David'</span>;</div><div class="line">Person.prototype.showName = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">	<span class="built_in">console</span>.log(<span class="string">'My name is '</span>+<span class="keyword">this</span>.name)</div><div class="line">&#125;</div><div class="line"><span class="keyword">var</span> person = <span class="keyword">new</span> Person()</div><div class="line">person.showName()<span class="comment">//My name is David</span></div><div class="line">person.name = <span class="string">'tangy'</span></div><div class="line">person.showName()</div><div class="line"><span class="keyword">var</span> person2 = <span class="keyword">new</span> Person()</div><div class="line"><span class="built_in">console</span>.log(person.func == person2.func);<span class="comment">//false</span></div><div class="line"><span class="built_in">console</span>.log(person.showName == person2.showName);<span class="comment">//true</span></div></pre></td></tr></table></figure></p>
<p>上面这段代码使用了原型而不是构造函数初始化对象。这样做与直接在构造函数内定义属性有什么不同呢？可以从最后看出，原型中的函数是同一个应用，而构造函数每次都会重复创建，由于闭包的局部变量上下文，所以有额外开销，因此可以得出下面结论：</p>
<ul>
<li>构造函数内定义的属性继承方式与原型不同，子对象需要显式调用父对象才能继承构造函数内定义的属性；</li>
<li>构造函数内定义的任何属性，包括函数在内都会被重复创建，同一个构造函数产生的两个对象不共享实例；</li>
<li>构造函数内定义的函数有运行时闭包的开销，因为构造函数内的局部变量对其中定义的函数来说也是可见的。</li>
</ul>
<p>尽管如此，并不是说在构造函数内创建属性不好，而是两者各有适合的范围。那么我们什么时候使用原型，什么时候使用构造函数内定义来创建属性呢？</p>
<ul>
<li>除非必须用构造函数闭包，否则尽量用原型定义成员函数，因为这样可以减少开销；</li>
<li>尽量在构造函数内定义一般成员，尤其是对象或数组，因为用原型定义的成员是多个实例共享的。</li>
</ul>
<p>##3.6 原型链<br>Object 与 Function是两个特殊对象，它们都是构造函数，用于生成对象，参加如下代码。Object.prototype 是所有对象的祖先，Function.prototype 是所有函数的原型，包括构造函数。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">Function</span>.prototype.testfunc = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">	<span class="built_in">console</span>.log(<span class="string">'this is a test func!'</span>);</div><div class="line">&#125;</div><div class="line"><span class="keyword">var</span> o = <span class="keyword">new</span> <span class="built_in">Object</span>();</div><div class="line"><span class="keyword">var</span> f = <span class="keyword">new</span> <span class="built_in">Function</span>();</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">func</span>(<span class="params"></span>)</span>&#123;</div><div class="line"></div><div class="line">&#125;</div><div class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> o)</div><div class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> f)</div><div class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> func)</div><div class="line"><span class="built_in">console</span>.log(f.testFunc == func.testFunc)</div></pre></td></tr></table></figure></p>
<p>###3.6.1 对象分类<br>javascript中的对象有三类，一类是用户创建的对象，一类是构造函数对象，一类是原型对象。用户创建的对象，即一般意义上用 new 语句显式构造的对象。构造函数对象指的是普通的构造函数（第一类是该函数构造的对象，这里就是这构造函数），即通过 new 调用生成普通对象的函数。原型对象特指构造函数 prototype 属性指向的对象。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">constructor</span>(<span class="params"></span>)</span>&#123;</div><div class="line"></div><div class="line">&#125;</div><div class="line"><span class="keyword">var</span> object = <span class="keyword">new</span> <span class="keyword">constructor</span>()</div><div class="line">console.log(typeof <span class="keyword">constructor</span>);//function</div><div class="line">console.log(typeof object);//object</div><div class="line">console.log(<span class="keyword">constructor</span>.prototype);//&#123;&#125;</div><div class="line"><span class="built_in">console</span>.log(object.prototype);<span class="comment">//undefined</span></div><div class="line"><span class="built_in">console</span>.log(object.__proto__);<span class="comment">//&#123;&#125;</span></div><div class="line"><span class="built_in">console</span>.log(object.__proto__ === <span class="keyword">constructor</span>.prototype);//true</div></pre></td></tr></table></figure></p>
<p>###3.6.2 <strong>proto</strong>属性<br>上面的例子也稍微提到了<strong>proto</strong>属性，可以看出，他指向该对象的原型，从任何对象沿着它开始遍历都可以追溯到 Object.prototype。<br>构造函数对象有 prototype 属性，指向一个原型对象，通过该构造函数创建对象时，被创建对象的 <strong>proto</strong> 属性将会指向构造函数的 prototype 属性。原型对象有 constructor属性，指向它对应的构造函数。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">function Constructor()&#123;</div><div class="line"></div><div class="line">&#125;</div><div class="line">Object.prototype.name = &quot;ObjectPrototypeAttr&quot;</div><div class="line">Constructor.prototype.name = &quot;ConstructorPrototypeAttr&quot;</div><div class="line">var constructor = new Constructor()</div><div class="line">var object = new Object()</div><div class="line">console.log(constructor.name);//ConstructorPrototypeAttr</div><div class="line">console.log(object.name);//ObjectPrototypeAttr</div><div class="line">console.log(constructor.__proto__.name);//ConstructorPrototypeAttr</div><div class="line">console.log(constructor.__proto__.__proto__.name);//ObjectPrototypeAttr</div><div class="line">console.log(constructor.__proto__.constructor.prototype.name);//ConstructorPrototypeAttr</div></pre></td></tr></table></figure></p>
<p>##3.7 对象复制</p>
<p>###3.7.1 浅复制<br>浅复制只是重新创建了一个指针（同类型变量的引用），实际上引用还是相同的对象。浅复制实现如下代码。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">Object</span>.prototype.clone = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line"><span class="keyword">var</span> newObj = &#123;&#125;;</div><div class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i <span class="keyword">in</span> <span class="keyword">this</span>) &#123;</div><div class="line">newObj[i] = <span class="keyword">this</span>[i];</div><div class="line">&#125;</div><div class="line"><span class="keyword">return</span> newObj;</div><div class="line">&#125;</div><div class="line"><span class="keyword">var</span> obj = &#123;</div><div class="line">name: <span class="string">'David'</span>,</div><div class="line">likes: [<span class="string">'basketball'</span>]</div><div class="line">&#125;;</div><div class="line"><span class="keyword">var</span> newObj = obj.clone();</div><div class="line">obj.likes.push(<span class="string">'football'</span>);</div><div class="line"><span class="built_in">console</span>.log(obj.likes); <span class="comment">//[ 'basketball', 'football' ]</span></div><div class="line"><span class="built_in">console</span>.log(newObj.likes); <span class="comment">// [ 'basketball', 'football' ]</span></div></pre></td></tr></table></figure></p>
<p>###3.7.2 深复制<br>深复制比较复杂，因为每个对象的内部逻辑都不一样，需要循环递归，而且对于函数和数组需要做特殊处理。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line">Object.prototype.clone = function() &#123;</div><div class="line">	var newObj = &#123;&#125;;</div><div class="line">	for (var i in this) &#123;</div><div class="line">		if (typeof(this[i]) == &apos;object&apos; || typeof(this[i]) == &apos;function&apos;) &#123;</div><div class="line">			newObj[i] = this[i].clone();</div><div class="line">		&#125; else &#123;</div><div class="line">			newObj[i] = this[i];</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	return newObj;</div><div class="line">&#125;;</div><div class="line">Array.prototype.clone = function() &#123;</div><div class="line">	var newArray = [];</div><div class="line">	for (var i = 0; i &lt; this.length; i++) &#123;</div><div class="line">		if (typeof(this[i]) == &apos;object&apos; || typeof(this[i]) == &apos;function&apos;) &#123;</div><div class="line">			newArray[i] = this[i].clone();</div><div class="line">		&#125; else &#123;</div><div class="line">			newArray[i] = this[i];</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	return newArray;</div><div class="line">&#125;;</div><div class="line">Function.prototype.clone = function() &#123;</div><div class="line">	var that = this;</div><div class="line">	var newFunc = function() &#123;</div><div class="line">		return that.apply(this, arguments);</div><div class="line">	&#125;;</div><div class="line">	for (var i in this) &#123;</div><div class="line">		newFunc[i] = this[i];</div><div class="line">	&#125;</div><div class="line">	return newFunc;</div><div class="line">&#125;;</div><div class="line">var obj = &#123;</div><div class="line">	name: &apos;david&apos;,</div><div class="line">	likes: [&apos;basketball&apos;],</div><div class="line">	display: function() &#123;</div><div class="line">	console.log(this.name);</div><div class="line">&#125;,</div><div class="line">&#125;;</div><div class="line">var newObj = obj.clone();</div><div class="line">newObj.likes.push(&apos;football&apos;);</div><div class="line">console.log(obj.likes); // [ &apos;basketball&apos; ]</div><div class="line">console.log(newObj.likes); // [ &apos;basketball&apos;, &apos;football&apos; ]</div><div class="line">console.log(newObj.display == obj.display); //false</div></pre></td></tr></table></figure></p>
<p>###3.7.3 深复制的问题<br>如上代码其实存在一个问题，如果存在循环引用就会报错（如下代码加到上面那个代码）。要实现真正的深复制，那么就需要分析对象的依赖关系，像Java中的Spring初始化那样。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> obj1 = &#123;</div><div class="line">ref: <span class="literal">null</span></div><div class="line">&#125;;</div><div class="line"><span class="keyword">var</span> obj2 = &#123;</div><div class="line">ref: obj1</div><div class="line">&#125;;</div><div class="line">obj1.ref = obj2;</div><div class="line">obj1.clone();<span class="comment">//RangeError: Maximum call stack size exceeded</span></div></pre></td></tr></table></figure></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/3/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><span class="space">&hellip;</span><a class="page-number" href="/page/10/">10</a><a class="extend next" rel="next" href="/page/5/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="David Woo" />
          <p class="site-author-name" itemprop="name">David Woo</p>
          <p class="site-description motion-element" itemprop="description"></p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">91</span>
              <span class="site-state-item-name">posts</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">195</span>
                <span class="site-state-item-name">categories</span>
              </a>
            </div>
          

          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">David Woo</span>
</div>

<div class="powered-by">
  Powered by <a class="theme-link" href="https://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  



  




  
  

  

  

  

</body>
</html>
