<!doctype html>



  


<html class="theme-next muse use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta property="og:type" content="website">
<meta property="og:title" content="大胃吴的闲话唠嗑">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="大胃吴的闲话唠嗑">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="大胃吴的闲话唠嗑">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: 'Author'
    }
  };
</script>




  <link rel="canonical" href="http://yoursite.com/"/>

  <title> 大胃吴的闲话唠嗑 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">大胃吴的闲话唠嗑</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">扯扯技术，唠唠闲话 交流email-xiao303178394@gmail.com</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-首页">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            menu.首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-文章">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            menu.文章
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2020/06/17/HelloOpenGLAndMetal/" itemprop="url">
                  Hello OpenGL ES
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Veröffentlicht am</span>
            <time itemprop="dateCreated" datetime="2020-06-17T06:46:47+08:00" content="2020-06-17">
              2020-06-17
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>要换工作了，美图秀秀是图像、音视频方面相关的应用，所以赶紧学习点点这方面的基础知识，就先从图像渲染开始了。</p>
</blockquote>
<p><strong>OpenGL(Open Graphics Library)</strong> 是一种应用程序编程接口，它是一种可以对图形硬件设备特性进行访问的软件库规范，它是硬件无关的。它主要为我们定义了用来操作图形和图片的一系列函数的 API，OpenGL 本身并非 API。<br><strong>OpenGL ES(OpenGL for Embedded Systems)</strong> 是 OpenGL 的子集，为手机等嵌入式设备而设计。它去除了四边形、多边形等复杂图元等一些非绝对必要特性，算是OpenGL在移动端上的精简规范。<br><strong>Metal</strong> 是一个和 OpenGL ES 类似的面向底层的图形编程接口，通过使用相关的 api 可以直接操作 GPU， 是 iOS 平台独有的，意味着它不能像 OpenGL ES 那样支持跨平台，但是它能最大的挖掘苹果移动设备的 GPU 能力，进行复杂的运算，像 Unity 等游戏引擎都通过 Metal 对 3D 能力进行了优化， App Store 还有相应的运用 Metal 技术的游戏专题。<br><strong>GLSL</strong> (OpenGL Shading Language) 是OpenGL的着色器语言，Metal也是用该语法。它C的子集，语法与C类似，有了自己独特的一些数据结构及状态控制流程。</p>
<h2 id="iOS渲染的过程"><a href="#iOS渲染的过程" class="headerlink" title="iOS渲染的过程"></a>iOS渲染的过程</h2><p><a href="https://github.com/RickeyBoy/Rickey-iOS-Notes/blob/master/%E7%AC%94%E8%AE%B0/iOS%20Rendering.md" target="_blank" rel="external">具体关于iOS GPU渲染的知识，可以看瓜神的这篇文章就够了。</a></p>
<p>不管是OpenGL 还是Metal，在图元渲染过程，顶点着色器和片段着色器是可编程的部分。</p>
<p><img src="https://lymanli-1258009115.cos.ap-guangzhou.myqcloud.com/image/blog/render-texture-image-3.jpg" alt=""></p>
<p>这里不展开说渲染，具体还是看瓜神的文章吧。</p>
<h2 id="渲染一个三角形的编写流程"><a href="#渲染一个三角形的编写流程" class="headerlink" title="渲染一个三角形的编写流程"></a>渲染一个三角形的编写流程</h2><p><a href="https://github.com/yuezaixz/DwGPUImageLearning" target="_blank" rel="external">本例DEMO代码仓库</a></p>
<h3 id="OpenGL-ES-渲染一个三角形的编写流程"><a href="#OpenGL-ES-渲染一个三角形的编写流程" class="headerlink" title="OpenGL ES 渲染一个三角形的编写流程"></a>OpenGL ES 渲染一个三角形的编写流程</h3><p>苹果通过GLKit提供了一些列方便使用OpenGL的API，本实例为了学习底层渲染流程，所以不引入该库。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">// 引入最基础的GL库</div><div class="line">import OpenGLES</div></pre></td></tr></table></figure>
<h4 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h4><ul>
<li>context，OpenGL ES 是一个状态机，相关的配置信息会被保存在一个上下文（Context）中，这个些值会被一直保存，直到被修改。但我们可以配置多个上下文，通过调用 EAGLContext.setCurrent(self.eagContext) 来切换。</li>
<li>程序挂载标识 program，挂载着色器的progarm</li>
<li>帧缓存 frameBuffer，一个接收渲染结果的缓冲区，为 GPU 指定存储渲染结果的区域。更通俗点，可以理解成存储屏幕上最终显示的一帧画面的区域。我们需要将它挂在到渲染缓冲对象上，再最后展示到屏幕上。</li>
<li>渲染缓冲对象 renderBuffer，是最后要展示的结果通过 renderbufferStorage:fromDrawable:进行渲染层绑定，再presentRenderbuffer呈现到屏幕上。</li>
</ul>
<p>具体代码如下，过程如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">private func commonInit() &#123;</div><div class="line">       // 创建OpenGL ES2 的上下文</div><div class="line">       eagContext = EAGLContext(api: .openGLES2)</div><div class="line">       // 初始化OpenGL绘制Layer的一些属性</div><div class="line">       self.metalLayer.frame = self.bounds</div><div class="line">       self.metalLayer.isOpaque = true</div><div class="line">       metalLayer.drawableProperties = [kEAGLDrawablePropertyRetainedBacking : false,</div><div class="line">                                              kEAGLDrawablePropertyColorFormat : kEAGLColorFormatRGBA8]</div><div class="line">       // 初始化一下renderBuffer和FrameBuffer</div><div class="line">       genBuffer()</div><div class="line">       // 初始化着色器程序</div><div class="line">       loadShader()</div><div class="line">   &#125;</div><div class="line">   </div><div class="line">   func genBuffer() &#123;</div><div class="line">       EAGLContext.setCurrent(self.eagContext)</div><div class="line">       </div><div class="line">       // 生成缓冲区</div><div class="line">       glGenFramebuffers(1, &amp;self.frameBuffer)</div><div class="line">       glGenRenderbuffers(1, &amp;self.renderBuffer)</div><div class="line">       </div><div class="line">       // 绑定缓冲区</div><div class="line">       glBindFramebuffer(GLenum(GL_FRAMEBUFFER), self.frameBuffer)</div><div class="line">       glBindRenderbuffer(GLenum(GL_RENDERBUFFER), self.renderBuffer)</div><div class="line">       </div><div class="line">       // 渲染层绑定</div><div class="line">       self.eagContext?.renderbufferStorage(Int(GL_RENDERBUFFER), from: self.metalLayer)</div><div class="line">       </div><div class="line">       // 将渲染缓存绑定到帧缓存上</div><div class="line">       glFramebufferRenderbuffer(GLenum(GL_FRAMEBUFFER), GLenum(GL_COLOR_ATTACHMENT0), GLenum(GL_RENDERBUFFER), self.renderBuffer)</div><div class="line">   &#125;</div><div class="line">   </div><div class="line">   func loadShader() &#123;</div><div class="line">       // 已加载则删除</div><div class="line">       if self.program &gt; 0 &#123;</div><div class="line">           glDeleteProgram(self.program)</div><div class="line">       &#125;</div><div class="line">       </div><div class="line">       // 顶点着色器，简单的传递</div><div class="line">       let vertexSources =</div><div class="line">           &quot;attribute vec3 position;&quot; +</div><div class="line">           &quot;void main() &#123;&quot; +</div><div class="line">           &quot;  gl_Position = vec4(position, 1.0);&quot; +</div><div class="line">           &quot;&#125;&quot;</div><div class="line">       // 片段着色器，简单的用红色着色</div><div class="line">       let fragmentSources =</div><div class="line">           &quot;precision mediump float;&quot; +</div><div class="line">           &quot;void main() &#123;&quot; +</div><div class="line">           &quot;  gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);&quot; +</div><div class="line">           &quot;&#125;&quot;</div><div class="line">       // 编译两个着色器</div><div class="line">       let vertexShader = compilerShader(GLenum(GL_VERTEX_SHADER), vertexSources)</div><div class="line">       let fragmentShader = compilerShader(GLenum(GL_FRAGMENT_SHADER), fragmentSources)</div><div class="line">       </div><div class="line">       // 创建着色器程序标识</div><div class="line">       self.program = glCreateProgram()</div><div class="line">       </div><div class="line">       // 绑定上相应着色器</div><div class="line">       glAttachShader(self.program, vertexShader)</div><div class="line">       glAttachShader(self.program, fragmentShader)</div><div class="line">       </div><div class="line">       // 设置索引和变量之间的对应关系，当前着色器传入的就是一个position，索引为3，与后面用到的glVertexAttribPointer相关联</div><div class="line">       glBindAttribLocation(self.program, 3, (&quot;position&quot; as NSString).utf8String)</div><div class="line">       </div><div class="line">       // 将程序连接到OpenGL</div><div class="line">       glLinkProgram(self.program)</div><div class="line">       </div><div class="line">       var linkSuccess: GLint = 1</div><div class="line">       glGetProgramiv(self.program, GLenum(GL_LINK_STATUS), &amp;linkSuccess)</div><div class="line">       </div><div class="line">       if linkSuccess == GL_FALSE &#123;</div><div class="line">           // 链接失败</div><div class="line">           var message = [GLchar](repeating: GLchar(0), count: 256)</div><div class="line">           var len = GLsizei(0)</div><div class="line">           glGetProgramInfoLog(self.program, 256, &amp;len, &amp;message)</div><div class="line">           let log = String.init(utf8String: message)</div><div class="line">           print(&quot;program link error is \(String(describing: log))&quot;)</div><div class="line">       &#125;</div><div class="line">       </div><div class="line">       // 清除已经绑定了的着色器</div><div class="line">       glDeleteShader(vertexShader)</div><div class="line">       glDeleteShader(fragmentShader)</div><div class="line">   &#125;</div><div class="line">   </div><div class="line">   func compilerShader(_ shaderType: GLenum, _ sources: String) -&gt; GLuint &#123;</div><div class="line">       let shader = glCreateShader(shaderType)</div><div class="line">       var sourcePointer = (sources as NSString).utf8String</div><div class="line">       var len = GLint((sources as NSString).length)</div><div class="line">       glShaderSource(shader, 1, &amp;sourcePointer, &amp;len)</div><div class="line">       </div><div class="line">       glCompileShader(shader)</div><div class="line">       </div><div class="line">       var success: GLint = 1</div><div class="line">       glGetShaderiv(shader, GLenum(GL_COMPILE_STATUS), &amp;success)</div><div class="line">       </div><div class="line">       if success == GL_FALSE &#123;</div><div class="line">           var message = [GLchar](repeating: GLchar(0), count: 256)</div><div class="line">           var len = GLsizei(0)</div><div class="line">           glGetShaderInfoLog(shader, 256, &amp;len, &amp;message)</div><div class="line">           let log = String.init(utf8String: message)</div><div class="line">           print(&quot;shader:\(shaderType) compile error is \(String(describing: log))&quot;)</div><div class="line">       &#125;</div><div class="line">       </div><div class="line">       return shader</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<h4 id="渲染"><a href="#渲染" class="headerlink" title="渲染"></a>渲染</h4><p>需要的着色器、缓冲区、上下文、渲染Layer都准备好了，那剩下的就是进行渲染了。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">	override func didMoveToWindow() &#123;</div><div class="line">        super.didMoveToWindow()</div><div class="line">        render()</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    func render() &#123;</div><div class="line">        // 设置上下文</div><div class="line">        EAGLContext.setCurrent(self.eagContext)</div><div class="line">        </div><div class="line">        // 引入程序库</div><div class="line">        glUseProgram(self.program)</div><div class="line">        // 绑定帧缓冲区</div><div class="line">        glBindFramebuffer(GLenum(GL_FRAMEBUFFER), self.frameBuffer)</div><div class="line">        </div><div class="line">        // 用黑色清除背景色，clear设置背景色会比较快，大概认为 clear 改的是 cache 里的值，并不会真得写到显存里，所以特别快。cache 和 shader 的执行单元离得近，显存和 shader 的执行单元离得远，能少走点路就少走点路。</div><div class="line">        glClearColor(0, 0, 0, 1.0)</div><div class="line">        glClear(GLbitfield(GL_COLOR_BUFFER_BIT))</div><div class="line">        </div><div class="line">        // x，y 以像素为单位，指定了视口的左下角位置。</div><div class="line">        // width，height 表示这个视口矩形的宽度和高度，根据窗口的实时变化重绘窗口</div><div class="line">        glViewport(0, 0, GLsizei(self.frame.width), GLsizei(self.frame.height))</div><div class="line">        </div><div class="line">        // 这里只使用位置，不使用颜色变量。位置的索引为3</div><div class="line">        let positionLocaltion: GLuint = 3</div><div class="line">//        let colorLocation: GLuint = 4</div><div class="line">        </div><div class="line">        let vertices:[GLfloat] =</div><div class="line">            [-0.5, -0.5, 0.0,</div><div class="line">             0.5, -0.5, 0.0,</div><div class="line">             0.0, 0.5, 0.0]</div><div class="line">        // 在内存中采用交叉模式存储，向gpu传入顶点数据的方法</div><div class="line">        // 第一个参数是索引，第二个参数是长度，后面是类型</div><div class="line">        glVertexAttribPointer(positionLocaltion, 3, GLenum(GL_FLOAT), GLboolean(GL_FALSE), 0, vertices)</div><div class="line">        glEnableVertexAttribArray(positionLocaltion)</div><div class="line">        </div><div class="line">        // 使用缓存的数据进行绘制</div><div class="line">        glDrawArrays(GLenum(GL_TRIANGLES), 0, 3)</div><div class="line">        </div><div class="line">        // 将绑定的渲染缓存呈现到屏幕上</div><div class="line">        let finished = eagContext?.presentRenderbuffer(Int(GL_RENDERBUFFER)) ?? false</div><div class="line">        print(&quot;finished is: \(finished)&quot;)</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<h4 id="结果"><a href="#结果" class="headerlink" title="结果"></a>结果</h4><p><img src="http://image.runmaf.com/2020-06-17-15923569380658.jpg" alt=""></p>
<h2 id="写在最后"><a href="#写在最后" class="headerlink" title="写在最后"></a>写在最后</h2><p>初学，或许有一些理解上偏差。</p>
<p>下一篇用Metal实现个一样的。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2020/06/10/NeumorphismAndSomeShadowStyle/" itemprop="url">
                  今年流行的拟态Neumorphism与常见的几种阴影形式
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Veröffentlicht am</span>
            <time itemprop="dateCreated" datetime="2020-06-10T00:23:55+08:00" content="2020-06-10">
              2020-06-10
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a href="https://github.com/yuezaixz/DwShadowDemo" target="_blank" rel="external">DEMO地址:https://github.com/yuezaixz/DwShadowDemo</a></p>
<p>最近应用中用到的阴影比较多，加上自己独立开发的应用也尝试了今年流行的拟态Neumorphism设计，所以稍微研究了下常见的几种阴影在设计和开发实现上形式。</p>
<h2 id="iOS的阴影API"><a href="#iOS的阴影API" class="headerlink" title="iOS的阴影API"></a>iOS的阴影API</h2><h3 id="shadowColor"><a href="#shadowColor" class="headerlink" title="shadowColor"></a>shadowColor</h3><p>自定义阴影的颜色。默认颜色是UIColor.black.cgColor，它会产生深色阴影，但您也可以设置浅色以创建发光效果，或其他任何颜色。</p>
<h3 id="shadowOpacity"><a href="#shadowOpacity" class="headerlink" title="shadowOpacity"></a>shadowOpacity</h3><p>自定义阴影的不透明度，介于0和1之间。值为0表示阴影将不可见。</p>
<h3 id="shadowRadius"><a href="#shadowRadius" class="headerlink" title="shadowRadius"></a>shadowRadius</h3><p>自定义阴影的模糊度。0表示阴影完全不会模糊。</p>
<h3 id="shadowOffset"><a href="#shadowOffset" class="headerlink" title="shadowOffset"></a>shadowOffset</h3><p>从视图中自定义阴影的位置。如果要向界面添加深度，此属性特别有用。 CGSize.zero值表示阴影将与其父视图完美对齐。默认为-3，在iOS上表现是向上偏移3个点，在macOS上是向下偏移，应该是因为macOS的原因，正常感觉，阴影应该是在下方的，因为现实世界中，很少光源处于低视角。</p>
<h3 id="shadowPath"><a href="#shadowPath" class="headerlink" title="shadowPath"></a>shadowPath</h3><p>自定义阴影的形状。此属性的默认值为nil，这意味着UIKit将自行确定父视图的形状。<br>不设置shadowPath会实时计算阴影，这会是一个非常消耗资源的，尤其是图层有多个子图层，每个图层还有一个有透明效果的寄宿图的时候。<br>因此，如果形状是可控的话，尽量设置他。</p>
<h2 id="阴影的常见形式"><a href="#阴影的常见形式" class="headerlink" title="阴影的常见形式"></a>阴影的常见形式</h2><h3 id="拟态Neumorphism"><a href="#拟态Neumorphism" class="headerlink" title="拟态Neumorphism"></a>拟态Neumorphism</h3><p>竟然今天这篇文章因他而起，就先说他吧。<br>拟态是今年比较火的一种设计形式，dribble和一些个人应用开发上比较常见。商业应用由于风格统一问题，暂时应该还很难看到。<br><a href="https://uxdesign.cc/neumorphism-in-user-interfaces-b47cef3bf3a6" target="_blank" rel="external">有兴趣了解的话，可以看看这篇文章</a></p>
<p>个人开发应用中，我已经尝试起这种形式了。</p>
<p><img src="http://image.runmaf.com/2020-06-10-15917206259996.jpg" alt=""></p>
<p>其实他的原理就是两段式的阴影组合，左侧和上侧用暗色阴影，右侧和下侧用亮色阴影，组合其他就是一个凹陷的效果。反之，就是一个凸出的效果。</p>
<h3 id="正面投影（光源较远）"><a href="#正面投影（光源较远）" class="headerlink" title="正面投影（光源较远）"></a>正面投影（光源较远）</h3><p>正面投影应该是最经典阴影了，也是最常见的阴影。通过从View的Bounds创建UIBezierPath来为此基本阴影指定路径，加上偏移、模糊、颜色等，就快速实现了阴影。</p>
<p><img src="http://image.runmaf.com/2020-06-10-15917209241272.jpg" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">imageView.layer.shadowRadius = 10</div><div class="line">imageView.layer.shadowOffset = .zero</div><div class="line">imageView.layer.shadowOpacity = 0.5</div><div class="line">imageView.layer.shadowColor = UIColor.black.cgColor</div><div class="line">imageView.layer.shadowPath = UIBezierPath(rect: imageView.bounds).cgPath</div><div class="line">imageView.layer.masksToBounds = false</div></pre></td></tr></table></figure>
<h3 id="高处投影"><a href="#高处投影" class="headerlink" title="高处投影"></a>高处投影</h3><p>当光源在高处试物体产生投影。产生的阴影是一个椭圆形。这种阴影很像太阳光使各种物体产生的阴影效果。</p>
<p><img src="http://image.runmaf.com/2020-06-10-15917212274721.jpg" alt=""></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="comment">// 阴影的厚度</span></div><div class="line"><span class="keyword">let</span> size: <span class="type">CGFloat</span> = <span class="number">20</span></div><div class="line"><span class="comment">// 阴影在下方的距离</span></div><div class="line"><span class="keyword">let</span> <span class="built_in">distance</span>: <span class="type">CGFloat</span> = <span class="number">80</span></div><div class="line"><span class="keyword">let</span> rect = <span class="type">CGRect</span>(</div><div class="line">    x: -size,</div><div class="line">    y: imageView.frame.height - (size * <span class="number">0.4</span>) + <span class="built_in">distance</span>,</div><div class="line">    width: imageView.frame.width + size * <span class="number">2</span>,</div><div class="line">    height: size</div><div class="line">)</div><div class="line"></div><div class="line">imageView.layer.shadowColor = <span class="type">UIColor</span>.black.cgColor</div><div class="line">imageView.layer.shadowRadius = <span class="number">7</span></div><div class="line">imageView.layer.shadowOpacity = <span class="number">0.5</span></div><div class="line">imageView.layer.shadowPath = <span class="type">UIBezierPath</span>(ovalIn: rect).cgPath</div><div class="line">imageView.layer.masksToBounds = <span class="literal">false</span></div></pre></td></tr></table></figure>
<h3 id="正面阴影（较近且可以水平移动光源）"><a href="#正面阴影（较近且可以水平移动光源）" class="headerlink" title="正面阴影（较近且可以水平移动光源）"></a>正面阴影（较近且可以水平移动光源）</h3><p>当光源在你正面或背面，且可以水平移动，那么就会产生以后正面或背面的投影。有点像晚上在马路上，远处路灯产生的投影效果。</p>
<p><img src="http://image.runmaf.com/2020-06-10-15917214247257.jpg" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">// height 负数，光源在正面，阴影绘制在背影。正数，光源在背面，阴影绘制在前影</div><div class="line">let scale = CGSize(width: 0.8, height: -0.6)</div><div class="line">// 光源水平位置</div><div class="line">let offsetX: CGFloat = 100</div><div class="line"></div><div class="line">let shadowPath = UIBezierPath()</div><div class="line">shadowPath.move(to:</div><div class="line">    CGPoint(</div><div class="line">        x: 0,</div><div class="line">        y: imageView.frame.height</div><div class="line">    )</div><div class="line">)</div><div class="line">shadowPath.addLine(to:</div><div class="line">    CGPoint(</div><div class="line">        x: imageView.frame.width,</div><div class="line">        y: imageView.frame.height</div><div class="line">    )</div><div class="line">)</div><div class="line">shadowPath.addLine(to:</div><div class="line">    CGPoint(</div><div class="line">        x: imageView.frame.width * scale.width + offsetX,</div><div class="line">        y: imageView.frame.height * (1 + scale.height)</div><div class="line">    )</div><div class="line">)</div><div class="line">shadowPath.addLine(to:</div><div class="line">    CGPoint(</div><div class="line">        x: imageView.frame.width * (1 - scale.width) + offsetX,</div><div class="line">        y: imageView.frame.height * (1 + scale.height)</div><div class="line">    )</div><div class="line">)</div><div class="line">imageView.layer.shadowColor = UIColor.black.cgColor</div><div class="line">imageView.layer.shadowRadius = 7</div><div class="line">imageView.layer.shadowOpacity = 0.5</div><div class="line">imageView.layer.shadowPath = shadowPath.cgPath</div><div class="line">imageView.layer.masksToBounds = false</div></pre></td></tr></table></figure>
<h3 id="弧形阴影"><a href="#弧形阴影" class="headerlink" title="弧形阴影"></a>弧形阴影</h3><p>弧形阴影算我比较喜欢的阴影效果之一了。一是圆滑的曲线显得不会那么生硬，然后整体立体感也比较好。<br>可以调节弧度和模糊度来让弧度更明显，不过我觉得自然点更重要。</p>
<p><img src="http://image.runmaf.com/2020-06-10-15917217072946.jpg" alt=""></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="comment">// 曲形阴影的曲度</span></div><div class="line"><span class="keyword">let</span> curve: <span class="type">CGFloat</span> = <span class="number">15</span></div><div class="line"></div><div class="line"><span class="keyword">let</span> shadowPath = <span class="type">UIBezierPath</span>()</div><div class="line">shadowPath.move(to: <span class="type">CGPoint</span>.zero)</div><div class="line">shadowPath.addLine(to: <span class="type">CGPoint</span>(</div><div class="line">    x: imageView.frame.width,</div><div class="line">    y: <span class="number">0</span></div><div class="line">))</div><div class="line">shadowPath.addLine(to: <span class="type">CGPoint</span>(</div><div class="line">    x: imageView.frame.width,</div><div class="line">    y: imageView.frame.height + curve</div><div class="line">))</div><div class="line">shadowPath.addCurve(</div><div class="line">    to: <span class="type">CGPoint</span>(</div><div class="line">        x: <span class="number">0</span>,</div><div class="line">        y: imageView.frame.height + curve</div><div class="line">    ),</div><div class="line">    controlPoint1: <span class="type">CGPoint</span>(</div><div class="line">        x: imageView.frame.width,</div><div class="line">        y: imageView.frame.height</div><div class="line">    ),</div><div class="line">    controlPoint2: <span class="type">CGPoint</span>(</div><div class="line">        x: <span class="number">0</span>,</div><div class="line">        y: imageView.frame.height</div><div class="line">    )</div><div class="line">)</div><div class="line">imageView.layer.shadowPath = shadowPath.cgPath</div><div class="line">imageView.layer.shadowRadius = <span class="number">10</span></div><div class="line">imageView.layer.shadowOffset = <span class="type">CGSize</span>(width: <span class="number">0</span>, height: <span class="number">10</span>)</div><div class="line">imageView.layer.shadowOpacity = <span class="number">0.5</span></div><div class="line">imageView.layer.shadowColor = <span class="type">UIColor</span>.black.cgColor</div><div class="line">imageView.layer.masksToBounds = <span class="literal">false</span></div></pre></td></tr></table></figure>
<h3 id="扁平阴影"><a href="#扁平阴影" class="headerlink" title="扁平阴影"></a>扁平阴影</h3><p>这种阴影用的很少，简单看看效果带过吧。</p>
<p><img src="http://image.runmaf.com/2020-06-10-15917216653737.jpg" alt=""></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">let</span> scale = <span class="type">CGSize</span>(width: <span class="number">1.5</span>, height: <span class="number">1.5</span>)</div><div class="line"><span class="keyword">let</span> offset = <span class="type">CGPoint</span>(x: imageView.frame.width, y: -imageView.frame.height)</div><div class="line"></div><div class="line"><span class="keyword">let</span> shadowPath = <span class="type">UIBezierPath</span>()</div><div class="line">shadowPath.move(to:</div><div class="line">    <span class="type">CGPoint</span>(</div><div class="line">        x: <span class="number">0</span>,</div><div class="line">        y: imageView.frame.height + (copysign(<span class="number">1</span>, scale.height) * copysign(<span class="number">1</span>, offset.x) == <span class="number">1</span> ? <span class="number">0</span> : offset.y)</div><div class="line">    )</div><div class="line">)</div><div class="line">shadowPath.addLine(to:</div><div class="line">    <span class="type">CGPoint</span>(</div><div class="line">        x: imageView.frame.width,</div><div class="line">        y: imageView.frame.height + (copysign(<span class="number">1</span>, scale.height) * copysign(<span class="number">1</span>, offset.x) == -<span class="number">1</span> ? <span class="number">0</span> : offset.y)</div><div class="line">    )</div><div class="line">)</div><div class="line">shadowPath.addLine(to:</div><div class="line">    <span class="type">CGPoint</span>(</div><div class="line">        x: imageView.frame.width * scale.width + offset.x,</div><div class="line">        y: imageView.frame.height * (<span class="number">1</span> + scale.height) + offset.y</div><div class="line">    )</div><div class="line">)</div><div class="line">shadowPath.addLine(to:</div><div class="line">    <span class="type">CGPoint</span>(</div><div class="line">        x: imageView.frame.width * (<span class="number">1</span> - scale.width) + offset.x,</div><div class="line">        y: imageView.frame.height * (<span class="number">1</span> + scale.height) + offset.y</div><div class="line">    )</div><div class="line">)</div><div class="line">imageView.layer.shadowPath = shadowPath.cgPath</div><div class="line">imageView.layer.shadowRadius = <span class="number">0</span></div><div class="line">imageView.layer.shadowOffset = .zero</div><div class="line">imageView.layer.shadowOpacity = <span class="number">0.2</span></div><div class="line">imageView.layer.shadowColor = <span class="type">UIColor</span>.black.cgColor</div><div class="line">imageView.layer.masksToBounds = <span class="literal">false</span></div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2020/06/02/SwiftMagicInLeetCode/" itemprop="url">
                  Swift刷LeetCode时候的一些方便的API
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Veröffentlicht am</span>
            <time itemprop="dateCreated" datetime="2020-06-02T18:29:20+08:00" content="2020-06-02">
              2020-06-02
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Swift刷LeetCode时候的一些方便的API"><a href="#Swift刷LeetCode时候的一些方便的API" class="headerlink" title="Swift刷LeetCode时候的一些方便的API"></a>Swift刷LeetCode时候的一些方便的API</h1><p>用Swift刷了1个月LeetCode，一些函数库、API、数据结构相比Python确实有点差距，不过还是发现了一些以前不知道的小技巧，这里总结一下。</p>
<h2 id="ObjectIdentifier"><a href="#ObjectIdentifier" class="headerlink" title="ObjectIdentifier"></a>ObjectIdentifier</h2><p>字典缓存结果是一个常用的空间换时间的技巧，但是TreeNode或ListNode这种，如果他们的val不是唯一存在的，那么用什么作为字典的key呢？<br>这时候就是英雄出场的时候了。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">TreeNode</span> </span>&#123;</div><div class="line">    <span class="keyword">var</span> <span class="keyword">left</span>: <span class="type">TreeNode</span>?</div><div class="line">    <span class="keyword">var</span> <span class="keyword">right</span>: <span class="type">TreeNode</span>?</div><div class="line">    <span class="keyword">var</span> val: <span class="type">Int</span></div><div class="line">    </div><div class="line">    <span class="keyword">init</span>(<span class="number">_</span> val: <span class="type">Int</span>) &#123;</div><div class="line">        <span class="keyword">self</span>.val = val</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">let</span> empty = <span class="type">TreeNode</span>(-<span class="number">1</span>)</div><div class="line"></div><div class="line"><span class="keyword">let</span> root = <span class="type">TreeNode</span>(<span class="number">0</span>)</div><div class="line">root.<span class="keyword">left</span> = <span class="type">TreeNode</span>(<span class="number">1</span>)</div><div class="line">root.<span class="keyword">right</span> = <span class="type">TreeNode</span>(<span class="number">2</span>)</div><div class="line"></div><div class="line"><span class="keyword">var</span> dict = [<span class="type">ObjectIdentifier</span>: <span class="type">TreeNode</span>]()</div><div class="line">dict[<span class="type">ObjectIdentifier</span>(root)] = root</div><div class="line"><span class="built_in">print</span>(dict)</div><div class="line"><span class="built_in">print</span>(dict[<span class="type">ObjectIdentifier</span>(root), <span class="keyword">default</span>: empty].val)</div><div class="line"><span class="comment">//[ObjectIdentifier(0x0000600002d32b80): __lldb_expr_15.TreeNode]</span></div><div class="line"><span class="comment">//0</span></div></pre></td></tr></table></figure>
<p>厉害了吧，直接可以用ObjectIdentifier做key，不知道它之前，我还自己写个hash函数去实现Hashable。</p>
<h3 id="ObjectIdentifier的原理"><a href="#ObjectIdentifier的原理" class="headerlink" title="ObjectIdentifier的原理"></a>ObjectIdentifier的原理</h3><p>那么他怎么实现的呢？看下面代码你就知道了，其实他就是用指针地址来做的。然后再给他实现Hashable和Equatable接口。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">struct</span> <span class="title">ObjectIdentifier</span> </span>&#123;</div><div class="line">  <span class="keyword">internal</span> <span class="keyword">let</span> _value: <span class="type">Builtin</span>.<span class="type">RawPointer</span></div><div class="line">  <span class="keyword">public</span> <span class="keyword">init</span>(<span class="number">_</span> x: <span class="type">AnyObject</span>) &#123;</div><div class="line">    <span class="keyword">self</span>._value = <span class="type">Builtin</span>.bridgeToRawPointer(x)</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">public</span> <span class="keyword">init</span>(<span class="number">_</span> x: <span class="type">Any</span>.<span class="type">Type</span>) &#123;</div><div class="line">    <span class="keyword">self</span>._value = <span class="built_in">unsafeBitCast</span>(x, to: <span class="type">Builtin</span>.<span class="type">RawPointer</span>.<span class="keyword">self</span>)</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"><span class="class"><span class="keyword">extension</span> <span class="title">ObjectIdentifier</span>: <span class="title">Equatable</span> </span>&#123;</div><div class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> == <span class="params">(x: ObjectIdentifier, y: ObjectIdentifier)</span></span> -&gt; <span class="type">Bool</span> &#123;</div><div class="line">    <span class="keyword">return</span> <span class="type">Bool</span>(<span class="type">Builtin</span>.cmp_eq_RawPointer(x._value, y._value))</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"><span class="class"><span class="keyword">extension</span> <span class="title">ObjectIdentifier</span>: <span class="title">Hashable</span> </span>&#123;</div><div class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">hash</span><span class="params">(into hasher: <span class="keyword">inout</span> Hasher)</span></span> &#123;</div><div class="line">    hasher.combine(<span class="type">Int</span>(<span class="type">Builtin</span>.ptrtoint_Word(_value)))</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="扩展"><a href="#扩展" class="headerlink" title="扩展"></a>扩展</h3><p>如果项目中需要使用到这个的话，可以添加一个方便的协议扩展。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">protocol</span> <span class="title">Identifiable</span> </span>&#123;</div><div class="line">  associatedtype <span class="type">ID</span>: <span class="type">Hashable</span></div><div class="line">  <span class="keyword">var</span> id: <span class="type">ID</span> &#123; <span class="keyword">get</span> &#125;</div><div class="line">&#125;</div><div class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Identifiable</span> <span class="title">where</span> <span class="title">Self</span>: <span class="title">AnyObject</span> </span>&#123;</div><div class="line">  <span class="keyword">public</span> <span class="keyword">var</span> id: <span class="type">ObjectIdentifier</span> &#123;</div><div class="line">    <span class="keyword">return</span> <span class="type">ObjectIdentifier</span>(<span class="keyword">self</span>)</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="dump-函数"><a href="#dump-函数" class="headerlink" title="dump 函数"></a>dump 函数</h2><p>print打印对象的话，无法打印出对象的层次结构，刷LeetCode出错的时候，调试就不方便了，有时候需要为了调试信息写很长的print代码。<br>这时候有dump你接方便了，接前面的TreeNode对象，对他进行输出。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="built_in">print</span>(root)</div><div class="line"><span class="comment">// __lldb_expr_31.TreeNode</span></div><div class="line"></div><div class="line"><span class="built_in">dump</span>(root)</div><div class="line"><span class="comment">//▿ __lldb_expr_17.TreeNode #0</span></div><div class="line"><span class="comment">//▿ left: Optional(__lldb_expr_17.TreeNode)</span></div><div class="line"><span class="comment">//  ▿ some: __lldb_expr_17.TreeNode #1</span></div><div class="line"><span class="comment">//    - left: nil</span></div><div class="line"><span class="comment">//    - right: nil</span></div><div class="line"><span class="comment">//    - val: 1</span></div><div class="line"><span class="comment">//▿ right: Optional(__lldb_expr_17.TreeNode)</span></div><div class="line"><span class="comment">//  ▿ some: __lldb_expr_17.TreeNode #2</span></div><div class="line"><span class="comment">//    - left: nil</span></div><div class="line"><span class="comment">//    - right: nil</span></div><div class="line"><span class="comment">//    - val: 2</span></div><div class="line"><span class="comment">//- val: 0</span></div></pre></td></tr></table></figure>
<p>是不是很好用？</p>
<h2 id="sequence"><a href="#sequence" class="headerlink" title="sequence"></a>sequence</h2><p>做链表题时候经常有这个需求，遍历所有节点，需要用while，然后用个临时对象一层一层的往下走。<br>结果是一样，个人认为代码可读性上比较差，可以换成sequence来做。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">let</span> firstNode = <span class="type">ListNode</span>(<span class="number">0</span>)</div><div class="line">firstNode.next = <span class="type">ListNode</span>(<span class="number">1</span>)</div><div class="line">firstNode.next?.next = <span class="type">ListNode</span>(<span class="number">2</span>)</div><div class="line">firstNode.next?.next?.next = <span class="type">ListNode</span>(<span class="number">3</span>)</div><div class="line"></div><div class="line"><span class="keyword">var</span> curr: <span class="type">ListNode</span>? = firstNode</div><div class="line"><span class="keyword">while</span> curr != <span class="literal">nil</span> &#123;</div><div class="line">    <span class="built_in">print</span>(curr!.val)</div><div class="line">    curr = curr?.next</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 效果一样</span></div><div class="line"></div><div class="line"><span class="keyword">for</span> curr <span class="keyword">in</span> sequence(first: firstNode, next: &#123; $<span class="number">0</span>.next &#125; ) &#123;</div><div class="line">    <span class="built_in">print</span>(curr.val)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//0</span></div><div class="line"><span class="comment">//1</span></div><div class="line"><span class="comment">//2</span></div><div class="line"><span class="comment">//3</span></div></pre></td></tr></table></figure>
<h2 id="swap"><a href="#swap" class="headerlink" title="swap"></a>swap</h2><p>这个也主要是可读性，不然tupple方式就可以搞定了。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">var</span> a = <span class="string">"a"</span></div><div class="line"><span class="keyword">var</span> b = <span class="string">"b"</span></div><div class="line"></div><div class="line">(a, b) = (b, a)</div><div class="line"><span class="built_in">print</span>(a, b)</div><div class="line"></div><div class="line"><span class="comment">// 效果相同</span></div><div class="line"></div><div class="line"><span class="built_in">swap</span>(&amp;a, &amp;b)</div><div class="line"><span class="built_in">print</span>(a, b)</div><div class="line"><span class="comment">// b a</span></div></pre></td></tr></table></figure>
<h2 id="repeating-和-Repeated"><a href="#repeating-和-Repeated" class="headerlink" title="repeating 和 Repeated"></a>repeating 和 Repeated</h2><p>快速创建同样元素数组的两个方法。</p>
<p>快捷创建动规二元数组或者做批量替换时候特别好用。</p>
<font color="red">要注意的是，重复的值如果是对象的话，是同一个引用的哦。</font>

<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">var</span> nums = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>]</div><div class="line"><span class="keyword">var</span> dp = <span class="type">Array</span>(repeating: <span class="type">Array</span>(repeating: <span class="number">0</span>, <span class="built_in">count</span>: nums.<span class="built_in">count</span>), <span class="built_in">count</span>: nums.<span class="built_in">count</span>)</div><div class="line"><span class="built_in">print</span>(dp)</div><div class="line"><span class="comment">// [[0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0]]</span></div><div class="line"></div><div class="line"><span class="keyword">let</span> repeated: <span class="type">Repeated</span>&lt;<span class="type">String</span>&gt; = repeatElement(<span class="string">"SwiftRocks"</span>, <span class="built_in">count</span>: <span class="number">3</span>)</div><div class="line"><span class="keyword">for</span> value <span class="keyword">in</span> repeated &#123;</div><div class="line">    <span class="built_in">print</span>(value)</div><div class="line">&#125;</div><div class="line"><span class="comment">//SwiftRocks</span></div><div class="line"><span class="comment">//SwiftRocks</span></div><div class="line"><span class="comment">//SwiftRocks</span></div><div class="line"></div><div class="line">nums.replaceSubrange(<span class="number">2</span>...<span class="number">5</span>, with: [<span class="type">Int</span>](repeating: <span class="number">1</span>, <span class="built_in">count</span>: <span class="number">4</span>))</div><div class="line"><span class="built_in">print</span>(nums)</div><div class="line"><span class="comment">//[1, 2, 1, 1, 1, 1]</span></div><div class="line">nums.replaceSubrange(<span class="number">2</span>...<span class="number">5</span>, with: repeatElement(<span class="number">3</span>, <span class="built_in">count</span>: <span class="number">4</span>))</div><div class="line"><span class="built_in">print</span>(nums)</div><div class="line"><span class="comment">//[1, 2, 3, 3, 3, 3]</span></div></pre></td></tr></table></figure>
<h2 id="zip"><a href="#zip" class="headerlink" title="zip"></a>zip</h2><p>把两个数组压到一起，题目有两个同样长度的数组需要一起遍历，这个就很好用了</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">var</span> nums = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>]</div><div class="line"></div><div class="line"><span class="keyword">var</span> strs = [<span class="string">"a"</span>, <span class="string">"b"</span>, <span class="string">"c"</span>]</div><div class="line"></div><div class="line"><span class="keyword">for</span> item <span class="keyword">in</span> <span class="built_in">zip</span>(nums, strs) &#123;</div><div class="line">    <span class="built_in">print</span>(item)</div><div class="line">&#125;</div><div class="line"><span class="comment">//(1, "a")</span></div><div class="line"><span class="comment">//(2, "b")</span></div><div class="line"><span class="comment">//(3, "c")</span></div></pre></td></tr></table></figure>
<h2 id="stride"><a href="#stride" class="headerlink" title="stride"></a>stride</h2><p>反向遍历，跳跃遍历。注意，to不包含哦。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">// 反向遍历，to不包含，所以要到-1</div><div class="line">for i in stride(from: 10, to: -1, by: -1) &#123;</div><div class="line">    print(i)</div><div class="line">&#125;</div><div class="line">// 跳跃遍历</div><div class="line">for i in stride(from: 0, to: 10, by: 2) &#123;</div><div class="line">    print(i)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><p>max min pow abs，比较基础，基本没人不知道了，就不说了。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2020/05/28/SwiftCodePoisoningManual/" itemprop="url">
                  Swift投毒利器dynamicMemberLookup
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Veröffentlicht am</span>
            <time itemprop="dateCreated" datetime="2020-05-28T19:02:36+08:00" content="2020-05-28">
              2020-05-28
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="这是一个标题"><a href="#这是一个标题" class="headerlink" title="这是一个标题"></a>这是一个标题</h1><h2 id="题外话"><a href="#题外话" class="headerlink" title="题外话"></a>题外话</h2><p>开始恢复写文章，不过都写的都好仓促，写文章的目的其实是为了自己通过写出来能增加自己的理解，现在这样确实有点偏离初衷了。<br>现在大多是6点下班后，7点开始加班前把早上地铁上看的东西自己敲代码理解下，顺便记录下，时间仓促。但是不当天就写，隔天基本就懒得写了，去年基本是这个样，所以先坚持做起来再增加质量吧。</p>
<h2 id="动态成员查找"><a href="#动态成员查找" class="headerlink" title="动态成员查找"></a>动态成员查找</h2><p>这是个Swift4.2添加的特性，不过官方在当时的Session里并没有提到他，可能也是考虑到这大大降低了Swift的安全性，会导致编译器根本没法在编译期间检查出调用错误，也会让你在编写代码时候，没有coding错误的提示。<br>做过JavaScript的同学应该是很熟悉这个特性的，通过.的调用方式替代[]的方式。</p>
<h3 id="Hello-DynamicMemberLookup"><a href="#Hello-DynamicMemberLookup" class="headerlink" title="Hello DynamicMemberLookup"></a>Hello DynamicMemberLookup</h3><p>给类、结构体、枚举添加这个注解。<br>添加后，通过.xxx的都会进入到subscript函数。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">@dynamicMemberLookup</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Person</span> </span>&#123;</div><div class="line">    <span class="keyword">subscript</span>(dynamicMember member: <span class="type">String</span>) -&gt; <span class="type">String</span> &#123;</div><div class="line">        <span class="keyword">let</span> properties = [<span class="string">"nickName"</span>: <span class="string">"David_Woo"</span>, <span class="string">"hoby"</span>: <span class="string">"marathon"</span>]</div><div class="line">        <span class="keyword">return</span> properties[member, <span class="keyword">default</span>: <span class="string">"不，你没有"</span>]</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">let</span> me = <span class="type">Person</span>()</div><div class="line"><span class="built_in">print</span>(me.nickName) <span class="comment">//David_Woo</span></div><div class="line"><span class="built_in">print</span>(me.hoby) <span class="comment">// marathon</span></div><div class="line"><span class="built_in">print</span>(me.villa) <span class="comment">//不，你没有</span></div></pre></td></tr></table></figure>
<p>其实他就是编译时把me.xxx变成了me[xxx]，然后就是你熟悉的下标知识点了。</p>
<h3 id="One-More"><a href="#One-More" class="headerlink" title="One More"></a>One More</h3><p>与下标一样，也可以编译多个，通过返回值来区分。不过定义多个以后调用就变麻烦了，如果你在调用处明确类型，那编译器就不知道匹配到那个脚本了，就会编译报错。</p>
<p>有个好的就是可以通过他来返回函数。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">@dynamicMemberLookup</div><div class="line">struct Person &#123;</div><div class="line">    subscript(dynamicMember member: String) -&gt; String &#123;</div><div class="line">        let properties = [&quot;nickName&quot;: &quot;David_Woo&quot;, &quot;hoby&quot;: &quot;marathon&quot;]</div><div class="line">        return properties[member, default: &quot;something unexpected&quot;]</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    subscript(dynamicMember member: String) -&gt; () -&gt; () &#123;</div><div class="line">        return &#123;</div><div class="line">            print(&quot;This is fun&quot;)</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">let me = Person()</div><div class="line"></div><div class="line">let nickName: String = me.nickName</div><div class="line">let hoby: String = me.hoby</div><div class="line">let villa: String = me.villa</div><div class="line"></div><div class="line">me.a() // This is fun</div></pre></td></tr></table></figure>
<h3 id="重点来了，如何投毒"><a href="#重点来了，如何投毒" class="headerlink" title="重点来了，如何投毒"></a>重点来了，如何投毒</h3><p>可怕的来了，这个特性是可以继承的。也就是说基类上定义了，那么所有继承的子类也都有这个特性了，这样不小心一些属性调用敲错键盘编译器都不会提示你了。</p>
<font color="red">尽可能不要在基类上使用这个特性</font>

<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"></div><div class="line">@dynamicMemberLookup</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</div><div class="line">    <span class="keyword">subscript</span>(dynamicMember member: <span class="type">String</span>) -&gt; <span class="type">String</span> &#123;</div><div class="line">        <span class="keyword">let</span> properties = [<span class="string">"nickName"</span>: <span class="string">"David_Woo"</span>, <span class="string">"hoby"</span>: <span class="string">"marathon"</span>]</div><div class="line">        <span class="keyword">return</span> properties[member, <span class="keyword">default</span>: <span class="string">"something unexpected"</span>]</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Employee</span>: <span class="title">Person</span> </span>&#123;</div><div class="line">    <span class="comment">// 为什么工资是不可变类型，那你得问老板</span></div><div class="line">    <span class="keyword">let</span> salary: <span class="type">Int</span></div><div class="line">    </div><div class="line">    <span class="keyword">override</span> <span class="keyword">init</span>() &#123;</div><div class="line">        salary = <span class="number">0</span></div><div class="line">        <span class="keyword">super</span>.<span class="keyword">init</span>()</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">init</span>(<span class="number">_</span> salary: <span class="type">Int</span>) &#123;</div><div class="line">        <span class="keyword">self</span>.salary = salary</div><div class="line">        <span class="keyword">super</span>.<span class="keyword">init</span>()</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">let</span> me = <span class="type">Employee</span>(<span class="number">0</span>)</div><div class="line"><span class="built_in">print</span>(me.nickName)</div><div class="line"><span class="built_in">print</span>(me.hoby)</div><div class="line"><span class="built_in">print</span>(me.villa) <span class="comment">// 编译器不会提示错误</span></div><div class="line"><span class="built_in">print</span>(me.salary) <span class="comment">// 但是IDE还是会自动提示的</span></div><div class="line"></div><div class="line"><span class="comment">// 在此投毒</span></div><div class="line">@dynamicMemberLookup</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">VVBaseViewController</span> : <span class="title">UIViewController</span> </span>&#123;</div><div class="line">    <span class="keyword">subscript</span>(dynamicMember member: <span class="type">String</span>) -&gt; <span class="type">String</span> &#123;</div><div class="line">        <span class="keyword">return</span> <span class="string">"Congratulations! U will be fired!"</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="不可以用来满足协议"><a href="#不可以用来满足协议" class="headerlink" title="不可以用来满足协议"></a>不可以用来满足协议</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">protocol Namable &#123;</div><div class="line">    var nickName: String &#123; get &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">@dynamicMemberLookup</div><div class="line">class Person &#123;</div><div class="line">    subscript(dynamicMember member: String) -&gt; String &#123;</div><div class="line">        let properties = [&quot;nickName&quot;: &quot;David_Woo&quot;, &quot;hoby&quot;: &quot;marathon&quot;]</div><div class="line">        return properties[member, default: &quot;something unexpected&quot;]</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">// 会编译出错，还是要手动实现nickName</div><div class="line">class Employee: Person, Namable &#123;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2020/05/28/HelloSwiftPropertyWrappers/" itemprop="url">
                  Swift的属性装饰器
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Veröffentlicht am</span>
            <time itemprop="dateCreated" datetime="2020-05-28T01:09:31+08:00" content="2020-05-28">
              2020-05-28
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Swift的属性装饰器"><a href="#Swift的属性装饰器" class="headerlink" title="Swift的属性装饰器"></a>Swift的属性装饰器</h1><p>做Python开发的，肯定对属性装饰器这东西是又爱又恨。爱是因为带来了很多遍历，简化代码，剥离一些属性的处理逻辑。狠是滥用以后，可读性很差，一堆的装饰器，不熟悉这个模块的话得去看一堆的装饰器源码。</p>
<p>苹果在去年Swift4.1就发布了这个功能，并且WWDC有一个Session专门介绍了这个新特性。</p>
<p><a href="https://docs.swift.org/swift-book/LanguageGuide/Properties.html" target="_blank" rel="external">Swift.org也有详细的说明了，点这里跳转</a></p>
<p>确实对WWDC关注太少了，这么重要信息现在才发现。之前学SwiftUI时候还暗自抱怨怎么Swift Foundation怎么不加入这个呢。看来只是自己太Low了。</p>
<h2 id="功能"><a href="#功能" class="headerlink" title="功能"></a>功能</h2><ul>
<li>通过结构体装饰一个值，包装他的getter和setter</li>
<li>传入初始值</li>
<li>注入一些附加值，支撑当前装饰器完成需要的逻辑，比如限制范围的装饰器，那就需要传入一个范围</li>
<li>多个构造器，让附加值或者当前值都变成可选的</li>
<li>projectedValue，比如前面的限制范围，那么传入的值不合法，这个值就会让调用者可以跟踪传入的合法性了</li>
</ul>
<h2 id="Hello-Swift-Property-Wrappers"><a href="#Hello-Swift-Property-Wrappers" class="headerlink" title="Hello Swift Property Wrappers"></a>Hello Swift Property Wrappers</h2><p>这是一个非常简单的，他的作用就是去除空格。<br>装饰器都是结构体，隐藏一个实际示例变量的私有属性，通过装饰属性来setter和getter。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">@propertyWrapper</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Trimmed</span> </span>&#123;</div><div class="line">    <span class="comment">// 实际值，设置成私有属性，保护起来</span></div><div class="line">    <span class="keyword">private</span>(<span class="keyword">set</span>) <span class="keyword">var</span> value: <span class="type">String</span> = <span class="string">""</span></div><div class="line"></div><div class="line">    <span class="comment">// 装饰属性后的getter和setter方法</span></div><div class="line">    <span class="keyword">var</span> wrappedValue: <span class="type">String</span> &#123;</div><div class="line">        <span class="keyword">get</span> &#123; value &#125;</div><div class="line">        <span class="keyword">set</span> &#123; value = newValue.trimmingCharacters(<span class="keyword">in</span>: .whitespacesAndNewlines) &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// 装饰器的初始化器，可以初始默认值</span></div><div class="line">    <span class="keyword">init</span>(wrappedValue initialValue: <span class="type">String</span>) &#123;</div><div class="line">        <span class="keyword">self</span>.wrappedValue = initialValue</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</div><div class="line">    <span class="comment">//装饰器,因为构造函数有一个参数，所以必须按一下一种方式初始化</span></div><div class="line">    @<span class="type">Trimmed</span>(wrappedValue: <span class="string">"  David "</span>) <span class="keyword">var</span> firstName: <span class="type">String</span></div><div class="line">    @<span class="type">Trimmed</span> <span class="keyword">var</span> lastName: <span class="type">String</span> = <span class="string">"  Woo "</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="如何实现的？"><a href="#如何实现的？" class="headerlink" title="如何实现的？"></a>如何实现的？</h2><p>其实装饰器就是帮你简化了这一大坨代码。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</div><div class="line">    <span class="comment">//装饰器,因为构造函数有一个参数，所以必须按一下一种方式初始化</span></div><div class="line">    @<span class="type">Trimmed</span>(wrappedValue: <span class="string">"  David "</span>) <span class="keyword">var</span> firstName: <span class="type">String</span></div><div class="line">    @<span class="type">Trimmed</span> <span class="keyword">var</span> lastName: <span class="type">String</span> = <span class="string">"  Woo "</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 其实装饰器就是帮你把这balabala这么多代码，简化了</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person2</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">var</span> _firstName = <span class="type">Trimmed</span>(wrappedValue: <span class="string">"  David "</span>)</div><div class="line">    <span class="keyword">private</span> <span class="keyword">var</span> _lastName = <span class="type">Trimmed</span>(wrappedValue: <span class="string">"  Woo "</span>)</div><div class="line">    </div><div class="line">    <span class="keyword">var</span> firstName: <span class="type">String</span> &#123;</div><div class="line">        <span class="keyword">get</span> &#123; <span class="keyword">return</span> _firstName.wrappedValue &#125;</div><div class="line">        <span class="keyword">set</span> &#123; _firstName.wrappedValue = newValue &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">var</span> lastName: <span class="type">String</span> &#123;</div><div class="line">        <span class="keyword">get</span> &#123; <span class="keyword">return</span> _lastName.wrappedValue &#125;</div><div class="line">        <span class="keyword">set</span> &#123; _lastName.wrappedValue = newValue &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="附加属性"><a href="#附加属性" class="headerlink" title="附加属性"></a>附加属性</h2><p>在装饰器中传入一个值，让这个值在setter或getter中发光发热</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Folder</span> </span>&#123;</div><div class="line">		<span class="comment">// 文件夹的最大容量不能超过100个子文件</span></div><div class="line">    @<span class="type">SmallNumber</span>(<span class="number">100</span>) <span class="keyword">var</span> capacity: <span class="type">Int</span> = <span class="number">0</span></div><div class="line">&#125;</div><div class="line"></div><div class="line">@propertyWrapper</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">SmallNumber</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">var</span> number: <span class="type">Int</span></div><div class="line">    <span class="comment">// 一个最大值的附加值，装饰的对象不能超过这个值，用他在setter的时候做约束</span></div><div class="line">    <span class="keyword">private</span> <span class="keyword">var</span> maxNumber: <span class="type">Int</span></div><div class="line">    <span class="comment">// 增加了附加值的初始化器</span></div><div class="line">    <span class="keyword">init</span>(wrappedValue value: <span class="type">Int</span>, <span class="number">_</span> maxNumber: <span class="type">Int</span>) &#123;</div><div class="line">        <span class="keyword">self</span>.number = value</div><div class="line">        <span class="keyword">self</span>.maxNumber = maxNumber</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">var</span> wrappedValue: <span class="type">Int</span> &#123;</div><div class="line">        <span class="keyword">get</span> &#123; <span class="keyword">return</span> number &#125;</div><div class="line">        <span class="comment">// 在setter中起作用</span></div><div class="line">        <span class="keyword">set</span> &#123;</div><div class="line">            <span class="keyword">if</span> newValue &gt; maxNumber &#123;</div><div class="line">                number = maxNumber</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                number = newValue</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Folder</span> </span>&#123;</div><div class="line">		<span class="comment">// 文件夹的最大容量不能超过100个子文件</span></div><div class="line">    @<span class="type">SmallNumber</span>(<span class="number">100</span>) <span class="keyword">var</span> capacity: <span class="type">Int</span> = <span class="number">0</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="Projecting-Value"><a href="#Projecting-Value" class="headerlink" title="Projecting Value"></a>Projecting Value</h2><p>计入传入的值合法性，是否被限制或调整了，让调用者可以跟踪到传入的合法性</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Folder</span> </span>&#123;</div><div class="line">    @<span class="type">SmallNumber</span>(<span class="number">100</span>) <span class="keyword">var</span> capacity: <span class="type">Int</span> = <span class="number">0</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">let</span> f = <span class="type">Folder</span>()</div><div class="line">f.capacity = <span class="number">10</span></div><div class="line"><span class="built_in">print</span>(f.$capacity) <span class="comment">// false 正常写入</span></div><div class="line">f.capacity = <span class="number">200</span></div><div class="line"><span class="built_in">print</span>(f.$capacity) <span class="comment">// true 不合法，被修改写入值</span></div><div class="line"></div><div class="line">@propertyWrapper</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">SmallNumber</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">var</span> number: <span class="type">Int</span></div><div class="line">    <span class="keyword">private</span> <span class="keyword">var</span> maxNumber: <span class="type">Int</span></div><div class="line">    <span class="comment">// 合法性属性</span></div><div class="line">    <span class="keyword">var</span> projectedValue: <span class="type">Bool</span></div><div class="line">    <span class="keyword">init</span>(wrappedValue value: <span class="type">Int</span>, <span class="number">_</span> maxNumber: <span class="type">Int</span>) &#123;</div><div class="line">        <span class="keyword">self</span>.number = value</div><div class="line">        <span class="keyword">self</span>.maxNumber = maxNumber</div><div class="line">        <span class="keyword">self</span>.projectedValue = <span class="literal">false</span></div><div class="line">    &#125;</div><div class="line">    <span class="keyword">var</span> wrappedValue: <span class="type">Int</span> &#123;</div><div class="line">        <span class="keyword">get</span> &#123; <span class="keyword">return</span> number &#125;</div><div class="line">        <span class="keyword">set</span> &#123;</div><div class="line">            <span class="keyword">if</span> newValue &gt; maxNumber &#123;</div><div class="line">                number = maxNumber</div><div class="line">                <span class="comment">// 设置输入值是不合法的</span></div><div class="line">                projectedValue = <span class="literal">true</span></div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                number = newValue</div><div class="line">                projectedValue = <span class="literal">false</span></div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="Happy-Ending-With-Testing"><a href="#Happy-Ending-With-Testing" class="headerlink" title="Happy Ending With Testing"></a>Happy Ending With Testing</h2><p>单元测试部分</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">testExample</span><span class="params">()</span></span> &#123;</div><div class="line">        <span class="keyword">var</span> iOSProjectRootFolder = <span class="type">Folder</span>(title: <span class="string">"  Swift Property Wrappers  "</span>, body: <span class="string">"  Body   "</span>)</div><div class="line">        <span class="type">XCTAssertEqual</span>(iOSProjectRootFolder.title, <span class="string">"Swift Property Wrappers"</span>)</div><div class="line"></div><div class="line">        iOSProjectRootFolder.title = <span class="string">"      @propertyWrapper     "</span></div><div class="line">        <span class="type">XCTAssertEqual</span>(iOSProjectRootFolder.title, <span class="string">"@propertyWrapper"</span>)</div><div class="line">        </div><div class="line">        iOSProjectRootFolder.size = <span class="number">10</span></div><div class="line">        <span class="type">XCTAssertEqual</span>(iOSProjectRootFolder.size, <span class="number">10.0</span>)</div><div class="line">        <span class="type">XCTAssertEqual</span>(iOSProjectRootFolder.$size, <span class="literal">false</span>)</div><div class="line">        iOSProjectRootFolder.size = <span class="number">100</span></div><div class="line">        <span class="type">XCTAssertEqual</span>(iOSProjectRootFolder.size, <span class="number">14.0</span>)</div><div class="line">        <span class="type">XCTAssertEqual</span>(iOSProjectRootFolder.$size, <span class="literal">true</span>)</div><div class="line">        </div><div class="line">        iOSProjectRootFolder.capacity = <span class="number">120</span></div><div class="line">        <span class="type">XCTAssertEqual</span>(iOSProjectRootFolder.capacity, <span class="number">100</span>)</div><div class="line">        <span class="type">XCTAssertEqual</span>(iOSProjectRootFolder.$capacity, <span class="literal">true</span>)</div><div class="line">        </div><div class="line">        iOSProjectRootFolder.capacity = <span class="number">20</span></div><div class="line">        <span class="type">XCTAssertEqual</span>(iOSProjectRootFolder.capacity, <span class="number">20</span>)</div><div class="line">        <span class="type">XCTAssertEqual</span>(iOSProjectRootFolder.$capacity, <span class="literal">false</span>)</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>代码部分</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">import Foundation</div><div class="line"></div><div class="line">@propertyWrapper</div><div class="line">struct Trimmed &#123;</div><div class="line">    // 实际值，设置成私有属性，保护起来</div><div class="line">    private(set) var value: String = &quot;&quot;</div><div class="line"></div><div class="line">    // 装饰属性后的getter和setter方法</div><div class="line">    var wrappedValue: String &#123;</div><div class="line">        get &#123; value &#125;</div><div class="line">        set &#123; value = newValue.trimmingCharacters(in: .whitespacesAndNewlines) &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    // 装饰器的初始化器，可以初始默认值</div><div class="line">    init(wrappedValue initialValue: String) &#123;</div><div class="line">        self.wrappedValue = initialValue</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">class Person &#123;</div><div class="line">    //装饰器,因为构造函数有一个参数，所以必须按一下一种方式初始化</div><div class="line">    @Trimmed(wrappedValue: &quot;  David &quot;) var firstName: String</div><div class="line">    @Trimmed var lastName: String = &quot;  Woo &quot;</div><div class="line">&#125;</div><div class="line"></div><div class="line">// 其实装饰器就是帮你把这balabala这么多代码，简化了</div><div class="line">class Person2 &#123;</div><div class="line">    private var _firstName = Trimmed(wrappedValue: &quot;  David &quot;)</div><div class="line">    private var _lastName = Trimmed(wrappedValue: &quot;  Woo &quot;)</div><div class="line">    </div><div class="line">    var firstName: String &#123;</div><div class="line">        get &#123; return _firstName.wrappedValue &#125;</div><div class="line">        set &#123; _firstName.wrappedValue = newValue &#125;</div><div class="line">    &#125;</div><div class="line">    var lastName: String &#123;</div><div class="line">        get &#123; return _lastName.wrappedValue &#125;</div><div class="line">        set &#123; _lastName.wrappedValue = newValue &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">@propertyWrapper</div><div class="line">struct Clamping&lt;Value: Comparable&gt; &#123;</div><div class="line">    var value: Value</div><div class="line">    let range: ClosedRange&lt;Value&gt;</div><div class="line">    var projectedValue: Bool</div><div class="line"></div><div class="line">    init(wrappedValue value: Value, _ range: ClosedRange&lt;Value&gt;) &#123;</div><div class="line">        precondition(range.contains(value))</div><div class="line">        self.value = value</div><div class="line">        self.range = range</div><div class="line">        self.projectedValue = false</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    var wrappedValue: Value &#123;</div><div class="line">        get &#123; value &#125;</div><div class="line">        set &#123;</div><div class="line">            value = min(max(range.lowerBound, newValue), range.upperBound)</div><div class="line">            projectedValue = value != newValue</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">@propertyWrapper</div><div class="line">struct SmallNumber &#123;</div><div class="line">    private var number: Int</div><div class="line">    // 一个最大值的附加值，装饰的对象不能超过这个值，用他在setter的时候做约束</div><div class="line">    private var maxNumber: Int</div><div class="line">    // 合法性属性</div><div class="line">    var projectedValue: Bool</div><div class="line">    // 增加了附加值的初始化器</div><div class="line">    init(wrappedValue value: Int, _ maxNumber: Int) &#123;</div><div class="line">        self.number = value</div><div class="line">        self.maxNumber = maxNumber</div><div class="line">        self.projectedValue = false</div><div class="line">    &#125;</div><div class="line">    var wrappedValue: Int &#123;</div><div class="line">        get &#123; return number &#125;</div><div class="line">        // 在setter中起作用</div><div class="line">        set &#123;</div><div class="line">            if newValue &gt; maxNumber &#123;</div><div class="line">                // 设置输入值是不合法的</div><div class="line">                number = maxNumber</div><div class="line">                projectedValue = true</div><div class="line">            &#125; else &#123;</div><div class="line">                number = newValue</div><div class="line">                projectedValue = false</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">struct Folder &#123;</div><div class="line">    @Trimmed var title: String</div><div class="line">    @Trimmed var body: String</div><div class="line">    </div><div class="line">    @Clamping(0...14) var size: Double = 10.0</div><div class="line">    </div><div class="line">    @SmallNumber(100) var capacity: Int = 0</div><div class="line">&#125;</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2020/05/27/optimize-big-amount-cell-image-load/" itemprop="url">
                  优化无限数量快速滑动情况的Cell Image加载过程
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Veröffentlicht am</span>
            <time itemprop="dateCreated" datetime="2020-05-27T20:49:19+08:00" content="2020-05-27">
              2020-05-27
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="TableView图片加载优化"><a href="#TableView图片加载优化" class="headerlink" title="TableView图片加载优化"></a>TableView图片加载优化</h1><h2 id="Situation"><a href="#Situation" class="headerlink" title="Situation"></a>Situation</h2><p>昨天被位大佬问到当一个TableView有无限多的Cell，当快速滑动时候，如何避免由于加载图片造成的卡顿问题。<br>UITableView算最常用的UIKit控件之一了，苹果已经为它做了很多优化，比如重用池就解决了反复创建Cell造成的性能问题。<br>但像iPhone5S上还是无法运行流畅滑动TableView，Cell的离屏渲染、Cell过大、Cell滑动过程大图片加载、业务逻辑阻塞线程等都是造成滑动不流畅的原因。<br>大图片可以考虑把加载图片的block添加到DefaultRunLoopMode上执行，但大佬说的图片较小，需要滑动过程就立即展现，确实很少会有这种情况，因为一般产品设计和交互设计上，都会有分页加载逻辑，不会出现可以让用户疯狂无限滑动情况。</p>
<p>不过这个问题还是可以研究一下的TableView图片加载优化。</p>
<p><a href="https://github.com/yuezaixz/DwOptimizeCellImageLoad/tree/start_project" target="_blank" rel="external">初始工程分支</a></p>
<h3 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h3><ul>
<li>大量图片，url不一致不会被cache命中。</li>
<li>快速滑动卡顿或者滑动结束后图片无法加载，因为中间N张图片正在加载，体验糟糕</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">extension ViewController: UITableViewDelegate, UITableViewDataSource &#123;</div><div class="line">    </div><div class="line">    func tableView(_ tableView: UITableView, heightForRowAt indexPath: IndexPath) -&gt; CGFloat &#123;</div><div class="line">        return 60.0</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    func tableView(_ tableView: UITableView, numberOfRowsInSection section: Int) -&gt; Int &#123;</div><div class="line">        10000</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    func tableView(_ tableView: UITableView, cellForRowAt indexPath: IndexPath) -&gt; UITableViewCell &#123;</div><div class="line">        let cell = tableView.dequeueReusableCell(withIdentifier: ImageTableViewCell.kReuseIdentifier, for: indexPath) as! ImageTableViewCell</div><div class="line">        cell.loadImage(imageUrlStr: imageUrlStrs[indexPath.row % 8] + &quot;?random=&quot; + randomStrUtil.getRandomStringOfLength(length: 10))</div><div class="line">        return cell</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="Task"><a href="#Task" class="headerlink" title="Task"></a>Task</h2><p>可以从几个方面去考虑优化：</p>
<ul>
<li>异步渲染，本案例中不使用这个方式，可以使用AsyncDisplayKit(现在叫Texture)</li>
<li>根据行为区分加载策略，快速滑动时候，只加载内存缓存的图片，因为磁盘加载还需要解码，生成位图，也是耗时操作；滑动或者减速后才正常通过全缓存和网络进行加载</li>
</ul>
<h2 id="Action"><a href="#Action" class="headerlink" title="Action"></a>Action</h2><h3 id="根据滚动的交互，来控制load"><a href="#根据滚动的交互，来控制load" class="headerlink" title="根据滚动的交互，来控制load"></a>根据滚动的交互，来控制load</h3><ul>
<li>finalPureLand为放开拖动时候的区域finalPureLand</li>
<li>刚刚拖拽时:finalPureLand=nil</li>
<li>拖拽完毕的减速过程:速度超过一个常量则finalPureLand=Rect，否则还是nil，finalPureLand有值情况，判断当前界面展现的cell是否在相应范围内，在的话加载内存中图片，没加载到则不加载</li>
<li>减速还未完全停止时再次拖拽:finalPureLand=nil</li>
<li>手势跟随过程中，仍然加载图片</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">extension ViewController: UIScrollViewDelegate &#123;</div><div class="line">    </div><div class="line">    // 刚开始拖动，可以加载图片</div><div class="line">    func scrollViewWillBeginDragging(_ scrollView: UIScrollView) &#123;</div><div class="line">        finalPureLand = nil</div><div class="line">        </div><div class="line">        loadImageIfNeed()</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    // 滚动过程中，如果手势跟随，加载图片</div><div class="line">    func scrollViewDidScroll(_ scrollView: UIScrollView) &#123;</div><div class="line">        if scrollView.isTracking &#123;</div><div class="line">            loadImageIfNeed()</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    // 手势放开，根据速度判断是否要启用内存加载机制</div><div class="line">    func scrollViewWillEndDragging(_ scrollView: UIScrollView, withVelocity velocity: CGPoint, targetContentOffset: UnsafeMutablePointer&lt;CGPoint&gt;) &#123;</div><div class="line">        // 速度低的话，加载，速度快的话，等减速</div><div class="line">        // 1 是个magicNum，DEMO项目不要太注意细节 =。。=</div><div class="line">        if velocity.y &gt; 1 &#123;</div><div class="line">            finalPureLand = CGRect(x: targetContentOffset.pointee.x, y: targetContentOffset.pointee.y, width: scrollView.frame.size.width, height: scrollView.frame.size.height)</div><div class="line">        &#125; else &#123;</div><div class="line">            finalPureLand = nil</div><div class="line">            loadImageIfNeed()</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    // 结束减速，正常加载图片</div><div class="line">    func scrollViewDidEndDecelerating(_ scrollView: UIScrollView) &#123;</div><div class="line">        finalPureLand = nil</div><div class="line">        loadImageIfNeed()</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    func loadImageIfNeed() &#123;</div><div class="line">        for cell in tableView.visibleCells &#123;</div><div class="line">            if let indexPath = tableView.indexPath(for: cell), let imageCell = cell as? ImageTableViewCell &#123;</div><div class="line">                </div><div class="line">                // 制造一些可以在内存中展现的cell</div><div class="line">                let urlStr = indexPath.row / 10 % 5 == 1 ? imageUrlStrs[indexPath.row % 8] : (imageUrlStrs[indexPath.row % 8] + &quot;?random=\(indexPath.row)&quot;)</div><div class="line">                let cellRect = tableView.rectForRow(at: indexPath)</div><div class="line">                imageCell.loadImage(imageUrlStr: urlStr, landRect: finalPureLand, cellFrame: cellRect)</div><div class="line">            &#125;</div><div class="line">            </div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="磁盘加载机制"><a href="#磁盘加载机制" class="headerlink" title="磁盘加载机制"></a>磁盘加载机制</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">func loadImage(imageUrlStr: String, landRect: CGRect?, cellFrame: CGRect) &#123;</div><div class="line">        guard !isLoad else &#123; return &#125;</div><div class="line">        if let landRect = landRect, !landRect.intersects(cellFrame) &#123;</div><div class="line">            // 如果滑动中为减速，则只加载内存中的。</div><div class="line">            // 如果加载硬盘中的，硬盘中的加载后要解析转换成位图，也会造成卡顿</div><div class="line">            if let image = ImageCache.default.retrieveImageInMemoryCache(forKey: imageUrlStr) &#123;</div><div class="line">                isLoad = true</div><div class="line">                avatarImageView.image = image</div><div class="line">            &#125;</div><div class="line">        &#125; else &#123;</div><div class="line">            loadImage(imageUrlStr: imageUrlStr)</div><div class="line">        &#125;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<h2 id="Result"><a href="#Result" class="headerlink" title="Result"></a>Result</h2><p>效果上看起来，比start分支的效果和体验好太多了。<br>本DEMO只是个实例，具体应用还需要进一步优化，并且需要通过TableView和ImageView的扩展或者继承来实现，达到组件复用。</p>
<p><a href="https://github.com/yuezaixz/DwOptimizeCellImageLoad" target="_blank" rel="external">源码地址</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2020/05/17/stupid-man-s-Greedy-algo/" itemprop="url">
                  学渣的贪婪算法
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Veröffentlicht am</span>
            <time itemprop="dateCreated" datetime="2020-05-17T22:24:39+08:00" content="2020-05-17">
              2020-05-17
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="学渣的贪婪算法"><a href="#学渣的贪婪算法" class="headerlink" title="学渣的贪婪算法"></a>学渣的贪婪算法</h1><p>贪婪算法是寻找最优解的常用算法。<br>一般先要确定每一步贪婪的逻辑是什么，也就是在当前状态下最好/最优的选择判断方式，并以此希望最后推导出来的结果是最好的。</p>
<h2 id="沟通交流"><a href="#沟通交流" class="headerlink" title="沟通交流"></a>沟通交流</h2><p>mail: xiao303178394@gmail.com<br>wechat: xiao303178394</p>
<h2 id="有时候不是最优解"><a href="#有时候不是最优解" class="headerlink" title="有时候不是最优解"></a>有时候不是最优解</h2><p>由于只是贪婪局部利益的最大化，他有时候的结果并不是最优解。</p>
<p>比如这个问题，需要找给顾客41分钱，现在的货币只有 25 分、20分、10 分、5 分和 1 分四种硬币</p>
<p>贪婪算法的话，就是尽可能给更大面额的钱，那么就是 25-&gt;10-&gt;5-&gt;1，但其实20-&gt;20-&gt;1才是最优解。</p>
<h2 id="三步骤"><a href="#三步骤" class="headerlink" title="三步骤"></a>三步骤</h2><ul>
<li>从某个初始解出发，设定好最优策略</li>
<li>采用迭代的过程，当可以向目标前进一步时，就根据局部最优策略，得到一部分解，缩小问题规模；</li>
<li>将所有解综合起来。</li>
</ul>
<h2 id="课程问题"><a href="#课程问题" class="headerlink" title="课程问题"></a>课程问题</h2><p>这里有 n 门不同的在线课程，他们按从 1 到 n 编号。每一门课程有一定的持续上课时间（课程时间）t 以及关闭时间第 d 天。一门课要持续学习 t 天直到第 d 天时要完成，你将会从第 1 天开始。</p>
<p>给出 n 个在线课程用 (t, d) 对表示。你的任务是找出最多可以修几门课。</p>
<p><a href="https://leetcode-cn.com/problems/course-schedule-iii" target="_blank" rel="external">直达链接</a></p>
<h3 id="最优策略"><a href="#最优策略" class="headerlink" title="最优策略"></a>最优策略</h3><p>以下是LeetCode官方的最优策略，挺妙的，确实我这脑子想不到：</p>
<blockquote>
<p>如果两门课 (t1, d1) 和 (t2, d2) 满足 d1 &lt;= d2，即后者的结束时间不晚于前者，那么我们先学习前者再学习后者总是最优的。因为如果先学习前者，即需要满足 x + t1 &lt;= d1 且 x + t1 + t2 &lt;= d2；如果先学习后者，则需要满足 x + t2 &lt;= d2 且 x + t1 + t2 &lt;= d1。如果后者中的 x + t1 + t2 &lt;= d1 成立，那么显然有 x + t1 &lt;= d1 且 x + t1 + t2 &lt;= d1 &lt;= d2，即前者一定成立；反之如果 x = 0, (t1, d1) = (2, 3), (t2, d2) = (5, 100)，那么前者成立且后者不成立。因此先学习前者再学习后者总是最优的。</p>
</blockquote>
<p>基于上面的结论，我们可以将课程按照完成时间 d 递增排序。</p>
<h3 id="回溯调整"><a href="#回溯调整" class="headerlink" title="回溯调整"></a>回溯调整</h3><p>ti与di为当前遍历到的课程开始时间与结束时间</p>
<p>如果当前优先队列中所有课程的时间之和 t 与 ti 之和大于 di，那么找到当前优先队列中课程时间最大的课程 (tj, dj)，如果 tj &gt; ti，则将它移出优先队列，并把 (ti, di) 加入优先队列中。</p>
<h3 id="优化时间复杂度"><a href="#优化时间复杂度" class="headerlink" title="优化时间复杂度"></a>优化时间复杂度</h3><p>因为每次都要调整队列的耗时在长度异常大情况下耗时严重，所以做个小优化，记录下当前的最大时间，只当满足需要替换条件的时候，才做队列排序。</p>
<h3 id="解题"><a href="#解题" class="headerlink" title="解题"></a>解题</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">class Solution &#123;</div><div class="line">    func scheduleCourse(_ courses: [[Int]]) -&gt; Int &#123;</div><div class="line">        let courses = courses.sorted &#123; (c1, c2) -&gt; Bool in</div><div class="line">            if c1[1] == c2[1] &#123;</div><div class="line">                return c1[0] &lt; c2[0]</div><div class="line">            &#125;</div><div class="line">            return c1[1] &lt; c2[1]</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        var sum = 0</div><div class="line">        </div><div class="line">        var queue:[Int] = []</div><div class="line">        // 一个小优化，不然时间达不到要求，每次都要排序</div><div class="line">        var maxCTime: Int = 0</div><div class="line">        </div><div class="line">        for c in courses &#123;</div><div class="line">            if sum + c[0] &lt;= c[1] &#123;</div><div class="line">                sum += c[0]</div><div class="line">                queue.append(c[0])</div><div class="line">                maxCTime = max(c[0], maxCTime)</div><div class="line">            &#125; else &#123;</div><div class="line">                if maxCTime &gt; c[0] &#123;</div><div class="line">                    queue.sort()</div><div class="line">                    sum += c[0] - queue.removeLast()</div><div class="line">                    maxCTime = queue.last ?? 0</div><div class="line">                    queue.append(c[0])</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        return queue.count</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="double-100"><a href="#double-100" class="headerlink" title="double 100%"></a>double 100%</h3><p><img src="http://image.runmaf.com/2020-05-17-15897250256218.jpg" alt=""></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2020/05/11/stupid-man-s-dfs/" itemprop="url">
                  学渣的分治算法
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Veröffentlicht am</span>
            <time itemprop="dateCreated" datetime="2020-05-11T17:25:30+08:00" content="2020-05-11">
              2020-05-11
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="学渣的分治算法"><a href="#学渣的分治算法" class="headerlink" title="学渣的分治算法"></a>学渣的分治算法</h1><p>个人感觉分治算法和区域动规很像，都是把一个大问题拆解成很多小问题。<br>不同的是区域动规是从上往下。<br>而分治算法是从下往上。</p>
<h2 id="一般步骤："><a href="#一般步骤：" class="headerlink" title="一般步骤："></a>一般步骤：</h2><ul>
<li>分解，将问题划分成若干规模较小的同类问题</li>
<li>求解，当子问题足够小，就可以很容易的得到答案</li>
<li>合并，按原问题的要求，将子问题的解逐层合并构成原问题的解</li>
</ul>
<h2 id="二分法"><a href="#二分法" class="headerlink" title="二分法"></a>二分法</h2><p>分治算法所需时间取决于分解后子问题的个数、子问题的复杂度等。<br>而二分法，其划分简单、均匀，是经常采用的一种有效的方法，如二分检索</p>
<h2 id="解题-输出二叉树"><a href="#解题-输出二叉树" class="headerlink" title="解题-输出二叉树"></a>解题-输出二叉树</h2><p>在一个 m*n 的二维字符串数组中输出二叉树，并遵守以下规则：</p>
<ul>
<li>行数 m 应当等于给定二叉树的高度。</li>
<li>列数 n 应当总是奇数。</li>
<li>根节点的值（以字符串格式给出）应当放在可放置的第一行正中间。根节点所在的行与列会将剩余空间划分为两部分（左下部分和右下部分）。你应该将左子树输出在左下部分，右子树输出在右下部分。左下和右下部分应当有相同的大小。即使一个子树为空而另一个非空，你不需要为空的子树输出任何东西，但仍需要为另一个子树留出足够的空间。然而，如果两个子树都为空则不需要为它们留出任何空间。</li>
<li>每个未使用的空间应包含一个空的字符串””。</li>
<li>使用相同的规则输出子树。</li>
</ul>
<p><a href="https://leetcode-cn.com/problems/print-binary-tree" target="_blank" rel="external">直达链接</a></p>
<h3 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h3><p>这道题需要先构建二位数组，所以需要先递归获取到高度，通过高度计算出宽度。<br>然后就可以简单的通过二分搜索来填充这个二位数组了。</p>
<h3 id="解题"><a href="#解题" class="headerlink" title="解题"></a>解题</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TreeNode</span> </span>&#123;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">var</span> val: <span class="type">Int</span></div><div class="line">    <span class="keyword">public</span> <span class="keyword">var</span> <span class="keyword">left</span>: <span class="type">TreeNode</span>?</div><div class="line">    <span class="keyword">public</span> <span class="keyword">var</span> <span class="keyword">right</span>: <span class="type">TreeNode</span>?</div><div class="line">    <span class="keyword">public</span> <span class="keyword">init</span>(<span class="number">_</span> val: <span class="type">Int</span>) &#123;</div><div class="line">        <span class="keyword">self</span>.val = val</div><div class="line">        <span class="keyword">self</span>.<span class="keyword">left</span> = <span class="literal">nil</span></div><div class="line">        <span class="keyword">self</span>.<span class="keyword">right</span> = <span class="literal">nil</span></div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">printTree</span><span class="params">(<span class="number">_</span> root: TreeNode?)</span></span> -&gt; [[<span class="type">String</span>]] &#123;</div><div class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> root = root <span class="keyword">else</span> &#123; <span class="keyword">return</span> [] &#125;</div><div class="line">        <span class="keyword">if</span> root.<span class="keyword">left</span> == <span class="literal">nil</span> &amp;&amp; root.<span class="keyword">right</span> == <span class="literal">nil</span> &#123; <span class="keyword">return</span> [[<span class="type">String</span>(root.val)]] &#125;</div><div class="line">        </div><div class="line">        <span class="keyword">let</span> height = treeHeight(root)</div><div class="line">        <span class="keyword">let</span> width = <span class="number">2</span> &lt;&lt; (height - <span class="number">1</span>) - <span class="number">1</span></div><div class="line">        <span class="built_in">print</span>(height, width)</div><div class="line">        </div><div class="line">        <span class="keyword">var</span> result = <span class="type">Array</span>(repeating: <span class="type">Array</span>(repeating: <span class="string">""</span>, <span class="built_in">count</span>: width), <span class="built_in">count</span>: height)</div><div class="line">        </div><div class="line">        dfs(root, result: &amp;result, start: <span class="number">0</span>, end: width - <span class="number">1</span>, deep: <span class="number">0</span>)</div><div class="line">        </div><div class="line">        <span class="keyword">return</span> result</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">dfs</span><span class="params">(<span class="number">_</span> root: TreeNode?, result: <span class="keyword">inout</span> [[String]] ,start: Int, end: Int, deep: Int)</span></span> &#123;</div><div class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> root = root <span class="keyword">else</span> &#123; <span class="keyword">return</span> &#125;</div><div class="line">        <span class="keyword">let</span> mid = (start + end) &gt;&gt; <span class="number">1</span></div><div class="line">        <span class="keyword">if</span> <span class="keyword">let</span> <span class="keyword">left</span> = root.<span class="keyword">left</span> &#123;</div><div class="line">            dfs(<span class="keyword">left</span>, result: &amp;result, start: start, end: mid - <span class="number">1</span>, deep: deep + <span class="number">1</span>)</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> <span class="keyword">let</span> <span class="keyword">right</span> = root.<span class="keyword">right</span> &#123;</div><div class="line">            dfs(<span class="keyword">right</span>, result: &amp;result, start: mid + <span class="number">1</span>, end: end, deep: deep + <span class="number">1</span>)</div><div class="line">        &#125;</div><div class="line">        result[deep][mid] = <span class="type">String</span>(root.val)</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">treeHeight</span><span class="params">(<span class="number">_</span> root: TreeNode?)</span></span> -&gt; <span class="type">Int</span> &#123;</div><div class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> root = root <span class="keyword">else</span> &#123; <span class="keyword">return</span> <span class="number">0</span> &#125;</div><div class="line">        <span class="keyword">if</span> root.<span class="keyword">left</span> == <span class="literal">nil</span> &amp;&amp; root.<span class="keyword">right</span> == <span class="literal">nil</span> &#123; <span class="keyword">return</span> <span class="number">1</span> &#125;</div><div class="line">        <span class="keyword">return</span> <span class="built_in">max</span>(treeHeight(root.<span class="keyword">left</span>), treeHeight(root.<span class="keyword">right</span>)) + <span class="number">1</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="double-100"><a href="#double-100" class="headerlink" title="double 100%"></a>double 100%</h3><p><img src="http://image.runmaf.com/2020-05-17-15897074475037.jpg" alt=""></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2020/05/09/stupid-man-s-dfs-bfs/" itemprop="url">
                  学渣的拓扑排序
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Veröffentlicht am</span>
            <time itemprop="dateCreated" datetime="2020-05-09T19:53:43+08:00" content="2020-05-09">
              2020-05-09
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="学渣的拓扑排序"><a href="#学渣的拓扑排序" class="headerlink" title="学渣的拓扑排序"></a>学渣的拓扑排序</h1><p>看了好久的 DFS和BFS题目，还是想不到怎么简单解释清楚拓扑排序。</p>
<p>比较标准的解释就是<br>给定一个包含 n 个节点的有向图 G，我们给出它的节点编号的一种排列，如果满足</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">对于图 G 中的任意一条有向边 (u, v)，u 在排列中都出现在 V 的前面。</div></pre></td></tr></table></figure>
<p>那么称该排列是图 G 的「拓扑排序」。</p>
<p>如果实在理解不了，就记住是一个有向图，但他可以有一些节点独立，他不能存在环。</p>
<h2 id="DFS-深度优先搜索"><a href="#DFS-深度优先搜索" class="headerlink" title="DFS 深度优先搜索"></a>DFS 深度优先搜索</h2><p>如果对二叉树比较熟，那么先序遍历就类似于深度优先搜索。</p>
<p>比如</p>
<table>
<thead>
<tr>
<th>a</th>
<th>→</th>
<th>→</th>
</tr>
</thead>
<tbody>
<tr>
<td>↓</td>
<td>↓</td>
<td>↓</td>
</tr>
<tr>
<td>b</td>
<td>c</td>
<td>d</td>
</tr>
<tr>
<td>↓</td>
<td></td>
<td>↓</td>
</tr>
<tr>
<td>e</td>
<td></td>
<td>f</td>
</tr>
<tr>
<td></td>
<td></td>
<td>↓</td>
</tr>
<tr>
<td></td>
<td></td>
<td>g</td>
</tr>
</tbody>
</table>
<p>那么 a 先放进备忘录memo，备忘录中的元素有3种状态</p>
<ul>
<li>未遍历,记住nil或者0</li>
<li>遍历中,记住1</li>
<li>遍历结束,记住2</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">a 0 b 1 c 2 d 3 e 4 f 5 g 6</div><div class="line">// 先序条件</div><div class="line">edges: [d: [f], b: [e], a: [b, c, d], f: [g]]</div><div class="line"></div><div class="line">// 那么备忘录中的状态变化就是</div><div class="line">遍历a [a: 1] </div><div class="line">找到a的后续节点 b, c, d</div><div class="line">遍历b [b: 1, a: 1]</div><div class="line">找到b的后续节点 e</div><div class="line">遍历e [b: 1, e: 1, a: 1]</div><div class="line">e没有后续节点了，结束标记为2，</div><div class="line">退回到b，b也没有后续节点了，结束标记为2，</div><div class="line">退回到a，遍历a的第二个后续节点c</div><div class="line">遍历c [b: 2, e: 2, a: 1, c: 1]</div><div class="line">c没有后续节点了，结束标记为2，退回到a，继续遍历a的下一个后续节点d</div><div class="line">遍历d [b: 2, e: 2, d: 1, a: 1, c: 2]</div><div class="line">找到d的后续节点 f</div><div class="line">遍历f [b: 2, e: 2, d: 1, 5: 1, a: 1, c: 2]</div><div class="line">找到f的后续节点 g</div><div class="line">遍历g [g: 1, f: 1, e: 2, d: 1, a: 1, b: 2, c: 2]</div><div class="line">g没有后续节点了，结束标记为2，退回到f</div><div class="line">f没有后续节点了，结束标记为2，退回到d</div><div class="line">d没有后续节点了，结束标记为2，退回到a</div><div class="line">a没有后续节点了，结束标记为2，结束</div></pre></td></tr></table></figure>
<p>如果要记录遍历顺序，标记为2的时候，就可以放入results了。<br>由于是深度优先，所以results要reverse下。</p>
<p>如果存在环，那么就会出现要遍历他的时候，他已经是遍历中的状态了，那么这时候就可以直接返回，并标识这不是一个拓扑结构。</p>
<h3 id="例题-课程表"><a href="#例题-课程表" class="headerlink" title="例题-课程表"></a>例题-课程表</h3><p>现在你总共有 n 门课需要选，记为 0 到 n-1。</p>
<p>在选修某些课程之前需要一些先修课程。 例如，想要学习课程 0 ，你需要先完成课程 1 ，我们用一个匹配来表示他们: [0,1]</p>
<p>给定课程总量以及它们的先决条件，返回你为了学完所有课程所安排的学习顺序。</p>
<p>可能会有多个正确的顺序，你只要返回一种就可以了。如果不可能完成所有课程，返回一个空数组。</p>
<p><a href="https://leetcode-cn.com/problems/course-schedule-ii" target="_blank" rel="external">直达链接</a></p>
<h4 id="解题"><a href="#解题" class="headerlink" title="解题"></a>解题</h4><p>前面分析很多了，直接上源码吧</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">findOrder</span><span class="params">(<span class="number">_</span> numCourses: Int, <span class="number">_</span> prerequisites: [[Int]])</span></span> -&gt; [<span class="type">Int</span>] &#123;</div><div class="line">        <span class="keyword">var</span> edges: [<span class="type">Int</span>: [<span class="type">Int</span>]] = [:]</div><div class="line"></div><div class="line">        <span class="keyword">for</span> prerequisite <span class="keyword">in</span> prerequisites &#123;</div><div class="line">            edges[prerequisite[<span class="number">1</span>], <span class="keyword">default</span>: []].append(prerequisite[<span class="number">0</span>])</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">var</span> memo: [<span class="type">Int</span>: <span class="type">Int</span>] = [:]</div><div class="line">        <span class="keyword">var</span> isInvalid = <span class="literal">false</span></div><div class="line">        <span class="keyword">var</span> result: [<span class="type">Int</span>] = []</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">func</span> <span class="title">dfs</span><span class="params">(<span class="number">_</span> i: Int)</span></span> &#123;</div><div class="line">            memo[i] = <span class="number">1</span></div><div class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> edges[i] ?? [] &#123;</div><div class="line">                <span class="keyword">if</span> memo[j] == <span class="literal">nil</span> &#123;</div><div class="line">                    dfs(j)</div><div class="line">                    <span class="keyword">if</span> isInvalid &#123; <span class="keyword">return</span> &#125;</div><div class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> memo[j] == <span class="number">1</span> &#123;</div><div class="line">                    isInvalid = <span class="literal">true</span></div><div class="line">                    <span class="keyword">return</span></div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            memo[i] = <span class="number">2</span></div><div class="line">            result.append(i)</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">0</span> ..&lt; numCourses <span class="keyword">where</span> !isInvalid &amp;&amp; memo[i] == <span class="literal">nil</span> &#123;</div><div class="line">            dfs(i)</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">if</span> isInvalid &#123; <span class="keyword">return</span> [] &#125;</div><div class="line"></div><div class="line">        <span class="keyword">return</span> result.reversed()</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="BFS-广度优先搜索"><a href="#BFS-广度优先搜索" class="headerlink" title="BFS 广度优先搜索"></a>BFS 广度优先搜索</h2><p>广度优先遍历，就类似中序遍历，一层一层的往下。</p>
<p>广度优先需要一个先进先出的队列，队列初始是没有先序的节点，遍历这些节点并塞入他们的后续节点（有多个先序，还需要判断是否先序全部都完成了，所以还需要一个counter记录其先序节点的数量），并且查找该节点的后续节点。</p>
<h3 id="题目-课程表"><a href="#题目-课程表" class="headerlink" title="题目-课程表"></a>题目-课程表</h3><p>题目一样</p>
<h4 id="解题-1"><a href="#解题-1" class="headerlink" title="解题"></a>解题</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">findOrder</span><span class="params">(<span class="number">_</span> numCourses: Int, <span class="number">_</span> prerequisites: [[Int]])</span></span> -&gt; [<span class="type">Int</span>] &#123;</div><div class="line">        <span class="keyword">var</span> edges: [<span class="type">Int</span>: [<span class="type">Int</span>]] = [:]</div><div class="line">        <span class="keyword">var</span> counter: [<span class="type">Int</span>: <span class="type">Int</span>] = [:]</div><div class="line"></div><div class="line">        <span class="keyword">for</span> p <span class="keyword">in</span> prerequisites &#123;</div><div class="line">            edges[p[<span class="number">1</span>], <span class="keyword">default</span>: []].append(p[<span class="number">0</span>])</div><div class="line">            counter[p[<span class="number">0</span>], <span class="keyword">default</span>: <span class="number">0</span>] += <span class="number">1</span></div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">var</span> queue: [<span class="type">Int</span>] = []</div><div class="line"></div><div class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">0</span> ..&lt; numCourses &#123;</div><div class="line">            <span class="keyword">if</span> counter[i] == <span class="literal">nil</span> &#123;</div><div class="line">                queue.append(i)</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">var</span> result: [<span class="type">Int</span>] = []</div><div class="line"></div><div class="line">        <span class="keyword">while</span> !queue.isEmpty &#123;</div><div class="line">            <span class="keyword">let</span> num = queue.removeFirst()</div><div class="line">            result.append(num)</div><div class="line"></div><div class="line">            <span class="keyword">for</span> e <span class="keyword">in</span> edges[num] ?? [] &#123;</div><div class="line">                <span class="keyword">if</span> <span class="keyword">let</span> <span class="built_in">count</span> = counter[e] &#123;</div><div class="line">                    <span class="keyword">if</span> <span class="built_in">count</span> == <span class="number">1</span> &#123;</div><div class="line">                        queue.append(e)</div><div class="line">                    &#125; <span class="keyword">else</span> &#123;</div><div class="line">                        counter[e] = <span class="built_in">count</span> - <span class="number">1</span></div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">if</span> result.<span class="built_in">count</span> != numCourses &#123;</div><div class="line">            <span class="keyword">return</span> []</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="keyword">return</span> result</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2020/05/05/stupid-man-s-area-dp/" itemprop="url">
                  学渣的区域动规
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Veröffentlicht am</span>
            <time itemprop="dateCreated" datetime="2020-05-05T11:07:41+08:00" content="2020-05-05">
              2020-05-05
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="学渣的区域动规"><a href="#学渣的区域动规" class="headerlink" title="学渣的区域动规"></a>学渣的区域动规</h1><p>区域动规主要是把一个问题分成具有相同复杂度的小问题，以便从小到大解决问题。</p>
<p>概念比较生硬，直接拿题目来说吧。</p>
<h2 id="沟通交流"><a href="#沟通交流" class="headerlink" title="沟通交流"></a>沟通交流</h2><p>mail: xiao303178394@gmail.com<br>wechat: xiao303178394</p>
<h2 id="青蛙过河"><a href="#青蛙过河" class="headerlink" title="青蛙过河"></a>青蛙过河</h2><p>一只青蛙想要过河。 假定河流被等分为 x 个单元格，并且在每一个单元格内都有可能放有一石子（也有可能没有）。 青蛙可以跳上石头，但是不可以跳入水中。</p>
<p>给定石子的位置列表（用单元格序号升序表示）， 请判定青蛙能否成功过河（即能否在最后一步跳至最后一个石子上）。 开始时， 青蛙默认已站在第一个石子上，并可以假定它第一步只能跳跃一个单位（即只能从单元格1跳至单元格2）。</p>
<p>如果青蛙上一步跳跃了 k 个单位，那么它接下来的跳跃距离只能选择为 k - 1、k 或 k + 1个单位。 另请注意，青蛙只能向前方（终点的方向）跳跃。</p>
<p><a href="https://leetcode-cn.com/problems/frog-jump" target="_blank" rel="external">直达链接：</a></p>
<h3 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h3><p>把问题化解成一堆小问题。</p>
<ul>
<li>能否跳到位置需要为0的石头？可以，跳0步</li>
<li>能否跳到位置为1的石头？上一步跳了0，那么这一步跳0+1,所以可以跳到</li>
<li>能否跳到位置为i的石头？上一步跳到k，跳了j（j可能有几种情况或），那么 stones[i] = (stones[k] + j + 1 ) || (stones[k] + j ) || (stones[k] + j - 1 )成立的话，就可以跳到</li>
<li>…</li>
</ul>
<h3 id="转移方程"><a href="#转移方程" class="headerlink" title="转移方程"></a>转移方程</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">// j in dp[k], i = k + j</div><div class="line">if k in dp and i in dp:</div><div class="line">	dp[i] = Set[所有满足条件的j]</div></pre></td></tr></table></figure>
<h3 id="状态标识"><a href="#状态标识" class="headerlink" title="状态标识"></a>状态标识</h3><p>stones 为输入数列<br>m 为数字的数量</p>
<p>dp是一个Dict<int: set<int="">&gt;的数据结构<br>key是i，i为位置序号<br>value为跳到i的跳跃距离集合，所以dp[i][j]存在则代表可以通过最后一步j的跳远距离，跳跃到序号为i的石头</int:></p>
<p>k标识上一步的位置序号</p>
<h3 id="边界"><a href="#边界" class="headerlink" title="边界"></a>边界</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">dp[0] = Set[0]</div></pre></td></tr></table></figure>
<h3 id="目标"><a href="#目标" class="headerlink" title="目标"></a>目标</h3><p>dp[stones[m - 1]] 非空</p>
<h3 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">canCross</span><span class="params">(<span class="number">_</span> stones: [Int])</span></span> -&gt; <span class="type">Bool</span> &#123;</div><div class="line">        <span class="keyword">let</span> m = stones.<span class="built_in">count</span></div><div class="line">        <span class="keyword">if</span> m &lt;= <span class="number">1</span> &#123;</div><div class="line">            <span class="keyword">return</span> <span class="literal">true</span></div><div class="line">        &#125;</div><div class="line">        <span class="keyword">var</span> dp = <span class="type">Dictionary</span>&lt;<span class="type">Int</span>, <span class="type">Set</span>&lt;<span class="type">Int</span>&gt;&gt;()</div><div class="line">        </div><div class="line">        <span class="keyword">for</span> stone <span class="keyword">in</span> stones &#123;</div><div class="line">            dp[stone] = <span class="type">Set</span>&lt;<span class="type">Int</span>&gt;()</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        dp[stones[<span class="number">0</span>]]?.insert(<span class="number">0</span>)</div><div class="line">        </div><div class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">0</span> ..&lt; m &#123;</div><div class="line">            <span class="keyword">let</span> curr = stones[i]</div><div class="line">            <span class="keyword">let</span> si = dp[curr]!</div><div class="line">            </div><div class="line">            <span class="keyword">for</span> k <span class="keyword">in</span> si &#123;</div><div class="line">                <span class="keyword">for</span> j <span class="keyword">in</span> k - <span class="number">1</span> ... k + <span class="number">1</span> &#123;</div><div class="line">                    <span class="keyword">if</span> dp.keys.<span class="built_in">contains</span>(curr + j) &#123;</div><div class="line">                        dp[curr + j]?.insert(j)</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        <span class="keyword">return</span> !dp[stones[m - <span class="number">1</span>]]!.isEmpty</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="built_in">assert</span>(<span class="type">Solution</span>().canCross([<span class="number">0</span>,<span class="number">1</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">8</span>,<span class="number">12</span>,<span class="number">17</span>]) == <span class="literal">true</span>)</div><div class="line"><span class="built_in">assert</span>(<span class="type">Solution</span>().canCross([<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">11</span>]) == <span class="literal">false</span>)</div><div class="line"><span class="built_in">assert</span>(<span class="type">Solution</span>().canCross([<span class="number">0</span>,<span class="number">2</span>]) == <span class="literal">false</span>)</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/12/">12</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="David Woo" />
          <p class="site-author-name" itemprop="name">David Woo</p>
          <p class="site-description motion-element" itemprop="description"></p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/">
              <span class="site-state-item-count">112</span>
              <span class="site-state-item-name">Artikel</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              
                <span class="site-state-item-count">195</span>
                <span class="site-state-item-name">Kategorien</span>
              
            </div>
          

          
            <div class="site-state-item site-state-tags">
              
                <span class="site-state-item-count">5</span>
                <span class="site-state-item-name">Tags</span>
              
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">David Woo</span>
</div>

<div class="powered-by">
  Erstellt mit  <a class="theme-link" href="https://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  



  




  
  

  

  

  

</body>
</html>
